
> vite-project@0.0.0 test
> vitest --run


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mF:/tes 9/sistem-praktikum-pwa[39m

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mgetLaboranStats[2m > [22m[2mshould return laboran statistics successfully
[22m[39mðŸ”„ Upgrading IndexedDB from v0 to v2
âœ… Created store: kuis
âœ… Created store: kuis_soal
âœ… Created store: kuis_jawaban
âœ… Created store: nilai
âœ… Created store: materi
âœ… Created store: kelas
âœ… Created store: users
âœ… Created store: sync_queue
âœ… Created store: metadata
âœ… Created store: offline_quiz
âœ… Created store: offline_questions
âœ… Created store: offline_answers
âœ… Created store: offline_attempts

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mgetLaboranStats[2m > [22m[2mshould return laboran statistics successfully
[22m[39mâœ… IndexedDB initialized successfully

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts
[22m[39mGoTrueClient@sb-rkyoifqbfcztnhevpnpx-auth-token:1 (2.86.0) 2026-01-14T05:28:09.557Z Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mgetLaboranStats[2m > [22m[2mshould return laboran statistics successfully
[22m[39m[API Cache] MISS: laboran_stats (fetching...)

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mquery[2m > [22m[2mshould fetch all records from a table
[22m[39mðŸ”´ API Error (query:test_table)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mquery[2m > [22m[2mshould fetch all records from a table
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mquery[2m > [22m[2mshould apply select option
[22m[39mðŸ”´ API Error (query:test_table)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mquery[2m > [22m[2mshould apply select option
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mquery[2m > [22m[2mshould apply order option
[22m[39mðŸ”´ API Error (query:test_table)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mquery[2m > [22m[2mshould apply order option
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mquery[2m > [22m[2mshould apply limit option
[22m[39mðŸ”´ API Error (query:test_table)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mquery[2m > [22m[2mshould apply limit option
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mquery[2m > [22m[2mshould apply offset with range
[22m[39mðŸ”´ API Error (query:test_table)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mquery[2m > [22m[2mshould apply offset with range
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mquery[2m > [22m[2mshould throw NotFoundError when throwOnEmpty is true and no data
[22m[39mðŸ”´ API Error (query:test_table)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mquery[2m > [22m[2mshould throw NotFoundError when throwOnEmpty is true and no data
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mgetLaboranStats[2m > [22m[2mshould return laboran statistics successfully
[22m[39m[API Cache] Cached: laboran_stats (TTL: 300000ms)

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mqueryWithFilters[2m > [22m[2mshould apply eq filter
[22m[39mðŸ”´ API Error (queryWithFilters:test_table)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mqueryWithFilters[2m > [22m[2mshould apply eq filter
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mgetLaboranStats[2m > [22m[2mshould handle empty data
[22m[39m[API Cache] HIT: laboran_stats

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mgetLaboranStats[2m > [22m[2mshould handle database errors
[22m[39m[API Cache] HIT: laboran_stats

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mqueryWithFilters[2m > [22m[2mshould apply multiple filters
[22m[39mðŸ”´ API Error (queryWithFilters:test_table)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mqueryWithFilters[2m > [22m[2mshould apply multiple filters
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mqueryWithFilters[2m > [22m[2mshould apply all filter operators
[22m[39mðŸ”´ API Error (queryWithFilters:test_table)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mqueryWithFilters[2m > [22m[2mshould apply all filter operators
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mgetById[2m > [22m[2mshould fetch single record by ID
[22m[39mðŸ”´ API Error (getById:test_table:1)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mgetById[2m > [22m[2mshould fetch single record by ID
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mgetKehadiranStats[2m > [22m[2mshould calculate stats correctly with all statuses
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mgetById[2m > [22m[2mshould throw NotFoundError when record not found
[22m[39mðŸ”´ API Error (getById:test_table:nonexistent)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mgetById[2m > [22m[2mshould throw NotFoundError when record not found
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mgetKehadiranStats[2m > [22m[2mshould return zero stats when no records
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mgetKehadiranStats[2m > [22m[2mshould calculate 100% when all hadir
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mgetKehadiranStats[2m > [22m[2mshould calculate 0% when all alpha
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mgetPaginated[2m > [22m[2mshould return paginated results with metadata
[22m[39mðŸ”´ API Error (getPaginated:test_table)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mgetPaginated[2m > [22m[2mshould return paginated results with metadata
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mgetKehadiranStats[2m > [22m[2mshould handle errors gracefully
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mapprovePeminjaman[2m > [22m[2mshould approve peminjaman and decrease stock
[22m[39mðŸ” DEBUG: checkPermission called: manage:peminjaman

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mapprovePeminjaman[2m > [22m[2mshould fail when stock is insufficient
[22m[39mðŸ” DEBUG: checkPermission called: manage:peminjaman

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mapprovePeminjaman[2m > [22m[2mshould fail when user not authenticated
[22m[39mðŸ” DEBUG: checkPermission called: manage:peminjaman

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mapprovePeminjaman[2m > [22m[2mshould fail when peminjaman not found
[22m[39mðŸ” DEBUG: checkPermission called: manage:peminjaman

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mrejectPeminjaman[2m > [22m[2mshould reject peminjaman with reason
[22m[39mðŸ” DEBUG: checkPermission called: manage:peminjaman

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mrejectPeminjaman[2m > [22m[2mshould fail when user not authenticated
[22m[39mðŸ” DEBUG: checkPermission called: manage:peminjaman

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mgetKehadiranStats[2m > [22m[2mshould round persentase to nearest integer
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mcalculateNilaiKehadiran[2m > [22m[2mshould calculate nilai with hadir only (100)
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mcalculateNilaiKehadiran[2m > [22m[2mshould calculate nilai with hadir only (100)
[22m[39mFailed to calculate nilai kehadiran {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: ServerError: Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache
      at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
      at getKehadiranStats [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:348:11[90m)[39m
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at Module.calculateNilaiKehadiran [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:360:19[90m)[39m
      at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\kehadiran.api.test.ts:372:21
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
    code: [32m'INTERNAL_ERROR'[39m,
    statusCode: [33m500[39m,
    details: {
      hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
      details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m
    },
    timestamp: [32m'2026-01-14T05:28:11.403Z'[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mcalculateNilaiKehadiran[2m > [22m[2mshould calculate nilai with mixed statuses
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mcalculateNilaiKehadiran[2m > [22m[2mshould calculate nilai with mixed statuses
[22m[39mFailed to calculate nilai kehadiran {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: ServerError: Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache
      at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
      at getKehadiranStats [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:348:11[90m)[39m
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at Module.calculateNilaiKehadiran [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:360:19[90m)[39m
      at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\kehadiran.api.test.ts:397:21
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
    code: [32m'INTERNAL_ERROR'[39m,
    statusCode: [33m500[39m,
    details: {
      hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
      details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m
    },
    timestamp: [32m'2026-01-14T05:28:11.467Z'[39m
  }
}

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mgetPaginated[2m > [22m[2mshould calculate correct pagination for last page
[22m[39mðŸ”´ API Error (getPaginated:test_table)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mgetPaginated[2m > [22m[2mshould calculate correct pagination for last page
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mcalculateNilaiKehadiran[2m > [22m[2mshould give 0 nilai for all alpha
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mcalculateNilaiKehadiran[2m > [22m[2mshould give 0 nilai for all alpha
[22m[39mFailed to calculate nilai kehadiran {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: ServerError: Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache
      at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
      at getKehadiranStats [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:348:11[90m)[39m
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at Module.calculateNilaiKehadiran [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:360:19[90m)[39m
      at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\kehadiran.api.test.ts:416:21
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
    code: [32m'INTERNAL_ERROR'[39m,
    statusCode: [33m500[39m,
    details: {
      hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
      details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m
    },
    timestamp: [32m'2026-01-14T05:28:11.535Z'[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mInventaris CRUD[2m > [22m[2mgetInventarisList[2m > [22m[2mshould apply pagination
[22m[39mError fetching inventaris list: { message: [32m'{"'[39m }

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mInventaris CRUD[2m > [22m[2mcreateInventaris[2m > [22m[2mshould create new inventaris
[22m[39mðŸ” DEBUG: checkPermission called: manage:inventaris

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mInventaris CRUD[2m > [22m[2mcreateInventaris[2m > [22m[2mshould handle creation errors
[22m[39mðŸ” DEBUG: checkPermission called: manage:inventaris

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mInventaris CRUD[2m > [22m[2mupdateInventaris[2m > [22m[2mshould update inventaris
[22m[39mðŸ” DEBUG: checkPermission called: manage:inventaris

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mInventaris CRUD[2m > [22m[2mdeleteInventaris[2m > [22m[2mshould delete inventaris when no active borrowings
[22m[39mðŸ” DEBUG: checkPermission called: manage:inventaris

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mInventaris CRUD[2m > [22m[2mdeleteInventaris[2m > [22m[2mshould fail when active borrowings exist
[22m[39mðŸ” DEBUG: checkPermission called: manage:inventaris

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mcalculateNilaiKehadiran[2m > [22m[2mshould return 0 when no records
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mcalculateNilaiKehadiran[2m > [22m[2mshould return 0 when no records
[22m[39mFailed to calculate nilai kehadiran {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: ServerError: Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache
      at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
      at getKehadiranStats [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:348:11[90m)[39m
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at Module.calculateNilaiKehadiran [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:360:19[90m)[39m
      at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\kehadiran.api.test.ts:433:21
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
    code: [32m'INTERNAL_ERROR'[39m,
    statusCode: [33m500[39m,
    details: {
      hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
      details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m
    },
    timestamp: [32m'2026-01-14T05:28:11.610Z'[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mcalculateNilaiKehadiran[2m > [22m[2mshould cap nilai at 100
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mcalculateNilaiKehadiran[2m > [22m[2mshould cap nilai at 100
[22m[39mFailed to calculate nilai kehadiran {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: ServerError: Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache
      at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
      at getKehadiranStats [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:348:11[90m)[39m
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at Module.calculateNilaiKehadiran [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:360:19[90m)[39m
      at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\kehadiran.api.test.ts:453:21
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
    code: [32m'INTERNAL_ERROR'[39m,
    statusCode: [33m500[39m,
    details: {
      hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
      details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m
    },
    timestamp: [32m'2026-01-14T05:28:11.677Z'[39m
  }
}

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mgetPaginated[2m > [22m[2mshould apply sorting
[22m[39mðŸ”´ API Error (getPaginated:test_table)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Query Functions[2m > [22m[2mgetPaginated[2m > [22m[2mshould apply sorting
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2minsert[2m > [22m[2mshould insert single record
[22m[39mðŸ” DEBUG: insert called with table: test_table data: { name: [32m'New Item'[39m }

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mLaboratorium Management[2m > [22m[2mcreateLaboratorium[2m > [22m[2mshould create new laboratorium
[22m[39mðŸ” DEBUG: checkPermission called: manage:laboratorium

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mLaboratorium Management[2m > [22m[2mdeleteLaboratorium[2m > [22m[2mshould delete laboratorium when no related data
[22m[39mðŸ” DEBUG: checkPermission called: manage:laboratorium

[90mstdout[2m | server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mLaboratorium Management[2m > [22m[2mdeleteLaboratorium[2m > [22m[2mshould fail when equipment exists
[22m[39mðŸ” DEBUG: checkPermission called: manage:laboratorium

 [31mâ¯[39m server/src/__tests__/unit/api/laboran.api.test.ts [2m([22m[2m27 tests[22m[2m | [22m[31m23 failed[39m[2m)[22m[33m 2245[2mms[22m[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mgetLaboranStats[2m > [22mshould return laboran statistics successfully[39m[33m 1165[2mms[22m[39m
[31m     â†’ expected { totalLab: 11, â€¦(3) } to deeply equal { totalLab: 5, â€¦(3) }[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mgetLaboranStats[2m > [22mshould handle empty data[39m[32m 5[2mms[22m[39m
[31m     â†’ expected { totalLab: 11, â€¦(3) } to deeply equal { totalLab: +0, â€¦(3) }[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mgetLaboranStats[2m > [22mshould handle database errors[39m[32m 7[2mms[22m[39m
[31m     â†’ promise resolved "{ totalLab: 11, â€¦(3) }" instead of rejecting[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mgetPendingApprovals[2m > [22mshould return pending approval list[39m[32m 164[2mms[22m[39m
[31m     â†’ expected [] to have a length of 1 but got +0[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mgetPendingApprovals[2m > [22mshould handle missing related data gracefully[39m[32m 189[2mms[22m[39m
[31m     â†’ Cannot read properties of undefined (reading 'peminjam_nama')[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mgetPendingApprovals[2m > [22mshould respect limit parameter[39m[32m 73[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ 20 ][90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mgetInventoryAlerts[2m > [22mshould return low stock items[39m[32m 80[2mms[22m[39m
[31m     â†’ expected [] to have a length of 1 but got +0[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mgetInventoryAlerts[2m > [22mshould handle null category as "Umum"[39m[32m 87[2mms[22m[39m
[31m     â†’ Cannot read properties of undefined (reading 'kategori')[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mapprovePeminjaman[2m > [22mshould approve peminjaman and decrease stock[39m[32m 4[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mapprovePeminjaman[2m > [22mshould fail when stock is insufficient[39m[32m 6[2mms[22m[39m
[31m     â†’ expected [Function] to throw error including 'Stok tidak cukup' but got 'User not authenticated'[39m
   [32mâœ“[39m Laboran API[2m > [22mapprovePeminjaman[2m > [22mshould fail when user not authenticated[32m 2[2mms[22m[39m
   [32mâœ“[39m Laboran API[2m > [22mapprovePeminjaman[2m > [22mshould fail when peminjaman not found[32m 2[2mms[22m[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mrejectPeminjaman[2m > [22mshould reject peminjaman with reason[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
   [32mâœ“[39m Laboran API[2m > [22mrejectPeminjaman[2m > [22mshould fail when user not authenticated[32m 1[2mms[22m[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mInventaris CRUD[2m > [22mgetInventarisList[2m > [22mshould return inventaris list with filters[39m[32m 101[2mms[22m[39m
[31m     â†’ expected [ { â€¦(15) }, { â€¦(15) } ] to have a length of 1 but got 2[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mInventaris CRUD[2m > [22mgetInventarisList[2m > [22mshould apply search filter[39m[32m 91[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ Array(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mInventaris CRUD[2m > [22mgetInventarisList[2m > [22mshould apply pagination[39m[32m 81[2mms[22m[39m
[31m     â†’ {"[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mInventaris CRUD[2m > [22mcreateInventaris[2m > [22mshould create new inventaris[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
   [32mâœ“[39m Laboran API[2m > [22mInventaris CRUD[2m > [22mcreateInventaris[2m > [22mshould handle creation errors[32m 2[2mms[22m[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mInventaris CRUD[2m > [22mupdateInventaris[2m > [22mshould update inventaris[39m[32m 4[2mms[22m[39m
[31m     â†’ promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mInventaris CRUD[2m > [22mdeleteInventaris[2m > [22mshould delete inventaris when no active borrowings[39m[32m 2[2mms[22m[39m
[31m     â†’ promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mInventaris CRUD[2m > [22mdeleteInventaris[2m > [22mshould fail when active borrowings exist[39m[32m 3[2mms[22m[39m
[31m     â†’ expected [Function] to throw error including 'Cannot delete inventaris with active â€¦' but got 'User not authenticated'[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mLaboratorium Management[2m > [22mgetLaboratoriumList[2m > [22mshould return laboratorium list[39m[32m 85[2mms[22m[39m
[31m     â†’ expected [ { â€¦(10) }, { â€¦(10) }, â€¦(9) ] to have a length of 1 but got 11[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mLaboratorium Management[2m > [22mgetLaboratoriumList[2m > [22mshould filter by is_active[39m[32m 75[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'is_active', true ][90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mLaboratorium Management[2m > [22mcreateLaboratorium[2m > [22mshould create new laboratorium[39m[32m 2[2mms[22m[39m
[31m     â†’ promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mLaboratorium Management[2m > [22mdeleteLaboratorium[2m > [22mshould delete laboratorium when no related data[39m[32m 2[2mms[22m[39m
[31m     â†’ promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[31m   [31mÃ—[31m Laboran API[2m > [22mLaboratorium Management[2m > [22mdeleteLaboratorium[2m > [22mshould fail when equipment exists[39m[32m 3[2mms[22m[39m
[31m     â†’ expected [Function] to throw error including 'Cannot delete laboratory that has equâ€¦' but got 'User not authenticated'[39m
[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mcalculateNilaiKehadiran[2m > [22m[2mshould return 0 on error
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mcalculateNilaiKehadiran[2m > [22m[2mshould return 0 on error
[22m[39mFailed to calculate nilai kehadiran {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: ServerError: Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache
      at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
      at getKehadiranStats [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:348:11[90m)[39m
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at Module.calculateNilaiKehadiran [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:360:19[90m)[39m
      at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\kehadiran.api.test.ts:472:21
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
    code: [32m'INTERNAL_ERROR'[39m,
    statusCode: [33m500[39m,
    details: {
      hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
      details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m
    },
    timestamp: [32m'2026-01-14T05:28:11.764Z'[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mcalculateNilaiKehadiran[2m > [22m[2mshould round nilai to nearest integer
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mcalculateNilaiKehadiran[2m > [22m[2mshould round nilai to nearest integer
[22m[39mFailed to calculate nilai kehadiran {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: ServerError: Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache
      at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
      at getKehadiranStats [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:348:11[90m)[39m
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at Module.calculateNilaiKehadiran [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:360:19[90m)[39m
      at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\kehadiran.api.test.ts:496:21
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
    code: [32m'INTERNAL_ERROR'[39m,
    statusCode: [33m500[39m,
    details: {
      hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
      details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m
    },
    timestamp: [32m'2026-01-14T05:28:11.830Z'[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2minsert[2m > [22m[2mshould insert single record
[22m[39mâŒ DEBUG: insert error: {
  code: [32m'PGRST205'[39m,
  details: [1mnull[22m,
  hint: [1mnull[22m,
  message: [32m"Could not find the table 'public.test_table' in the schema cache"[39m
}
âŒ DEBUG: insert catch error: ServerError: Could not find the table 'public.test_table' in the schema cache
    at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
    at handleError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:323:12[90m)[39m
    at Module.insert [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\base.api.ts:375:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\base.api.test.ts:368:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  code: [32m'INTERNAL_ERROR'[39m,
  statusCode: [33m500[39m,
  details: { hint: [1mnull[22m, details: [1mnull[22m },
  timestamp: [32m'2026-01-14T05:28:11.839Z'[39m
}
  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2minsert[2m > [22m[2mshould insert single record
[22m[39mðŸ” DEBUG: insert result: {
  result: [1mnull[22m,
  error: {
    code: [32m'PGRST205'[39m,
    details: [1mnull[22m,
    hint: [1mnull[22m,
    message: [32m"Could not find the table 'public.test_table' in the schema cache"[39m
  }
}
ðŸ”´ API Error (insert:test_table)

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2minsert[2m > [22m[2mshould throw error when insert fails
[22m[39mðŸ” DEBUG: insert called with table: test_table data: { name: [32m'New Item'[39m }

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2minsert[2m > [22m[2mshould throw error when insert fails
[22m[39mâŒ DEBUG: insert error: {
  code: [32m'PGRST205'[39m,
  details: [1mnull[22m,
  hint: [1mnull[22m,
  message: [32m"Could not find the table 'public.test_table' in the schema cache"[39m
}
âŒ DEBUG: insert catch error: ServerError: Could not find the table 'public.test_table' in the schema cache
    at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
    at handleError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:323:12[90m)[39m
    at Module.insert [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\base.api.ts:375:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\base.api.test.ts:383:7
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  code: [32m'INTERNAL_ERROR'[39m,
  statusCode: [33m500[39m,
  details: { hint: [1mnull[22m, details: [1mnull[22m },
  timestamp: [32m'2026-01-14T05:28:11.909Z'[39m
}
  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2minsert[2m > [22m[2mshould throw error when insert fails
[22m[39mðŸ” DEBUG: insert result: {
  result: [1mnull[22m,
  error: {
    code: [32m'PGRST205'[39m,
    details: [1mnull[22m,
    hint: [1mnull[22m,
    message: [32m"Could not find the table 'public.test_table' in the schema cache"[39m
  }
}
ðŸ”´ API Error (insert:test_table)

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2minsertMany[2m > [22m[2mshould insert multiple records
[22m[39mðŸ”´ API Error (insertMany:test_table)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2minsertMany[2m > [22m[2mshould insert multiple records
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2mupdate[2m > [22m[2mshould update record by ID
[22m[39mðŸ”´ API Error (update:test_table:1)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2mupdate[2m > [22m[2mshould update record by ID
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2mupdate[2m > [22m[2mshould throw NotFoundError when record not found
[22m[39mðŸ”´ API Error (update:test_table:nonexistent)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2mupdate[2m > [22m[2mshould throw NotFoundError when record not found
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2mupdateMany[2m > [22m[2mshould update multiple records with filters
[22m[39mðŸ”´ API Error (updateMany:test_table)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2mupdateMany[2m > [22m[2mshould update multiple records with filters
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2mremove[2m > [22m[2mshould delete record by ID
[22m[39mðŸ—‘ï¸ Deleting from test_table where id = 1
ðŸ”§ Using hard delete for test_table

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mEdge Cases & Business Logic Validation[2m > [22m[2mshould handle single attendance record correctly
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mEdge Cases & Business Logic Validation[2m > [22m[2mshould handle single attendance record correctly
[22m[39mFailed to calculate nilai kehadiran {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: ServerError: Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache
      at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
      at getKehadiranStats [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:348:11[90m)[39m
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at Module.calculateNilaiKehadiran [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:360:19[90m)[39m
      at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\kehadiran.api.test.ts:641:21
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
    code: [32m'INTERNAL_ERROR'[39m,
    statusCode: [33m500[39m,
    details: {
      hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
      details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m
    },
    timestamp: [32m'2026-01-14T05:28:12.283Z'[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2mremove[2m > [22m[2mshould delete record by ID
[22m[39mâŒ Delete failed for test_table:1: {
  code: [32m'PGRST205'[39m,
  details: [1mnull[22m,
  hint: [1mnull[22m,
  message: [32m"Could not find the table 'public.test_table' in the schema cache"[39m
}
  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2mremove[2m > [22m[2mshould delete record by ID
[22m[39mðŸ“Š Hard delete result: error=true, count=null
ðŸ”´ API Error (remove:test_table:1)

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mEdge Cases & Business Logic Validation[2m > [22m[2mshould handle all izin correctly (50% nilai)
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mEdge Cases & Business Logic Validation[2m > [22m[2mshould handle all izin correctly (50% nilai)
[22m[39mFailed to calculate nilai kehadiran {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: ServerError: Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache
      at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
      at getKehadiranStats [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:348:11[90m)[39m
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at Module.calculateNilaiKehadiran [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:360:19[90m)[39m
      at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\kehadiran.api.test.ts:660:21
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
    code: [32m'INTERNAL_ERROR'[39m,
    statusCode: [33m500[39m,
    details: {
      hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
      details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m
    },
    timestamp: [32m'2026-01-14T05:28:12.360Z'[39m
  }
}

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2mremoveMany[2m > [22m[2mshould delete multiple records with filters
[22m[39mðŸ”´ API Error (removeMany:test_table)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2mremoveMany[2m > [22m[2mshould delete multiple records with filters
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mEdge Cases & Business Logic Validation[2m > [22m[2mshould handle all sakit correctly (50% nilai)
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mEdge Cases & Business Logic Validation[2m > [22m[2mshould handle all sakit correctly (50% nilai)
[22m[39mFailed to calculate nilai kehadiran {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: ServerError: Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache
      at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
      at getKehadiranStats [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:348:11[90m)[39m
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at Module.calculateNilaiKehadiran [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:360:19[90m)[39m
      at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\kehadiran.api.test.ts:679:21
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
    code: [32m'INTERNAL_ERROR'[39m,
    statusCode: [33m500[39m,
    details: {
      hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
      details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m
    },
    timestamp: [32m'2026-01-14T05:28:12.432Z'[39m
  }
}

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Utility Functions[2m > [22m[2mexists[2m > [22m[2mshould return true when record exists
[22m[39mðŸ”´ API Error (exists:test_table:1)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Utility Functions[2m > [22m[2mexists[2m > [22m[2mshould return true when record exists
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mEdge Cases & Business Logic Validation[2m > [22m[2mshould validate formula with large dataset
[22m[39mFailed to fetch kehadiran stats {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m,
    hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
    message: [32m"Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache"[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22m[2mKehadiran API[2m > [22m[2mEdge Cases & Business Logic Validation[2m > [22m[2mshould validate formula with large dataset
[22m[39mFailed to calculate nilai kehadiran {
  mahasiswaId: [32m'323e4567-e89b-12d3-a456-426614174002'[39m,
  kelasId: [32m'423e4567-e89b-12d3-a456-426614174003'[39m,
  error: ServerError: Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache
      at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
      at getKehadiranStats [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:348:11[90m)[39m
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at Module.calculateNilaiKehadiran [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\kehadiran.api.ts:360:19[90m)[39m
      at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\kehadiran.api.test.ts:705:21
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
    code: [32m'INTERNAL_ERROR'[39m,
    statusCode: [33m500[39m,
    details: {
      hint: [32m"Perhaps you meant 'jadwal_praktikum' instead of 'jadwal'."[39m,
      details: [32m"Searched for a foreign key relationship between 'kehadiran' and 'jadwal' in the schema 'public', but no matches were found."[39m
    },
    timestamp: [32m'2026-01-14T05:28:12.504Z'[39m
  }
}

 [31mâ¯[39m server/src/__tests__/unit/api/kehadiran.api.test.ts [2m([22m[2m30 tests[22m[2m | [22m[31m22 failed[39m[2m)[22m[33m 2876[2mms[22m[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mgetKehadiranByJadwal[2m > [22mshould fetch kehadiran by jadwal_id successfully[39m[33m 380[2mms[22m[39m
[31m     â†’ expected [] to deeply equal [ { â€¦(10) } ][39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mgetKehadiranByJadwal[2m > [22mshould order by mahasiswa NIM ascending[39m[33m 311[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'mahasiswa(nim)', â€¦(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mgetKehadiranByJadwal[2m > [22mshould handle errors gracefully[39m[32m 96[2mms[22m[39m
[31m     â†’ promise resolved "[]" instead of rejecting[39m
   [32mâœ“[39m Kehadiran API[2m > [22mgetKehadiranByJadwal[2m > [22mshould return empty array when no data[32m 93[2mms[22m[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mgetKehadiranByKelas[2m > [22mshould fetch kehadiran by kelas_id successfully[39m[32m 102[2mms[22m[39m
[31m     â†’ expected [] to deeply equal [ { â€¦(10) } ][39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mgetKehadiranByKelas[2m > [22mshould apply date range filters when provided[39m[32m 77[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'jadwal.tanggal_praktikum', â€¦(1) ][90m

Number of calls: [1m0[22m
[31m[39m
   [32mâœ“[39m Kehadiran API[2m > [22mgetKehadiranByKelas[2m > [22mshould work without date filters[32m 84[2mms[22m[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mgetKehadiranByKelas[2m > [22mshould handle errors gracefully[39m[32m 74[2mms[22m[39m
[31m     â†’ promise resolved "[]" instead of rejecting[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mgetKehadiranStats[2m > [22mshould calculate stats correctly with all statuses[39m[32m 97[2mms[22m[39m
[31m     â†’ Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mgetKehadiranStats[2m > [22mshould return zero stats when no records[39m[32m 77[2mms[22m[39m
[31m     â†’ Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mgetKehadiranStats[2m > [22mshould calculate 100% when all hadir[39m[32m 69[2mms[22m[39m
[31m     â†’ Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mgetKehadiranStats[2m > [22mshould calculate 0% when all alpha[39m[32m 70[2mms[22m[39m
[31m     â†’ Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache[39m
   [32mâœ“[39m Kehadiran API[2m > [22mgetKehadiranStats[2m > [22mshould handle errors gracefully[32m 87[2mms[22m[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mgetKehadiranStats[2m > [22mshould round persentase to nearest integer[39m[32m 71[2mms[22m[39m
[31m     â†’ Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mcalculateNilaiKehadiran[2m > [22mshould calculate nilai with hadir only (100)[39m[32m 74[2mms[22m[39m
[31m     â†’ expected +0 to be 100 // Object.is equality[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mcalculateNilaiKehadiran[2m > [22mshould calculate nilai with mixed statuses[39m[32m 63[2mms[22m[39m
[31m     â†’ expected +0 to be 75 // Object.is equality[39m
   [32mâœ“[39m Kehadiran API[2m > [22mcalculateNilaiKehadiran[2m > [22mshould give 0 nilai for all alpha[32m 67[2mms[22m[39m
   [32mâœ“[39m Kehadiran API[2m > [22mcalculateNilaiKehadiran[2m > [22mshould return 0 when no records[32m 74[2mms[22m[39m
   [32mâœ“[39m Kehadiran API[2m > [22mcalculateNilaiKehadiran[2m > [22mshould cap nilai at 100[32m 67[2mms[22m[39m
   [32mâœ“[39m Kehadiran API[2m > [22mcalculateNilaiKehadiran[2m > [22mshould return 0 on error[32m 87[2mms[22m[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mcalculateNilaiKehadiran[2m > [22mshould round nilai to nearest integer[39m[32m 66[2mms[22m[39m
[31m     â†’ expected +0 to be 83 // Object.is equality[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mgetMahasiswaKehadiran[2m > [22mshould fetch mahasiswa kehadiran records successfully[39m[32m 78[2mms[22m[39m
[31m     â†’ expected [] to deeply equal [ { â€¦(5) } ][39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mgetMahasiswaKehadiran[2m > [22mshould limit results to 100[39m[32m 69[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ 100 ][90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mgetMahasiswaKehadiran[2m > [22mshould order by tanggal descending[39m[32m 81[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'jadwal(tanggal_praktikum)', â€¦(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mgetMahasiswaKehadiran[2m > [22mshould handle errors gracefully[39m[32m 69[2mms[22m[39m
[31m     â†’ promise resolved "[]" instead of rejecting[39m
   [32mâœ“[39m Kehadiran API[2m > [22mgetMahasiswaKehadiran[2m > [22mshould return empty array when no data[32m 77[2mms[22m[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mEdge Cases & Business Logic Validation[2m > [22mshould handle single attendance record correctly[39m[32m 79[2mms[22m[39m
[31m     â†’ expected +0 to be 100 // Object.is equality[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mEdge Cases & Business Logic Validation[2m > [22mshould handle all izin correctly (50% nilai)[39m[32m 76[2mms[22m[39m
[31m     â†’ expected +0 to be 50 // Object.is equality[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mEdge Cases & Business Logic Validation[2m > [22mshould handle all sakit correctly (50% nilai)[39m[32m 73[2mms[22m[39m
[31m     â†’ expected +0 to be 50 // Object.is equality[39m
[31m   [31mÃ—[31m Kehadiran API[2m > [22mEdge Cases & Business Logic Validation[2m > [22mshould validate formula with large dataset[39m[32m 71[2mms[22m[39m
[31m     â†’ expected +0 to be 82 // Object.is equality[39m
[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Utility Functions[2m > [22m[2mexists[2m > [22m[2mshould return false when record does not exist
[22m[39mðŸ”´ API Error (exists:test_table:nonexistent)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Utility Functions[2m > [22m[2mexists[2m > [22m[2mshould return false when record does not exist
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Utility Functions[2m > [22m[2mexists[2m > [22m[2mshould return false on error
[22m[39mðŸ”´ API Error (exists:test_table:1)

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Utility Functions[2m > [22m[2mexists[2m > [22m[2mshould return false on error
[22m[39m  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Integration[2m > [22m[2mshould handle complete CRUD workflow
[22m[39mðŸ” DEBUG: insert called with table: test_table data: { name: [32m'Test'[39m }

[90mstderr[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Integration[2m > [22m[2mshould handle complete CRUD workflow
[22m[39mâŒ DEBUG: insert error: {
  code: [32m'PGRST205'[39m,
  details: [1mnull[22m,
  hint: [1mnull[22m,
  message: [32m"Could not find the table 'public.test_table' in the schema cache"[39m
}
âŒ DEBUG: insert catch error: ServerError: Could not find the table 'public.test_table' in the schema cache
    at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
    at handleError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:323:12[90m)[39m
    at Module.insert [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\base.api.ts:375:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\base.api.test.ts:619:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  code: [32m'INTERNAL_ERROR'[39m,
  statusCode: [33m500[39m,
  details: { hint: [1mnull[22m, details: [1mnull[22m },
  timestamp: [32m'2026-01-14T05:28:13.339Z'[39m
}
  Message: Could not find the table 'public.test_table' in the schema cache
  Code: INTERNAL_ERROR
  Status: [33m500[39m
  Details: { hint: [1mnull[22m, details: [1mnull[22m }

[90mstdout[2m | server/src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Integration[2m > [22m[2mshould handle complete CRUD workflow
[22m[39mðŸ” DEBUG: insert result: {
  result: [1mnull[22m,
  error: {
    code: [32m'PGRST205'[39m,
    details: [1mnull[22m,
    hint: [1mnull[22m,
    message: [32m"Could not find the table 'public.test_table' in the schema cache"[39m
  }
}
ðŸ”´ API Error (insert:test_table)

 [31mâ¯[39m server/src/__tests__/unit/api/base.api.test.ts [2m([22m[2m32 tests[22m[2m | [22m[31m26 failed[39m[2m)[22m[33m 4090[2mms[22m[39m
[31m   [31mÃ—[31m Base API - Query Functions[2m > [22mquery[2m > [22mshould fetch all records from a table[39m[33m 819[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - Query Functions[2m > [22mquery[2m > [22mshould apply select option[39m[32m 150[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - Query Functions[2m > [22mquery[2m > [22mshould apply order option[39m[32m 95[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - Query Functions[2m > [22mquery[2m > [22mshould apply limit option[39m[32m 81[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - Query Functions[2m > [22mquery[2m > [22mshould apply offset with range[39m[32m 78[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - Query Functions[2m > [22mquery[2m > [22mshould throw NotFoundError when throwOnEmpty is true and no data[39m[32m 89[2mms[22m[39m
[31m     â†’ expected [Function] to throw error including 'No records found' but got 'Could not find the table \'public.tesâ€¦'[39m
   [32mâœ“[39m Base API - Query Functions[2m > [22mquery[2m > [22mshould return empty array when offline[32m 2[2mms[22m[39m
[31m   [31mÃ—[31m Base API - Query Functions[2m > [22mqueryWithFilters[2m > [22mshould apply eq filter[39m[32m 78[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - Query Functions[2m > [22mqueryWithFilters[2m > [22mshould apply multiple filters[39m[32m 72[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - Query Functions[2m > [22mqueryWithFilters[2m > [22mshould apply all filter operators[39m[32m 90[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - Query Functions[2m > [22mgetById[2m > [22mshould fetch single record by ID[39m[32m 97[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - Query Functions[2m > [22mgetById[2m > [22mshould throw NotFoundError when record not found[39m[32m 128[2mms[22m[39m
[31m     â†’ expected error to be instance of NotFoundError[39m
[31m   [31mÃ—[31m Base API - Query Functions[2m > [22mgetPaginated[2m > [22mshould return paginated results with metadata[39m[32m 220[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - Query Functions[2m > [22mgetPaginated[2m > [22mshould calculate correct pagination for last page[39m[32m 217[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - Query Functions[2m > [22mgetPaginated[2m > [22mshould apply sorting[39m[32m 213[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - CRUD Operations[2m > [22minsert[2m > [22mshould insert single record[39m[32m 154[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - CRUD Operations[2m > [22minsert[2m > [22mshould throw error when insert fails[39m[32m 73[2mms[22m[39m
[31m     â†’ expected [Function] to throw error including 'Insert failed' but got 'Could not find the table \'public.tesâ€¦'[39m
[31m   [31mÃ—[31m Base API - CRUD Operations[2m > [22minsertMany[2m > [22mshould insert multiple records[39m[32m 75[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - CRUD Operations[2m > [22mupdate[2m > [22mshould update record by ID[39m[32m 69[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - CRUD Operations[2m > [22mupdate[2m > [22mshould throw NotFoundError when record not found[39m[32m 93[2mms[22m[39m
[31m     â†’ expected error to be instance of NotFoundError[39m
[31m   [31mÃ—[31m Base API - CRUD Operations[2m > [22mupdateMany[2m > [22mshould update multiple records with filters[39m[32m 69[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - CRUD Operations[2m > [22mremove[2m > [22mshould delete record by ID[39m[32m 68[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - CRUD Operations[2m > [22mremoveMany[2m > [22mshould delete multiple records with filters[39m[32m 75[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[31m   [31mÃ—[31m Base API - Utility Functions[2m > [22mexists[2m > [22mshould return true when record exists[39m[32m 73[2mms[22m[39m
[31m     â†’ expected false to be true // Object.is equality[39m
   [32mâœ“[39m Base API - Utility Functions[2m > [22mexists[2m > [22mshould return false when record does not exist[32m 70[2mms[22m[39m
   [32mâœ“[39m Base API - Utility Functions[2m > [22mexists[2m > [22mshould return false on error[32m 79[2mms[22m[39m
[31m   [31mÃ—[31m Base API - Utility Functions[2m > [22mcount[2m > [22mshould count all records[39m[32m 72[2mms[22m[39m
[31m     â†’ expected +0 to be 42 // Object.is equality[39m
[31m   [31mÃ—[31m Base API - Utility Functions[2m > [22mcount[2m > [22mshould count records with filters[39m[32m 70[2mms[22m[39m
[31m     â†’ expected +0 to be 10 // Object.is equality[39m
   [33m[2mâœ“[22m[39m Base API - Utility Functions[2m > [22mcount[2m > [22mshould return 0 when count is null [33m 405[2mms[22m[39m
   [32mâœ“[39m Base API - Utility Functions[2m > [22mwithApiResponse[2m > [22mshould wrap successful response[32m 2[2mms[22m[39m
   [32mâœ“[39m Base API - Utility Functions[2m > [22mwithApiResponse[2m > [22mshould wrap error response[32m 2[2mms[22m[39m
[31m   [31mÃ—[31m Base API - Integration[2m > [22mshould handle complete CRUD workflow[39m[32m 203[2mms[22m[39m
[31m     â†’ Could not find the table 'public.test_table' in the schema cache[39m
[90mstdout[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Dashboard Stats[2m > [22m[2mgetDosenStats[2m > [22m[2mshould return stats for authenticated dosen
[22m[39mðŸ”„ Upgrading IndexedDB from v0 to v2
âœ… Created store: kuis
âœ… Created store: kuis_soal
âœ… Created store: kuis_jawaban
âœ… Created store: nilai
âœ… Created store: materi
âœ… Created store: kelas
âœ… Created store: users
âœ… Created store: sync_queue
âœ… Created store: metadata
âœ… Created store: offline_quiz
âœ… Created store: offline_questions
âœ… Created store: offline_answers
âœ… Created store: offline_attempts

[90mstdout[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Dashboard Stats[2m > [22m[2mgetDosenStats[2m > [22m[2mshould return stats for authenticated dosen
[22m[39mâœ… IndexedDB initialized successfully

[90mstdout[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Dashboard Stats[2m > [22m[2mgetDosenStats[2m > [22m[2mshould return stats for authenticated dosen
[22m[39m[API Cache] MISS: dosen_stats (fetching...)

[90mstdout[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Dashboard Stats[2m > [22m[2mgetDosenStats[2m > [22m[2mshould return stats for authenticated dosen
[22m[39mðŸ” DEBUG getDosenId: user = [90mundefined[39m
âŒ DEBUG: No authenticated user

[90mstdout[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Dashboard Stats[2m > [22m[2mgetDosenStats[2m > [22m[2mshould return stats for authenticated dosen
[22m[39m[API Cache] Cached: dosen_stats (TTL: 300000ms)

[90mstdout[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Dashboard Stats[2m > [22m[2mgetDosenStats[2m > [22m[2mshould return zero stats when no dosen found
[22m[39m[API Cache] HIT: dosen_stats

[90mstdout[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Dashboard Stats[2m > [22m[2mgetDosenStats[2m > [22m[2mshould handle errors gracefully
[22m[39m[API Cache] HIT: dosen_stats

[90mstdout[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Dashboard Stats[2m > [22m[2mgetDosenStats[2m > [22m[2mshould use cached dosen ID on subsequent calls
[22m[39m[API Cache] HIT: dosen_stats

[90mstdout[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould return kelas with stats for dosen
[22m[39mðŸ” DEBUG getMyKelas: Getting ALL available kelas

[90mstdout[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould return kelas with stats for dosen
[22m[39mâš ï¸ DEBUG: No kelas found in database

[90mstdout[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould apply limit when provided
[22m[39mðŸ” DEBUG getMyKelas: Getting ALL available kelas

[90mstdout[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould apply limit when provided
[22m[39mâš ï¸ DEBUG: No kelas found in database

[90mstdout[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould return empty array when no dosen ID
[22m[39mðŸ” DEBUG getMyKelas: Getting ALL available kelas

[90mstdout[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould return empty array when no dosen ID
[22m[39mâš ï¸ DEBUG: No kelas found in database

[90mstdout[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould handle duplicate kelas correctly
[22m[39mðŸ” DEBUG getMyKelas: Getting ALL available kelas

[90mstderr[2m | server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22m[2mNilai API - CRUD Operations[2m > [22m[2mgetNilaiByKelas[2m > [22m[2mshould get all nilai for a kelas
[22m[39mgetNilaiByKelas error: ServerError: "failed to parse order (mahasiswa(user(full_name)).asc)" (line 1, column 10)
    at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
    at handleError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:323:12[90m)[39m
    at Module.getNilaiByKelas [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\nilai.api.ts:160:22[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\nilai.api.test.ts:230:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  code: [32m'INTERNAL_ERROR'[39m,
  statusCode: [33m500[39m,
  details: {
    hint: [1mnull[22m,
    details: [32m`unexpected '(' expecting letter, digit, "-", "->>", "->", delimiter (.), "," or end of input`[39m
  },
  timestamp: [32m'2026-01-14T05:28:21.799Z'[39m
}

[90mstdout[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould handle duplicate kelas correctly
[22m[39mâš ï¸ DEBUG: No kelas found in database

[90mstderr[2m | server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22m[2mNilai API - CRUD Operations[2m > [22m[2mgetNilaiByKelas[2m > [22m[2mshould return empty array when no nilai found
[22m[39mgetNilaiByKelas error: ServerError: "failed to parse order (mahasiswa(user(full_name)).asc)" (line 1, column 10)
    at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
    at handleError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:323:12[90m)[39m
    at Module.getNilaiByKelas [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\nilai.api.ts:160:22[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\nilai.api.test.ts:244:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  code: [32m'INTERNAL_ERROR'[39m,
  statusCode: [33m500[39m,
  details: {
    hint: [1mnull[22m,
    details: [32m`unexpected '(' expecting letter, digit, "-", "->>", "->", delimiter (.), "," or end of input`[39m
  },
  timestamp: [32m'2026-01-14T05:28:21.897Z'[39m
}

[90mstderr[2m | server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22m[2mNilai API - CRUD Operations[2m > [22m[2mgetNilaiByKelas[2m > [22m[2mshould throw error on database error
[22m[39mgetNilaiByKelas error: ServerError: "failed to parse order (mahasiswa(user(full_name)).asc)" (line 1, column 10)
    at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:284:16[90m)[39m
    at handleError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:323:12[90m)[39m
    at Module.getNilaiByKelas [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\nilai.api.ts:160:22[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\nilai.api.test.ts:254:7
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  code: [32m'INTERNAL_ERROR'[39m,
  statusCode: [33m500[39m,
  details: {
    hint: [1mnull[22m,
    details: [32m`unexpected '(' expecting letter, digit, "-", "->>", "->", delimiter (.), "," or end of input`[39m
  },
  timestamp: [32m'2026-01-14T05:28:21.980Z'[39m
}

[90mstderr[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Student Management[2m > [22m[2mgetKelasStudents[2m > [22m[2mshould return students for a kelas
[22m[39mError fetching kelas students: {
  code: [32m'42703'[39m,
  details: [1mnull[22m,
  hint: [1mnull[22m,
  message: [32m'column users_2.nama does not exist'[39m
}

[90mstderr[2m | server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22m[2mNilai API - CRUD Operations[2m > [22m[2mgetNilaiByMahasiswa[2m > [22m[2mshould get all nilai for a mahasiswa
[22m[39mgetNilaiByMahasiswa error: ValidationError: Invalid data format
    at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:282:16[90m)[39m
    at handleError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:323:12[90m)[39m
    at Module.getNilaiByMahasiswa [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\nilai.api.ts:198:22[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\nilai.api.test.ts:264:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  code: [32m'VALIDATION_ERROR'[39m,
  statusCode: [33m400[39m,
  details: { hint: [1mnull[22m, details: [1mnull[22m },
  timestamp: [32m'2026-01-14T05:28:22.063Z'[39m
}

[90mstderr[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Student Management[2m > [22m[2mgetKelasStudents[2m > [22m[2mshould return empty array when no students
[22m[39mError fetching kelas students: {
  code: [32m'42703'[39m,
  details: [1mnull[22m,
  hint: [1mnull[22m,
  message: [32m'column users_2.nama does not exist'[39m
}

[90mstderr[2m | server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22m[2mNilai API - CRUD Operations[2m > [22m[2mgetNilaiByMahasiswa[2m > [22m[2mshould return empty array when no nilai found
[22m[39mgetNilaiByMahasiswa error: ValidationError: Invalid data format
    at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:282:16[90m)[39m
    at handleError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:323:12[90m)[39m
    at Module.getNilaiByMahasiswa [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\nilai.api.ts:198:22[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\nilai.api.test.ts:279:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  code: [32m'VALIDATION_ERROR'[39m,
  statusCode: [33m400[39m,
  details: { hint: [1mnull[22m, details: [1mnull[22m },
  timestamp: [32m'2026-01-14T05:28:22.141Z'[39m
}

[90mstderr[2m | server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22m[2mNilai API - CRUD Operations[2m > [22m[2mgetNilaiById[2m > [22m[2mshould throw error when nilai not found
[22m[39mgetNilaiById error: Error: Not found
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\nilai.api.test.ts:302:52
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

 [31mâ¯[39m server/src/__tests__/unit/api/reports.api.test.ts [2m([22m[2m7 tests[22m[2m | [22m[31m4 failed[39m[2m)[22m[33m 1140[2mms[22m[39m
[31m   [31mÃ—[31m Reports API[2m > [22mgetBorrowingStats[2m > [22mshould calculate borrowing statistics[39m[33m 447[2mms[22m[39m
[31m     â†’ expected { total_borrowings: +0, â€¦(6) } to have property "total_borrowings" with value 3[39m
[31m   [31mÃ—[31m Reports API[2m > [22mgetEquipmentStats[2m > [22mshould calculate equipment statistics[39m[32m 205[2mms[22m[39m
[31m     â†’ expected { total_items: 2, low_stock: +0, â€¦(4) } to have property "out_of_stock" with value 1[39m
   [32mâœ“[39m Reports API[2m > [22mgetLabUsageStats[2m > [22mshould calculate lab usage statistics[32m 162[2mms[22m[39m
[31m   [31mÃ—[31m Reports API[2m > [22mgetTopBorrowedItems[2m > [22mshould return top borrowed items[39m[32m 89[2mms[22m[39m
[31m     â†’ expected [] to have a length of 1 but got +0[39m
   [32mâœ“[39m Reports API[2m > [22mgetBorrowingTrends[2m > [22mshould return borrowing trends[32m 69[2mms[22m[39m
   [32mâœ“[39m Reports API[2m > [22mgetLabUtilization[2m > [22mshould calculate lab utilization[32m 84[2mms[22m[39m
[31m   [31mÃ—[31m Reports API[2m > [22mgetRecentActivities[2m > [22mshould return recent activities[39m[32m 79[2mms[22m[39m
[31m     â†’ expected [] to have a length of 1 but got +0[39m
[90mstderr[2m | server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Student Management[2m > [22m[2mgetKelasStudents[2m > [22m[2mshould handle database errors gracefully
[22m[39mError fetching kelas students: {
  code: [32m'42703'[39m,
  details: [1mnull[22m,
  hint: [1mnull[22m,
  message: [32m'column users_2.nama does not exist'[39m
}

[90mstderr[2m | server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22m[2mNilai API - Statistics[2m > [22m[2mgetNilaiSummary[2m > [22m[2mshould calculate summary statistics correctly
[22m[39mgetNilaiSummary error: BaseApiError: An unknown error occurred
    at handleError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:339:10[90m)[39m
    at Module.getNilaiSummary [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\nilai.api.ts:538:27[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\nilai.api.test.ts:337:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  code: [32m'UNKNOWN'[39m,
  statusCode: [90mundefined[39m,
  details: { originalError: [32m'[object Object]'[39m },
  timestamp: [32m'2026-01-14T05:28:22.223Z'[39m
}

[90mstderr[2m | server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22m[2mNilai API - Statistics[2m > [22m[2mgetNilaiSummary[2m > [22m[2mshould handle empty nilai data
[22m[39mgetNilaiSummary error: BaseApiError: An unknown error occurred
    at handleError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:339:10[90m)[39m
    at Module.getNilaiSummary [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\nilai.api.ts:538:27[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\nilai.api.test.ts:360:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  code: [32m'UNKNOWN'[39m,
  statusCode: [90mundefined[39m,
  details: { originalError: [32m'[object Object]'[39m },
  timestamp: [32m'2026-01-14T05:28:22.387Z'[39m
}

[90mstderr[2m | server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22m[2mNilai API - Statistics[2m > [22m[2mgetNilaiSummary[2m > [22m[2mshould filter out null nilai_akhir when calculating average
[22m[39mgetNilaiSummary error: BaseApiError: An unknown error occurred
    at handleError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:339:10[90m)[39m
    at Module.getNilaiSummary [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\nilai.api.ts:538:27[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\nilai.api.test.ts:392:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  code: [32m'UNKNOWN'[39m,
  statusCode: [90mundefined[39m,
  details: { originalError: [32m'[object Object]'[39m },
  timestamp: [32m'2026-01-14T05:28:22.534Z'[39m
}

 [31mâ¯[39m server/src/__tests__/unit/api/dosen.api.test.ts [2m([22m[2m19 tests[22m[2m | [22m[31m12 failed[39m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 1549[2mms[22m[39m
[31m   [31mÃ—[31m Dosen API - Dashboard Stats[2m > [22mgetDosenStats[2m > [22mshould return stats for authenticated dosen[39m[32m 79[2mms[22m[39m
[31m     â†’ expected { totalKelas: +0, â€¦(3) } to deeply equal { totalKelas: 5, â€¦(3) }[39m
   [32mâœ“[39m Dosen API - Dashboard Stats[2m > [22mgetDosenStats[2m > [22mshould return zero stats when no dosen found[32m 2[2mms[22m[39m
   [32mâœ“[39m Dosen API - Dashboard Stats[2m > [22mgetDosenStats[2m > [22mshould handle errors gracefully[32m 3[2mms[22m[39m
[31m   [31mÃ—[31m Dosen API - Dashboard Stats[2m > [22mgetDosenStats[2m > [22mshould use cached dosen ID on subsequent calls[39m[32m 13[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'cached_dosen_id', â€¦(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31mÃ—[31m Dosen API - Kelas Management[2m > [22mgetMyKelas[2m > [22mshould return kelas with stats for dosen[39m[33m 342[2mms[22m[39m
[31m     â†’ expected [] to have a length of 1 but got +0[39m
[31m   [31mÃ—[31m Dosen API - Kelas Management[2m > [22mgetMyKelas[2m > [22mshould apply limit when provided[39m[32m 154[2mms[22m[39m
[31m     â†’ expected [] to have a length of 2 but got +0[39m
   [32mâœ“[39m Dosen API - Kelas Management[2m > [22mgetMyKelas[2m > [22mshould return empty array when no dosen ID[32m 77[2mms[22m[39m
[31m   [31mÃ—[31m Dosen API - Kelas Management[2m > [22mgetMyKelas[2m > [22mshould handle duplicate kelas correctly[39m[32m 77[2mms[22m[39m
[31m     â†’ expected [] to have a length of 2 but got +0[39m
[31m   [31mÃ—[31m Dosen API - Kelas Management[2m > [22mgetMyMataKuliah[2m > [22mshould return mata kuliah with aggregated stats[39m[32m 79[2mms[22m[39m
[31m     â†’ expected [] to have a length of 1 but got +0[39m
[31m   [31mÃ—[31m Dosen API - Kelas Management[2m > [22mgetMyMataKuliah[2m > [22mshould apply limit when provided[39m[32m 74[2mms[22m[39m
[31m     â†’ expected [] to have a length of 2 but got +0[39m
[31m   [31mÃ—[31m Dosen API - Student Management[2m > [22mgetKelasStudents[2m > [22mshould return students for a kelas[39m[32m 80[2mms[22m[39m
[31m     â†’ expected [] to have a length of 1 but got +0[39m
   [32mâœ“[39m Dosen API - Student Management[2m > [22mgetKelasStudents[2m > [22mshould return empty array when no students[32m 79[2mms[22m[39m
   [32mâœ“[39m Dosen API - Student Management[2m > [22mgetKelasStudents[2m > [22mshould handle database errors gracefully[32m 74[2mms[22m[39m
   [2m[90mâ†“[39m[22m Dosen API - Student Management[2m > [22mgetStudentStats[2m > [22mshould return aggregated student statistics
   [32mâœ“[39m Dosen API - Student Management[2m > [22mgetStudentStats[2m > [22mshould handle no kelas scenario[32m 95[2mms[22m[39m
[31m   [31mÃ—[31m Dosen API - Grading Operations[2m > [22mgetPendingGrading[2m > [22mshould return pending grading items[39m[32m 76[2mms[22m[39m
[31m     â†’ expected [] to have a length of 1 but got +0[39m
[31m   [31mÃ—[31m Dosen API - Grading Operations[2m > [22mgetPendingGrading[2m > [22mshould apply limit when provided[39m[32m 75[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ 5 ][90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31mÃ—[31m Dosen API - Grading Operations[2m > [22mgetActiveKuis[2m > [22mshould return active quizzes with stats[39m[32m 82[2mms[22m[39m
[31m     â†’ expected [] to have a length of 1 but got +0[39m
[31m   [31mÃ—[31m Dosen API - Grading Operations[2m > [22mgetActiveKuis[2m > [22mshould apply limit when provided[39m[32m 79[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ 10 ][90m

Number of calls: [1m0[22m
[31m[39m
[90mstderr[2m | server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22m[2mNilai API - Statistics[2m > [22m[2mgetNilaiSummary[2m > [22m[2mshould round average to 2 decimal places
[22m[39mgetNilaiSummary error: BaseApiError: An unknown error occurred
    at handleError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:339:10[90m)[39m
    at Module.getNilaiSummary [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\nilai.api.ts:538:27[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\nilai.api.test.ts:414:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  code: [32m'UNKNOWN'[39m,
  statusCode: [90mundefined[39m,
  details: { originalError: [32m'[object Object]'[39m },
  timestamp: [32m'2026-01-14T05:28:22.680Z'[39m
}

[90mstderr[2m | server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22m[2mNilai API - Statistics[2m > [22m[2mgetMahasiswaForGrading[2m > [22m[2mshould return mahasiswa with their nilai
[22m[39mgetMahasiswaForGrading error: ValidationError: Invalid data format
    at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:282:16[90m)[39m
    at handleError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:323:12[90m)[39m
    at Module.getMahasiswaForGrading [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\nilai.api.ts:597:28[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\nilai.api.test.ts:455:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  code: [32m'VALIDATION_ERROR'[39m,
  statusCode: [33m400[39m,
  details: { hint: [1mnull[22m, details: [1mnull[22m },
  timestamp: [32m'2026-01-14T05:28:22.838Z'[39m
}

[90mstderr[2m | server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22m[2mNilai API - Statistics[2m > [22m[2mgetMahasiswaForGrading[2m > [22m[2mshould return mahasiswa with default nilai when not graded yet
[22m[39mgetMahasiswaForGrading error: ValidationError: Invalid data format
    at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:282:16[90m)[39m
    at handleError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:323:12[90m)[39m
    at Module.getMahasiswaForGrading [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\nilai.api.ts:597:28[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\nilai.api.test.ts:491:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  code: [32m'VALIDATION_ERROR'[39m,
  statusCode: [33m400[39m,
  details: { hint: [1mnull[22m, details: [1mnull[22m },
  timestamp: [32m'2026-01-14T05:28:22.917Z'[39m
}

[90mstderr[2m | server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22m[2mNilai API - Statistics[2m > [22m[2mgetMahasiswaForGrading[2m > [22m[2mshould return empty array when no mahasiswa enrolled
[22m[39mgetMahasiswaForGrading error: ValidationError: Invalid data format
    at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:282:16[90m)[39m
    at handleError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:323:12[90m)[39m
    at Module.getMahasiswaForGrading [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\nilai.api.ts:597:28[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\nilai.api.test.ts:507:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  code: [32m'VALIDATION_ERROR'[39m,
  statusCode: [33m400[39m,
  details: { hint: [1mnull[22m, details: [1mnull[22m },
  timestamp: [32m'2026-01-14T05:28:22.989Z'[39m
}

[90mstderr[2m | server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22m[2mNilai API - Statistics[2m > [22m[2mgetMahasiswaForGrading[2m > [22m[2mshould handle multiple mahasiswa with mixed nilai status
[22m[39mgetMahasiswaForGrading error: ValidationError: Invalid data format
    at handleSupabaseError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:282:16[90m)[39m
    at handleError [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\utils\errors.ts:323:12[90m)[39m
    at Module.getMahasiswaForGrading [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\api\nilai.api.ts:597:28[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\nilai.api.test.ts:552:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20 {
  code: [32m'VALIDATION_ERROR'[39m,
  statusCode: [33m400[39m,
  details: { hint: [1mnull[22m, details: [1mnull[22m },
  timestamp: [32m'2026-01-14T05:28:23.067Z'[39m
}

 [31mâ¯[39m server/src/__tests__/unit/api/nilai.api.test.ts [2m([22m[2m20 tests[22m[2m | [22m[31m12 failed[39m[2m)[22m[33m 1608[2mms[22m[39m
   [32mâœ“[39m Nilai API - CRUD Operations[2m > [22mgetNilai[2m > [22mshould get all nilai without filters[32m 11[2mms[22m[39m
   [32mâœ“[39m Nilai API - CRUD Operations[2m > [22mgetNilai[2m > [22mshould get nilai with kelas_id filter[32m 2[2mms[22m[39m
   [32mâœ“[39m Nilai API - CRUD Operations[2m > [22mgetNilai[2m > [22mshould get nilai with mahasiswa_id filter[32m 2[2mms[22m[39m
   [32mâœ“[39m Nilai API - CRUD Operations[2m > [22mgetNilai[2m > [22mshould get nilai with nilai_akhir range filters[32m 1[2mms[22m[39m
   [32mâœ“[39m Nilai API - CRUD Operations[2m > [22mgetNilai[2m > [22mshould get nilai with all filters combined[32m 2[2mms[22m[39m
[31m   [31mÃ—[31m Nilai API - CRUD Operations[2m > [22mgetNilaiByKelas[2m > [22mshould get all nilai for a kelas[39m[33m 331[2mms[22m[39m
[31m     â†’ "failed to parse order (mahasiswa(user(full_name)).asc)" (line 1, column 10)[39m
[31m   [31mÃ—[31m Nilai API - CRUD Operations[2m > [22mgetNilaiByKelas[2m > [22mshould return empty array when no nilai found[39m[32m 83[2mms[22m[39m
[31m     â†’ "failed to parse order (mahasiswa(user(full_name)).asc)" (line 1, column 10)[39m
   [32mâœ“[39m Nilai API - CRUD Operations[2m > [22mgetNilaiByKelas[2m > [22mshould throw error on database error[32m 84[2mms[22m[39m
[31m   [31mÃ—[31m Nilai API - CRUD Operations[2m > [22mgetNilaiByMahasiswa[2m > [22mshould get all nilai for a mahasiswa[39m[32m 81[2mms[22m[39m
[31m     â†’ Invalid data format[39m
[31m   [31mÃ—[31m Nilai API - CRUD Operations[2m > [22mgetNilaiByMahasiswa[2m > [22mshould return empty array when no nilai found[39m[32m 77[2mms[22m[39m
[31m     â†’ Invalid data format[39m
   [32mâœ“[39m Nilai API - CRUD Operations[2m > [22mgetNilaiById[2m > [22mshould get nilai by ID[32m 1[2mms[22m[39m
   [32mâœ“[39m Nilai API - CRUD Operations[2m > [22mgetNilaiById[2m > [22mshould throw error when nilai not found[32m 2[2mms[22m[39m
[31m   [31mÃ—[31m Nilai API - Statistics[2m > [22mgetNilaiSummary[2m > [22mshould calculate summary statistics correctly[39m[32m 80[2mms[22m[39m
[31m     â†’ An unknown error occurred[39m
[31m   [31mÃ—[31m Nilai API - Statistics[2m > [22mgetNilaiSummary[2m > [22mshould handle empty nilai data[39m[32m 164[2mms[22m[39m
[31m     â†’ An unknown error occurred[39m
[31m   [31mÃ—[31m Nilai API - Statistics[2m > [22mgetNilaiSummary[2m > [22mshould filter out null nilai_akhir when calculating average[39m[32m 147[2mms[22m[39m
[31m     â†’ An unknown error occurred[39m
[31m   [31mÃ—[31m Nilai API - Statistics[2m > [22mgetNilaiSummary[2m > [22mshould round average to 2 decimal places[39m[32m 145[2mms[22m[39m
[31m     â†’ An unknown error occurred[39m
[31m   [31mÃ—[31m Nilai API - Statistics[2m > [22mgetMahasiswaForGrading[2m > [22mshould return mahasiswa with their nilai[39m[32m 157[2mms[22m[39m
[31m     â†’ Invalid data format[39m
[31m   [31mÃ—[31m Nilai API - Statistics[2m > [22mgetMahasiswaForGrading[2m > [22mshould return mahasiswa with default nilai when not graded yet[39m[32m 79[2mms[22m[39m
[31m     â†’ Invalid data format[39m
[31m   [31mÃ—[31m Nilai API - Statistics[2m > [22mgetMahasiswaForGrading[2m > [22mshould return empty array when no mahasiswa enrolled[39m[32m 71[2mms[22m[39m
[31m     â†’ Invalid data format[39m
[31m   [31mÃ—[31m Nilai API - Statistics[2m > [22mgetMahasiswaForGrading[2m > [22mshould handle multiple mahasiswa with mixed nilai status[39m[32m 79[2mms[22m[39m
[31m     â†’ Invalid data format[39m
[90mstderr[2m | server/src/__tests__/unit/api/kelas.api.test.ts
[22m[39mGoTrueClient@sb-rkyoifqbfcztnhevpnpx-auth-token:1 (2.86.0) 2026-01-14T05:28:28.334Z Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.

[90mstderr[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - CRUD Operations[2m > [22m[2mgetKelas[2m > [22m[2mshould handle errors gracefully
[22m[39mError fetching kelas: Error: DB Error
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\kelas.api.test.ts:239:53
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - CRUD Operations[2m > [22m[2mgetKelasById[2m > [22m[2mshould handle not found errors
[22m[39mError fetching kelas: Error: Not found
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\api\kelas.api.test.ts:260:44
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - CRUD Operations[2m > [22m[2mcreateKelas[2m > [22m[2mshould create new kelas and return with relations
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - CRUD Operations[2m > [22m[2mcreateKelas[2m > [22m[2mshould handle creation errors
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - CRUD Operations[2m > [22m[2mupdateKelas[2m > [22m[2mshould update kelas and return updated data
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - CRUD Operations[2m > [22m[2mdeleteKelas[2m > [22m[2mshould delete kelas by ID
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas

[90mstderr[2m | server/src/__tests__/unit/api/peminjaman-extensions.test.ts[2m > [22m[2mPeminjaman Extensions API[2m > [22m[2mgetAllPeminjaman[2m > [22m[2mshould fetch all peminjaman with details
[22m[39mFailed to fetch peminjaman {
  params: [90mundefined[39m,
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'peminjaman' and 'mahasiswa' using the hint 'peminjaman_peminjam_id_fkey' in the schema 'public', but no matches were found."[39m,
    hint: [1mnull[22m,
    message: [32m"Could not find a relationship between 'peminjaman' and 'mahasiswa' in the schema cache"[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2mgetEnrolledStudents[2m > [22m[2mshould fetch enrolled students for a kelas
[22m[39mError fetching enrolled students: {
  code: [32m'22P02'[39m,
  details: [1mnull[22m,
  hint: [1mnull[22m,
  message: [32m'invalid input syntax for type uuid: "kelas-1"'[39m
}

[90mstderr[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2mgetEnrolledStudents[2m > [22m[2mshould handle empty enrollment
[22m[39mError fetching enrolled students: {
  code: [32m'22P02'[39m,
  details: [1mnull[22m,
  hint: [1mnull[22m,
  message: [32m'invalid input syntax for type uuid: "kelas-1"'[39m
}

[90mstderr[2m | server/src/__tests__/unit/api/peminjaman-extensions.test.ts[2m > [22m[2mPeminjaman Extensions API[2m > [22m[2mgetAllPeminjaman[2m > [22m[2mshould apply status filter
[22m[39mFailed to fetch peminjaman {
  params: { status: [32m'approved'[39m },
  error: {
    code: [32m'PGRST200'[39m,
    details: [32m"Searched for a foreign key relationship between 'peminjaman' and 'mahasiswa' using the hint 'peminjaman_peminjam_id_fkey' in the schema 'public', but no matches were found."[39m,
    hint: [1mnull[22m,
    message: [32m"Could not find a relationship between 'peminjaman' and 'mahasiswa' in the schema cache"[39m
  }
}

[90mstderr[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2mgetEnrolledStudents[2m > [22m[2mshould handle database errors
[22m[39mError fetching enrolled students: {
  code: [32m'22P02'[39m,
  details: [1mnull[22m,
  hint: [1mnull[22m,
  message: [32m'invalid input syntax for type uuid: "kelas-1"'[39m
}

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2menrollStudent - CRITICAL VALIDATION[2m > [22m[2mshould enroll student successfully when quota available
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas_mahasiswa

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2menrollStudent - CRITICAL VALIDATION[2m > [22m[2mshould reject enrollment when kelas is full
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas_mahasiswa

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2menrollStudent - CRITICAL VALIDATION[2m > [22m[2mshould reject duplicate enrollment
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas_mahasiswa

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2menrollStudent - CRITICAL VALIDATION[2m > [22m[2mshould handle kelas not found
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas_mahasiswa

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2menrollStudent - CRITICAL VALIDATION[2m > [22m[2mshould handle null kuota (unlimited enrollment)
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas_mahasiswa

[90mstderr[2m | server/src/__tests__/unit/api/peminjaman-extensions.test.ts[2m > [22m[2mPeminjaman Extensions API[2m > [22m[2mmarkAsReturned[2m > [22m[2mshould mark peminjaman as returned
[22m[39mFailed to mark peminjaman as returned {
  peminjamanId: [32m'pinjam-1'[39m,
  error: {
    code: [32m'22P02'[39m,
    details: [1mnull[22m,
    hint: [1mnull[22m,
    message: [32m'invalid input syntax for type uuid: "pinjam-1"'[39m
  }
}

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2munenrollStudent[2m > [22m[2mshould remove student from kelas
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas_mahasiswa

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2munenrollStudent[2m > [22m[2mshould handle errors during unenrollment
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas_mahasiswa

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2mtoggleStudentStatus[2m > [22m[2mshould activate student in kelas
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas_mahasiswa

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2mtoggleStudentStatus[2m > [22m[2mshould deactivate student in kelas
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas_mahasiswa

[90mstderr[2m | server/src/__tests__/unit/api/peminjaman-extensions.test.ts[2m > [22m[2mPeminjaman Extensions API[2m > [22m[2mapproveRoomBooking[2m > [22m[2mshould approve room booking
[22m[39mFailed to approve room booking {
  jadwalId: [32m'jadwal-1'[39m,
  error: {
    code: [32m'22P02'[39m,
    details: [1mnull[22m,
    hint: [1mnull[22m,
    message: [32m'invalid input syntax for type uuid: "jadwal-1"'[39m
  }
}

[90mstdout[2m | server/src/__tests__/unit/api/announcements.api.test.ts[2m > [22m[2mAnnouncements API[2m > [22m[2mcreateAnnouncement[2m > [22m[2mshould create announcement
[22m[39mðŸ” DEBUG: checkPermission called: manage:pengumuman

[90mstdout[2m | server/src/__tests__/unit/api/announcements.api.test.ts[2m > [22m[2mAnnouncements API[2m > [22m[2mdeleteAnnouncement[2m > [22m[2mshould delete announcement
[22m[39mðŸ” DEBUG: checkPermission called: manage:pengumuman

[90mstderr[2m | server/src/__tests__/unit/api/peminjaman-extensions.test.ts[2m > [22m[2mPeminjaman Extensions API[2m > [22m[2mrejectRoomBooking[2m > [22m[2mshould reject and delete room booking
[22m[39mFailed to reject room booking {
  jadwalId: [32m'jadwal-1'[39m,
  reason: [32m'Not available'[39m,
  error: {
    code: [32m'22P02'[39m,
    details: [1mnull[22m,
    hint: [1mnull[22m,
    message: [32m'invalid input syntax for type uuid: "jadwal-1"'[39m
  }
}

 [31mâ¯[39m server/src/__tests__/unit/api/peminjaman-extensions.test.ts [2m([22m[2m6 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 1779[2mms[22m[39m
[31m   [31mÃ—[31m Peminjaman Extensions API[2m > [22mgetAllPeminjaman[2m > [22mshould fetch all peminjaman with details[39m[33m 1198[2mms[22m[39m
[31m     â†’ Could not find a relationship between 'peminjaman' and 'mahasiswa' in the schema cache[39m
[31m   [31mÃ—[31m Peminjaman Extensions API[2m > [22mgetAllPeminjaman[2m > [22mshould apply status filter[39m[32m 165[2mms[22m[39m
[31m     â†’ Could not find a relationship between 'peminjaman' and 'mahasiswa' in the schema cache[39m
[31m   [31mÃ—[31m Peminjaman Extensions API[2m > [22mmarkAsReturned[2m > [22mshould mark peminjaman as returned[39m[32m 82[2mms[22m[39m
[31m     â†’ Invalid data format[39m
[31m   [31mÃ—[31m Peminjaman Extensions API[2m > [22mgetPendingRoomBookings[2m > [22mshould fetch pending room bookings[39m[32m 90[2mms[22m[39m
[31m     â†’ expected [] to have a length of 1 but got +0[39m
[31m   [31mÃ—[31m Peminjaman Extensions API[2m > [22mapproveRoomBooking[2m > [22mshould approve room booking[39m[32m 168[2mms[22m[39m
[31m     â†’ Invalid data format[39m
[31m   [31mÃ—[31m Peminjaman Extensions API[2m > [22mrejectRoomBooking[2m > [22mshould reject and delete room booking[39m[32m 69[2mms[22m[39m
[31m     â†’ Invalid data format[39m
[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Management[2m > [22m[2mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22m[2mshould enroll existing mahasiswa to kelas
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas_mahasiswa

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Management[2m > [22m[2mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22m[2mshould create new mahasiswa and enroll
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas_mahasiswa

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Management[2m > [22m[2mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22m[2mshould reject if email already exists
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas_mahasiswa

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Management[2m > [22m[2mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22m[2mshould reject if already enrolled
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas_mahasiswa

[90mstdout[2m | server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Management[2m > [22m[2mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22m[2mshould handle NIM duplicate error
[22m[39mðŸ” DEBUG: checkPermission called: manage:kelas_mahasiswa

 [31mâ¯[39m server/src/__tests__/unit/api/kelas.api.test.ts [2m([22m[2m33 tests[22m[2m | [22m[31m21 failed[39m[2m)[22m[33m 1668[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelas[2m > [22mshould fetch all kelas without filters[32m 15[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelas[2m > [22mshould apply dosen_id filter[32m 2[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelas[2m > [22mshould apply mata_kuliah_id filter[32m 2[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelas[2m > [22mshould apply semester and tahun filters[32m 2[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelas[2m > [22mshould allow filtering inactive kelas[32m 1[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelas[2m > [22mshould default to active kelas only[32m 2[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelas[2m > [22mshould handle errors gracefully[32m 30[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelasById[2m > [22mshould fetch kelas by ID with relations[32m 3[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelasById[2m > [22mshould handle not found errors[32m 7[2mms[22m[39m
[31m   [31mÃ—[31m Kelas API - CRUD Operations[2m > [22mcreateKelas[2m > [22mshould create new kelas and return with relations[39m[32m 10[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Kelas API - CRUD Operations[2m > [22mcreateKelas[2m > [22mshould handle creation errors[39m[32m 23[2mms[22m[39m
[31m     â†’ expected [Function] to throw error including 'Failed to create kelas' but got 'User not authenticated'[39m
[31m   [31mÃ—[31m Kelas API - CRUD Operations[2m > [22mupdateKelas[2m > [22mshould update kelas and return updated data[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Kelas API - CRUD Operations[2m > [22mdeleteKelas[2m > [22mshould delete kelas by ID[39m[32m 3[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Kelas API - Student Enrollment[2m > [22mgetEnrolledStudents[2m > [22mshould fetch enrolled students for a kelas[39m[33m 1013[2mms[22m[39m
[31m     â†’ Failed to fetch enrolled students: invalid input syntax for type uuid: "kelas-1"[39m
[31m   [31mÃ—[31m Kelas API - Student Enrollment[2m > [22mgetEnrolledStudents[2m > [22mshould handle empty enrollment[39m[32m 78[2mms[22m[39m
[31m     â†’ Failed to fetch enrolled students: invalid input syntax for type uuid: "kelas-1"[39m
   [32mâœ“[39m Kelas API - Student Enrollment[2m > [22mgetEnrolledStudents[2m > [22mshould handle database errors[32m 89[2mms[22m[39m
[31m   [31mÃ—[31m Kelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould enroll student successfully when quota available[39m[32m 5[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Kelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould reject enrollment when kelas is full[39m[32m 5[2mms[22m[39m
[31m     â†’ expected [Function] to throw error including 'sudah penuh' but got 'User not authenticated'[39m
[31m   [31mÃ—[31m Kelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould reject duplicate enrollment[39m[32m 4[2mms[22m[39m
[31m     â†’ expected [Function] to throw error including 'sudah terdaftar' but got 'User not authenticated'[39m
[31m   [31mÃ—[31m Kelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould handle kelas not found[39m[32m 3[2mms[22m[39m
[31m     â†’ expected [Function] to throw error including 'tidak ditemukan' but got 'User not authenticated'[39m
[31m   [31mÃ—[31m Kelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould handle null kuota (unlimited enrollment)[39m[32m 4[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Kelas API - Student Enrollment[2m > [22munenrollStudent[2m > [22mshould remove student from kelas[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
   [32mâœ“[39m Kelas API - Student Enrollment[2m > [22munenrollStudent[2m > [22mshould handle errors during unenrollment[32m 2[2mms[22m[39m
[31m   [31mÃ—[31m Kelas API - Student Enrollment[2m > [22mtoggleStudentStatus[2m > [22mshould activate student in kelas[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Kelas API - Student Enrollment[2m > [22mtoggleStudentStatus[2m > [22mshould deactivate student in kelas[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Kelas API - Student Management[2m > [22mgetAllMahasiswa[2m > [22mshould fetch all mahasiswa with user info[39m[32m 79[2mms[22m[39m
[31m     â†’ expected [] to have a length of 1 but got +0[39m
   [32mâœ“[39m Kelas API - Student Management[2m > [22mgetAllMahasiswa[2m > [22mshould return empty array when no mahasiswa[32m 170[2mms[22m[39m
[31m   [31mÃ—[31m Kelas API - Student Management[2m > [22mgetAllMahasiswa[2m > [22mshould handle mahasiswa without users gracefully[39m[32m 83[2mms[22m[39m
[31m     â†’ Cannot read properties of undefined (reading 'users')[39m
[31m   [31mÃ—[31m Kelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould enroll existing mahasiswa to kelas[39m[32m 3[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Kelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould create new mahasiswa and enroll[39m[32m 5[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Kelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould reject if email already exists[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Kelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould reject if already enrolled[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Kelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould handle NIM duplicate error[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
 [31mâ¯[39m server/src/__tests__/unit/api/announcements.api.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 816[2mms[22m[39m
   [33m[2mâœ“[22m[39m Announcements API[2m > [22mgetAllAnnouncements[2m > [22mshould fetch all announcements [33m 652[2mms[22m[39m
   [32mâœ“[39m Announcements API[2m > [22mgetAnnouncementStats[2m > [22mshould calculate stats correctly[32m 98[2mms[22m[39m
[31m   [31mÃ—[31m Announcements API[2m > [22mcreateAnnouncement[2m > [22mshould create announcement[39m[32m 25[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Announcements API[2m > [22mdeleteAnnouncement[2m > [22mshould delete announcement[39m[32m 8[2mms[22m[39m
[31m     â†’ User not authenticated[39m
 [31mâ¯[39m src/__tests__/unit/validations/jadwal.schema.test.ts [2m([22m[2m31 tests[22m[2m | [22m[31m11 failed[39m[2m)[22m[33m 334[2mms[22m[39m
[31m   [31mÃ—[31m Jadwal Schema Validation[2m > [22mjadwalSchema - Valid Cases[2m > [22mshould accept valid jadwal data[39m[32m 113[2mms[22m[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [31mÃ—[31m Jadwal Schema Validation[2m > [22mjadwalSchema - Valid Cases[2m > [22mshould accept kelas with uppercase letters and numbers[39m[32m 13[2mms[22m[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [31mÃ—[31m Jadwal Schema Validation[2m > [22mjadwalSchema - Valid Cases[2m > [22mshould accept minimum duration of 30 minutes[39m[32m 3[2mms[22m[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [31mÃ—[31m Jadwal Schema Validation[2m > [22mjadwalSchema - Valid Cases[2m > [22mshould accept topik with minimum 10 characters[39m[32m 3[2mms[22m[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [31mÃ—[31m Jadwal Schema Validation[2m > [22mjadwalSchema - Valid Cases[2m > [22mshould accept empty topik[39m[32m 3[2mms[22m[39m
[31m     â†’ expected false to be true // Object.is equality[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mjadwalSchema - Invalid Cases[2m > [22mshould reject kelas with lowercase letters[32m 3[2mms[22m[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mjadwalSchema - Invalid Cases[2m > [22mshould reject kelas longer than 10 characters[32m 1[2mms[22m[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mjadwalSchema - Invalid Cases[2m > [22mshould reject invalid UUID for laboratorium_id[32m 2[2mms[22m[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mjadwalSchema - Invalid Cases[2m > [22mshould reject past dates[32m 2[2mms[22m[39m
[31m   [31mÃ—[31m Jadwal Schema Validation[2m > [22mjadwalSchema - Invalid Cases[2m > [22mshould reject invalid time format[39m[32m 55[2mms[22m[39m
[31m     â†’ expected 'Tanggal praktikum tidak boleh di masaâ€¦' to contain 'HH:MM'[39m
[31m   [31mÃ—[31m Jadwal Schema Validation[2m > [22mjadwalSchema - Invalid Cases[2m > [22mshould reject when jam_selesai <= jam_mulai[39m[32m 6[2mms[22m[39m
[31m     â†’ expected 'Tanggal praktikum tidak boleh di masaâ€¦' to contain 'lebih besar'[39m
[31m   [31mÃ—[31m Jadwal Schema Validation[2m > [22mjadwalSchema - Invalid Cases[2m > [22mshould reject duration less than 30 minutes[39m[32m 6[2mms[22m[39m
[31m     â†’ expected 'Tanggal praktikum tidak boleh di masaâ€¦' to contain 'minimal 30 menit'[39m
[31m   [31mÃ—[31m Jadwal Schema Validation[2m > [22mjadwalSchema - Invalid Cases[2m > [22mshould reject topik less than 10 characters when provided[39m[32m 24[2mms[22m[39m
[31m     â†’ expected 'Tanggal praktikum tidak boleh di masaâ€¦' to contain 'minimal 10 karakter'[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mjadwalSchema - Invalid Cases[2m > [22mshould reject topik longer than 200 characters[32m 1[2mms[22m[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mjadwalSchema - Invalid Cases[2m > [22mshould reject catatan longer than 500 characters[32m 1[2mms[22m[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mupdateJadwalSchema[2m > [22mshould accept partial updates[32m 3[2mms[22m[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mupdateJadwalSchema[2m > [22mshould accept empty update[32m 1[2mms[22m[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mjadwalFilterSchema[2m > [22mshould accept valid filters[32m 3[2mms[22m[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mjadwalFilterSchema[2m > [22mshould use default sortBy and sortOrder[32m 2[2mms[22m[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mjadwalFilterSchema[2m > [22mshould reject invalid hari enum[32m 2[2mms[22m[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mjadwalConflictCheckSchema[2m > [22mshould accept valid conflict check data[32m 5[2mms[22m[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mjadwalConflictCheckSchema[2m > [22mshould accept exclude_id for update operations[32m 1[2mms[22m[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mTime Utilities[2m > [22mtimeToMinutes[2m > [22mshould convert time to minutes correctly[32m 1[2mms[22m[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mTime Utilities[2m > [22mcalculateDuration[2m > [22mshould calculate duration correctly[32m 1[2mms[22m[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mTime Utilities[2m > [22mcalculateDuration[2m > [22mshould return negative for invalid order[32m 0[2mms[22m[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mTime Utilities[2m > [22misTimeOverlap[2m > [22mshould detect overlap correctly[32m 1[2mms[22m[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mTime Utilities[2m > [22misTimeOverlap[2m > [22mshould not detect overlap for non-overlapping times[32m 0[2mms[22m[39m
[31m   [31mÃ—[31m Jadwal Schema Validation[2m > [22mHelper Functions[2m > [22mparseCreateJadwalForm[2m > [22mshould parse valid data[39m[32m 60[2mms[22m[39m
[31m     â†’ expected [Function] to not throw an error but '[\n  {\n    "code": "custom",\n    "pâ€¦' was thrown[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mHelper Functions[2m > [22mparseCreateJadwalForm[2m > [22mshould throw on invalid data[32m 4[2mms[22m[39m
[31m   [31mÃ—[31m Jadwal Schema Validation[2m > [22mHelper Functions[2m > [22msafeParseCreateJadwal[2m > [22mshould return success for valid data[39m[32m 3[2mms[22m[39m
[31m     â†’ expected false to be true // Object.is equality[39m
   [32mâœ“[39m Jadwal Schema Validation[2m > [22mHelper Functions[2m > [22msafeParseCreateJadwal[2m > [22mshould return error for invalid data[32m 1[2mms[22m[39m
[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould fetch all users with role-specific data
[22m[39mðŸ” DEBUG: checkPermission called: view:all_users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould map mahasiswa NIM correctly
[22m[39mðŸ” DEBUG: checkPermission called: view:all_users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould map dosen NIP and NIDN correctly
[22m[39mðŸ” DEBUG: checkPermission called: view:all_users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould handle empty users list
[22m[39mðŸ” DEBUG: checkPermission called: view:all_users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould handle null users data
[22m[39mðŸ” DEBUG: checkPermission called: view:all_users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould provide default values for missing data
[22m[39mðŸ” DEBUG: checkPermission called: view:all_users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould handle database errors gracefully
[22m[39mðŸ” DEBUG: checkPermission called: view:all_users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Statistics[2m > [22m[2mgetUserStats[2m > [22m[2mshould calculate user statistics correctly
[22m[39mðŸ” DEBUG: checkPermission called: view:all_users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Statistics[2m > [22m[2mgetUserStats[2m > [22m[2mshould return zero stats when no users
[22m[39mðŸ” DEBUG: checkPermission called: view:all_users

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - CRUD Operations[2m > [22m[2mgetKelas[2m > [22m[2mshould handle errors gracefully
[22m[39mError fetching kelas: Error: DB Error
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:239:53
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Statistics[2m > [22m[2mgetUserStats[2m > [22m[2mshould handle errors and return zero stats
[22m[39mðŸ” DEBUG: checkPermission called: view:all_users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mtoggleUserStatus[2m > [22m[2mshould activate user
[22m[39mðŸ” DEBUG: checkPermission called: manage:users

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - CRUD Operations[2m > [22m[2mgetKelasById[2m > [22m[2mshould handle not found errors
[22m[39mError fetching kelas: Error: Not found
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:260:44
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mtoggleUserStatus[2m > [22m[2mshould deactivate user
[22m[39mðŸ” DEBUG: checkPermission called: manage:users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mtoggleUserStatus[2m > [22m[2mshould handle errors
[22m[39mðŸ” DEBUG: checkPermission called: manage:users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mupdateUser[2m > [22m[2mshould update user data
[22m[39mðŸ” DEBUG: checkPermission called: manage:users

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - CRUD Operations[2m > [22m[2mcreateKelas[2m > [22m[2mshould handle creation errors
[22m[39mError creating kelas: Error: Insert failed
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:292:43
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mupdateUser[2m > [22m[2mshould update user role
[22m[39mðŸ” DEBUG: checkPermission called: manage:users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mcreateUser - COMPLEX FLOW[2m > [22m[2mshould create admin user successfully
[22m[39mðŸ” DEBUG: checkPermission called: manage:users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mcreateUser - COMPLEX FLOW[2m > [22m[2mshould create mahasiswa with role-specific data
[22m[39mðŸ” DEBUG: checkPermission called: manage:users

[90mstdout[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - CRUD Operations[2m > [22m[2mdeleteKelas[2m > [22m[2mshould delete kelas by ID
[22m[39mðŸ—‘ï¸ Attempting to delete kelas with id: kelas-1

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - CRUD Operations[2m > [22m[2mdeleteKelas[2m > [22m[2mshould delete kelas by ID
[22m[39mâŒ Error deleting kelas: TypeError: Cannot read properties of undefined (reading 'select')
    at Module.deleteKelasImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:220:20[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:322:13
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mcreateUser - COMPLEX FLOW[2m > [22m[2mshould create dosen with NIP and NIDN
[22m[39mðŸ” DEBUG: checkPermission called: manage:users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mcreateUser - COMPLEX FLOW[2m > [22m[2mshould handle signup errors
[22m[39mðŸ” DEBUG: checkPermission called: manage:users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mcreateUser - COMPLEX FLOW[2m > [22m[2mshould handle missing user data after signup
[22m[39mðŸ” DEBUG: checkPermission called: manage:users

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2mgetEnrolledStudents[2m > [22m[2mshould handle database errors
[22m[39mError fetching enrolled students: Error: DB Error
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:371:16
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2menrollStudent - CRITICAL VALIDATION[2m > [22m[2mshould enroll student successfully when quota available
[22m[39mError enrolling student: TypeError: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.
    at Module.enrollStudentImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:395:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:415:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2menrollStudent - CRITICAL VALIDATION[2m > [22m[2mshould reject enrollment when kelas is full
[22m[39mError enrolling student: Error: Kelas Kelas A sudah penuh! (30/30 mahasiswa)
    at Module.enrollStudentImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:352:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:438:7
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2menrollStudent - CRITICAL VALIDATION[2m > [22m[2mshould reject duplicate enrollment
[22m[39mError enrolling student: Error: Mahasiswa sudah terdaftar di kelas ini
    at Module.enrollStudentImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:366:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:469:7
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2menrollStudent - CRITICAL VALIDATION[2m > [22m[2mshould handle kelas not found
[22m[39mError enrolling student: Error: Kelas tidak ditemukan
    at Module.enrollStudentImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:334:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete mahasiswa from role table then users table
[22m[39mðŸ” DEBUG: checkPermission called: manage:users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete dosen from role table then users table
[22m[39mðŸ” DEBUG: checkPermission called: manage:users

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete laboran from role table then users table
[22m[39mðŸ” DEBUG: checkPermission called: manage:users

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2menrollStudent - CRITICAL VALIDATION[2m > [22m[2mshould handle null kuota (unlimited enrollment)
[22m[39mError enrolling student: TypeError: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.
    at Module.enrollStudentImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:395:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:516:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould fail if role-specific delete fails
[22m[39mðŸ” DEBUG: checkPermission called: manage:users

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Enrollment[2m > [22m[2munenrollStudent[2m > [22m[2mshould handle errors during unenrollment
[22m[39mError unenrolling student: Error: Delete failed
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:543:37
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstdout[2m | server/src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould handle user not found
[22m[39mðŸ” DEBUG: checkPermission called: manage:users

 [31mâ¯[39m server/src/__tests__/unit/api/users.api.test.ts [2m([22m[2m25 tests[22m[2m | [22m[31m21 failed[39m[2m)[22m[32m 156[2mms[22m[39m
[31m   [31mÃ—[31m Users API - Get All Users[2m > [22mgetAllUsers[2m > [22mshould fetch all users with role-specific data[39m[32m 21[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Users API - Get All Users[2m > [22mgetAllUsers[2m > [22mshould map mahasiswa NIM correctly[39m[32m 3[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Users API - Get All Users[2m > [22mgetAllUsers[2m > [22mshould map dosen NIP and NIDN correctly[39m[32m 3[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Users API - Get All Users[2m > [22mgetAllUsers[2m > [22mshould handle empty users list[39m[32m 3[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Users API - Get All Users[2m > [22mgetAllUsers[2m > [22mshould handle null users data[39m[32m 3[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Users API - Get All Users[2m > [22mgetAllUsers[2m > [22mshould provide default values for missing data[39m[32m 4[2mms[22m[39m
[31m     â†’ User not authenticated[39m
   [32mâœ“[39m Users API - Get All Users[2m > [22mgetAllUsers[2m > [22mshould handle database errors gracefully[32m 7[2mms[22m[39m
[31m   [31mÃ—[31m Users API - Statistics[2m > [22mgetUserStats[2m > [22mshould calculate user statistics correctly[39m[32m 3[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Users API - Statistics[2m > [22mgetUserStats[2m > [22mshould return zero stats when no users[39m[32m 3[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Users API - Statistics[2m > [22mgetUserStats[2m > [22mshould handle errors and return zero stats[39m[32m 4[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Users API - CRUD Operations[2m > [22mtoggleUserStatus[2m > [22mshould activate user[39m[32m 5[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Users API - CRUD Operations[2m > [22mtoggleUserStatus[2m > [22mshould deactivate user[39m[32m 5[2mms[22m[39m
[31m     â†’ User not authenticated[39m
   [32mâœ“[39m Users API - CRUD Operations[2m > [22mtoggleUserStatus[2m > [22mshould handle errors[32m 3[2mms[22m[39m
[31m   [31mÃ—[31m Users API - CRUD Operations[2m > [22mupdateUser[2m > [22mshould update user data[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Users API - CRUD Operations[2m > [22mupdateUser[2m > [22mshould update user role[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Users API - CRUD Operations[2m > [22mcreateUser - COMPLEX FLOW[2m > [22mshould create admin user successfully[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Users API - CRUD Operations[2m > [22mcreateUser - COMPLEX FLOW[2m > [22mshould create mahasiswa with role-specific data[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Users API - CRUD Operations[2m > [22mcreateUser - COMPLEX FLOW[2m > [22mshould create dosen with NIP and NIDN[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
   [32mâœ“[39m Users API - CRUD Operations[2m > [22mcreateUser - COMPLEX FLOW[2m > [22mshould handle signup errors[32m 2[2mms[22m[39m
[31m   [31mÃ—[31m Users API - CRUD Operations[2m > [22mcreateUser - COMPLEX FLOW[2m > [22mshould handle missing user data after signup[39m[32m 36[2mms[22m[39m
[31m     â†’ expected [Function] to throw error including 'Failed to create user' but got 'User not authenticated'[39m
[31m   [31mÃ—[31m Users API - CRUD Operations[2m > [22mdeleteUser - CASCADE DELETE[2m > [22mshould delete mahasiswa from role table then users table[39m[32m 15[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Users API - CRUD Operations[2m > [22mdeleteUser - CASCADE DELETE[2m > [22mshould delete dosen from role table then users table[39m[32m 3[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Users API - CRUD Operations[2m > [22mdeleteUser - CASCADE DELETE[2m > [22mshould delete laboran from role table then users table[39m[32m 4[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Users API - CRUD Operations[2m > [22mdeleteUser - CASCADE DELETE[2m > [22mshould fail if role-specific delete fails[39m[32m 8[2mms[22m[39m
[31m     â†’ expected [Function] to throw error including 'Failed to delete mahasiswa record' but got 'User not authenticated'[39m
   [32mâœ“[39m Users API - CRUD Operations[2m > [22mdeleteUser - CASCADE DELETE[2m > [22mshould handle user not found[32m 3[2mms[22m[39m
[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Management[2m > [22m[2mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22m[2mshould enroll existing mahasiswa to kelas
[22m[39mCould not fetch semester data: TypeError: __vite_ssr_import_1__.supabase.from(...).select(...).eq is not a function
    at enrollStudentImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:376:10[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.createOrEnrollMahasiswaImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:667:5[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:720:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Management[2m > [22m[2mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22m[2mshould enroll existing mahasiswa to kelas
[22m[39mError enrolling student: TypeError: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.
    at enrollStudentImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:395:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.createOrEnrollMahasiswaImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:667:5[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:720:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Management[2m > [22m[2mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22m[2mshould enroll existing mahasiswa to kelas
[22m[39mError creating/enrolling mahasiswa: Error: Failed to enroll student: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.
    at enrollStudentImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:405:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.createOrEnrollMahasiswaImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:667:5[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:720:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Management[2m > [22m[2mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22m[2mshould create new mahasiswa and enroll
[22m[39mCould not fetch semester data: TypeError: __vite_ssr_import_1__.supabase.from(...).select(...).eq is not a function
    at enrollStudentImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:376:10[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.createOrEnrollMahasiswaImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:667:5[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:805:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Management[2m > [22m[2mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22m[2mshould create new mahasiswa and enroll
[22m[39mError enrolling student: TypeError: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.
    at enrollStudentImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:395:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.createOrEnrollMahasiswaImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:667:5[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:805:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Management[2m > [22m[2mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22m[2mshould create new mahasiswa and enroll
[22m[39mError creating/enrolling mahasiswa: Error: Failed to enroll student: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.
    at enrollStudentImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:405:11[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.createOrEnrollMahasiswaImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:667:5[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:805:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Management[2m > [22m[2mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22m[2mshould reject if email already exists
[22m[39mError creating/enrolling mahasiswa: Error: Email existing@example.com sudah terdaftar di sistem. Gunakan email lain atau hubungi admin.
    at Module.createOrEnrollMahasiswaImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:564:15[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:837:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

[90mstderr[2m | src/__tests__/unit/api/kelas.api.test.ts[2m > [22m[2mKelas API - Student Management[2m > [22m[2mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22m[2mshould handle NIM duplicate error
[22m[39mError creating/enrolling mahasiswa: Error: NIM BD2321001 sudah terdaftar di sistem
    at Module.createOrEnrollMahasiswaImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\kelas.api.ts:631:17[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\kelas.api.test.ts:928:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

 [31mâ¯[39m src/__tests__/unit/api/kelas.api.test.ts [2m([22m[2m33 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[32m 214[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelas[2m > [22mshould fetch all kelas without filters[32m 16[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelas[2m > [22mshould apply dosen_id filter[32m 1[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelas[2m > [22mshould apply mata_kuliah_id filter[32m 2[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelas[2m > [22mshould apply semester and tahun filters[32m 2[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelas[2m > [22mshould allow filtering inactive kelas[32m 1[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelas[2m > [22mshould default to active kelas only[32m 3[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelas[2m > [22mshould handle errors gracefully[32m 24[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelasById[2m > [22mshould fetch kelas by ID with relations[32m 1[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mgetKelasById[2m > [22mshould handle not found errors[32m 3[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mcreateKelas[2m > [22mshould create new kelas and return with relations[32m 2[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mcreateKelas[2m > [22mshould handle creation errors[32m 9[2mms[22m[39m
   [32mâœ“[39m Kelas API - CRUD Operations[2m > [22mupdateKelas[2m > [22mshould update kelas and return updated data[32m 2[2mms[22m[39m
[31m   [31mÃ—[31m Kelas API - CRUD Operations[2m > [22mdeleteKelas[2m > [22mshould delete kelas by ID[39m[32m 7[2mms[22m[39m
[31m     â†’ Failed to delete kelas: Cannot read properties of undefined (reading 'select')[39m
   [32mâœ“[39m Kelas API - Student Enrollment[2m > [22mgetEnrolledStudents[2m > [22mshould fetch enrolled students for a kelas[32m 8[2mms[22m[39m
   [32mâœ“[39m Kelas API - Student Enrollment[2m > [22mgetEnrolledStudents[2m > [22mshould handle empty enrollment[32m 1[2mms[22m[39m
   [32mâœ“[39m Kelas API - Student Enrollment[2m > [22mgetEnrolledStudents[2m > [22mshould handle database errors[32m 3[2mms[22m[39m
[31m   [31mÃ—[31m Kelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould enroll student successfully when quota available[39m[32m 9[2mms[22m[39m
[31m     â†’ Failed to enroll student: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
   [32mâœ“[39m Kelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould reject enrollment when kelas is full[32m 3[2mms[22m[39m
   [32mâœ“[39m Kelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould reject duplicate enrollment[32m 4[2mms[22m[39m
   [32mâœ“[39m Kelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould handle kelas not found[32m 3[2mms[22m[39m
[31m   [31mÃ—[31m Kelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould handle null kuota (unlimited enrollment)[39m[32m 29[2mms[22m[39m
[31m     â†’ Failed to enroll student: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
   [32mâœ“[39m Kelas API - Student Enrollment[2m > [22munenrollStudent[2m > [22mshould remove student from kelas[32m 1[2mms[22m[39m
   [32mâœ“[39m Kelas API - Student Enrollment[2m > [22munenrollStudent[2m > [22mshould handle errors during unenrollment[32m 3[2mms[22m[39m
   [32mâœ“[39m Kelas API - Student Enrollment[2m > [22mtoggleStudentStatus[2m > [22mshould activate student in kelas[32m 2[2mms[22m[39m
   [32mâœ“[39m Kelas API - Student Enrollment[2m > [22mtoggleStudentStatus[2m > [22mshould deactivate student in kelas[32m 2[2mms[22m[39m
   [32mâœ“[39m Kelas API - Student Management[2m > [22mgetAllMahasiswa[2m > [22mshould fetch all mahasiswa with user info[32m 5[2mms[22m[39m
   [32mâœ“[39m Kelas API - Student Management[2m > [22mgetAllMahasiswa[2m > [22mshould return empty array when no mahasiswa[32m 12[2mms[22m[39m
   [32mâœ“[39m Kelas API - Student Management[2m > [22mgetAllMahasiswa[2m > [22mshould handle mahasiswa without users gracefully[32m 1[2mms[22m[39m
[31m   [31mÃ—[31m Kelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould enroll existing mahasiswa to kelas[39m[32m 13[2mms[22m[39m
[31m     â†’ expected false to be true // Object.is equality[39m
[31m   [31mÃ—[31m Kelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould create new mahasiswa and enroll[39m[32m 22[2mms[22m[39m
[31m     â†’ expected false to be true // Object.is equality[39m
   [32mâœ“[39m Kelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould reject if email already exists[32m 4[2mms[22m[39m
   [32mâœ“[39m Kelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould reject if already enrolled[32m 2[2mms[22m[39m
   [32mâœ“[39m Kelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould handle NIM duplicate error[32m 5[2mms[22m[39m
[90mstdout[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2minitStorage[2m > [22m[2mshould initialize IndexedDB successfully
[22m[39mStorage systems initialized successfully

[90mstdout[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2minitStorage[2m > [22m[2mshould warn if localStorage is not available
[22m[39mStorage systems initialized successfully

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2minitStorage[2m > [22m[2mshould warn if localStorage is not available
[22m[39mlocalStorage is not available

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2minitStorage[2m > [22m[2mshould handle initialization errors
[22m[39mFailed to initialize storage: Error: Init error
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:155:9
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2mgetItem[2m > [22m[2mwith ID (IndexedDB)[2m > [22m[2mshould handle IndexedDB read errors
[22m[39mFailed to get item users: Error: Read error
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:188:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2mgetItem[2m > [22m[2mwithout ID (localStorage)[2m > [22m[2mshould get JSON object from localStorage
[22m[39mFailed to get item test-key: TypeError: Cannot read properties of undefined (reading 'getItem')
    at Module.getItem [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:56:31[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:206:30
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2mgetItem[2m > [22m[2mwithout ID (localStorage)[2m > [22m[2mshould get string from localStorage
[22m[39mFailed to get item string-key: TypeError: Cannot read properties of undefined (reading 'getItem')
    at Module.getItem [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:56:31[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:215:30
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2mgetItem[2m > [22m[2mwithout ID (localStorage)[2m > [22m[2mshould return undefined when key not found
[22m[39mFailed to get item non-existent: TypeError: Cannot read properties of undefined (reading 'getItem')
    at Module.getItem [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:56:31[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:223:30
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2mgetItem[2m > [22m[2mwithout ID (localStorage)[2m > [22m[2mshould handle invalid JSON gracefully
[22m[39mFailed to get item bad-json: TypeError: Cannot read properties of undefined (reading 'getItem')
    at Module.getItem [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:56:31[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:231:30
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2mgetItem[2m > [22m[2mwithout ID (localStorage)[2m > [22m[2mshould handle localStorage errors
[22m[39mFailed to get item error-key: TypeError: Cannot read properties of undefined (reading 'getItem')
    at Module.getItem [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:56:31[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:242:30
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2msetItem[2m > [22m[2mshould store string in localStorage
[22m[39mFailed to set item string-key: TypeError: Cannot read properties of undefined (reading 'setItem')
    at Module.setItem [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:83:18[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:255:13
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2msetItem[2m > [22m[2mshould serialize and store object in localStorage
[22m[39mFailed to set item object-key: TypeError: Cannot read properties of undefined (reading 'setItem')
    at Module.setItem [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:83:18[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:266:13
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2msetItem[2m > [22m[2mshould serialize and store array in localStorage
[22m[39mFailed to set item array-key: TypeError: Cannot read properties of undefined (reading 'setItem')
    at Module.setItem [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:83:18[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:277:13
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2msetItem[2m > [22m[2mshould store number in localStorage
[22m[39mFailed to set item number-key: TypeError: Cannot read properties of undefined (reading 'setItem')
    at Module.setItem [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:83:18[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:286:13
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2msetItem[2m > [22m[2mshould store boolean in localStorage
[22m[39mFailed to set item bool-key: TypeError: Cannot read properties of undefined (reading 'setItem')
    at Module.setItem [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:83:18[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:292:13
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2msetItem[2m > [22m[2mshould handle storage quota errors
[22m[39mFailed to set item key: TypeError: Cannot read properties of undefined (reading 'setItem')
    at Module.setItem [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:83:18[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:302:20
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2mremoveItem[2m > [22m[2mshould remove item from localStorage
[22m[39mFailed to remove item test-key: TypeError: Cannot read properties of undefined (reading 'removeItem')
    at Module.removeItem [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:99:18[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:312:13
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2mremoveItem[2m > [22m[2mshould handle removal errors
[22m[39mFailed to remove item error-key: TypeError: Cannot read properties of undefined (reading 'removeItem')
    at Module.removeItem [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:99:18[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:322:20
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2mclear[2m > [22m[2mshould clear both localStorage and IndexedDB
[22m[39mFailed to clear storage: TypeError: Cannot read properties of undefined (reading 'clear')
    at Module.clear [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:114:18[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:332:13
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2mclear[2m > [22m[2mshould handle clear errors
[22m[39mFailed to clear storage: TypeError: Cannot read properties of undefined (reading 'clear')
    at Module.clear [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:114:18[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:344:20
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2mclear[2m > [22m[2mshould call localStorage.clear before IndexedDB
[22m[39mFailed to clear storage: TypeError: Cannot read properties of undefined (reading 'clear')
    at Module.clear [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:114:18[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:362:13
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2mgetStorageInfo[2m > [22m[2mshould handle errors getting storage info
[22m[39mFailed to get storage info: Error: Info error
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:482:9
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2mIntegration[2m > [22m[2mshould work with getItem and setItem together
[22m[39mFailed to set item integration-key: TypeError: Cannot read properties of undefined (reading 'setItem')
    at Module.setItem [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:83:18[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:548:13
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2mIntegration[2m > [22m[2mshould work with setItem and removeItem together
[22m[39mFailed to set item temp-key: TypeError: Cannot read properties of undefined (reading 'setItem')
    at Module.setItem [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:83:18[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:558:13
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22m[2mStorage Manager[2m > [22m[2mType Safety[2m > [22m[2mshould preserve type information for getItem
[22m[39mFailed to get item user-key: TypeError: Cannot read properties of undefined (reading 'getItem')
    at Module.getItem [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\storage-manager.ts:56:31[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\offline\storage-manager.test.ts:582:28
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

 [31mâ¯[39m server/src/__tests__/unit/offline/storage-manager.test.ts [2m([22m[2m32 tests[22m[2m | [22m[31m27 failed[39m[2m)[22m[32m 127[2mms[22m[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22minitStorage[2m > [22mshould initialize IndexedDB successfully[39m[32m 21[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ Array(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22minitStorage[2m > [22mshould warn if localStorage is not available[39m[32m 2[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'localStorage is not available' ][90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22minitStorage[2m > [22mshould handle initialization errors[39m[32m 8[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ â€¦(2) ][90m

Number of calls: [1m0[22m
[31m[39m
   [32mâœ“[39m Storage Manager[2m > [22mgetItem[2m > [22mwith ID (IndexedDB)[2m > [22mshould fetch from IndexedDB when ID is provided[32m 2[2mms[22m[39m
   [32mâœ“[39m Storage Manager[2m > [22mgetItem[2m > [22mwith ID (IndexedDB)[2m > [22mshould return undefined when IndexedDB item not found[32m 1[2mms[22m[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mgetItem[2m > [22mwith ID (IndexedDB)[2m > [22mshould handle IndexedDB read errors[39m[32m 4[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'Failed to get item users:', â€¦(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mgetItem[2m > [22mwithout ID (localStorage)[2m > [22mshould get JSON object from localStorage[39m[32m 7[2mms[22m[39m
[31m     â†’ expected undefined to deeply equal { id: 1, name: 'Test' }[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mgetItem[2m > [22mwithout ID (localStorage)[2m > [22mshould get string from localStorage[39m[32m 2[2mms[22m[39m
[31m     â†’ expected undefined to be 'simple-string' // Object.is equality[39m
   [32mâœ“[39m Storage Manager[2m > [22mgetItem[2m > [22mwithout ID (localStorage)[2m > [22mshould return undefined when key not found[32m 5[2mms[22m[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mgetItem[2m > [22mwithout ID (localStorage)[2m > [22mshould handle invalid JSON gracefully[39m[32m 3[2mms[22m[39m
[31m     â†’ expected undefined to be 'invalid-json{' // Object.is equality[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mgetItem[2m > [22mwithout ID (localStorage)[2m > [22mshould handle localStorage errors[39m[32m 5[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ â€¦(2) ][90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22msetItem[2m > [22mshould store string in localStorage[39m[32m 2[2mms[22m[39m
[31m     â†’ Cannot read properties of undefined (reading 'setItem')[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22msetItem[2m > [22mshould serialize and store object in localStorage[39m[32m 2[2mms[22m[39m
[31m     â†’ Cannot read properties of undefined (reading 'setItem')[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22msetItem[2m > [22mshould serialize and store array in localStorage[39m[32m 1[2mms[22m[39m
[31m     â†’ Cannot read properties of undefined (reading 'setItem')[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22msetItem[2m > [22mshould store number in localStorage[39m[32m 3[2mms[22m[39m
[31m     â†’ Cannot read properties of undefined (reading 'setItem')[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22msetItem[2m > [22mshould store boolean in localStorage[39m[32m 2[2mms[22m[39m
[31m     â†’ Cannot read properties of undefined (reading 'setItem')[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22msetItem[2m > [22mshould handle storage quota errors[39m[32m 9[2mms[22m[39m
[31m     â†’ expected [Function] to throw error including 'Quota exceeded' but got 'Cannot read properties of undefined (â€¦'[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mremoveItem[2m > [22mshould remove item from localStorage[39m[32m 1[2mms[22m[39m
[31m     â†’ Cannot read properties of undefined (reading 'removeItem')[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mremoveItem[2m > [22mshould handle removal errors[39m[32m 6[2mms[22m[39m
[31m     â†’ expected [Function] to throw error including 'Remove error' but got 'Cannot read properties of undefined (â€¦'[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mclear[2m > [22mshould clear both localStorage and IndexedDB[39m[32m 2[2mms[22m[39m
[31m     â†’ Cannot read properties of undefined (reading 'clear')[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mclear[2m > [22mshould handle clear errors[39m[32m 3[2mms[22m[39m
[31m     â†’ expected [Function] to throw error including 'Clear error' but got 'Cannot read properties of undefined (â€¦'[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mclear[2m > [22mshould call localStorage.clear before IndexedDB[39m[32m 1[2mms[22m[39m
[31m     â†’ Cannot read properties of undefined (reading 'clear')[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22misStorageAvailable[2m > [22mshould return true when both storages are available[39m[32m 14[2mms[22m[39m
[31m     â†’ expected false to be true // Object.is equality[39m
   [32mâœ“[39m Storage Manager[2m > [22misStorageAvailable[2m > [22mshould return false when localStorage throws error[32m 1[2mms[22m[39m
   [32mâœ“[39m Storage Manager[2m > [22misStorageAvailable[2m > [22mshould return false when IndexedDB is not ready[32m 0[2mms[22m[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mgetStorageInfo[2m > [22mshould return storage usage information[39m[32m 1[2mms[22m[39m
[31m     â†’ Object.defineProperty called on non-object[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mgetStorageInfo[2m > [22mshould handle empty localStorage[39m[32m 1[2mms[22m[39m
[31m     â†’ Cannot convert undefined or null to object[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mgetStorageInfo[2m > [22mshould handle errors getting storage info[39m[32m 3[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ 'Failed to get storage info:', â€¦(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mgetStorageInfo[2m > [22mshould calculate localStorage size correctly[39m[32m 1[2mms[22m[39m
[31m     â†’ Cannot convert undefined or null to object[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mIntegration[2m > [22mshould work with getItem and setItem together[39m[32m 2[2mms[22m[39m
[31m     â†’ Cannot read properties of undefined (reading 'setItem')[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mIntegration[2m > [22mshould work with setItem and removeItem together[39m[32m 1[2mms[22m[39m
[31m     â†’ Cannot read properties of undefined (reading 'setItem')[39m
[31m   [31mÃ—[31m Storage Manager[2m > [22mType Safety[2m > [22mshould preserve type information for getItem[39m[32m 3[2mms[22m[39m
[31m     â†’ expected undefined to deeply equal { id: 1, name: 'Test User', â€¦(1) }[39m
[90mstdout[2m | server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould allow admin to bypass permission check
[22m[39mðŸ” DEBUG: checkPermission called: create:kuis

[90mstdout[2m | server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould allow user with permission
[22m[39mðŸ” DEBUG: checkPermission called: create:kuis

[90mstdout[2m | server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould throw PermissionError if user lacks permission
[22m[39mðŸ” DEBUG: checkPermission called: create:kuis

[90mstdout[2m | server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould include role in error message
[22m[39mðŸ” DEBUG: checkPermission called: manage:user

[90mstdout[2m | server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermission[2m > [22m[2mshould execute function if permission granted
[22m[39mðŸ” DEBUG: checkPermission called: create:kuis

[90mstdout[2m | server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermission[2m > [22m[2mshould not execute function if permission denied
[22m[39mðŸ” DEBUG: checkPermission called: create:kuis

[90mstdout[2m | server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermission[2m > [22m[2mshould pass arguments to wrapped function
[22m[39mðŸ” DEBUG: checkPermission called: update:kuis

[90mstdout[2m | server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermission[2m > [22m[2mshould allow admin bypass
[22m[39mðŸ” DEBUG: checkPermission called: create:kuis

[90mstdout[2m | server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermissionAndOwnership[2m > [22m[2mshould check both permission and ownership
[22m[39mðŸ” DEBUG: checkPermission called: update:kuis

[90mstdout[2m | server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermissionAndOwnership[2m > [22m[2mshould fail if permission denied
[22m[39mðŸ” DEBUG: checkPermission called: delete:kuis

[90mstdout[2m | server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermissionAndOwnership[2m > [22m[2mshould fail if ownership denied
[22m[39mðŸ” DEBUG: checkPermission called: update:kuis

 [31mâ¯[39m server/src/__tests__/unit/middleware/permission.middleware.test.ts [2m([22m[2m33 tests[22m[2m | [22m[31m26 failed[39m[2m)[22m[32m 159[2mms[22m[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mgetCurrentUserWithRole[2m > [22mshould return user with role from database[39m[32m 21[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mgetCurrentUserWithRole[2m > [22mshould throw AuthenticationError if user not authenticated[39m[32m 9[2mms[22m[39m
[31m     â†’ expected error to be instance of AuthenticationError[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mgetCurrentUserWithRole[2m > [22mshould throw RoleNotFoundError if user role not found in database[39m[32m 2[2mms[22m[39m
[31m     â†’ expected error to be instance of RoleNotFoundError[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mgetCurrentUserWithRole[2m > [22mshould get role for admin user[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mgetCurrentUserWithRole[2m > [22mshould get role for mahasiswa user[39m[32m 1[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mgetCurrentDosenId[2m > [22mshould return dosen ID for dosen user[39m[32m 4[2mms[22m[39m
[31m     â†’ expected null to be 'dosen-456' // Object.is equality[39m
   [32mâœ“[39m Permission Middleware[2m > [22mgetCurrentDosenId[2m > [22mshould return null if user is not a dosen[32m 2[2mms[22m[39m
   [32mâœ“[39m Permission Middleware[2m > [22mgetCurrentDosenId[2m > [22mshould return null on error[32m 1[2mms[22m[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mgetCurrentMahasiswaId[2m > [22mshould return mahasiswa ID for mahasiswa user[39m[32m 2[2mms[22m[39m
[31m     â†’ expected null to be 'mhs-456' // Object.is equality[39m
   [32mâœ“[39m Permission Middleware[2m > [22mgetCurrentMahasiswaId[2m > [22mshould return null if user is not a mahasiswa[32m 1[2mms[22m[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mcheckPermission[2m > [22mshould allow admin to bypass permission check[39m[32m 12[2mms[22m[39m
[31m     â†’ promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mcheckPermission[2m > [22mshould allow user with permission[39m[32m 4[2mms[22m[39m
[31m     â†’ promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mcheckPermission[2m > [22mshould throw PermissionError if user lacks permission[39m[32m 3[2mms[22m[39m
[31m     â†’ expected error to be instance of PermissionError[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mcheckPermission[2m > [22mshould include role in error message[39m[32m 2[2mms[22m[39m
[31m     â†’ expected AuthenticationError: User not authenticatâ€¦ { â€¦(2) } to be an instance of PermissionError[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mrequirePermission[2m > [22mshould execute function if permission granted[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mrequirePermission[2m > [22mshould not execute function if permission denied[39m[32m 2[2mms[22m[39m
[31m     â†’ expected error to be instance of PermissionError[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mrequirePermission[2m > [22mshould pass arguments to wrapped function[39m[32m 14[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mrequirePermission[2m > [22mshould allow admin bypass[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mrequireOwnership[2m > [22mshould allow admin bypass by default[39m[32m 2[2mms[22m[39m
[31m     â†’ promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mrequireOwnership[2m > [22mshould allow owner to access their resource (user_id)[39m[32m 2[2mms[22m[39m
[31m     â†’ promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mrequireOwnership[2m > [22mshould allow dosen to access their own kuis[39m[32m 2[2mms[22m[39m
[31m     â†’ promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mrequireOwnership[2m > [22mshould throw OwnershipError if not owner[39m[32m 14[2mms[22m[39m
[31m     â†’ expected error to be instance of OwnershipError[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mrequireOwnership[2m > [22mshould throw error if resource not found[39m[32m 13[2mms[22m[39m
[31m     â†’ expected [Function] to throw error including 'Resource not found' but got 'User not authenticated'[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mrequireOwnership[2m > [22mshould respect allowAdmin option[39m[32m 3[2mms[22m[39m
[31m     â†’ expected error to be instance of OwnershipError[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mrequirePermissionAndOwnership[2m > [22mshould check both permission and ownership[39m[32m 4[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mrequirePermissionAndOwnership[2m > [22mshould fail if permission denied[39m[32m 3[2mms[22m[39m
[31m     â†’ expected error to be instance of PermissionError[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mrequirePermissionAndOwnership[2m > [22mshould fail if ownership denied[39m[32m 3[2mms[22m[39m
[31m     â†’ expected error to be instance of OwnershipError[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22misCurrentUserAdmin[2m > [22mshould return true for admin user[39m[32m 6[2mms[22m[39m
[31m     â†’ expected false to be true // Object.is equality[39m
   [32mâœ“[39m Permission Middleware[2m > [22misCurrentUserAdmin[2m > [22mshould return false for non-admin user[32m 2[2mms[22m[39m
   [32mâœ“[39m Permission Middleware[2m > [22misCurrentUserAdmin[2m > [22mshould return false on error[32m 3[2mms[22m[39m
[31m   [31mÃ—[31m Permission Middleware[2m > [22mhasRole[2m > [22mshould return true if user has specified role[39m[32m 4[2mms[22m[39m
[31m     â†’ expected false to be true // Object.is equality[39m
   [32mâœ“[39m Permission Middleware[2m > [22mhasRole[2m > [22mshould return false if user has different role[32m 3[2mms[22m[39m
   [32mâœ“[39m Permission Middleware[2m > [22mhasRole[2m > [22mshould return false on error[32m 1[2mms[22m[39m
[90mstdout[2m | server/src/__tests__/unit/api/mahasiswa.api.test.ts[2m > [22m[2mMahasiswa API[2m > [22m[2mgetMahasiswaStats[2m > [22m[2mshould return mahasiswa statistics successfully
[22m[39mðŸ”„ Upgrading IndexedDB from v0 to v2
âœ… Created store: kuis
âœ… Created store: kuis_soal
âœ… Created store: kuis_jawaban
âœ… Created store: nilai
âœ… Created store: materi
âœ… Created store: kelas
âœ… Created store: users
âœ… Created store: sync_queue
âœ… Created store: metadata
âœ… Created store: offline_quiz
âœ… Created store: offline_questions
âœ… Created store: offline_answers
âœ… Created store: offline_attempts

[90mstdout[2m | server/src/__tests__/unit/api/mahasiswa.api.test.ts[2m > [22m[2mMahasiswa API[2m > [22m[2mgetMahasiswaStats[2m > [22m[2mshould return mahasiswa statistics successfully
[22m[39mâœ… IndexedDB initialized successfully

[90mstdout[2m | server/src/__tests__/unit/api/mahasiswa.api.test.ts[2m > [22m[2mMahasiswa API[2m > [22m[2mgetMahasiswaStats[2m > [22m[2mshould return mahasiswa statistics successfully
[22m[39m[API Cache] MISS: mahasiswa_stats (fetching...)

[90mstdout[2m | server/src/__tests__/unit/api/mahasiswa.api.test.ts[2m > [22m[2mMahasiswa API[2m > [22m[2mgetMahasiswaStats[2m > [22m[2mshould return mahasiswa statistics successfully
[22m[39m[API Cache] Cached: mahasiswa_stats (TTL: 300000ms)

[90mstdout[2m | server/src/__tests__/unit/api/mahasiswa.api.test.ts[2m > [22m[2mMahasiswa API[2m > [22m[2mgetMahasiswaStats[2m > [22m[2mshould return zero stats when mahasiswa not found
[22m[39m[API Cache] HIT: mahasiswa_stats

[90mstdout[2m | server/src/__tests__/unit/api/mahasiswa.api.test.ts[2m > [22m[2mMahasiswa API[2m > [22m[2mgetMahasiswaStats[2m > [22m[2mshould calculate average score correctly
[22m[39m[API Cache] HIT: mahasiswa_stats

[90mstdout[2m | server/src/__tests__/unit/api/mahasiswa.api.test.ts[2m > [22m[2mMahasiswa API[2m > [22m[2mgetMahasiswaStats[2m > [22m[2mshould handle errors gracefully
[22m[39m[API Cache] HIT: mahasiswa_stats

 [31mâ¯[39m server/src/__tests__/unit/api/mahasiswa.api.test.ts [2m([22m[2m19 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[32m 112[2mms[22m[39m
[31m   [31mÃ—[31m Mahasiswa API[2m > [22mgetMahasiswaStats[2m > [22mshould return mahasiswa statistics successfully[39m[32m 63[2mms[22m[39m
[31m     â†’ expected { totalKelasPraktikum: +0, â€¦(3) } to deeply equal { totalKelasPraktikum: 2, â€¦(3) }[39m
   [32mâœ“[39m Mahasiswa API[2m > [22mgetMahasiswaStats[2m > [22mshould return zero stats when mahasiswa not found[32m 2[2mms[22m[39m
[31m   [31mÃ—[31m Mahasiswa API[2m > [22mgetMahasiswaStats[2m > [22mshould calculate average score correctly[39m[32m 4[2mms[22m[39m
[31m     â†’ expected null to be 80 // Object.is equality[39m
   [32mâœ“[39m Mahasiswa API[2m > [22mgetMahasiswaStats[2m > [22mshould handle errors gracefully[32m 2[2mms[22m[39m
   [32mâœ“[39m Mahasiswa API[2m > [22mgetAvailableKelas[2m > [22mshould return available kelas for enrollment[32m 1[2mms[22m[39m
   [32mâœ“[39m Mahasiswa API[2m > [22mgetAvailableKelas[2m > [22mshould return empty array when mahasiswa not found[32m 1[2mms[22m[39m
   [32mâœ“[39m Mahasiswa API[2m > [22mgetAvailableKelas[2m > [22mshould handle database errors[32m 1[2mms[22m[39m
[31m   [31mÃ—[31m Mahasiswa API[2m > [22menrollToKelas[2m > [22mshould enroll mahasiswa to kelas successfully[39m[32m 5[2mms[22m[39m
[31m     â†’ expected false to be true // Object.is equality[39m
   [32mâœ“[39m Mahasiswa API[2m > [22menrollToKelas[2m > [22mshould fail when mahasiswa not found[32m 1[2mms[22m[39m
[31m   [31mÃ—[31m Mahasiswa API[2m > [22menrollToKelas[2m > [22mshould fail when already enrolled[39m[32m 9[2mms[22m[39m
[31m     â†’ expected 'Mahasiswa tidak ditemukan' to be 'Anda sudah terdaftar di kelas ini' // Object.is equality[39m
[31m   [31mÃ—[31m Mahasiswa API[2m > [22menrollToKelas[2m > [22mshould fail when kelas is full[39m[32m 3[2mms[22m[39m
[31m     â†’ expected 'Mahasiswa tidak ditemukan' to be 'Kelas sudah penuh' // Object.is equality[39m
[31m   [31mÃ—[31m Mahasiswa API[2m > [22munenrollFromKelas[2m > [22mshould unenroll mahasiswa from kelas successfully[39m[32m 3[2mms[22m[39m
[31m     â†’ expected false to be true // Object.is equality[39m
   [32mâœ“[39m Mahasiswa API[2m > [22munenrollFromKelas[2m > [22mshould fail when mahasiswa not found[32m 1[2mms[22m[39m
   [32mâœ“[39m Mahasiswa API[2m > [22munenrollFromKelas[2m > [22mshould handle database errors[32m 2[2mms[22m[39m
[31m   [31mÃ—[31m Mahasiswa API[2m > [22mgetMyKelas[2m > [22mshould return enrolled kelas list[39m[32m 4[2mms[22m[39m
[31m     â†’ expected [] to have a length of 1 but got +0[39m
   [32mâœ“[39m Mahasiswa API[2m > [22mgetMyKelas[2m > [22mshould return empty array when mahasiswa not found[32m 1[2mms[22m[39m
   [32mâœ“[39m Mahasiswa API[2m > [22mgetMyJadwal[2m > [22mshould return jadwal for next 7 days[32m 1[2mms[22m[39m
   [32mâœ“[39m Mahasiswa API[2m > [22mgetMyJadwal[2m > [22mshould return empty array when not enrolled in any kelas[32m 1[2mms[22m[39m
[31m   [31mÃ—[31m Mahasiswa API[2m > [22mgetMyJadwal[2m > [22mshould respect limit parameter[39m[32m 2[2mms[22m[39m
[31m     â†’ expected "spy" to be called with arguments: [ 5 ][90m

Number of calls: [1m0[22m
[31m[39m
 [31mâ¯[39m src/__tests__/unit/validations/kuis.schema.test.ts [2m([22m[2m31 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 166[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mcreateKuisSchema[2m > [22mshould validate correct quiz data[32m 19[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mcreateKuisSchema[2m > [22mshould reject judul shorter than 5 characters[32m 2[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mcreateKuisSchema[2m > [22mshould reject durasi below minimum[32m 1[2mms[22m[39m
[31m   [31mÃ—[31m Kuis Validation Schemas[2m > [22mcreateKuisSchema[2m > [22mshould reject durasi above maximum[39m[32m 20[2mms[22m[39m
[31m     â†’ expected true to be false // Object.is equality[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mcreateKuisSchema[2m > [22mshould reject invalid UUID for kelas_id[32m 54[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mcreateKuisSchema[2m > [22mshould accept optional fields as null[32m 7[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mupdateKuisSchema[2m > [22mshould validate quiz update[32m 5[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mupdateKuisSchema[2m > [22mshould validate tanggal_selesai after tanggal_mulai[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mupdateKuisSchema[2m > [22mshould allow partial updates[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mcreateSoalPilihanGandaSchema[2m > [22mshould validate multiple choice question[32m 3[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mcreateSoalPilihanGandaSchema[2m > [22mshould reject with less than 2 options[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mcreateSoalPilihanGandaSchema[2m > [22mshould reject with no correct answer[32m 2[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mcreateSoalPilihanGandaSchema[2m > [22mshould reject with multiple correct answers[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mcreateSoalBenarSalahSchema[2m > [22mshould validate true/false question[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mcreateSoalBenarSalahSchema[2m > [22mshould reject invalid jawaban_benar[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mcreateSoalEssaySchema[2m > [22mshould validate essay question[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mcreateSoalEssaySchema[2m > [22mshould allow empty jawaban_benar for essay[32m 0[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mcreateSoalJawabanSingkatSchema[2m > [22mshould validate short answer question[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mcreateSoalJawabanSingkatSchema[2m > [22mshould reject empty jawaban_benar[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mstartAttemptSchema[2m > [22mshould validate start attempt data[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mstartAttemptSchema[2m > [22mshould reject invalid UUID[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22msubmitAnswerSchema[2m > [22mshould validate submit answer data[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22msubmitAnswerSchema[2m > [22mshould reject empty jawaban[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22msubmitAnswerSchema[2m > [22mshould reject jawaban longer than 5000 characters[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22msubmitQuizSchema[2m > [22mshould validate submit quiz data[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22msubmitQuizSchema[2m > [22mshould reject negative time_spent[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22msubmitQuizSchema[2m > [22mshould reject non-integer time_spent[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mVALIDATION_CONSTANTS[2m > [22mshould export all validation constants[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mEdge Cases[2m > [22mshould handle pertanyaan at minimum length[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mEdge Cases[2m > [22mshould reject pertanyaan shorter than minimum[32m 1[2mms[22m[39m
   [32mâœ“[39m Kuis Validation Schemas[2m > [22mEdge Cases[2m > [22mshould handle poin at boundaries[32m 1[2mms[22m[39m
[90mstdout[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Dashboard Stats[2m > [22m[2mgetDosenStats[2m > [22m[2mshould return stats for authenticated dosen
[22m[39mðŸ” DEBUG getDosenId: user = user-1

[90mstdout[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Dashboard Stats[2m > [22m[2mgetDosenStats[2m > [22m[2mshould return stats for authenticated dosen
[22m[39mðŸ” DEBUG getDosenId: dosen query result = {
  data: { id: [32m'dosen-1'[39m, user_id: [32m'user-1'[39m, nidn: [32m'1234567890'[39m },
  error: [1mnull[22m
}

[90mstderr[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Dashboard Stats[2m > [22m[2mgetDosenStats[2m > [22m[2mshould return stats for authenticated dosen
[22m[39mError fetching dosen stats: TypeError: __vite_ssr_import_0__.supabase.from(...).select(...).eq is not a function
    at ttl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\dosen.api.ts:275:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstderr[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Dashboard Stats[2m > [22m[2mgetDosenStats[2m > [22m[2mshould handle errors gracefully
[22m[39mError fetching dosen stats: TypeError: Cannot read properties of undefined (reading 'select')
    at ttl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\dosen.api.ts:245:35[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstdout[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Dashboard Stats[2m > [22m[2mgetDosenStats[2m > [22m[2mshould use cached dosen ID on subsequent calls
[22m[39mðŸ” DEBUG getDosenId: user = user-1

[90mstdout[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Dashboard Stats[2m > [22m[2mgetDosenStats[2m > [22m[2mshould use cached dosen ID on subsequent calls
[22m[39mðŸ” DEBUG getDosenId: dosen query result = {
  data: { id: [32m'dosen-1'[39m, user_id: [32m'user-1'[39m, nidn: [32m'1234567890'[39m },
  error: [1mnull[22m
}

[90mstdout[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould return kelas with stats for dosen
[22m[39mðŸ” DEBUG getMyKelas: Getting ALL available kelas

[90mstdout[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould return kelas with stats for dosen
[22m[39mðŸ“š DEBUG: Found 1 total active kelas
ðŸ” DEBUG: Extracting 0 unique mata_kuliah_ids: []

[90mstderr[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould return kelas with stats for dosen
[22m[39mError fetching my kelas: TypeError: __vite_ssr_import_0__.supabase.from(...).select(...).in is not a function
    at Module.getMyKelas [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\dosen.api.ts:358:8[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\dosen.api.test.ts:335:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

[90mstdout[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould apply limit when provided
[22m[39mðŸ” DEBUG getMyKelas: Getting ALL available kelas

[90mstderr[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould apply limit when provided
[22m[39mError fetching my kelas: TypeError: __vite_ssr_import_0__.supabase.from(...).select(...).in is not a function
    at Module.getMyKelas [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\dosen.api.ts:358:8[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\dosen.api.test.ts:393:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

[90mstdout[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould apply limit when provided
[22m[39mðŸ“š DEBUG: Found 3 total active kelas
ðŸ” DEBUG: Extracting 0 unique mata_kuliah_ids: []

[90mstdout[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould return empty array when no dosen ID
[22m[39mðŸ” DEBUG getMyKelas: Getting ALL available kelas

[90mstdout[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould return empty array when no dosen ID
[22m[39mâš ï¸ DEBUG: No kelas found in database

[90mstdout[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould handle duplicate kelas correctly
[22m[39mðŸ” DEBUG getMyKelas: Getting ALL available kelas

[90mstdout[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould handle duplicate kelas correctly
[22m[39mðŸ“š DEBUG: Found 3 total active kelas
ðŸ” DEBUG: Extracting 0 unique mata_kuliah_ids: []

[90mstderr[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Kelas Management[2m > [22m[2mgetMyKelas[2m > [22m[2mshould handle duplicate kelas correctly
[22m[39mError fetching my kelas: TypeError: __vite_ssr_import_0__.supabase.from(...).select(...).in is not a function
    at Module.getMyKelas [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\dosen.api.ts:358:8[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\dosen.api.test.ts:453:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

[90mstderr[2m | src/__tests__/unit/api/dosen.api.test.ts[2m > [22m[2mDosen API - Student Management[2m > [22m[2mgetKelasStudents[2m > [22m[2mshould handle database errors gracefully
[22m[39mError fetching kelas students: Error: DB Error
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\dosen.api.test.ts:653:18
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

 [31mâ¯[39m src/__tests__/unit/api/dosen.api.test.ts [2m([22m[2m19 tests[22m[2m | [22m[31m4 failed[39m[2m | [22m[33m1 skipped[39m[2m)[22m[32m 164[2mms[22m[39m
[31m   [31mÃ—[31m Dosen API - Dashboard Stats[2m > [22mgetDosenStats[2m > [22mshould return stats for authenticated dosen[39m[32m 43[2mms[22m[39m
[31m     â†’ expected { totalKelas: +0, â€¦(3) } to deeply equal { totalKelas: 5, â€¦(3) }[39m
   [32mâœ“[39m Dosen API - Dashboard Stats[2m > [22mgetDosenStats[2m > [22mshould return zero stats when no dosen found[32m 1[2mms[22m[39m
   [32mâœ“[39m Dosen API - Dashboard Stats[2m > [22mgetDosenStats[2m > [22mshould handle errors gracefully[32m 17[2mms[22m[39m
   [32mâœ“[39m Dosen API - Dashboard Stats[2m > [22mgetDosenStats[2m > [22mshould use cached dosen ID on subsequent calls[32m 5[2mms[22m[39m
[31m   [31mÃ—[31m Dosen API - Kelas Management[2m > [22mgetMyKelas[2m > [22mshould return kelas with stats for dosen[39m[32m 19[2mms[22m[39m
[31m     â†’ expected [] to have a length of 1 but got +0[39m
[31m   [31mÃ—[31m Dosen API - Kelas Management[2m > [22mgetMyKelas[2m > [22mshould apply limit when provided[39m[32m 6[2mms[22m[39m
[31m     â†’ expected [] to have a length of 2 but got +0[39m
   [32mâœ“[39m Dosen API - Kelas Management[2m > [22mgetMyKelas[2m > [22mshould return empty array when no dosen ID[32m 1[2mms[22m[39m
[31m   [31mÃ—[31m Dosen API - Kelas Management[2m > [22mgetMyKelas[2m > [22mshould handle duplicate kelas correctly[39m[32m 5[2mms[22m[39m
[31m     â†’ expected [] to have a length of 2 but got +0[39m
   [32mâœ“[39m Dosen API - Kelas Management[2m > [22mgetMyMataKuliah[2m > [22mshould return mata kuliah with aggregated stats[32m 35[2mms[22m[39m
   [32mâœ“[39m Dosen API - Kelas Management[2m > [22mgetMyMataKuliah[2m > [22mshould apply limit when provided[32m 3[2mms[22m[39m
   [32mâœ“[39m Dosen API - Student Management[2m > [22mgetKelasStudents[2m > [22mshould return students for a kelas[32m 5[2mms[22m[39m
   [32mâœ“[39m Dosen API - Student Management[2m > [22mgetKelasStudents[2m > [22mshould return empty array when no students[32m 1[2mms[22m[39m
   [32mâœ“[39m Dosen API - Student Management[2m > [22mgetKelasStudents[2m > [22mshould handle database errors gracefully[32m 2[2mms[22m[39m
   [2m[90mâ†“[39m[22m Dosen API - Student Management[2m > [22mgetStudentStats[2m > [22mshould return aggregated student statistics
   [32mâœ“[39m Dosen API - Student Management[2m > [22mgetStudentStats[2m > [22mshould handle no kelas scenario[32m 1[2mms[22m[39m
   [32mâœ“[39m Dosen API - Grading Operations[2m > [22mgetPendingGrading[2m > [22mshould return pending grading items[32m 4[2mms[22m[39m
   [32mâœ“[39m Dosen API - Grading Operations[2m > [22mgetPendingGrading[2m > [22mshould apply limit when provided[32m 2[2mms[22m[39m
   [32mâœ“[39m Dosen API - Grading Operations[2m > [22mgetActiveKuis[2m > [22mshould return active quizzes with stats[32m 3[2mms[22m[39m
   [32mâœ“[39m Dosen API - Grading Operations[2m > [22mgetActiveKuis[2m > [22mshould apply limit when provided[32m 2[2mms[22m[39m
[90mstdout[2m | server/src/__tests__/unit/api/sync.api.test.ts[2m > [22m[2mSync API[2m > [22m[2mgetSyncManagementStats[2m > [22m[2mshould return sync statistics
[22m[39mðŸ”„ Upgrading IndexedDB from v0 to v2
âœ… Created store: kuis
âœ… Created store: kuis_soal
âœ… Created store: kuis_jawaban
âœ… Created store: nilai
âœ… Created store: materi
âœ… Created store: kelas
âœ… Created store: users
âœ… Created store: sync_queue
âœ… Created store: metadata
âœ… Created store: offline_quiz
âœ… Created store: offline_questions
âœ… Created store: offline_answers
âœ… Created store: offline_attempts

[90mstdout[2m | server/src/__tests__/unit/api/sync.api.test.ts[2m > [22m[2mSync API[2m > [22m[2mgetSyncManagementStats[2m > [22m[2mshould return sync statistics
[22m[39mâœ… IndexedDB initialized successfully

[90mstdout[2m | server/src/__tests__/unit/api/sync.api.test.ts[2m > [22m[2mSync API[2m > [22m[2mgetSyncManagementStats[2m > [22m[2mshould return sync statistics
[22m[39mâœ… QueueManager initialized

[90mstdout[2m | server/src/__tests__/unit/api/sync.api.test.ts[2m > [22m[2mSync API[2m > [22m[2mforceSyncNow[2m > [22m[2mshould trigger sync process
[22m[39mðŸ” DEBUG: checkPermission called: manage:sync

[90mstdout[2m | server/src/__tests__/unit/api/sync.api.test.ts[2m > [22m[2mSync API[2m > [22m[2mforceSyncNow[2m > [22m[2mshould handle sync errors
[22m[39mðŸ” DEBUG: checkPermission called: manage:sync

 [31mâ¯[39m server/src/__tests__/unit/api/sync.api.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 72[2mms[22m[39m
[31m   [31mÃ—[31m Sync API[2m > [22mgetSyncManagementStats[2m > [22mshould return sync statistics[39m[32m 55[2mms[22m[39m
[31m     â†’ expected { pendingSync: +0, synced: +0, â€¦(5) } to have property "pendingSync" with value 10[39m
   [32mâœ“[39m Sync API[2m > [22mgetSyncManagementStats[2m > [22mshould handle errors gracefully[32m 1[2mms[22m[39m
[31m   [31mÃ—[31m Sync API[2m > [22mforceSyncNow[2m > [22mshould trigger sync process[39m[32m 7[2mms[22m[39m
[31m     â†’ User not authenticated[39m
   [32mâœ“[39m Sync API[2m > [22mforceSyncNow[2m > [22mshould handle sync errors[32m 4[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/lib/offline/network-detector.test.ts [2m([22m[2m47 tests[22m[2m)[22m[32m 114[2mms[22m[39m
 [31mâ¯[39m server/src/__tests__/unit/api/admin.api.test.ts [2m([22m[2m27 tests[22m[2m | [22m[31m27 failed[39m[2m)[22m[32m 143[2mms[22m[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetDashboardStats[2m > [22mshould return dashboard statistics successfully[39m[32m 26[2mms[22m[39m
[31m     â†’ supabase.from.mockImplementation is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetDashboardStats[2m > [22mshould handle empty data gracefully[39m[32m 1[2mms[22m[39m
[31m     â†’ supabase.from.mockImplementation is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetDashboardStats[2m > [22mshould handle database errors[39m[32m 2[2mms[22m[39m
[31m     â†’ supabase.from.mockImplementation is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetDashboardStats[2m > [22mshould handle null data from database[39m[32m 2[2mms[22m[39m
[31m     â†’ supabase.from.mockImplementation is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetUserGrowth[2m > [22mshould return user growth data for last 6 months[39m[32m 2[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetUserGrowth[2m > [22mshould initialize all months with zero users[39m[32m 2[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetUserGrowth[2m > [22mshould handle users without created_at[39m[32m 1[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetUserGrowth[2m > [22mshould handle database errors[39m[32m 25[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetUserDistribution[2m > [22mshould return user distribution by role[39m[32m 2[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetUserDistribution[2m > [22mshould capitalize role names[39m[32m 5[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetUserDistribution[2m > [22mshould handle empty data[39m[32m 1[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetUserDistribution[2m > [22mshould calculate percentage correctly[39m[32m 1[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetUserDistribution[2m > [22mshould handle database errors[39m[32m 2[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetLabUsage[2m > [22mshould return lab usage data[39m[32m 35[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetLabUsage[2m > [22mshould limit to 5 labs[39m[32m 3[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetLabUsage[2m > [22mshould handle empty lab data[39m[32m 1[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetLabUsage[2m > [22mshould handle database errors[39m[32m 1[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetRecentUsers[2m > [22mshould return recent users with default limit[39m[32m 2[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetRecentUsers[2m > [22mshould accept custom limit parameter[39m[32m 2[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetRecentUsers[2m > [22mshould handle users without created_at[39m[32m 2[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetRecentUsers[2m > [22mshould handle empty data[39m[32m 1[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetRecentUsers[2m > [22mshould handle database errors[39m[32m 6[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetRecentAnnouncements[2m > [22mshould return recent announcements with author names[39m[32m 2[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetRecentAnnouncements[2m > [22mshould handle announcements with null users[39m[32m 1[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetRecentAnnouncements[2m > [22mshould accept custom limit parameter[39m[32m 1[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetRecentAnnouncements[2m > [22mshould handle empty data[39m[32m 2[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
[31m   [31mÃ—[31m Admin API[2m > [22mgetRecentAnnouncements[2m > [22mshould handle database errors[39m[32m 2[2mms[22m[39m
[31m     â†’ supabase.from.mockReturnValue is not a function[39m
 [31mâ¯[39m server/src/__tests__/unit/hooks/useSync.test.ts [2m([22m[2m34 tests[22m[2m | [22m[31m34 failed[39m[2m)[22m[32m 37[2mms[22m[39m
[31m   [31mÃ—[31m useSync[2m > [22mInitialization[2m > [22mshould initialize with default state[39m[32m 15[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mInitialization[2m > [22mshould initialize queue manager if not ready[39m[32m 1[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mInitialization[2m > [22mshould not re-initialize if already ready[39m[32m 1[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mInitialization[2m > [22mshould subscribe to queue events[39m[32m 1[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mInitialization[2m > [22mshould load initial stats[39m[32m 1[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mInitialization[2m > [22mshould mark as ready after initialization[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mInitialization[2m > [22mshould get initial processing state[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22maddToQueue[2m > [22mshould add item to queue[39m[32m 1[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22maddToQueue[2m > [22mshould refresh stats after adding[39m[32m 1[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22maddToQueue[2m > [22mshould handle different entity types[39m[32m 1[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22maddToQueue[2m > [22mshould handle different operations[39m[32m 1[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22maddToQueue[2m > [22mshould throw error on enqueue failure[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mprocessQueue[2m > [22mshould process the queue[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mprocessQueue[2m > [22mshould set processing state during queue processing[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mprocessQueue[2m > [22mshould refresh stats after processing[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mprocessQueue[2m > [22mshould reset processing state on error[39m[32m 1[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mretryFailed[2m > [22mshould retry failed items[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mretryFailed[2m > [22mshould refresh stats after retrying[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mretryFailed[2m > [22mshould return 0 on retry failure[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mclearCompleted[2m > [22mshould clear completed items[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mclearCompleted[2m > [22mshould refresh stats after clearing[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mclearCompleted[2m > [22mshould return 0 on clear failure[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mgetAllItems[2m > [22mshould get all items without filter[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mgetAllItems[2m > [22mshould get items with status filter[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mgetAllItems[2m > [22mshould return empty array on error[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mQueue Events[2m > [22mshould update processing state on processing event[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mQueue Events[2m > [22mshould update processing state on completed event[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mQueue Events[2m > [22mshould update processing state on failed event[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mQueue Events[2m > [22mshould refresh stats on queue events[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mStats[2m > [22mshould expose queue statistics[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mStats[2m > [22mshould refresh stats manually[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mCleanup[2m > [22mshould unsubscribe from queue events on unmount[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mIntegration[2m > [22mshould handle complete sync workflow[39m[32m 1[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[31m   [31mÃ—[31m useSync[2m > [22mIntegration[2m > [22mshould maintain consistent state across re-renders[39m[32m 0[2mms[22m[39m
[31m     â†’ queueManager._reset is not a function[39m
[90mstdout[2m | server/src/__tests__/unit/api/mata-kuliah.api.test.ts[2m > [22m[2mMata Kuliah API[2m > [22m[2mcreateMataKuliah[2m > [22m[2mshould create new mata kuliah
[22m[39mðŸ” DEBUG: checkPermission called: manage:mata_kuliah

[90mstdout[2m | server/src/__tests__/unit/api/mata-kuliah.api.test.ts[2m > [22m[2mMata Kuliah API[2m > [22m[2mcreateMataKuliah[2m > [22m[2mshould reject duplicate kode_mk
[22m[39mðŸ” DEBUG: checkPermission called: manage:mata_kuliah

[90mstdout[2m | server/src/__tests__/unit/api/mata-kuliah.api.test.ts[2m > [22m[2mMata Kuliah API[2m > [22m[2mupdateMataKuliah[2m > [22m[2mshould update mata kuliah
[22m[39mðŸ” DEBUG: checkPermission called: manage:mata_kuliah

[90mstdout[2m | server/src/__tests__/unit/api/mata-kuliah.api.test.ts[2m > [22m[2mMata Kuliah API[2m > [22m[2mdeleteMataKuliah[2m > [22m[2mshould delete when no kelas
[22m[39mðŸ” DEBUG: checkPermission called: manage:mata_kuliah

[90mstdout[2m | server/src/__tests__/unit/api/mata-kuliah.api.test.ts[2m > [22m[2mMata Kuliah API[2m > [22m[2mdeleteMataKuliah[2m > [22m[2mshould detach kelas and delete when kelas exist by default
[22m[39mðŸ” DEBUG: checkPermission called: manage:mata_kuliah

 [31mâ¯[39m server/src/__tests__/unit/api/mata-kuliah.api.test.ts [2m([22m[2m9 tests[22m[2m | [22m[31m5 failed[39m[2m)[22m[32m 46[2mms[22m[39m
   [32mâœ“[39m Mata Kuliah API[2m > [22mgetMataKuliah[2m > [22mshould fetch all mata kuliah[32m 5[2mms[22m[39m
   [32mâœ“[39m Mata Kuliah API[2m > [22mgetMataKuliah[2m > [22mshould apply filters[32m 1[2mms[22m[39m
   [32mâœ“[39m Mata Kuliah API[2m > [22mgetMataKuliahById[2m > [22mshould fetch single mata kuliah[32m 1[2mms[22m[39m
[31m   [31mÃ—[31m Mata Kuliah API[2m > [22mcreateMataKuliah[2m > [22mshould create new mata kuliah[39m[32m 16[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Mata Kuliah API[2m > [22mcreateMataKuliah[2m > [22mshould reject duplicate kode_mk[39m[32m 13[2mms[22m[39m
[31m     â†’ expected [Function] to throw error including 'sudah ada' but got 'User not authenticated'[39m
[31m   [31mÃ—[31m Mata Kuliah API[2m > [22mupdateMataKuliah[2m > [22mshould update mata kuliah[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Mata Kuliah API[2m > [22mdeleteMataKuliah[2m > [22mshould delete when no kelas[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Mata Kuliah API[2m > [22mdeleteMataKuliah[2m > [22mshould detach kelas and delete when kelas exist by default[39m[32m 1[2mms[22m[39m
[31m     â†’ User not authenticated[39m
   [32mâœ“[39m Mata Kuliah API[2m > [22mgetMataKuliahStats[2m > [22mshould calculate statistics[32m 1[2mms[22m[39m
[90mstdout[2m | server/src/__tests__/unit/api/analytics.api.test.ts[2m > [22m[2mAnalytics API - System Metrics[2m > [22m[2mgetSystemMetrics[2m > [22m[2mshould fetch all system metrics successfully
[22m[39mðŸ” DEBUG: checkPermission called: view:analytics

[90mstdout[2m | server/src/__tests__/unit/api/analytics.api.test.ts[2m > [22m[2mAnalytics API - System Metrics[2m > [22m[2mgetSystemMetrics[2m > [22m[2mshould determine Good health when borrowings < 50
[22m[39mðŸ” DEBUG: checkPermission called: view:analytics

[90mstdout[2m | server/src/__tests__/unit/api/analytics.api.test.ts[2m > [22m[2mAnalytics API - System Metrics[2m > [22m[2mgetSystemMetrics[2m > [22m[2mshould determine Warning health when borrowings 51-100
[22m[39mðŸ” DEBUG: checkPermission called: view:analytics

[90mstdout[2m | server/src/__tests__/unit/api/analytics.api.test.ts[2m > [22m[2mAnalytics API - System Metrics[2m > [22m[2mgetSystemMetrics[2m > [22m[2mshould determine Critical health when borrowings > 100
[22m[39mðŸ” DEBUG: checkPermission called: view:analytics

[90mstdout[2m | server/src/__tests__/unit/api/analytics.api.test.ts[2m > [22m[2mAnalytics API - System Metrics[2m > [22m[2mgetSystemMetrics[2m > [22m[2mshould handle null counts as 0
[22m[39mðŸ” DEBUG: checkPermission called: view:analytics

[90mstdout[2m | server/src/__tests__/unit/api/analytics.api.test.ts[2m > [22m[2mAnalytics API - System Metrics[2m > [22m[2mgetSystemMetrics[2m > [22m[2mshould return zero metrics on error
[22m[39mðŸ” DEBUG: checkPermission called: view:analytics

[90mstdout[2m | server/src/__tests__/unit/api/analytics.api.test.ts[2m > [22m[2mAnalytics API - System Metrics[2m > [22m[2mgetSystemMetrics[2m > [22m[2mshould filter active classes correctly
[22m[39mðŸ” DEBUG: checkPermission called: view:analytics

[90mstdout[2m | server/src/__tests__/unit/api/analytics.api.test.ts[2m > [22m[2mAnalytics API - System Metrics[2m > [22m[2mgetSystemMetrics[2m > [22m[2mshould filter pending and approved borrowings
[22m[39mðŸ” DEBUG: checkPermission called: view:analytics

 [31mâ¯[39m server/src/__tests__/unit/api/analytics.api.test.ts [2m([22m[2m8 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[32m 49[2mms[22m[39m
[31m   [31mÃ—[31m Analytics API - System Metrics[2m > [22mgetSystemMetrics[2m > [22mshould fetch all system metrics successfully[39m[32m 23[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Analytics API - System Metrics[2m > [22mgetSystemMetrics[2m > [22mshould determine Good health when borrowings < 50[39m[32m 4[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Analytics API - System Metrics[2m > [22mgetSystemMetrics[2m > [22mshould determine Warning health when borrowings 51-100[39m[32m 3[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Analytics API - System Metrics[2m > [22mgetSystemMetrics[2m > [22mshould determine Critical health when borrowings > 100[39m[32m 3[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Analytics API - System Metrics[2m > [22mgetSystemMetrics[2m > [22mshould handle null counts as 0[39m[32m 3[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Analytics API - System Metrics[2m > [22mgetSystemMetrics[2m > [22mshould return zero metrics on error[39m[32m 2[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Analytics API - System Metrics[2m > [22mgetSystemMetrics[2m > [22mshould filter active classes correctly[39m[32m 3[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Analytics API - System Metrics[2m > [22mgetSystemMetrics[2m > [22mshould filter pending and approved borrowings[39m[32m 3[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[90mstdout[2m | server/src/__tests__/unit/api/materi.api.test.ts[2m > [22m[2mMateri API[2m > [22m[2mcreateMateri[2m > [22m[2mshould upload file and create materi
[22m[39mðŸ” DEBUG: checkPermission called: manage:materi

[90mstdout[2m | server/src/__tests__/unit/api/materi.api.test.ts[2m > [22m[2mMateri API[2m > [22m[2mdeleteMateri[2m > [22m[2mshould delete file and materi record
[22m[39mðŸ” DEBUG: checkPermission called: manage:materi

 [31mâ¯[39m server/src/__tests__/unit/api/materi.api.test.ts [2m([22m[2m7 tests[22m[2m | [22m[31m2 failed[39m[2m | [22m[33m1 skipped[39m[2m)[22m[32m 38[2mms[22m[39m
   [32mâœ“[39m Materi API[2m > [22mgetMateri[2m > [22mshould fetch materi with filters[32m 5[2mms[22m[39m
   [32mâœ“[39m Materi API[2m > [22mgetMateriById[2m > [22mshould fetch single materi[32m 1[2mms[22m[39m
[31m   [31mÃ—[31m Materi API[2m > [22mcreateMateri[2m > [22mshould upload file and create materi[39m[32m 21[2mms[22m[39m
[31m     â†’ User not authenticated[39m
[31m   [31mÃ—[31m Materi API[2m > [22mdeleteMateri[2m > [22mshould delete file and materi record[39m[32m 3[2mms[22m[39m
[31m     â†’ User not authenticated[39m
   [2m[90mâ†“[39m[22m Materi API[2m > [22mdownloadMateri[2m > [22mshould download file
   [32mâœ“[39m Materi API[2m > [22mpublishMateri[2m > [22mshould set is_active to true[32m 2[2mms[22m[39m
   [32mâœ“[39m Materi API[2m > [22munpublishMateri[2m > [22mshould set is_active to false[32m 1[2mms[22m[39m
[90mstdout[2m | server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mInitialization[2m > [22m[2mshould initialize IndexedDB on mount
[22m[39mâœ… OfflineProvider: IndexedDB initialized

[90mstdout[2m | server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mInitialization[2m > [22m[2mshould render children after IndexedDB is ready
[22m[39mâœ… OfflineProvider: IndexedDB initialized

[90mstdout[2m | server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mContext[2m > [22m[2mshould provide offline context to children
[22m[39mâœ… OfflineProvider: IndexedDB initialized

[90mstdout[2m | server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mContext[2m > [22m[2mshould provide all offline methods
[22m[39mâœ… OfflineProvider: IndexedDB initialized

[90mstdout[2m | server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mContext[2m > [22m[2mshould provide quality metrics
[22m[39mâœ… OfflineProvider: IndexedDB initialized

[90mstdout[2m | server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mCleanup[2m > [22m[2mshould cleanup on unmount
[22m[39mâœ… OfflineProvider: IndexedDB initialized

[90mstdout[2m | server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mIntegration[2m > [22m[2mshould work with multiple children
[22m[39mâœ… OfflineProvider: IndexedDB initialized

[90mstdout[2m | server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mIntegration[2m > [22m[2mshould initialize only once with multiple children
[22m[39mâœ… OfflineProvider: IndexedDB initialized

[90mstdout[2m | server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mIntegration[2m > [22m[2mshould handle nested components accessing context
[22m[39mâœ… OfflineProvider: IndexedDB initialized

 [31mâ¯[39m server/src/__tests__/unit/providers/OfflineProvider.test.tsx [2m([22m[2m16 tests[22m[2m | [22m[31m8 failed[39m[2m)[22m[33m 2624[2mms[22m[39m
[31m   [31mÃ—[31m OfflineProvider[2m > [22mInitialization[2m > [22mshould initialize IndexedDB on mount[39m[33m 1132[2mms[22m[39m
[31m     â†’ [AsyncFunction initialize] is not a spy or a call to a spy!

Ignored nodes: comments, script, style
[36m<html>[31m
  [36m<head />[31m
  [36m<body>[31m
    [36m<div>[31m
      [36m<div>[31m
        [36m<div[31m
          [33mdata-testid[31m=[32m"status"[31m
        [36m>[31m
          [0monline[0m
        [36m</div>[31m
        [36m<div[31m
          [33mdata-testid[31m=[32m"isOnline"[31m
        [36m>[31m
          [0mtrue[0m
        [36m</div>[31m
        [36m<div[31m
          [33mdata-testid[31m=[32m"isOffline"[31m
        [36m>[31m
          [0mfalse[0m
        [36m</div>[31m
      [36m</div>[31m
    [36m</div>[31m
  [36m</body>[31m
[36m</html>[31m[39m
   [32mâœ“[39m OfflineProvider[2m > [22mInitialization[2m > [22mshould render children after IndexedDB is ready[32m 56[2mms[22m[39m
[31m   [31mÃ—[31m OfflineProvider[2m > [22mInitialization[2m > [22mshould not render children before IndexedDB is ready[39m[32m 2[2mms[22m[39m
[31m     â†’ indexedDBManager.initialize.mockImplementation is not a function[39m
   [32mâœ“[39m OfflineProvider[2m > [22mInitialization[2m > [22mshould log success message when IndexedDB initializes[32m 39[2mms[22m[39m
[31m   [31mÃ—[31m OfflineProvider[2m > [22mInitialization[2m > [22mshould log error message when IndexedDB initialization fails[39m[32m 1[2mms[22m[39m
[31m     â†’ indexedDBManager.initialize.mockRejectedValue is not a function[39m
   [32mâœ“[39m OfflineProvider[2m > [22mContext[2m > [22mshould provide offline context to children[32m 49[2mms[22m[39m
   [32mâœ“[39m OfflineProvider[2m > [22mContext[2m > [22mshould throw error when useOfflineContext is used outside provider[32m 63[2mms[22m[39m
   [32mâœ“[39m OfflineProvider[2m > [22mContext[2m > [22mshould provide all offline methods[32m 26[2mms[22m[39m
   [32mâœ“[39m OfflineProvider[2m > [22mContext[2m > [22mshould provide quality metrics[32m 14[2mms[22m[39m
[31m   [31mÃ—[31m OfflineProvider[2m > [22mCleanup[2m > [22mshould cleanup on unmount[39m[33m 1044[2mms[22m[39m
[31m     â†’ [AsyncFunction initialize] is not a spy or a call to a spy!

Ignored nodes: comments, script, style
[36m<html>[31m
  [36m<head />[31m
  [36m<body>[31m
    [36m<div>[31m
      [36m<div>[31m
        [36m<div[31m
          [33mdata-testid[31m=[32m"status"[31m
        [36m>[31m
          [0monline[0m
        [36m</div>[31m
        [36m<div[31m
          [33mdata-testid[31m=[32m"isOnline"[31m
        [36m>[31m
          [0mtrue[0m
        [36m</div>[31m
        [36m<div[31m
          [33mdata-testid[31m=[32m"isOffline"[31m
        [36m>[31m
          [0mfalse[0m
        [36m</div>[31m
      [36m</div>[31m
    [36m</div>[31m
  [36m</body>[31m
[36m</html>[31m[39m
[31m   [31mÃ—[31m OfflineProvider[2m > [22mCleanup[2m > [22mshould not update state after unmount[39m[32m 2[2mms[22m[39m
[31m     â†’ indexedDBManager.initialize.mockReturnValue is not a function[39m
   [32mâœ“[39m OfflineProvider[2m > [22mIntegration[2m > [22mshould work with multiple children[32m 66[2mms[22m[39m
[31m   [31mÃ—[31m OfflineProvider[2m > [22mIntegration[2m > [22mshould initialize only once with multiple children[39m[32m 34[2mms[22m[39m
[31m     â†’ [AsyncFunction initialize] is not a spy or a call to a spy![39m
   [32mâœ“[39m OfflineProvider[2m > [22mIntegration[2m > [22mshould handle nested components accessing context[32m 84[2mms[22m[39m
[31m   [31mÃ—[31m OfflineProvider[2m > [22mError Handling[2m > [22mshould handle IndexedDB initialization error gracefully[39m[32m 2[2mms[22m[39m
[31m     â†’ indexedDBManager.initialize.mockRejectedValue is not a function[39m
[31m   [31mÃ—[31m OfflineProvider[2m > [22mError Handling[2m > [22mshould not throw when initialization takes long time[39m[32m 3[2mms[22m[39m
[31m     â†’ indexedDBManager.initialize.mockReturnValue is not a function[39m
[90mstdout[2m | src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould save answers online
[22m[39mâœ… Loaded soal securely (jawaban_benar hidden)
ðŸ”µ Starting new attempt for kuis: quiz-1

[90mstdout[2m | src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould save answers online
[22m[39mâœ… Attempt loaded: attempt-1

[90mstdout[2m | src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould save answers online
[22m[39mâœ… Auto-saved (offline): soal-1

[90mstdout[2m | src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould detect offline status and show alert
[22m[39mâœ… Loaded soal securely (jawaban_benar hidden)
ðŸ”µ Starting new attempt for kuis: quiz-1

[90mstdout[2m | src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould detect offline status and show alert
[22m[39mâœ… Attempt loaded: attempt-1

[90mstdout[2m | src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould persist data after refresh when offline
[22m[39mâœ… Loaded soal securely (jawaban_benar hidden)
ðŸ”µ Resuming attempt: attempt-1

[90mstdout[2m | src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould persist data after refresh when offline
[22m[39mâœ… Attempt loaded: attempt-1

[90mstdout[2m | src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould automatically sync when coming back online
[22m[39mâœ… Loaded soal securely (jawaban_benar hidden)
ðŸ”µ Starting new attempt for kuis: quiz-1

[90mstdout[2m | src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould automatically sync when coming back online
[22m[39mâœ… Attempt loaded: attempt-1

[90mstdout[2m | server/src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould save answers online
[22m[39mâœ… Loaded soal securely (jawaban_benar hidden)
ðŸ”µ Starting new attempt for kuis: quiz-1

[90mstdout[2m | server/src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould save answers online
[22m[39mâœ… Attempt loaded: attempt-1

 [32mâœ“[39m src/__tests__/integration/kuis-attempt-offline.test.tsx [2m([22m[2m7 tests[22m[2m | [22m[33m3 skipped[39m[2m)[22m[33m 3179[2mms[22m[39m
   [33m[2mâœ“[22m[39m Kuis Attempt Offline Integration[2m > [22mshould save answers online [33m 1139[2mms[22m[39m
   [33m[2mâœ“[22m[39m Kuis Attempt Offline Integration[2m > [22mshould detect offline status and show alert [33m 346[2mms[22m[39m
   [33m[2mâœ“[22m[39m Kuis Attempt Offline Integration[2m > [22mshould automatically sync when coming back online [33m 1472[2mms[22m[39m
[90mstdout[2m | server/src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould save answers online
[22m[39mâœ… Auto-saved (offline): soal-1

[90mstdout[2m | server/src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould detect offline status and show alert
[22m[39mâœ… Loaded soal securely (jawaban_benar hidden)
ðŸ”µ Starting new attempt for kuis: quiz-1

[90mstdout[2m | server/src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould detect offline status and show alert
[22m[39mâœ… Attempt loaded: attempt-1

[90mstdout[2m | server/src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould persist data after refresh when offline
[22m[39mâœ… Loaded soal securely (jawaban_benar hidden)
ðŸ”µ Resuming attempt: attempt-1

[90mstdout[2m | server/src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould persist data after refresh when offline
[22m[39mâœ… Attempt loaded: attempt-1

[90mstdout[2m | server/src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould automatically sync when coming back online
[22m[39mâœ… Loaded soal securely (jawaban_benar hidden)
ðŸ”µ Starting new attempt for kuis: quiz-1

[90mstdout[2m | server/src/__tests__/integration/kuis-attempt-offline.test.tsx[2m > [22m[2mKuis Attempt Offline Integration[2m > [22m[2mshould automatically sync when coming back online
[22m[39mâœ… Attempt loaded: attempt-1

 [32mâœ“[39m server/src/__tests__/integration/kuis-attempt-offline.test.tsx [2m([22m[2m7 tests[22m[2m | [22m[33m3 skipped[39m[2m)[22m[33m 3686[2mms[22m[39m
   [33m[2mâœ“[22m[39m Kuis Attempt Offline Integration[2m > [22mshould save answers online [33m 1452[2mms[22m[39m
   [33m[2mâœ“[22m[39m Kuis Attempt Offline Integration[2m > [22mshould detect offline status and show alert [33m 337[2mms[22m[39m
   [33m[2mâœ“[22m[39m Kuis Attempt Offline Integration[2m > [22mshould persist data after refresh when offline [33m 349[2mms[22m[39m
   [33m[2mâœ“[22m[39m Kuis Attempt Offline Integration[2m > [22mshould automatically sync when coming back online [33m 1544[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/hooks/useSync.test.ts [2m([22m[2m34 tests[22m[2m)[22m[33m 4162[2mms[22m[39m
   [33m[2mâœ“[22m[39m useSync[2m > [22mprocessQueue[2m > [22mshould set processing state during queue processing [33m 332[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/hooks/useLocalData.test.ts [2m([22m[2m30 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 2375[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/integration/network-reconnect.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[33m 850[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/hooks/useLocalData.test.ts [2m([22m[2m30 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 2040[2mms[22m[39m
 [32mâœ“[39m src/__tests__/integration/network-reconnect.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[33m 967[2mms[22m[39m
[90mstdout[2m | src/__tests__/unit/providers/SyncProvider.test.tsx[2m > [22m[2mSyncProvider[2m > [22m[2mInitialization[2m > [22m[2mshould render children immediately
[22m[39mAuto-syncing 5 pending items...

[90mstdout[2m | src/__tests__/unit/providers/SyncProvider.test.tsx[2m > [22m[2mSyncProvider[2m > [22m[2mInitialization[2m > [22m[2mshould provide sync context to children
[22m[39mAuto-syncing 5 pending items...

[90mstdout[2m | src/__tests__/unit/providers/SyncProvider.test.tsx[2m > [22m[2mSyncProvider[2m > [22m[2mInitialization[2m > [22m[2mshould provide stats to children
[22m[39mAuto-syncing 5 pending items...

 [32mâœ“[39m src/__tests__/unit/providers/SyncProvider.test.tsx [2m([22m[2m20 tests[22m[2m | [22m[33m6 skipped[39m[2m)[22m[33m 931[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/hooks/useNetworkStatus.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 863[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/hooks/useNetworkStatus.test.ts [2m([22m[2m23 tests[22m[2m)[22m[33m 1022[2mms[22m[39m
[90mstdout[2m | src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mInitialization[2m > [22m[2mshould initialize IndexedDB on mount
[22m[39mâœ… OfflineProvider: IndexedDB initialized

[90mstdout[2m | src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mInitialization[2m > [22m[2mshould render children after IndexedDB is ready
[22m[39mâœ… OfflineProvider: IndexedDB initialized

[90mstdout[2m | src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mContext[2m > [22m[2mshould provide offline context to children
[22m[39mâœ… OfflineProvider: IndexedDB initialized

 [32mâœ“[39m server/src/__tests__/unit/lib/offline/indexeddb.test.ts [2m([22m[2m54 tests[22m[2m)[22m[33m 631[2mms[22m[39m
[90mstdout[2m | src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mContext[2m > [22m[2mshould provide all offline methods
[22m[39mâœ… OfflineProvider: IndexedDB initialized

[90mstdout[2m | src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mContext[2m > [22m[2mshould provide quality metrics
[22m[39mâœ… OfflineProvider: IndexedDB initialized

[90mstdout[2m | src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mCleanup[2m > [22m[2mshould cleanup on unmount
[22m[39mâœ… OfflineProvider: IndexedDB initialized

[90mstdout[2m | src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mIntegration[2m > [22m[2mshould work with multiple children
[22m[39mâœ… OfflineProvider: IndexedDB initialized

[90mstdout[2m | src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mIntegration[2m > [22m[2mshould initialize only once with multiple children
[22m[39mâœ… OfflineProvider: IndexedDB initialized

[90mstdout[2m | src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mIntegration[2m > [22m[2mshould handle nested components accessing context
[22m[39mâœ… OfflineProvider: IndexedDB initialized

[90mstdout[2m | src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22m[2mOfflineProvider[2m > [22m[2mError Handling[2m > [22m[2mshould not throw when initialization takes long time
[22m[39mâœ… OfflineProvider: IndexedDB initialized

 [32mâœ“[39m src/__tests__/unit/providers/OfflineProvider.test.tsx [2m([22m[2m16 tests[22m[2m)[22m[33m 832[2mms[22m[39m
[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mInitialization[2m > [22m[2mshould setup global error handlers
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogReactError[2m > [22m[2mshould log React error boundary errors
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogReactError[2m > [22m[2mshould include custom metadata
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogReactError[2m > [22m[2mshould capture error stack trace
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogReactError[2m > [22m[2mshould handle error without component stack
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogJSError[2m > [22m[2mshould log JavaScript Error objects
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogJSError[2m > [22m[2mshould log ErrorEvent objects
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogJSError[2m > [22m[2mshould handle ErrorEvent without error object
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogJSError[2m > [22m[2mshould include custom metadata
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogPromiseRejection[2m > [22m[2mshould log promise rejection with Error object
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogPromiseRejection[2m > [22m[2mshould log promise rejection with string reason
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogPromiseRejection[2m > [22m[2mshould log promise rejection with no reason
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogPromiseRejection[2m > [22m[2mshould include custom metadata
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogError[2m > [22m[2mshould log Error objects
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogError[2m > [22m[2mshould log string errors
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogError[2m > [22m[2mshould include custom metadata
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Queue Management[2m > [22m[2mshould add errors to queue
[22m[39mðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Queue Management[2m > [22m[2mshould maintain max queue size of 50
[22m[39mðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Queue Management[2m > [22m[2mshould store last 10 errors in localStorage
[22m[39mðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Queue Management[2m > [22m[2mshould clear error logs
[22m[39mðŸ”´ Error Logged
ðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Queue Management[2m > [22m[2mshould handle localStorage errors gracefully
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Log Structure[2m > [22m[2mshould include timestamp
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Log Structure[2m > [22m[2mshould include user agent
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Log Structure[2m > [22m[2mshould include current URL
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Log Structure[2m > [22m[2mshould include stack trace when available
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mbeforeSend Hook[2m > [22m[2mshould apply beforeSend transformation
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mbeforeSend Hook[2m > [22m[2mshould skip logging when beforeSend returns null
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mbeforeSend Hook[2m > [22m[2mshould filter sensitive data in beforeSend
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mSample Rate[2m > [22m[2mshould log all errors with sampleRate 1.0
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mSample Rate[2m > [22m[2mshould log no errors with sampleRate 0.0
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mSample Rate[2m > [22m[2mshould sample errors at approximately 50% with sampleRate 0.5
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mInitialization[2m > [22m[2mshould setup global error handlers
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogReactError[2m > [22m[2mshould log React error boundary errors
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogReactError[2m > [22m[2mshould include custom metadata
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogReactError[2m > [22m[2mshould capture error stack trace
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mExternal Service Integration[2m > [22m[2mshould send to custom endpoint when DSN provided
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogReactError[2m > [22m[2mshould handle error without component stack
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogJSError[2m > [22m[2mshould log JavaScript Error objects
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogJSError[2m > [22m[2mshould log ErrorEvent objects
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogJSError[2m > [22m[2mshould handle ErrorEvent without error object
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogJSError[2m > [22m[2mshould include custom metadata
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogPromiseRejection[2m > [22m[2mshould log promise rejection with Error object
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogPromiseRejection[2m > [22m[2mshould log promise rejection with string reason
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogPromiseRejection[2m > [22m[2mshould log promise rejection with no reason
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogPromiseRejection[2m > [22m[2mshould include custom metadata
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogError[2m > [22m[2mshould log Error objects
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogError[2m > [22m[2mshould log string errors
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mlogError[2m > [22m[2mshould include custom metadata
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Queue Management[2m > [22m[2mshould add errors to queue
[22m[39mðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mExternal Service Integration[2m > [22m[2mshould handle fetch errors gracefully
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Queue Management[2m > [22m[2mshould maintain max queue size of 50
[22m[39mðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Queue Management[2m > [22m[2mshould store last 10 errors in localStorage
[22m[39mðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Queue Management[2m > [22m[2mshould clear error logs
[22m[39mðŸ”´ Error Logged
ðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Queue Management[2m > [22m[2mshould handle localStorage errors gracefully
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Log Structure[2m > [22m[2mshould include timestamp
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Log Structure[2m > [22m[2mshould include user agent
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Log Structure[2m > [22m[2mshould include current URL
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mError Log Structure[2m > [22m[2mshould include stack trace when available
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mbeforeSend Hook[2m > [22m[2mshould apply beforeSend transformation
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mbeforeSend Hook[2m > [22m[2mshould skip logging when beforeSend returns null
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mbeforeSend Hook[2m > [22m[2mshould filter sensitive data in beforeSend
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mSample Rate[2m > [22m[2mshould log all errors with sampleRate 1.0
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mExternal Service Integration[2m > [22m[2mshould not send to external service when disabled
[22m[39mâœ… Error Logger initialized { enabled: [33mfalse[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mExternal Service Integration[2m > [22m[2mshould not send to external service without DSN
[22m[39mâœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle complete error logging lifecycle
[22m[39mâœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle error logging with transformations
[22m[39mâœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle errors with circular references in metadata
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long error messages
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle errors without stack traces
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle undefined metadata values
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mSample Rate[2m > [22m[2mshould log no errors with sampleRate 0.0
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mSample Rate[2m > [22m[2mshould sample errors at approximately 50% with sampleRate 0.5
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mExternal Service Integration[2m > [22m[2mshould send to custom endpoint when DSN provided
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged

[90mstdout[2m | server/src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle rapid error logging
[22m[39mðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged

 [32mâœ“[39m server/src/__tests__/unit/utils/error-logger.test.ts [2m([22m[2m51 tests[22m[2m)[22m[33m 1110[2mms[22m[39m
[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mExternal Service Integration[2m > [22m[2mshould handle fetch errors gracefully
[22m[39mðŸ“¡ External error service configured (not yet implemented)
âœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mExternal Service Integration[2m > [22m[2mshould not send to external service when disabled
[22m[39mâœ… Error Logger initialized { enabled: [33mfalse[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mExternal Service Integration[2m > [22m[2mshould not send to external service without DSN
[22m[39mâœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle complete error logging lifecycle
[22m[39mâœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle error logging with transformations
[22m[39mâœ… Error Logger initialized { enabled: [33mtrue[39m, environment: [32m'production'[39m }
ðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle errors with circular references in metadata
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle very long error messages
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle errors without stack traces
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle undefined metadata values
[22m[39mðŸ”´ Error Logged

[90mstdout[2m | src/__tests__/unit/utils/error-logger.test.ts[2m > [22m[2mError Logger[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle rapid error logging
[22m[39mðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged
ðŸ”´ Error Logged

 [32mâœ“[39m src/__tests__/unit/utils/error-logger.test.ts [2m([22m[2m51 tests[22m[2m)[22m[33m 935[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/lib/offline/queue-manager.test.ts [2m([22m[2m47 tests[22m[2m)[22m[33m 848[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/lib/offline/indexeddb.test.ts [2m([22m[2m54 tests[22m[2m)[22m[33m 921[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/lib/offline/queue-manager.test.ts [2m([22m[2m47 tests[22m[2m)[22m[33m 708[2mms[22m[39m
[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould fetch all users with role-specific data
[22m[39m[getAllUsersImpl] Fetching all users from database...

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould fetch all users with role-specific data
[22m[39m[getAllUsersImpl] Query result: { count: [33m4[39m, error: [1mnull[22m }

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould map mahasiswa NIM correctly
[22m[39m[getAllUsersImpl] Fetching all users from database...

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould map mahasiswa NIM correctly
[22m[39m[getAllUsersImpl] Query result: { count: [33m4[39m, error: [1mnull[22m }

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould map dosen NIP and NIDN correctly
[22m[39m[getAllUsersImpl] Fetching all users from database...

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould map dosen NIP and NIDN correctly
[22m[39m[getAllUsersImpl] Query result: { count: [33m4[39m, error: [1mnull[22m }

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould handle empty users list
[22m[39m[getAllUsersImpl] Fetching all users from database...

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould handle empty users list
[22m[39m[getAllUsersImpl] Query result: { count: [33m0[39m, error: [1mnull[22m }
[getAllUsersImpl] No users found

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould handle null users data
[22m[39m[getAllUsersImpl] Fetching all users from database...

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould handle null users data
[22m[39m[getAllUsersImpl] Query result: { count: [90mundefined[39m, error: [1mnull[22m }
[getAllUsersImpl] No users found

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould provide default values for missing data
[22m[39m[getAllUsersImpl] Fetching all users from database...

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould provide default values for missing data
[22m[39m[getAllUsersImpl] Query result: { count: [33m1[39m, error: [1mnull[22m }

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould handle database errors gracefully
[22m[39m[getAllUsersImpl] Fetching all users from database...

[90mstderr[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould handle database errors gracefully
[22m[39mError fetching users: Error: Database connection failed
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\users.api.test.ts:295:16
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Get All Users[2m > [22m[2mgetAllUsers[2m > [22m[2mshould handle database errors gracefully
[22m[39m[getAllUsersImpl] Query result: {
  count: [90mundefined[39m,
  error: Error: Database connection failed
      at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\users.api.test.ts:295:16
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
      at new Promise (<anonymous>)
      at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
      at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
      at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
}

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Statistics[2m > [22m[2mgetUserStats[2m > [22m[2mshould calculate user statistics correctly
[22m[39m[getAllUsersImpl] Fetching all users from database...

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Statistics[2m > [22m[2mgetUserStats[2m > [22m[2mshould calculate user statistics correctly
[22m[39m[getAllUsersImpl] Query result: { count: [33m4[39m, error: [1mnull[22m }

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Statistics[2m > [22m[2mgetUserStats[2m > [22m[2mshould return zero stats when no users
[22m[39m[getAllUsersImpl] Fetching all users from database...

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Statistics[2m > [22m[2mgetUserStats[2m > [22m[2mshould return zero stats when no users
[22m[39m[getAllUsersImpl] Query result: { count: [33m0[39m, error: [1mnull[22m }
[getAllUsersImpl] No users found

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Statistics[2m > [22m[2mgetUserStats[2m > [22m[2mshould handle errors and return zero stats
[22m[39m[getAllUsersImpl] Fetching all users from database...

[90mstderr[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Statistics[2m > [22m[2mgetUserStats[2m > [22m[2mshould handle errors and return zero stats
[22m[39mError fetching users: Error: DB Error
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\users.api.test.ts:372:16
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Statistics[2m > [22m[2mgetUserStats[2m > [22m[2mshould handle errors and return zero stats
[22m[39m[getAllUsersImpl] Query result: {
  count: [90mundefined[39m,
  error: Error: DB Error
      at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\users.api.test.ts:372:16
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
      at new Promise (<anonymous>)
      at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
      at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
      at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
}

[90mstderr[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - Statistics[2m > [22m[2mgetUserStats[2m > [22m[2mshould handle errors and return zero stats
[22m[39mError fetching user stats: Error: DB Error
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\users.api.test.ts:372:16
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mtoggleUserStatus[2m > [22m[2mshould handle errors
[22m[39mError toggling user status: Error: Update failed
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\users.api.test.ts:425:45
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mcreateUser - COMPLEX FLOW[2m > [22m[2mshould handle signup errors
[22m[39mError creating user: Error: Email already exists
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\users.api.test.ts:565:16
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mcreateUser - COMPLEX FLOW[2m > [22m[2mshould handle missing user data after signup
[22m[39mError creating user: Error: Failed to create user
    at Module.createUserImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\users.api.ts:216:31[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete mahasiswa from role table then users table
[22m[39m[deleteUserImpl] Current authenticated user: { id: [32m'admin-user-id'[39m, email: [32m'admin@test.com'[39m, role: [32m'admin'[39m }
[deleteUserImpl] Step 1: Getting user info for user-3

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete mahasiswa from role table then users table
[22m[39m[deleteUserImpl] Step 1 result: { user: { role: [32m'mahasiswa'[39m }, error: [1mnull[22m }
[deleteUserImpl] Step 2: Deleting from role table: mahasiswa

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete mahasiswa from role table then users table
[22m[39m[deleteUserImpl] Deleted from mahasiswa table
[deleteUserImpl] Step 3: Deleting from users table

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete mahasiswa from role table then users table
[22m[39m[deleteUserImpl] Step 3 result: { error: [1mnull[22m, deletedData: [ { id: [32m'user-3'[39m } ], count: [33m1[39m }
[deleteUserImpl] Successfully deleted from users table, rows affected: [33m1[39m

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete mahasiswa from role table then users table
[22m[39m[deleteUserImpl] Database commit delay completed

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete mahasiswa from role table then users table
[22m[39m[Delete User] Cache invalidated for user user-3
[deleteUserImpl] Step 5: Calling edge function to delete from auth.users

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete mahasiswa from role table then users table
[22m[39m[deleteUserImpl] Successfully deleted user from auth.users: user-3

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete dosen from role table then users table
[22m[39m[deleteUserImpl] Current authenticated user: { id: [32m'admin-user-id'[39m, email: [32m'admin@test.com'[39m, role: [32m'admin'[39m }
[deleteUserImpl] Step 1: Getting user info for user-2

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete dosen from role table then users table
[22m[39m[deleteUserImpl] Step 1 result: { user: { role: [32m'dosen'[39m }, error: [1mnull[22m }
[deleteUserImpl] Step 2: Deleting from role table: dosen

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete dosen from role table then users table
[22m[39m[deleteUserImpl] Deleted from dosen table
[deleteUserImpl] Step 3: Deleting from users table

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete dosen from role table then users table
[22m[39m[deleteUserImpl] Step 3 result: { error: [1mnull[22m, deletedData: [ { id: [32m'user-2'[39m } ], count: [33m1[39m }
[deleteUserImpl] Successfully deleted from users table, rows affected: [33m1[39m

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete dosen from role table then users table
[22m[39m[deleteUserImpl] Database commit delay completed

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete dosen from role table then users table
[22m[39m[Delete User] Cache invalidated for user user-2
[deleteUserImpl] Step 5: Calling edge function to delete from auth.users

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete dosen from role table then users table
[22m[39m[deleteUserImpl] Successfully deleted user from auth.users: user-2

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete laboran from role table then users table
[22m[39m[deleteUserImpl] Current authenticated user: { id: [32m'admin-user-id'[39m, email: [32m'admin@test.com'[39m, role: [32m'admin'[39m }
[deleteUserImpl] Step 1: Getting user info for user-4

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete laboran from role table then users table
[22m[39m[deleteUserImpl] Step 1 result: { user: { role: [32m'laboran'[39m }, error: [1mnull[22m }
[deleteUserImpl] Step 2: Deleting from role table: laboran

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete laboran from role table then users table
[22m[39m[deleteUserImpl] Deleted from laboran table
[deleteUserImpl] Step 3: Deleting from users table

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete laboran from role table then users table
[22m[39m[deleteUserImpl] Step 3 result: { error: [1mnull[22m, deletedData: [ { id: [32m'user-4'[39m } ], count: [33m1[39m }
[deleteUserImpl] Successfully deleted from users table, rows affected: [33m1[39m

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete laboran from role table then users table
[22m[39m[deleteUserImpl] Database commit delay completed

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete laboran from role table then users table
[22m[39m[Delete User] Cache invalidated for user user-4
[deleteUserImpl] Step 5: Calling edge function to delete from auth.users

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould delete laboran from role table then users table
[22m[39m[deleteUserImpl] Successfully deleted user from auth.users: user-4

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould fail if role-specific delete fails
[22m[39m[deleteUserImpl] Current authenticated user: { id: [32m'admin-user-id'[39m, email: [32m'admin@test.com'[39m, role: [32m'admin'[39m }
[deleteUserImpl] Step 1: Getting user info for user-3

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould fail if role-specific delete fails
[22m[39m[deleteUserImpl] Step 1 result: { user: { role: [32m'mahasiswa'[39m }, error: [1mnull[22m }
[deleteUserImpl] Step 2: Deleting from role table: mahasiswa

[90mstderr[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould fail if role-specific delete fails
[22m[39mFailed to delete from mahasiswa table: Error: Foreign key constraint
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\users.api.test.ts:724:16
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
[deleteUserImpl] ERROR: Error: Failed to delete mahasiswa record: Foreign key constraint
    at Module.deleteUserImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\users.api.ts:317:15[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\users.api.test.ts:732:7
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20
[deleteUserImpl] Error details: {
  message: [32m'Failed to delete mahasiswa record: Foreign key constraint'[39m,
  code: [90mundefined[39m,
  details: [90mundefined[39m,
  hint: [90mundefined[39m,
  status: [90mundefined[39m
}

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould handle user not found
[22m[39m[deleteUserImpl] Current authenticated user: { id: [32m'admin-user-id'[39m, email: [32m'admin@test.com'[39m, role: [32m'admin'[39m }
[deleteUserImpl] Step 1: Getting user info for nonexistent

[90mstderr[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould handle user not found
[22m[39m[deleteUserImpl] Failed to get user: Error: Not found
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\users.api.test.ts:741:16
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
[deleteUserImpl] ERROR: Error: Not found
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\users.api.test.ts:741:16
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
[deleteUserImpl] Error details: {
  message: [32m'Not found'[39m,
  code: [90mundefined[39m,
  details: [90mundefined[39m,
  hint: [90mundefined[39m,
  status: [90mundefined[39m
}

[90mstdout[2m | src/__tests__/unit/api/users.api.test.ts[2m > [22m[2mUsers API - CRUD Operations[2m > [22m[2mdeleteUser - CASCADE DELETE[2m > [22m[2mshould handle user not found
[22m[39m[deleteUserImpl] Step 1 result: {
  user: [1mnull[22m,
  error: Error: Not found
      at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\users.api.test.ts:741:16
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
      at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
      at new Promise (<anonymous>)
      at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
      at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
      at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
      at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
      at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
}

 [32mâœ“[39m src/__tests__/unit/api/users.api.test.ts [2m([22m[2m25 tests[22m[2m)[22m[33m 553[2mms[22m[39m
[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mMahasiswa Role Access[2m > [22m[2mshould allow mahasiswa to access mahasiswa routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/mahasiswa/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.548Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/mahasiswa/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'mahasiswa'[39m,
  allowedRoles: [ [32m'mahasiswa'[39m ],
  hasPermission: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.551Z'[39m
}
âœ… RoleGuard: AUTHORIZED, rendering children { userRole: [32m'mahasiswa'[39m, allowedRoles: [ [32m'mahasiswa'[39m ] }

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mMahasiswa Role Access[2m > [22m[2mshould allow mahasiswa to access mahasiswa routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/mahasiswa/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.535Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/mahasiswa/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'mahasiswa'[39m,
  allowedRoles: [ [32m'mahasiswa'[39m ],
  hasPermission: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.538Z'[39m
}
âœ… RoleGuard: AUTHORIZED, rendering children { userRole: [32m'mahasiswa'[39m, allowedRoles: [ [32m'mahasiswa'[39m ] }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mMahasiswa Role Access[2m > [22m[2mshould prevent mahasiswa from accessing dosen routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/dosen/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.621Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/dosen/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'mahasiswa'[39m,
  allowedRoles: [ [32m'dosen'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.623Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 { userRole: [32m'mahasiswa'[39m, allowedRoles: [ [32m'dosen'[39m ] }

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mMahasiswa Role Access[2m > [22m[2mshould prevent mahasiswa from accessing dosen routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/dosen/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.648Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/dosen/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'mahasiswa'[39m,
  allowedRoles: [ [32m'dosen'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.650Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 { userRole: [32m'mahasiswa'[39m, allowedRoles: [ [32m'dosen'[39m ] }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mMahasiswa Role Access[2m > [22m[2mshould prevent mahasiswa from accessing admin routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/admin/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.710Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/admin/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'mahasiswa'[39m,
  allowedRoles: [ [32m'admin'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.712Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 { userRole: [32m'mahasiswa'[39m, allowedRoles: [ [32m'admin'[39m ] }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mMahasiswa Role Access[2m > [22m[2mshould prevent mahasiswa from accessing laboran routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/laboran/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.749Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/laboran/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'mahasiswa'[39m,
  allowedRoles: [ [32m'laboran'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.750Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 { userRole: [32m'mahasiswa'[39m, allowedRoles: [ [32m'laboran'[39m ] }

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mMahasiswa Role Access[2m > [22m[2mshould prevent mahasiswa from accessing admin routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/admin/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.755Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/admin/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'mahasiswa'[39m,
  allowedRoles: [ [32m'admin'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.756Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 { userRole: [32m'mahasiswa'[39m, allowedRoles: [ [32m'admin'[39m ] }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mDosen Role Access[2m > [22m[2mshould allow dosen to access dosen routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/dosen/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.779Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/dosen/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'dosen'[39m,
  allowedRoles: [ [32m'dosen'[39m ],
  hasPermission: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.779Z'[39m
}
âœ… RoleGuard: AUTHORIZED, rendering children { userRole: [32m'dosen'[39m, allowedRoles: [ [32m'dosen'[39m ] }

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mMahasiswa Role Access[2m > [22m[2mshould prevent mahasiswa from accessing laboran routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/laboran/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.791Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/laboran/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'mahasiswa'[39m,
  allowedRoles: [ [32m'laboran'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.791Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 { userRole: [32m'mahasiswa'[39m, allowedRoles: [ [32m'laboran'[39m ] }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mDosen Role Access[2m > [22m[2mshould prevent dosen from accessing mahasiswa routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/mahasiswa/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.820Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/mahasiswa/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'dosen'[39m,
  allowedRoles: [ [32m'mahasiswa'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.820Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 { userRole: [32m'dosen'[39m, allowedRoles: [ [32m'mahasiswa'[39m ] }

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mDosen Role Access[2m > [22m[2mshould allow dosen to access dosen routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/dosen/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.825Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/dosen/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'dosen'[39m,
  allowedRoles: [ [32m'dosen'[39m ],
  hasPermission: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.826Z'[39m
}
âœ… RoleGuard: AUTHORIZED, rendering children { userRole: [32m'dosen'[39m, allowedRoles: [ [32m'dosen'[39m ] }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mDosen Role Access[2m > [22m[2mshould prevent dosen from accessing admin routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/admin/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.840Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/admin/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'dosen'[39m,
  allowedRoles: [ [32m'admin'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.841Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 { userRole: [32m'dosen'[39m, allowedRoles: [ [32m'admin'[39m ] }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mLaboran Role Access[2m > [22m[2mshould allow laboran to access laboran routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/laboran/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.858Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/laboran/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'laboran'[39m,
  allowedRoles: [ [32m'laboran'[39m ],
  hasPermission: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.858Z'[39m
}
âœ… RoleGuard: AUTHORIZED, rendering children { userRole: [32m'laboran'[39m, allowedRoles: [ [32m'laboran'[39m ] }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mLaboran Role Access[2m > [22m[2mshould prevent laboran from accessing mahasiswa routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/mahasiswa/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.868Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/mahasiswa/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'laboran'[39m,
  allowedRoles: [ [32m'mahasiswa'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.868Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 { userRole: [32m'laboran'[39m, allowedRoles: [ [32m'mahasiswa'[39m ] }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mLaboran Role Access[2m > [22m[2mshould prevent laboran from accessing dosen routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/dosen/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.880Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/dosen/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'laboran'[39m,
  allowedRoles: [ [32m'dosen'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.881Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 { userRole: [32m'laboran'[39m, allowedRoles: [ [32m'dosen'[39m ] }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mAdmin Role Access[2m > [22m[2mshould allow admin to access admin routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/admin/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.901Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/admin/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'admin'[39m,
  allowedRoles: [ [32m'admin'[39m ],
  hasPermission: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.901Z'[39m
}
âœ… RoleGuard: AUTHORIZED, rendering children { userRole: [32m'admin'[39m, allowedRoles: [ [32m'admin'[39m ] }

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mDosen Role Access[2m > [22m[2mshould prevent dosen from accessing mahasiswa routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/mahasiswa/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.891Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/mahasiswa/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'dosen'[39m,
  allowedRoles: [ [32m'mahasiswa'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.892Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 { userRole: [32m'dosen'[39m, allowedRoles: [ [32m'mahasiswa'[39m ] }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mAdmin Role Access[2m > [22m[2mshould prevent admin from accessing mahasiswa routes (if not multi-role)
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/mahasiswa/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.914Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/mahasiswa/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'admin'[39m,
  allowedRoles: [ [32m'mahasiswa'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.915Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 { userRole: [32m'admin'[39m, allowedRoles: [ [32m'mahasiswa'[39m ] }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mUnauthenticated Access[2m > [22m[2mshould redirect unauthenticated users to login
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/mahasiswa/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.931Z'[39m
}
âŒ ProtectedRoute: NOT AUTHENTICATED, redirecting to login { attemptedPath: [32m'/mahasiswa/dashboard'[39m, redirectTo: [32m'/login'[39m }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mUnauthenticated Access[2m > [22m[2mshould redirect from protected admin routes to login when not authenticated
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/admin/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.948Z'[39m
}
âŒ ProtectedRoute: NOT AUTHENTICATED, redirecting to login { attemptedPath: [32m'/admin/dashboard'[39m, redirectTo: [32m'/login'[39m }

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mDosen Role Access[2m > [22m[2mshould prevent dosen from accessing admin routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/admin/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.916Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/admin/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'dosen'[39m,
  allowedRoles: [ [32m'admin'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.916Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 { userRole: [32m'dosen'[39m, allowedRoles: [ [32m'admin'[39m ] }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mLoading States[2m > [22m[2mshould show loading state when auth is initializing
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/mahasiswa/dashboard'[39m,
  loading: [33mtrue[39m,
  initialized: [33mfalse[39m,
  isAuthenticated: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.964Z'[39m
}
â³ ProtectedRoute: LOADING STATE (should be fast with cache!) { loading: [33mtrue[39m, initialized: [33mfalse[39m }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mLoading States[2m > [22m[2mshould show loading state in RoleGuard when verifying permissions
[22m[39mðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mtrue[39m,
  initialized: [33mfalse[39m,
  userRole: [90mundefined[39m,
  allowedRoles: [ [32m'mahasiswa'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.984Z'[39m
}
â³ RoleGuard: LOADING STATE { loading: [33mtrue[39m, initialized: [33mfalse[39m }

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mLaboran Role Access[2m > [22m[2mshould allow laboran to access laboran routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/laboran/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.979Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/laboran/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'laboran'[39m,
  allowedRoles: [ [32m'laboran'[39m ],
  hasPermission: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.982Z'[39m
}
âœ… RoleGuard: AUTHORIZED, rendering children { userRole: [32m'laboran'[39m, allowedRoles: [ [32m'laboran'[39m ] }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mMulti-Role Access[2m > [22m[2mshould allow access when user role matches any allowed role
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/shared/resource'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.997Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/shared/resource'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'dosen'[39m,
  allowedRoles: [ [32m'dosen'[39m, [32m'admin'[39m ],
  hasPermission: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.997Z'[39m
}
âœ… RoleGuard: AUTHORIZED, rendering children { userRole: [32m'dosen'[39m, allowedRoles: [ [32m'dosen'[39m, [32m'admin'[39m ] }

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mLaboran Role Access[2m > [22m[2mshould prevent laboran from accessing mahasiswa routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/mahasiswa/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:03.996Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/mahasiswa/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'laboran'[39m,
  allowedRoles: [ [32m'mahasiswa'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:03.997Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 { userRole: [32m'laboran'[39m, allowedRoles: [ [32m'mahasiswa'[39m ] }

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mMulti-Role Access[2m > [22m[2mshould deny access when user role does not match any allowed roles
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/shared/resource'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:04.029Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/shared/resource'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'mahasiswa'[39m,
  allowedRoles: [ [32m'dosen'[39m, [32m'admin'[39m, [32m'laboran'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:04.029Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 {
  userRole: [32m'mahasiswa'[39m,
  allowedRoles: [ [32m'dosen'[39m, [32m'admin'[39m, [32m'laboran'[39m ]
}

[90mstdout[2m | server/src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mRoleGuard without ProtectedRoute[2m > [22m[2mshould redirect to login when user is null in RoleGuard
[22m[39mðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [90mundefined[39m,
  allowedRoles: [ [32m'mahasiswa'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:04.056Z'[39m
}
âŒ RoleGuard: NO USER, redirecting to login

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mLaboran Role Access[2m > [22m[2mshould prevent laboran from accessing dosen routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/dosen/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:04.046Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/dosen/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'laboran'[39m,
  allowedRoles: [ [32m'dosen'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:04.047Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 { userRole: [32m'laboran'[39m, allowedRoles: [ [32m'dosen'[39m ] }

 [32mâœ“[39m server/src/__tests__/integration/role-access.test.tsx [2m([22m[2m19 tests[22m[2m)[22m[33m 556[2mms[22m[39m
[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mAdmin Role Access[2m > [22m[2mshould allow admin to access admin routes
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/admin/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:04.098Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/admin/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'admin'[39m,
  allowedRoles: [ [32m'admin'[39m ],
  hasPermission: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:04.098Z'[39m
}
âœ… RoleGuard: AUTHORIZED, rendering children { userRole: [32m'admin'[39m, allowedRoles: [ [32m'admin'[39m ] }

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mAdmin Role Access[2m > [22m[2mshould prevent admin from accessing mahasiswa routes (if not multi-role)
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/mahasiswa/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:04.116Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/mahasiswa/dashboard'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'admin'[39m,
  allowedRoles: [ [32m'mahasiswa'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:04.117Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 { userRole: [32m'admin'[39m, allowedRoles: [ [32m'mahasiswa'[39m ] }

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mUnauthenticated Access[2m > [22m[2mshould redirect unauthenticated users to login
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/mahasiswa/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:04.178Z'[39m
}
âŒ ProtectedRoute: NOT AUTHENTICATED, redirecting to login { attemptedPath: [32m'/mahasiswa/dashboard'[39m, redirectTo: [32m'/login'[39m }

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mUnauthenticated Access[2m > [22m[2mshould redirect from protected admin routes to login when not authenticated
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/admin/dashboard'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:04.228Z'[39m
}
âŒ ProtectedRoute: NOT AUTHENTICATED, redirecting to login { attemptedPath: [32m'/admin/dashboard'[39m, redirectTo: [32m'/login'[39m }

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mLoading States[2m > [22m[2mshould show loading state when auth is initializing
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/mahasiswa/dashboard'[39m,
  loading: [33mtrue[39m,
  initialized: [33mfalse[39m,
  isAuthenticated: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:04.240Z'[39m
}
â³ ProtectedRoute: LOADING STATE (should be fast with cache!) { loading: [33mtrue[39m, initialized: [33mfalse[39m }

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mLoading States[2m > [22m[2mshould show loading state in RoleGuard when verifying permissions
[22m[39mðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mtrue[39m,
  initialized: [33mfalse[39m,
  userRole: [90mundefined[39m,
  allowedRoles: [ [32m'mahasiswa'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:04.285Z'[39m
}
â³ RoleGuard: LOADING STATE { loading: [33mtrue[39m, initialized: [33mfalse[39m }

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mMulti-Role Access[2m > [22m[2mshould allow access when user role matches any allowed role
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/shared/resource'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:04.297Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/shared/resource'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'dosen'[39m,
  allowedRoles: [ [32m'dosen'[39m, [32m'admin'[39m ],
  hasPermission: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:04.297Z'[39m
}
âœ… RoleGuard: AUTHORIZED, rendering children { userRole: [32m'dosen'[39m, allowedRoles: [ [32m'dosen'[39m, [32m'admin'[39m ] }

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mMulti-Role Access[2m > [22m[2mshould deny access when user role does not match any allowed roles
[22m[39mðŸ” ProtectedRoute Check: {
  path: [32m'/shared/resource'[39m,
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  isAuthenticated: [33mtrue[39m,
  timestamp: [32m'2026-01-14T05:30:04.314Z'[39m
}
âœ… ProtectedRoute: AUTHENTICATED, rendering children { path: [32m'/shared/resource'[39m }
ðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [32m'mahasiswa'[39m,
  allowedRoles: [ [32m'dosen'[39m, [32m'admin'[39m, [32m'laboran'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:04.322Z'[39m
}
ðŸš« RoleGuard: UNAUTHORIZED, redirecting to 403 {
  userRole: [32m'mahasiswa'[39m,
  allowedRoles: [ [32m'dosen'[39m, [32m'admin'[39m, [32m'laboran'[39m ]
}

[90mstdout[2m | src/__tests__/integration/role-access.test.tsx[2m > [22m[2mRole-based Access Control - CORE LOGIC[2m > [22m[2mRoleGuard without ProtectedRoute[2m > [22m[2mshould redirect to login when user is null in RoleGuard
[22m[39mðŸ›¡ï¸ RoleGuard Check: {
  loading: [33mfalse[39m,
  initialized: [33mtrue[39m,
  userRole: [90mundefined[39m,
  allowedRoles: [ [32m'mahasiswa'[39m ],
  hasPermission: [33mfalse[39m,
  timestamp: [32m'2026-01-14T05:30:04.338Z'[39m
}
âŒ RoleGuard: NO USER, redirecting to login

 [32mâœ“[39m src/__tests__/integration/role-access.test.tsx [2m([22m[2m19 tests[22m[2m)[22m[33m 863[2mms[22m[39m
[90mstderr[2m | src/__tests__/unit/api/sync.api.test.ts[2m > [22m[2mSync API[2m > [22m[2mgetSyncManagementStats[2m > [22m[2mshould handle errors gracefully
[22m[39mError fetching sync stats: Error: Sync error
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\sync.api.test.ts:58:9
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | src/__tests__/unit/api/sync.api.test.ts[2m > [22m[2mSync API[2m > [22m[2mforceSyncNow[2m > [22m[2mshould handle sync errors
[22m[39mError forcing sync: Error: Sync failed
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\sync.api.test.ts:83:9
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

 [32mâœ“[39m src/__tests__/unit/api/sync.api.test.ts [2m([22m[2m4 tests[22m[2m)[22m[33m 1254[2mms[22m[39m
   [33m[2mâœ“[22m[39m Sync API[2m > [22mgetSyncManagementStats[2m > [22mshould return sync statistics [33m 1143[2mms[22m[39m
[90mstderr[2m | src/__tests__/unit/api/mahasiswa.api.test.ts[2m > [22m[2mMahasiswa API[2m > [22m[2munenrollFromKelas[2m > [22m[2mshould handle database errors
[22m[39mError unenrolling from kelas: Error: Database error
    at Object.<anonymous> [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\mahasiswa.api.test.ts:729:24[90m)[39m
    at Object.mockCall [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at Object.spy [as from] [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at Module.unenrollFromKelasImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\mahasiswa.api.ts:435:8[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\mahasiswa.api.test.ts:741:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

 [32mâœ“[39m src/__tests__/unit/api/mahasiswa.api.test.ts [2m([22m[2m19 tests[22m[2m)[22m[32m 273[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/utils/format.test.ts [2m([22m[2m7 tests[22m[2m)[22m[33m 413[2mms[22m[39m
   [33m[2mâœ“[22m[39m Format Utilities[2m > [22mdate formatting[2m > [22mshould format date correctly [33m 337[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/lib/pwa/cache-strategies.test.ts [2m([22m[2m35 tests[22m[2m)[22m[33m 331[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/lib/pwa/cache-strategies.test.ts [2m([22m[2m35 tests[22m[2m)[22m[33m 303[2mms[22m[39m
[90mstderr[2m | server/src/__tests__/unit/hooks/useOffline.test.ts[2m > [22m[2museOffline[2m > [22m[2msaveOffline[2m > [22m[2mshould throw error when save fails
[22m[39mFailed to save offline data to kuis: Error: Save failed
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\hooks\useOffline.test.ts:138:21
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | server/src/__tests__/unit/hooks/useOffline.test.ts[2m > [22m[2museOffline[2m > [22m[2mdeleteOffline[2m > [22m[2mshould throw error when delete fails
[22m[39mFailed to delete offline data from kuis: Error: Delete failed
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\hooks\useOffline.test.ts:317:21
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

 [32mâœ“[39m server/src/__tests__/unit/hooks/useOffline.test.ts [2m([22m[2m26 tests[22m[2m)[22m[33m 312[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/hooks/useNotification.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 213[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/hooks/useDebounce.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 225[2mms[22m[39m
[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mInitialization[2m > [22m[2mshould initialize successfully
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mInitialization[2m > [22m[2mshould initialize successfully
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mInitialization[2m > [22m[2mshould not initialize twice
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mInitialization[2m > [22m[2mshould not initialize twice
[22m[39m[SyncManager] Destroyed

[90mstderr[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mInitialization[2m > [22m[2mshould handle initialization errors gracefully
[22m[39mSyncManager init failed: Error: Network detector error
    at Object.<anonymous> [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\lib\offline\sync-manager.test.ts:136:15[90m)[39m
    at Object.mockCall [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at Object.spy [as on] [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at SyncManager.initialize [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\offline\sync-manager.ts:157:25[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mInitialization[2m > [22m[2mshould handle initialization errors gracefully
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mInitialization[2m > [22m[2mshould register background sync when supported
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mInitialization[2m > [22m[2mshould register background sync when supported
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould process sync successfully
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould process sync successfully
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould handle empty queue
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould handle empty queue
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould prevent concurrent syncs
[22m[39mSyncManager initialized

[90mstderr[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould prevent concurrent syncs
[22m[39m[SyncManager] Sync already in progress

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould prevent concurrent syncs
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould initialize queue manager if not ready
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould initialize queue manager if not ready
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould update statistics after sync
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould update statistics after sync
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould send message to service worker on completion
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould send message to service worker on completion
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould handle sync errors gracefully
[22m[39mSyncManager initialized

[90mstderr[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould handle sync errors gracefully
[22m[39m[SyncManager] Sync failed: Error: Queue processing failed
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\lib\offline\sync-manager.test.ts:236:9
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould handle sync errors gracefully
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould emit start event when sync begins
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould emit start event when sync begins
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould emit complete event when sync finishes
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould emit complete event when sync finishes
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould emit error event on sync failure
[22m[39mSyncManager initialized

[90mstderr[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould emit error event on sync failure
[22m[39m[SyncManager] Sync failed: Error: Sync failed
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\lib\offline\sync-manager.test.ts:281:9
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould emit error event on sync failure
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould allow adding and removing listeners
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould allow adding and removing listeners
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould handle listener errors gracefully
[22m[39mSyncManager initialized

[90mstderr[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould handle listener errors gracefully
[22m[39m[SyncManager] Event listener error: Error: Listener error
    at badListener [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\lib\offline\sync-manager.test.ts:319:15[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\lib\offline\sync-manager.ts:491:9
    at Set.forEach (<anonymous>)
    at SyncManager.emitEvent [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\offline\sync-manager.ts:489:20[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\lib\offline\sync-manager.test.ts:326:30
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould handle listener errors gracefully
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould remove all listeners
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould remove all listeners
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould pause sync when requested
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould pause sync when requested
[22m[39m[SyncManager] Sync paused

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould pause sync when requested
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould not allow pause when not syncing
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould not allow pause when not syncing
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould resume paused sync
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould resume paused sync
[22m[39m[SyncManager] Sync paused
[SyncManager] Sync resumed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould resume paused sync
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould emit pause event
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould emit pause event
[22m[39m[SyncManager] Sync paused

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould emit pause event
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould emit resume event
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould emit resume event
[22m[39m[SyncManager] Sync paused
[SyncManager] Sync resumed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould emit resume event
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould prevent sync when paused
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould prevent sync when paused
[22m[39m[SyncManager] Sync paused

[90mstderr[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould prevent sync when paused
[22m[39m[SyncManager] Sync already in progress

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould prevent sync when paused
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mRetry Failed Items[2m > [22m[2mshould retry failed items
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mRetry Failed Items[2m > [22m[2mshould retry failed items
[22m[39m[SyncManager] Retrying 2 failed items

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mRetry Failed Items[2m > [22m[2mshould retry failed items
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mRetry Failed Items[2m > [22m[2mshould not process if no failed items
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mRetry Failed Items[2m > [22m[2mshould not process if no failed items
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould track sync statistics
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould track sync statistics
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould accumulate statistics across multiple syncs
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould accumulate statistics across multiple syncs
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould limit history to 100 entries
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould limit history to 100 entries
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould calculate average duration correctly
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould calculate average duration correctly
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould clear history
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould clear history
[22m[39m[SyncManager] Sync history cleared

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould clear history
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould reset all statistics
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould reset all statistics
[22m[39m[SyncManager] Statistics reset

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould reset all statistics
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatus Tracking[2m > [22m[2mshould track sync status correctly
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatus Tracking[2m > [22m[2mshould track sync status correctly
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatus Tracking[2m > [22m[2mshould report sync in progress
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatus Tracking[2m > [22m[2mshould report sync in progress
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mLifecycle[2m > [22m[2mshould destroy properly
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mLifecycle[2m > [22m[2mshould destroy properly
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mLifecycle[2m > [22m[2mshould destroy properly
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mLifecycle[2m > [22m[2mshould remove event listeners on destroy
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mLifecycle[2m > [22m[2mshould remove event listeners on destroy
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mLifecycle[2m > [22m[2mshould remove event listeners on destroy
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mQueue Statistics[2m > [22m[2mshould get queue statistics
[22m[39mSyncManager initialized

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mQueue Statistics[2m > [22m[2mshould get queue statistics
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mConfiguration[2m > [22m[2mshould use default configuration
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mConfiguration[2m > [22m[2mshould accept custom configuration
[22m[39m[SyncManager] Destroyed

 [32mâœ“[39m src/__tests__/unit/lib/offline/sync-manager.test.ts [2m([22m[2m38 tests[22m[2m)[22m[33m 444[2mms[22m[39m
[90mstderr[2m | src/__tests__/unit/hooks/useOffline.test.ts[2m > [22m[2museOffline[2m > [22m[2msaveOffline[2m > [22m[2mshould throw error when save fails
[22m[39mFailed to save offline data to kuis: Error: Save failed
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\hooks\useOffline.test.ts:138:21
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | src/__tests__/unit/hooks/useOffline.test.ts[2m > [22m[2museOffline[2m > [22m[2mdeleteOffline[2m > [22m[2mshould throw error when delete fails
[22m[39mFailed to delete offline data from kuis: Error: Delete failed
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\hooks\useOffline.test.ts:317:21
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

 [32mâœ“[39m src/__tests__/unit/hooks/useOffline.test.ts [2m([22m[2m26 tests[22m[2m)[22m[33m 313[2mms[22m[39m
[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch all jadwal without filters
[22m[39mðŸ“‹ getJadwal called with filters: [90mundefined[39m

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch all jadwal without filters
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: []

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with kelas filter
[22m[39mðŸ“‹ getJadwal called with filters: { kelas: [32m'A'[39m }

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with kelas filter
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: [ { column: [32m'kelas'[39m, operator: [32m'eq'[39m, value: [32m'A'[39m } ]

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with laboratorium filter
[22m[39mðŸ“‹ getJadwal called with filters: { laboratorium_id: [32m'lab-1'[39m }

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with laboratorium filter
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: [ { column: [32m'laboratorium_id'[39m, operator: [32m'eq'[39m, value: [32m'lab-1'[39m } ]

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with hari filter
[22m[39mðŸ“‹ getJadwal called with filters: { hari: [32m'senin'[39m }

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with hari filter
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: [ { column: [32m'hari'[39m, operator: [32m'eq'[39m, value: [32m'senin'[39m } ]

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with is_active filter
[22m[39mðŸ“‹ getJadwal called with filters: { is_active: [33mtrue[39m }

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with is_active filter
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: [ { column: [32m'is_active'[39m, operator: [32m'eq'[39m, value: [33mtrue[39m } ]

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with multiple filters
[22m[39mðŸ“‹ getJadwal called with filters: {
  kelas: [32m'A'[39m,
  laboratorium_id: [32m'lab-1'[39m,
  hari: [32m'senin'[39m,
  is_active: [33mtrue[39m
}

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with multiple filters
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: [
  { column: [32m'kelas'[39m, operator: [32m'eq'[39m, value: [32m'A'[39m },
  { column: [32m'laboratorium_id'[39m, operator: [32m'eq'[39m, value: [32m'lab-1'[39m },
  { column: [32m'hari'[39m, operator: [32m'eq'[39m, value: [32m'senin'[39m },
  { column: [32m'is_active'[39m, operator: [32m'eq'[39m, value: [33mtrue[39m }
]

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ“‹ getJadwal called with filters: [90mundefined[39m

[90mstderr[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould handle errors gracefully
[22m[39m  Message: Database error
  Code: UNKNOWN

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ”´ API Error (getJadwal)

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwalById[2m > [22m[2mshould handle errors when jadwal not found
[22m[39mðŸ”´ API Error (getJadwalById:invalid-id)

[90mstderr[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwalById[2m > [22m[2mshould handle errors when jadwal not found
[22m[39m  Message: Jadwal not found
  Code: UNKNOWN

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwalByLab[2m > [22m[2mshould fetch active jadwal for specific lab
[22m[39mðŸ“‹ getJadwal called with filters: { laboratorium_id: [32m'lab-1'[39m, is_active: [33mtrue[39m }

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwalByLab[2m > [22m[2mshould fetch active jadwal for specific lab
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: [
  { column: [32m'laboratorium_id'[39m, operator: [32m'eq'[39m, value: [32m'lab-1'[39m },
  { column: [32m'is_active'[39m, operator: [32m'eq'[39m, value: [33mtrue[39m }
]

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwalByLab[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ“‹ getJadwal called with filters: { laboratorium_id: [32m'lab-1'[39m, is_active: [33mtrue[39m }

[90mstderr[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwalByLab[2m > [22m[2mshould handle errors gracefully
[22m[39m  Message: Database error
  Code: UNKNOWN

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwalByLab[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ”´ API Error (getJadwal)

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwalByLab[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ”´ API Error (getJadwalByLab:lab-1)

[90mstderr[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwalByLab[2m > [22m[2mshould handle errors gracefully
[22m[39m  Message: Database error
  Code: UNKNOWN

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetCalendarEvents[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ” getCalendarEvents called: {
  startDate: [32m'2025-01-01 08:00:00'[39m,
  endDate: [32m'2025-01-31 08:00:00'[39m,
  startDateISO: [32m'2025-01-01T00:00:00.000Z'[39m,
  endDateISO: [32m'2025-01-31T00:00:00.000Z'[39m,
  startDateFormatted: [32m'2025-01-01'[39m,
  endDateFormatted: [32m'2025-01-31'[39m
}

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetCalendarEvents[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ”´ API Error (getCalendarEvents)

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mcheckJadwalConflictByDate[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ”´ API Error (checkJadwalConflictByDate)

[90mstderr[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mcheckJadwalConflictByDate[2m > [22m[2mshould handle errors gracefully
[22m[39m  Message: Database error
  Code: UNKNOWN

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mcheckJadwalConflict (Legacy)[2m > [22m[2mshould check conflicts by hari
[22m[39mðŸ“‹ getJadwal called with filters: { laboratorium_id: [32m'lab-1'[39m, hari: [32m'senin'[39m, is_active: [33mtrue[39m }

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mcheckJadwalConflict (Legacy)[2m > [22m[2mshould check conflicts by hari
[22m[39mðŸ“‹ getJadwal returning 0 items: []
ðŸ“‹ getJadwal filterConditions: [
  { column: [32m'laboratorium_id'[39m, operator: [32m'eq'[39m, value: [32m'lab-1'[39m },
  { column: [32m'hari'[39m, operator: [32m'eq'[39m, value: [32m'senin'[39m },
  { column: [32m'is_active'[39m, operator: [32m'eq'[39m, value: [33mtrue[39m }
]

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mcheckJadwalConflict (Legacy)[2m > [22m[2mshould return true when time overlaps on same hari
[22m[39mðŸ“‹ getJadwal called with filters: { laboratorium_id: [32m'lab-1'[39m, hari: [32m'senin'[39m, is_active: [33mtrue[39m }

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mcheckJadwalConflict (Legacy)[2m > [22m[2mshould return true when time overlaps on same hari
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'senin'[39m,
    jam_mulai: [32m'09:00'[39m,
    jam_selesai: [32m'11:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: [
  { column: [32m'laboratorium_id'[39m, operator: [32m'eq'[39m, value: [32m'lab-1'[39m },
  { column: [32m'hari'[39m, operator: [32m'eq'[39m, value: [32m'senin'[39m },
  { column: [32m'is_active'[39m, operator: [32m'eq'[39m, value: [33mtrue[39m }
]

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mcheckJadwalConflict (Legacy)[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ“‹ getJadwal called with filters: { laboratorium_id: [32m'lab-1'[39m, hari: [32m'senin'[39m, is_active: [33mtrue[39m }

[90mstderr[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mcheckJadwalConflict (Legacy)[2m > [22m[2mshould handle errors gracefully
[22m[39m  Message: Database error
  Code: UNKNOWN

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mcheckJadwalConflict (Legacy)[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ”´ API Error (getJadwal)

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mcheckJadwalConflict (Legacy)[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ”´ API Error (checkJadwalConflict)

[90mstderr[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mcheckJadwalConflict (Legacy)[2m > [22m[2mshould handle errors gracefully
[22m[39m  Message: Database error
  Code: UNKNOWN

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwalPraktikumMahasiswa[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ”´ API Error (getJadwalPraktikumMahasiswa)

[90mstderr[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwalPraktikumMahasiswa[2m > [22m[2mshould handle errors gracefully
[22m[39m  Message: Database error
  Code: UNKNOWN

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle empty jadwal array
[22m[39mðŸ“‹ getJadwal called with filters: [90mundefined[39m

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle empty jadwal array
[22m[39mðŸ“‹ getJadwal returning 0 items: []
ðŸ“‹ getJadwal filterConditions: []

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mBusiness Logic Validation[2m > [22m[2mshould only return active jadwal when filtering
[22m[39mðŸ“‹ getJadwal called with filters: { laboratorium_id: [32m'lab-1'[39m, is_active: [33mtrue[39m }

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mBusiness Logic Validation[2m > [22m[2mshould only return active jadwal when filtering
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: [
  { column: [32m'laboratorium_id'[39m, operator: [32m'eq'[39m, value: [32m'lab-1'[39m },
  { column: [32m'is_active'[39m, operator: [32m'eq'[39m, value: [33mtrue[39m }
]

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mBusiness Logic Validation[2m > [22m[2mshould sort jadwal by tanggal_praktikum ascending
[22m[39mðŸ“‹ getJadwal called with filters: [90mundefined[39m

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mBusiness Logic Validation[2m > [22m[2mshould sort jadwal by tanggal_praktikum ascending
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: []

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mBusiness Logic Validation[2m > [22m[2mshould include laboratorium relation in queries
[22m[39mðŸ“‹ getJadwal called with filters: [90mundefined[39m

[90mstdout[2m | server/src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mBusiness Logic Validation[2m > [22m[2mshould include laboratorium relation in queries
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: { id: [32m'kelas-1'[39m, nama_kelas: [32m'A'[39m },
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m,
    laboratorium: {
      id: [32m'lab-1'[39m,
      nama_lab: [32m'Lab Kebidanan 1'[39m,
      kode_lab: [32m'KB-01'[39m,
      kapasitas: [33m30[39m
    }
  }
]
ðŸ“‹ getJadwal filterConditions: []

 [32mâœ“[39m server/src/__tests__/unit/api/jadwal.api.test.ts [2m([22m[2m38 tests[22m[2m)[22m[33m 995[2mms[22m[39m
   [33m[2mâœ“[22m[39m Jadwal API[2m > [22mgetJadwal[2m > [22mshould fetch all jadwal without filters [33m 622[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/hooks/useNotification.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 173[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/hooks/useDebounce.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 204[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/hooks/useTheme.test.tsx [2m([22m[2m5 tests[22m[2m)[22m[32m 97[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/offline/api-cache.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 125[2mms[22m[39m
[90mstdout[2m | src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2minsert[2m > [22m[2mshould insert single record
[22m[39mðŸ” DEBUG: insert called with table: test_table data: { name: [32m'New Item'[39m }

[90mstdout[2m | src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2minsert[2m > [22m[2mshould insert single record
[22m[39mðŸ” DEBUG: insert result: { result: { id: [32m'1'[39m, name: [32m'Test 1'[39m, value: [33m10[39m }, error: [1mnull[22m }
âœ… DEBUG: insert success: { id: [32m'1'[39m, name: [32m'Test 1'[39m, value: [33m10[39m }

[90mstdout[2m | src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2minsert[2m > [22m[2mshould throw error when insert fails
[22m[39mðŸ” DEBUG: insert called with table: test_table data: { name: [32m'New Item'[39m }

[90mstdout[2m | src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2minsert[2m > [22m[2mshould throw error when insert fails
[22m[39mðŸ” DEBUG: insert result: { result: [1mnull[22m, error: [1mnull[22m }

[90mstderr[2m | src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2minsert[2m > [22m[2mshould throw error when insert fails
[22m[39mâŒ DEBUG: insert failed - no data returned
âŒ DEBUG: insert catch error: BaseApiError: Insert failed - no data returned
    at Module.insert [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\base.api.ts:380:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstdout[2m | src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2mremove[2m > [22m[2mshould delete record by ID
[22m[39mðŸ—‘ï¸ Deleting from test_table where id = 1
ðŸ”§ Using hard delete for test_table

[90mstdout[2m | src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - CRUD Operations[2m > [22m[2mremove[2m > [22m[2mshould delete record by ID
[22m[39mðŸ“Š Hard delete result: error=false, count=undefined

[90mstdout[2m | src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Integration[2m > [22m[2mshould handle complete CRUD workflow
[22m[39mðŸ” DEBUG: insert called with table: test_table data: { name: [32m'Test'[39m }

[90mstdout[2m | src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Integration[2m > [22m[2mshould handle complete CRUD workflow
[22m[39mðŸ” DEBUG: insert result: { result: { id: [32m'new-id'[39m, name: [32m'Test'[39m }, error: [1mnull[22m }
âœ… DEBUG: insert success: { id: [32m'new-id'[39m, name: [32m'Test'[39m }

[90mstdout[2m | src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Integration[2m > [22m[2mshould handle complete CRUD workflow
[22m[39mðŸ—‘ï¸ Deleting from test_table where id = new-id
ðŸ”§ Using hard delete for test_table

[90mstdout[2m | src/__tests__/unit/api/base.api.test.ts[2m > [22m[2mBase API - Integration[2m > [22m[2mshould handle complete CRUD workflow
[22m[39mðŸ“Š Hard delete result: error=false, count=undefined

 [32mâœ“[39m src/__tests__/unit/api/base.api.test.ts [2m([22m[2m32 tests[22m[2m)[22m[32m 234[2mms[22m[39m
[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mInitialization[2m > [22m[2mshould initialize successfully
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mInitialization[2m > [22m[2mshould initialize successfully
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mInitialization[2m > [22m[2mshould not initialize twice
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mInitialization[2m > [22m[2mshould not initialize twice
[22m[39m[SyncManager] Destroyed

[90mstderr[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mInitialization[2m > [22m[2mshould handle initialization errors gracefully
[22m[39mSyncManager init failed: Error: Network detector error
    at Object.<anonymous> [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\lib\offline\sync-manager.test.ts:136:15[90m)[39m
    at Object.mockCall [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at Object.spy [as on] [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at SyncManager.initialize [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\sync-manager.ts:157:25[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mInitialization[2m > [22m[2mshould handle initialization errors gracefully
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mInitialization[2m > [22m[2mshould register background sync when supported
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mInitialization[2m > [22m[2mshould register background sync when supported
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould process sync successfully
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould process sync successfully
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould handle empty queue
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould handle empty queue
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould prevent concurrent syncs
[22m[39mSyncManager initialized

[90mstderr[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould prevent concurrent syncs
[22m[39m[SyncManager] Sync already in progress

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould prevent concurrent syncs
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould initialize queue manager if not ready
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould initialize queue manager if not ready
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould update statistics after sync
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould update statistics after sync
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould send message to service worker on completion
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould send message to service worker on completion
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould handle sync errors gracefully
[22m[39mSyncManager initialized

[90mstderr[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould handle sync errors gracefully
[22m[39m[SyncManager] Sync failed: Error: Queue processing failed
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\lib\offline\sync-manager.test.ts:236:9
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mSync Processing[2m > [22m[2mshould handle sync errors gracefully
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould emit start event when sync begins
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould emit start event when sync begins
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould emit complete event when sync finishes
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould emit complete event when sync finishes
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould emit error event on sync failure
[22m[39mSyncManager initialized

[90mstderr[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould emit error event on sync failure
[22m[39m[SyncManager] Sync failed: Error: Sync failed
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\lib\offline\sync-manager.test.ts:281:9
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould emit error event on sync failure
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould allow adding and removing listeners
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould allow adding and removing listeners
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould handle listener errors gracefully
[22m[39mSyncManager initialized

[90mstderr[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould handle listener errors gracefully
[22m[39m[SyncManager] Event listener error: Error: Listener error
    at badListener [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\lib\offline\sync-manager.test.ts:319:15[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\sync-manager.ts:491:9
    at Set.forEach (<anonymous>)
    at SyncManager.emitEvent [90m(F:\tes 9\sistem-praktikum-pwa\[39mserver\src\lib\offline\sync-manager.ts:489:20[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39mserver\src\__tests__\unit\lib\offline\sync-manager.test.ts:326:30
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould handle listener errors gracefully
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould remove all listeners
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mEvent System[2m > [22m[2mshould remove all listeners
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould pause sync when requested
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould pause sync when requested
[22m[39m[SyncManager] Sync paused

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould pause sync when requested
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould not allow pause when not syncing
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould not allow pause when not syncing
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould resume paused sync
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould resume paused sync
[22m[39m[SyncManager] Sync paused
[SyncManager] Sync resumed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould resume paused sync
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould emit pause event
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould emit pause event
[22m[39m[SyncManager] Sync paused

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould emit pause event
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould emit resume event
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould emit resume event
[22m[39m[SyncManager] Sync paused
[SyncManager] Sync resumed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould emit resume event
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould prevent sync when paused
[22m[39mSyncManager initialized

[90mstderr[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould prevent sync when paused
[22m[39m[SyncManager] Sync already in progress

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould prevent sync when paused
[22m[39m[SyncManager] Sync paused

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mPause/Resume[2m > [22m[2mshould prevent sync when paused
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mRetry Failed Items[2m > [22m[2mshould retry failed items
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mRetry Failed Items[2m > [22m[2mshould retry failed items
[22m[39m[SyncManager] Retrying 2 failed items

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mRetry Failed Items[2m > [22m[2mshould retry failed items
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mRetry Failed Items[2m > [22m[2mshould not process if no failed items
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mRetry Failed Items[2m > [22m[2mshould not process if no failed items
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould track sync statistics
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould track sync statistics
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould accumulate statistics across multiple syncs
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould accumulate statistics across multiple syncs
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould limit history to 100 entries
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould limit history to 100 entries
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould calculate average duration correctly
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould calculate average duration correctly
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould clear history
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould clear history
[22m[39m[SyncManager] Sync history cleared

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould clear history
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould reset all statistics
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould reset all statistics
[22m[39m[SyncManager] Statistics reset

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatistics[2m > [22m[2mshould reset all statistics
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatus Tracking[2m > [22m[2mshould track sync status correctly
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatus Tracking[2m > [22m[2mshould track sync status correctly
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatus Tracking[2m > [22m[2mshould report sync in progress
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mStatus Tracking[2m > [22m[2mshould report sync in progress
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mLifecycle[2m > [22m[2mshould destroy properly
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mLifecycle[2m > [22m[2mshould destroy properly
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mLifecycle[2m > [22m[2mshould destroy properly
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mLifecycle[2m > [22m[2mshould remove event listeners on destroy
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mLifecycle[2m > [22m[2mshould remove event listeners on destroy
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mLifecycle[2m > [22m[2mshould remove event listeners on destroy
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mQueue Statistics[2m > [22m[2mshould get queue statistics
[22m[39mSyncManager initialized

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mQueue Statistics[2m > [22m[2mshould get queue statistics
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mConfiguration[2m > [22m[2mshould use default configuration
[22m[39m[SyncManager] Destroyed

[90mstdout[2m | server/src/__tests__/unit/lib/offline/sync-manager.test.ts[2m > [22m[2mSyncManager[2m > [22m[2mConfiguration[2m > [22m[2mshould accept custom configuration
[22m[39m[SyncManager] Destroyed

 [32mâœ“[39m server/src/__tests__/unit/lib/offline/sync-manager.test.ts [2m([22m[2m38 tests[22m[2m)[22m[32m 232[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/utils/helpers.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 121[2mms[22m[39m
[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch all jadwal without filters
[22m[39mðŸ“‹ getJadwal called with filters: [90mundefined[39m

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch all jadwal without filters
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: []

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with kelas filter
[22m[39mðŸ“‹ getJadwal called with filters: { kelas: [32m'A'[39m }

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with kelas filter
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: [ { column: [32m'kelas'[39m, operator: [32m'eq'[39m, value: [32m'A'[39m } ]

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with laboratorium filter
[22m[39mðŸ“‹ getJadwal called with filters: { laboratorium_id: [32m'lab-1'[39m }

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with laboratorium filter
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: [ { column: [32m'laboratorium_id'[39m, operator: [32m'eq'[39m, value: [32m'lab-1'[39m } ]

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with hari filter
[22m[39mðŸ“‹ getJadwal called with filters: { hari: [32m'senin'[39m }

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with hari filter
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: [ { column: [32m'hari'[39m, operator: [32m'eq'[39m, value: [32m'senin'[39m } ]

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with is_active filter
[22m[39mðŸ“‹ getJadwal called with filters: { is_active: [33mtrue[39m }

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with is_active filter
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: [ { column: [32m'is_active'[39m, operator: [32m'eq'[39m, value: [33mtrue[39m } ]

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with multiple filters
[22m[39mðŸ“‹ getJadwal called with filters: {
  kelas: [32m'A'[39m,
  laboratorium_id: [32m'lab-1'[39m,
  hari: [32m'senin'[39m,
  is_active: [33mtrue[39m
}

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould fetch jadwal with multiple filters
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: [
  { column: [32m'kelas'[39m, operator: [32m'eq'[39m, value: [32m'A'[39m },
  { column: [32m'laboratorium_id'[39m, operator: [32m'eq'[39m, value: [32m'lab-1'[39m },
  { column: [32m'hari'[39m, operator: [32m'eq'[39m, value: [32m'senin'[39m },
  { column: [32m'is_active'[39m, operator: [32m'eq'[39m, value: [33mtrue[39m }
]

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwal[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ“‹ getJadwal called with filters: [90mundefined[39m

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwalByLab[2m > [22m[2mshould fetch active jadwal for specific lab
[22m[39mðŸ“‹ getJadwal called with filters: { laboratorium_id: [32m'lab-1'[39m, is_active: [33mtrue[39m }

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwalByLab[2m > [22m[2mshould fetch active jadwal for specific lab
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: [
  { column: [32m'laboratorium_id'[39m, operator: [32m'eq'[39m, value: [32m'lab-1'[39m },
  { column: [32m'is_active'[39m, operator: [32m'eq'[39m, value: [33mtrue[39m }
]

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetJadwalByLab[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ“‹ getJadwal called with filters: { laboratorium_id: [32m'lab-1'[39m, is_active: [33mtrue[39m }

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mgetCalendarEvents[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ” getCalendarEvents called: {
  startDate: [32m'2025-01-01 08:00:00'[39m,
  endDate: [32m'2025-01-31 08:00:00'[39m,
  startDateISO: [32m'2025-01-01T00:00:00.000Z'[39m,
  endDateISO: [32m'2025-01-31T00:00:00.000Z'[39m,
  startDateFormatted: [32m'2025-01-01'[39m,
  endDateFormatted: [32m'2025-01-31'[39m
}

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mcheckJadwalConflict (Legacy)[2m > [22m[2mshould check conflicts by hari
[22m[39mðŸ“‹ getJadwal called with filters: { laboratorium_id: [32m'lab-1'[39m, hari: [32m'senin'[39m, is_active: [33mtrue[39m }

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mcheckJadwalConflict (Legacy)[2m > [22m[2mshould check conflicts by hari
[22m[39mðŸ“‹ getJadwal returning 0 items: []
ðŸ“‹ getJadwal filterConditions: [
  { column: [32m'laboratorium_id'[39m, operator: [32m'eq'[39m, value: [32m'lab-1'[39m },
  { column: [32m'hari'[39m, operator: [32m'eq'[39m, value: [32m'senin'[39m },
  { column: [32m'is_active'[39m, operator: [32m'eq'[39m, value: [33mtrue[39m }
]

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mcheckJadwalConflict (Legacy)[2m > [22m[2mshould return true when time overlaps on same hari
[22m[39mðŸ“‹ getJadwal called with filters: { laboratorium_id: [32m'lab-1'[39m, hari: [32m'senin'[39m, is_active: [33mtrue[39m }

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mcheckJadwalConflict (Legacy)[2m > [22m[2mshould return true when time overlaps on same hari
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'senin'[39m,
    jam_mulai: [32m'09:00'[39m,
    jam_selesai: [32m'11:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: [
  { column: [32m'laboratorium_id'[39m, operator: [32m'eq'[39m, value: [32m'lab-1'[39m },
  { column: [32m'hari'[39m, operator: [32m'eq'[39m, value: [32m'senin'[39m },
  { column: [32m'is_active'[39m, operator: [32m'eq'[39m, value: [33mtrue[39m }
]

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mcheckJadwalConflict (Legacy)[2m > [22m[2mshould handle errors gracefully
[22m[39mðŸ“‹ getJadwal called with filters: { laboratorium_id: [32m'lab-1'[39m, hari: [32m'senin'[39m, is_active: [33mtrue[39m }

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle empty jadwal array
[22m[39mðŸ“‹ getJadwal called with filters: [90mundefined[39m

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle empty jadwal array
[22m[39mðŸ“‹ getJadwal returning 0 items: []
ðŸ“‹ getJadwal filterConditions: []

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mBusiness Logic Validation[2m > [22m[2mshould only return active jadwal when filtering
[22m[39mðŸ“‹ getJadwal called with filters: { laboratorium_id: [32m'lab-1'[39m, is_active: [33mtrue[39m }

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mBusiness Logic Validation[2m > [22m[2mshould only return active jadwal when filtering
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: [
  { column: [32m'laboratorium_id'[39m, operator: [32m'eq'[39m, value: [32m'lab-1'[39m },
  { column: [32m'is_active'[39m, operator: [32m'eq'[39m, value: [33mtrue[39m }
]

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mBusiness Logic Validation[2m > [22m[2mshould sort jadwal by tanggal_praktikum ascending
[22m[39mðŸ“‹ getJadwal called with filters: [90mundefined[39m

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mBusiness Logic Validation[2m > [22m[2mshould sort jadwal by tanggal_praktikum ascending
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: [32m'A'[39m,
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m
  }
]
ðŸ“‹ getJadwal filterConditions: []

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mBusiness Logic Validation[2m > [22m[2mshould include laboratorium relation in queries
[22m[39mðŸ“‹ getJadwal called with filters: [90mundefined[39m

[90mstdout[2m | src/__tests__/unit/api/jadwal.api.test.ts[2m > [22m[2mJadwal API[2m > [22m[2mBusiness Logic Validation[2m > [22m[2mshould include laboratorium relation in queries
[22m[39mðŸ“‹ getJadwal returning 1 items: [
  {
    id: [32m'jadwal-1'[39m,
    kelas_id: [32m'kelas-1'[39m,
    kelas: { id: [32m'kelas-1'[39m, nama_kelas: [32m'A'[39m },
    laboratorium_id: [32m'lab-1'[39m,
    tanggal_praktikum: [32m'2025-01-15'[39m,
    hari: [32m'rabu'[39m,
    jam_mulai: [32m'08:00'[39m,
    jam_selesai: [32m'10:00'[39m,
    topik: [32m'Praktikum Kebidanan Dasar'[39m,
    catatan: [32m'Bawa alat tulis'[39m,
    is_active: [33mtrue[39m,
    created_at: [32m'2025-01-01T00:00:00Z'[39m,
    updated_at: [32m'2025-01-01T00:00:00Z'[39m,
    laboratorium: {
      id: [32m'lab-1'[39m,
      nama_lab: [32m'Lab Kebidanan 1'[39m,
      kode_lab: [32m'KB-01'[39m,
      kapasitas: [33m30[39m
    }
  }
]
ðŸ“‹ getJadwal filterConditions: []

 [32mâœ“[39m src/__tests__/unit/api/jadwal.api.test.ts [2m([22m[2m38 tests[22m[2m)[22m[32m 283[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/utils/helpers.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 127[2mms[22m[39m
[90mstderr[2m | src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mgetLaboranStats[2m > [22m[2mshould handle database errors
[22m[39mError fetching laboran stats: Error: Database error
    at Object.<anonymous> [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\laboran.api.test.ts:146:15[90m)[39m
    at Object.mockCall [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at Object.spy [as from] [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at ttl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\laboran.api.ts:81:12[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\laboran.api.test.ts:22:32
    at mockCall [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at spy [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at Module.getLaboranStats [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\laboran.api.ts:75:10[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\laboran.api.test.ts:149:31
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11

[90mstderr[2m | src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mapprovePeminjaman[2m > [22m[2mshould fail when stock is insufficient
[22m[39mError approving peminjaman: Error: Stok tidak cukup! Mikroskop tersedia: 5, diminta: 10
    at Module.approvePeminjamanImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\laboran.api.ts:433:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\laboran.api.test.ts:501:7
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

[90mstderr[2m | src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mapprovePeminjaman[2m > [22m[2mshould fail when user not authenticated
[22m[39mError approving peminjaman: Error: User not authenticated
    at Module.approvePeminjamanImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\laboran.api.ts:406:22[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstderr[2m | src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mapprovePeminjaman[2m > [22m[2mshould fail when peminjaman not found
[22m[39mError approving peminjaman: Error: Peminjaman not found or not in pending status
    at Module.approvePeminjamanImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\laboran.api.ts:417:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\laboran.api.test.ts:538:7
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:20

[90mstderr[2m | src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mrejectPeminjaman[2m > [22m[2mshould fail when user not authenticated
[22m[39mError rejecting peminjaman: Error: User not authenticated
    at Module.rejectPeminjamanImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\laboran.api.ts:483:22[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstderr[2m | src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mInventaris CRUD[2m > [22m[2mcreateInventaris[2m > [22m[2mshould handle creation errors
[22m[39mError creating inventaris: Error: Creation failed
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\laboran.api.test.ts:705:24
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mInventaris CRUD[2m > [22m[2mdeleteInventaris[2m > [22m[2mshould fail when active borrowings exist
[22m[39mError deleting inventaris: Error: Cannot delete inventaris with active borrowings
    at Module.deleteInventarisImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\laboran.api.ts:808:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstderr[2m | src/__tests__/unit/api/laboran.api.test.ts[2m > [22m[2mLaboran API[2m > [22m[2mLaboratorium Management[2m > [22m[2mdeleteLaboratorium[2m > [22m[2mshould fail when equipment exists
[22m[39mError deleting laboratorium: Error: Cannot delete laboratory that has equipment assigned to it
    at Module.deleteLaboratoriumImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\laboran.api.ts:1159:13[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

 [32mâœ“[39m src/__tests__/unit/api/laboran.api.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 218[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/offline/offline-auth.test.ts [2m([22m[2m40 tests[22m[2m)[22m[32m 174[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/offline/api-cache.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 122[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/lib/offline/network-detector.test.ts [2m([22m[2m47 tests[22m[2m)[22m[32m 133[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/offline/offline-auth.test.ts [2m([22m[2m40 tests[22m[2m)[22m[32m 132[2mms[22m[39m
[90mstderr[2m | src/__tests__/unit/api/admin.api.test.ts[2m > [22m[2mAdmin API[2m > [22m[2mgetDashboardStats[2m > [22m[2mshould handle database errors
[22m[39mError fetching dashboard stats: Error: Database error
    at Object.<anonymous> [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\admin.api.test.ts:158:22[90m)[39m
    at Object.mockCall [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/spy[24m/dist/index.js:96:15[90m)[39m
    at Object.spy [as from] [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4mtinyspy[24m/dist/index.js:47:80[90m)[39m
    at Module.getDashboardStatsImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\admin.api.ts:67:8[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\admin.api.test.ts:163:29
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m

[90mstderr[2m | src/__tests__/unit/api/admin.api.test.ts[2m > [22m[2mAdmin API[2m > [22m[2mgetUserGrowth[2m > [22m[2mshould handle database errors
[22m[39mError fetching user growth: Error: Database error
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\admin.api.test.ts:279:20
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | src/__tests__/unit/api/admin.api.test.ts[2m > [22m[2mAdmin API[2m > [22m[2mgetUserDistribution[2m > [22m[2mshould handle database errors
[22m[39mError fetching user distribution: Error: Database error
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\admin.api.test.ts:366:18
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | src/__tests__/unit/api/admin.api.test.ts[2m > [22m[2mAdmin API[2m > [22m[2mgetLabUsage[2m > [22m[2mshould handle database errors
[22m[39mError fetching lab usage: Error: Database error
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\admin.api.test.ts:443:20
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | src/__tests__/unit/api/admin.api.test.ts[2m > [22m[2mAdmin API[2m > [22m[2mgetRecentUsers[2m > [22m[2mshould handle database errors
[22m[39mError fetching recent users: Error: Database error
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\admin.api.test.ts:568:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | src/__tests__/unit/api/admin.api.test.ts[2m > [22m[2mAdmin API[2m > [22m[2mgetRecentAnnouncements[2m > [22m[2mshould handle database errors
[22m[39mError fetching recent announcements: Error: Database error
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\admin.api.test.ts:691:22
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

 [32mâœ“[39m src/__tests__/unit/api/admin.api.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 138[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/utils/debounce.test.ts [2m([22m[2m24 tests[22m[2m)[22m[32m 113[2mms[22m[39m
[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to create kuis
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to create kuis
[22m[39mðŸ” DEBUG: user: { id: [32m'user-dosen-123'[39m, role: [32m'dosen'[39m, email: [32m'dosen@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: dosen permission: manage:kuis
âœ… DEBUG: Permission granted for role: dosen permission: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to update their own kuis
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to update their own kuis
[22m[39mðŸ” DEBUG: user: { id: [32m'user-dosen-123'[39m, role: [32m'dosen'[39m, email: [32m'dosen@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: dosen permission: manage:kuis
âœ… DEBUG: Permission granted for role: dosen permission: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to update their own kuis
[22m[39mâœ… Ownership verified: dosen owns kuis/kuis-123

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to delete their own kuis
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to delete their own kuis
[22m[39mðŸ” DEBUG: user: { id: [32m'user-dosen-123'[39m, role: [32m'dosen'[39m, email: [32m'dosen@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: dosen permission: manage:kuis
âœ… DEBUG: Permission granted for role: dosen permission: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to delete their own kuis
[22m[39mâœ… Ownership verified: dosen owns kuis/kuis-123

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould prevent dosen from updating kuis owned by another dosen
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould prevent dosen from updating kuis owned by another dosen
[22m[39mðŸ” DEBUG: user: { id: [32m'user-dosen-123'[39m, role: [32m'dosen'[39m, email: [32m'dosen@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: dosen permission: manage:kuis
âœ… DEBUG: Permission granted for role: dosen permission: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to create nilai for students
[22m[39mðŸ” DEBUG: checkPermission called: manage:nilai

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to create nilai for students
[22m[39mðŸ” DEBUG: user: { id: [32m'user-dosen-123'[39m, role: [32m'dosen'[39m, email: [32m'dosen@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: dosen permission: manage:nilai
âœ… DEBUG: Permission granted for role: dosen permission: manage:nilai

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Mahasiswa creates peminjaman[2m > [22m[2mshould allow mahasiswa to create peminjaman
[22m[39mðŸ” DEBUG: checkPermission called: create:peminjaman

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Mahasiswa creates peminjaman[2m > [22m[2mshould allow mahasiswa to create peminjaman
[22m[39mðŸ” DEBUG: user: { id: [32m'user-mhs-123'[39m, role: [32m'mahasiswa'[39m, email: [32m'mahasiswa@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: mahasiswa permission: create:peminjaman
âœ… DEBUG: Permission granted for role: mahasiswa permission: create:peminjaman

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Mahasiswa creates peminjaman[2m > [22m[2mshould prevent mahasiswa from creating kuis
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstderr[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Mahasiswa creates peminjaman[2m > [22m[2mshould prevent mahasiswa from creating kuis
[22m[39mâŒ DEBUG: Permission denied for role: mahasiswa permission: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Mahasiswa creates peminjaman[2m > [22m[2mshould prevent mahasiswa from creating kuis
[22m[39mðŸ” DEBUG: user: { id: [32m'user-mhs-123'[39m, role: [32m'mahasiswa'[39m, email: [32m'mahasiswa@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: mahasiswa permission: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Mahasiswa creates peminjaman[2m > [22m[2mshould prevent mahasiswa from approving peminjaman
[22m[39mðŸ” DEBUG: checkPermission called: approve:peminjaman

[90mstderr[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Mahasiswa creates peminjaman[2m > [22m[2mshould prevent mahasiswa from approving peminjaman
[22m[39mâŒ DEBUG: Permission denied for role: mahasiswa permission: approve:peminjaman

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Mahasiswa creates peminjaman[2m > [22m[2mshould prevent mahasiswa from approving peminjaman
[22m[39mðŸ” DEBUG: user: { id: [32m'user-mhs-123'[39m, role: [32m'mahasiswa'[39m, email: [32m'mahasiswa@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: mahasiswa permission: approve:peminjaman

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Laboran approves peminjaman[2m > [22m[2mshould allow laboran to approve peminjaman
[22m[39mðŸ” DEBUG: checkPermission called: approve:peminjaman

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Laboran approves peminjaman[2m > [22m[2mshould allow laboran to approve peminjaman
[22m[39mðŸ” DEBUG: user: { id: [32m'user-laboran-123'[39m, role: [32m'laboran'[39m, email: [32m'laboran@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: laboran permission: approve:peminjaman
âœ… DEBUG: Permission granted for role: laboran permission: approve:peminjaman

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Laboran approves peminjaman[2m > [22m[2mshould prevent laboran from creating kuis
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstderr[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Laboran approves peminjaman[2m > [22m[2mshould prevent laboran from creating kuis
[22m[39mâŒ DEBUG: Permission denied for role: laboran permission: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Laboran approves peminjaman[2m > [22m[2mshould prevent laboran from creating kuis
[22m[39mðŸ” DEBUG: user: { id: [32m'user-laboran-123'[39m, role: [32m'laboran'[39m, email: [32m'laboran@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: laboran permission: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Laboran approves peminjaman[2m > [22m[2mshould prevent laboran from managing nilai
[22m[39mðŸ” DEBUG: checkPermission called: manage:nilai

[90mstderr[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Laboran approves peminjaman[2m > [22m[2mshould prevent laboran from managing nilai
[22m[39mâŒ DEBUG: Permission denied for role: laboran permission: manage:nilai

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Laboran approves peminjaman[2m > [22m[2mshould prevent laboran from managing nilai
[22m[39mðŸ” DEBUG: user: { id: [32m'user-laboran-123'[39m, role: [32m'laboran'[39m, email: [32m'laboran@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: laboran permission: manage:nilai

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to create kuis (even without dosen_id)
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to create kuis (even without dosen_id)
[22m[39mðŸ” DEBUG: user: { id: [32m'user-admin-123'[39m, role: [32m'admin'[39m, email: [32m'admin@test.com'[39m }
âœ… DEBUG: Admin bypass for permission: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to update any kuis (ownership bypass)
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to update any kuis (ownership bypass)
[22m[39mðŸ” DEBUG: user: { id: [32m'user-admin-123'[39m, role: [32m'admin'[39m, email: [32m'admin@test.com'[39m }
âœ… DEBUG: Admin bypass for permission: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to update any kuis (ownership bypass)
[22m[39mâœ… Admin bypass: ownership check for kuis/kuis-123

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to approve peminjaman
[22m[39mðŸ” DEBUG: checkPermission called: approve:peminjaman

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to approve peminjaman
[22m[39mðŸ” DEBUG: user: { id: [32m'user-admin-123'[39m, role: [32m'admin'[39m, email: [32m'admin@test.com'[39m }
âœ… DEBUG: Admin bypass for permission: approve:peminjaman

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to create nilai
[22m[39mðŸ” DEBUG: checkPermission called: manage:nilai

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to create nilai
[22m[39mðŸ” DEBUG: user: { id: [32m'user-admin-123'[39m, role: [32m'admin'[39m, email: [32m'admin@test.com'[39m }
âœ… DEBUG: Admin bypass for permission: manage:nilai

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent mahasiswa from accessing dosen functions
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstderr[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent mahasiswa from accessing dosen functions
[22m[39mâŒ DEBUG: Permission denied for role: mahasiswa permission: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent mahasiswa from accessing dosen functions
[22m[39mðŸ” DEBUG: user: { id: [32m'user-mhs-123'[39m, role: [32m'mahasiswa'[39m, email: [32m'mahasiswa@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: mahasiswa permission: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent laboran from accessing dosen functions
[22m[39mðŸ” DEBUG: checkPermission called: manage:nilai

[90mstderr[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent laboran from accessing dosen functions
[22m[39mâŒ DEBUG: Permission denied for role: laboran permission: manage:nilai

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent laboran from accessing dosen functions
[22m[39mðŸ” DEBUG: user: { id: [32m'user-laboran-123'[39m, role: [32m'laboran'[39m, email: [32m'laboran@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: laboran permission: manage:nilai

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent dosen from accessing laboran functions
[22m[39mðŸ” DEBUG: checkPermission called: approve:peminjaman

[90mstderr[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent dosen from accessing laboran functions
[22m[39mâŒ DEBUG: Permission denied for role: dosen permission: approve:peminjaman

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent dosen from accessing laboran functions
[22m[39mðŸ” DEBUG: user: { id: [32m'user-dosen-123'[39m, role: [32m'dosen'[39m, email: [32m'dosen@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: dosen permission: approve:peminjaman

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Error handling and messages[2m > [22m[2mshould provide clear error message for permission denial
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstderr[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Error handling and messages[2m > [22m[2mshould provide clear error message for permission denial
[22m[39mâŒ DEBUG: Permission denied for role: mahasiswa permission: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Error handling and messages[2m > [22m[2mshould provide clear error message for permission denial
[22m[39mðŸ” DEBUG: user: { id: [32m'user-mhs-123'[39m, role: [32m'mahasiswa'[39m, email: [32m'mahasiswa@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: mahasiswa permission: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Error handling and messages[2m > [22m[2mshould provide clear error message for ownership denial
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstdout[2m | src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Error handling and messages[2m > [22m[2mshould provide clear error message for ownership denial
[22m[39mðŸ” DEBUG: user: { id: [32m'user-dosen-123'[39m, role: [32m'dosen'[39m, email: [32m'dosen@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: dosen permission: manage:kuis
âœ… DEBUG: Permission granted for role: dosen permission: manage:kuis

 [32mâœ“[39m src/__tests__/integration/middleware-rbac.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 167[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/api/kehadiran.api.test.ts [2m([22m[2m30 tests[22m[2m)[22m[32m 138[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/validations/auth.schema.test.ts [2m([22m[2m38 tests[22m[2m)[22m[32m 69[2mms[22m[39m
[90mstdout[2m | server/src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2minitializeCacheManager[2m > [22m[2mshould set app version on first run
[22m[39mðŸ”„ App version changed: null â†’ 1.0.0
âœ… Cache cleared successfully

[90mstdout[2m | server/src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2minitializeCacheManager[2m > [22m[2mshould clear cache when version changes
[22m[39mðŸ”„ App version changed: 0.9.0 â†’ 1.0.0
âœ… Cache cleared successfully

[90mstdout[2m | server/src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2minitializeCacheManager[2m > [22m[2mshould preserve auth data on version change
[22m[39mðŸ”„ App version changed: 0.9.0 â†’ 1.0.0
âœ… Cache cleared successfully

[90mstdout[2m | server/src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2mclearEverything[2m > [22m[2mshould clear localStorage
[22m[39mâœ… All storage cleared

[90mstdout[2m | server/src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2mclearEverything[2m > [22m[2mshould clear sessionStorage
[22m[39mâœ… All storage cleared

[90mstdout[2m | server/src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2mclearEverything[2m > [22m[2mshould clear cookies
[22m[39mâœ… All storage cleared

[90mstdout[2m | server/src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle full app lifecycle
[22m[39mðŸ”„ App version changed: null â†’ 1.0.0
âœ… Cache cleared successfully

[90mstdout[2m | server/src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle version migration
[22m[39mðŸ”„ App version changed: 0.5.0 â†’ 1.0.0
âœ… Cache cleared successfully

[90mstdout[2m | server/src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle logout scenario
[22m[39mâœ… All storage cleared

[90mstdout[2m | server/src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle localStorage quota exceeded
[22m[39mðŸ”„ App version changed: null â†’ 1.0.0

 [32mâœ“[39m server/src/__tests__/unit/utils/cache-manager.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 151[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/utils/format.test.ts [2m([22m[2m7 tests[22m[2m)[22m[33m 348[2mms[22m[39m
   [33m[2mâœ“[22m[39m Format Utilities[2m > [22mdate formatting[2m > [22mshould format date correctly [33m 308[2mms[22m[39m
[90mstderr[2m | src/__tests__/unit/api/analytics.api.test.ts[2m > [22m[2mAnalytics API - System Metrics[2m > [22m[2mgetSystemMetrics[2m > [22m[2mshould return zero metrics on error
[22m[39mError fetching system metrics: TypeError: __vite_ssr_import_0__.supabase.from(...).select(...).eq is not a function
    at Module.getSystemMetricsImpl [90m(F:\tes 9\sistem-praktikum-pwa\[39msrc\lib\api\analytics.api.ts:40:10[90m)[39m
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\analytics.api.test.ts:225:28
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

 [32mâœ“[39m src/__tests__/unit/api/analytics.api.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 41[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/hooks/useTheme.test.tsx [2m([22m[2m5 tests[22m[2m)[22m[32m 135[2mms[22m[39m
[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould allow admin to bypass permission check
[22m[39mðŸ” DEBUG: checkPermission called: create:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould allow admin to bypass permission check
[22m[39mðŸ” DEBUG: user: { id: [32m'admin-123'[39m, role: [32m'admin'[39m, email: [32m'admin@example.com'[39m }
âœ… DEBUG: Admin bypass for permission: create:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould allow user with permission
[22m[39mðŸ” DEBUG: checkPermission called: create:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould allow user with permission
[22m[39mðŸ” DEBUG: user: { id: [32m'user-123'[39m, role: [32m'dosen'[39m, email: [32m'test@example.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: dosen permission: create:kuis
âœ… DEBUG: Permission granted for role: dosen permission: create:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould throw PermissionError if user lacks permission
[22m[39mðŸ” DEBUG: checkPermission called: create:kuis

[90mstderr[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould throw PermissionError if user lacks permission
[22m[39mâŒ DEBUG: Permission denied for role: mahasiswa permission: create:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould throw PermissionError if user lacks permission
[22m[39mðŸ” DEBUG: user: { id: [32m'mhs-123'[39m, role: [32m'mahasiswa'[39m, email: [32m'mahasiswa@example.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: mahasiswa permission: create:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould throw PermissionError if user lacks permission
[22m[39mðŸ” DEBUG: checkPermission called: create:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould throw PermissionError if user lacks permission
[22m[39mðŸ” DEBUG: user: { id: [32m'mhs-123'[39m, role: [32m'mahasiswa'[39m, email: [32m'mahasiswa@example.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: mahasiswa permission: create:kuis

[90mstderr[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould throw PermissionError if user lacks permission
[22m[39mâŒ DEBUG: Permission denied for role: mahasiswa permission: create:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould include role in error message
[22m[39mðŸ” DEBUG: checkPermission called: manage:user

[90mstderr[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould include role in error message
[22m[39mâŒ DEBUG: Permission denied for role: mahasiswa permission: manage:user

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mcheckPermission[2m > [22m[2mshould include role in error message
[22m[39mðŸ” DEBUG: user: { id: [32m'mhs-123'[39m, role: [32m'mahasiswa'[39m, email: [32m'mahasiswa@example.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: mahasiswa permission: manage:user

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermission[2m > [22m[2mshould execute function if permission granted
[22m[39mðŸ” DEBUG: checkPermission called: create:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermission[2m > [22m[2mshould execute function if permission granted
[22m[39mðŸ” DEBUG: user: { id: [32m'user-123'[39m, role: [32m'dosen'[39m, email: [32m'test@example.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: dosen permission: create:kuis
âœ… DEBUG: Permission granted for role: dosen permission: create:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermission[2m > [22m[2mshould not execute function if permission denied
[22m[39mðŸ” DEBUG: checkPermission called: create:kuis

[90mstderr[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermission[2m > [22m[2mshould not execute function if permission denied
[22m[39mâŒ DEBUG: Permission denied for role: mahasiswa permission: create:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermission[2m > [22m[2mshould not execute function if permission denied
[22m[39mðŸ” DEBUG: user: { id: [32m'mhs-123'[39m, role: [32m'mahasiswa'[39m, email: [32m'mahasiswa@example.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: mahasiswa permission: create:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermission[2m > [22m[2mshould pass arguments to wrapped function
[22m[39mðŸ” DEBUG: checkPermission called: update:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermission[2m > [22m[2mshould pass arguments to wrapped function
[22m[39mðŸ” DEBUG: user: { id: [32m'admin-123'[39m, role: [32m'admin'[39m, email: [32m'admin@example.com'[39m }
âœ… DEBUG: Admin bypass for permission: update:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermission[2m > [22m[2mshould allow admin bypass
[22m[39mðŸ” DEBUG: checkPermission called: create:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermission[2m > [22m[2mshould allow admin bypass
[22m[39mðŸ” DEBUG: user: { id: [32m'admin-123'[39m, role: [32m'admin'[39m, email: [32m'admin@example.com'[39m }
âœ… DEBUG: Admin bypass for permission: create:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequireOwnership[2m > [22m[2mshould allow admin bypass by default
[22m[39mâœ… Admin bypass: ownership check for kuis/kuis-123

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequireOwnership[2m > [22m[2mshould allow owner to access their resource (user_id)
[22m[39mâœ… Ownership verified: dosen owns jawaban/jawaban-123

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequireOwnership[2m > [22m[2mshould allow dosen to access their own kuis
[22m[39mâœ… Ownership verified: dosen owns kuis/kuis-123

[90mstderr[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequireOwnership[2m > [22m[2mshould throw OwnershipError if not owner
[22m[39mâŒ Ownership denied: user-123 tried to access jawaban/jawaban-456 owned by different-user-id

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermissionAndOwnership[2m > [22m[2mshould check both permission and ownership
[22m[39mðŸ” DEBUG: checkPermission called: update:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermissionAndOwnership[2m > [22m[2mshould check both permission and ownership
[22m[39mðŸ” DEBUG: user: { id: [32m'user-123'[39m, role: [32m'dosen'[39m, email: [32m'test@example.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: dosen permission: update:kuis
âœ… DEBUG: Permission granted for role: dosen permission: update:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermissionAndOwnership[2m > [22m[2mshould check both permission and ownership
[22m[39mâœ… Ownership verified: dosen owns kuis/kuis-123

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermissionAndOwnership[2m > [22m[2mshould fail if permission denied
[22m[39mðŸ” DEBUG: checkPermission called: delete:kuis

[90mstderr[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermissionAndOwnership[2m > [22m[2mshould fail if permission denied
[22m[39mâŒ DEBUG: Permission denied for role: mahasiswa permission: delete:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermissionAndOwnership[2m > [22m[2mshould fail if permission denied
[22m[39mðŸ” DEBUG: user: { id: [32m'mhs-123'[39m, role: [32m'mahasiswa'[39m, email: [32m'mahasiswa@example.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: mahasiswa permission: delete:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermissionAndOwnership[2m > [22m[2mshould fail if ownership denied
[22m[39mðŸ” DEBUG: checkPermission called: update:kuis

[90mstdout[2m | src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22m[2mPermission Middleware[2m > [22m[2mrequirePermissionAndOwnership[2m > [22m[2mshould fail if ownership denied
[22m[39mðŸ” DEBUG: user: { id: [32m'user-123'[39m, role: [32m'dosen'[39m, email: [32m'test@example.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: dosen permission: update:kuis
âœ… DEBUG: Permission granted for role: dosen permission: update:kuis

 [32mâœ“[39m src/__tests__/unit/middleware/permission.middleware.test.ts [2m([22m[2m33 tests[22m[2m)[22m[32m 86[2mms[22m[39m
[90mstdout[2m | src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2minitializeCacheManager[2m > [22m[2mshould set app version on first run
[22m[39mðŸ”„ App version changed: null â†’ 1.0.0
âœ… Cache cleared successfully

[90mstdout[2m | src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2minitializeCacheManager[2m > [22m[2mshould clear cache when version changes
[22m[39mðŸ”„ App version changed: 0.9.0 â†’ 1.0.0
âœ… Cache cleared successfully

[90mstdout[2m | src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2minitializeCacheManager[2m > [22m[2mshould preserve auth data on version change
[22m[39mðŸ”„ App version changed: 0.9.0 â†’ 1.0.0
âœ… Cache cleared successfully

[90mstdout[2m | src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2mclearEverything[2m > [22m[2mshould clear localStorage
[22m[39mâœ… All storage cleared

[90mstdout[2m | src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2mclearEverything[2m > [22m[2mshould clear sessionStorage
[22m[39mâœ… All storage cleared

[90mstdout[2m | src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2mclearEverything[2m > [22m[2mshould clear cookies
[22m[39mâœ… All storage cleared

[90mstdout[2m | src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle full app lifecycle
[22m[39mðŸ”„ App version changed: null â†’ 1.0.0
âœ… Cache cleared successfully

[90mstdout[2m | src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle version migration
[22m[39mðŸ”„ App version changed: 0.5.0 â†’ 1.0.0
âœ… Cache cleared successfully

[90mstdout[2m | src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2mIntegration Scenarios[2m > [22m[2mshould handle logout scenario
[22m[39mâœ… All storage cleared

[90mstdout[2m | src/__tests__/unit/utils/cache-manager.test.ts[2m > [22m[2mCache Manager[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle localStorage quota exceeded
[22m[39mðŸ”„ App version changed: null â†’ 1.0.0

 [32mâœ“[39m src/__tests__/unit/utils/cache-manager.test.ts [2m([22m[2m27 tests[22m[2m)[22m[32m 93[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/hooks/useRole.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 81[2mms[22m[39m
[90mstderr[2m | src/__tests__/unit/api/nilai.api.test.ts[2m > [22m[2mNilai API - CRUD Operations[2m > [22m[2mgetNilaiByKelas[2m > [22m[2mshould throw error on database error
[22m[39mgetNilaiByKelas error: Error: DB Error
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\nilai.api.test.ts:251:53
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

[90mstderr[2m | src/__tests__/unit/api/nilai.api.test.ts[2m > [22m[2mNilai API - CRUD Operations[2m > [22m[2mgetNilaiById[2m > [22m[2mshould throw error when nilai not found
[22m[39mgetNilaiById error: Error: Not found
    at [90mF:\tes 9\sistem-praktikum-pwa\[39msrc\__tests__\unit\api\nilai.api.test.ts:302:52
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:155:11
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:752:26
    at [90mfile:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1897:20
    at new Promise (<anonymous>)
    at runWithTimeout [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1863:10[90m)[39m
    at runTest [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1574:12[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m
    at runSuite [90m(file:///F:/tes%209/sistem-praktikum-pwa/[39mnode_modules/[4m@vitest/runner[24m/dist/chunk-hooks.js:1729:8[90m)[39m

 [32mâœ“[39m src/__tests__/unit/api/nilai.api.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 101[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/hooks/useRole.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 134[2mms[22m[39m
[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to create kuis
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to create kuis
[22m[39mðŸ” DEBUG: user: { id: [32m'user-dosen-123'[39m, role: [32m'dosen'[39m, email: [32m'dosen@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: dosen permission: manage:kuis
âœ… DEBUG: Permission granted for role: dosen permission: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to update their own kuis
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to update their own kuis
[22m[39mðŸ” DEBUG: user: { id: [32m'user-dosen-123'[39m, role: [32m'dosen'[39m, email: [32m'dosen@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: dosen permission: manage:kuis
âœ… DEBUG: Permission granted for role: dosen permission: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to update their own kuis
[22m[39mâœ… Ownership verified: dosen owns kuis/kuis-123

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to delete their own kuis
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to delete their own kuis
[22m[39mðŸ” DEBUG: user: { id: [32m'user-dosen-123'[39m, role: [32m'dosen'[39m, email: [32m'dosen@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: dosen permission: manage:kuis
âœ… DEBUG: Permission granted for role: dosen permission: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to delete their own kuis
[22m[39mâœ… Ownership verified: dosen owns kuis/kuis-123

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould prevent dosen from updating kuis owned by another dosen
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould prevent dosen from updating kuis owned by another dosen
[22m[39mðŸ” DEBUG: user: { id: [32m'user-dosen-123'[39m, role: [32m'dosen'[39m, email: [32m'dosen@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: dosen permission: manage:kuis
âœ… DEBUG: Permission granted for role: dosen permission: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to create nilai for students
[22m[39mðŸ” DEBUG: checkPermission called: manage:nilai

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Dosen manages kuis[2m > [22m[2mshould allow dosen to create nilai for students
[22m[39mðŸ” DEBUG: user: { id: [32m'user-dosen-123'[39m, role: [32m'dosen'[39m, email: [32m'dosen@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: dosen permission: manage:nilai
âœ… DEBUG: Permission granted for role: dosen permission: manage:nilai

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Mahasiswa creates peminjaman[2m > [22m[2mshould allow mahasiswa to create peminjaman
[22m[39mðŸ” DEBUG: checkPermission called: create:peminjaman

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Mahasiswa creates peminjaman[2m > [22m[2mshould allow mahasiswa to create peminjaman
[22m[39mðŸ” DEBUG: user: { id: [32m'user-mhs-123'[39m, role: [32m'mahasiswa'[39m, email: [32m'mahasiswa@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: mahasiswa permission: create:peminjaman
âœ… DEBUG: Permission granted for role: mahasiswa permission: create:peminjaman

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Mahasiswa creates peminjaman[2m > [22m[2mshould prevent mahasiswa from creating kuis
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstderr[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Mahasiswa creates peminjaman[2m > [22m[2mshould prevent mahasiswa from creating kuis
[22m[39mâŒ DEBUG: Permission denied for role: mahasiswa permission: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Mahasiswa creates peminjaman[2m > [22m[2mshould prevent mahasiswa from creating kuis
[22m[39mðŸ” DEBUG: user: { id: [32m'user-mhs-123'[39m, role: [32m'mahasiswa'[39m, email: [32m'mahasiswa@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: mahasiswa permission: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Mahasiswa creates peminjaman[2m > [22m[2mshould prevent mahasiswa from approving peminjaman
[22m[39mðŸ” DEBUG: checkPermission called: approve:peminjaman

[90mstderr[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Mahasiswa creates peminjaman[2m > [22m[2mshould prevent mahasiswa from approving peminjaman
[22m[39mâŒ DEBUG: Permission denied for role: mahasiswa permission: approve:peminjaman

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Mahasiswa creates peminjaman[2m > [22m[2mshould prevent mahasiswa from approving peminjaman
[22m[39mðŸ” DEBUG: user: { id: [32m'user-mhs-123'[39m, role: [32m'mahasiswa'[39m, email: [32m'mahasiswa@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: mahasiswa permission: approve:peminjaman

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Laboran approves peminjaman[2m > [22m[2mshould allow laboran to approve peminjaman
[22m[39mðŸ” DEBUG: checkPermission called: approve:peminjaman

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Laboran approves peminjaman[2m > [22m[2mshould allow laboran to approve peminjaman
[22m[39mðŸ” DEBUG: user: { id: [32m'user-laboran-123'[39m, role: [32m'laboran'[39m, email: [32m'laboran@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: laboran permission: approve:peminjaman
âœ… DEBUG: Permission granted for role: laboran permission: approve:peminjaman

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Laboran approves peminjaman[2m > [22m[2mshould prevent laboran from creating kuis
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Laboran approves peminjaman[2m > [22m[2mshould prevent laboran from creating kuis
[22m[39mðŸ” DEBUG: user: { id: [32m'user-laboran-123'[39m, role: [32m'laboran'[39m, email: [32m'laboran@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: laboran permission: manage:kuis

[90mstderr[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Laboran approves peminjaman[2m > [22m[2mshould prevent laboran from creating kuis
[22m[39mâŒ DEBUG: Permission denied for role: laboran permission: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Laboran approves peminjaman[2m > [22m[2mshould prevent laboran from managing nilai
[22m[39mðŸ” DEBUG: checkPermission called: manage:nilai

[90mstderr[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Laboran approves peminjaman[2m > [22m[2mshould prevent laboran from managing nilai
[22m[39mâŒ DEBUG: Permission denied for role: laboran permission: manage:nilai

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Laboran approves peminjaman[2m > [22m[2mshould prevent laboran from managing nilai
[22m[39mðŸ” DEBUG: user: { id: [32m'user-laboran-123'[39m, role: [32m'laboran'[39m, email: [32m'laboran@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: laboran permission: manage:nilai

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to create kuis (even without dosen_id)
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to create kuis (even without dosen_id)
[22m[39mðŸ” DEBUG: user: { id: [32m'user-admin-123'[39m, role: [32m'admin'[39m, email: [32m'admin@test.com'[39m }
âœ… DEBUG: Admin bypass for permission: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to update any kuis (ownership bypass)
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to update any kuis (ownership bypass)
[22m[39mðŸ” DEBUG: user: { id: [32m'user-admin-123'[39m, role: [32m'admin'[39m, email: [32m'admin@test.com'[39m }
âœ… DEBUG: Admin bypass for permission: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to update any kuis (ownership bypass)
[22m[39mâœ… Admin bypass: ownership check for kuis/kuis-123

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to approve peminjaman
[22m[39mðŸ” DEBUG: checkPermission called: approve:peminjaman

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to approve peminjaman
[22m[39mðŸ” DEBUG: user: { id: [32m'user-admin-123'[39m, role: [32m'admin'[39m, email: [32m'admin@test.com'[39m }
âœ… DEBUG: Admin bypass for permission: approve:peminjaman

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to create nilai
[22m[39mðŸ” DEBUG: checkPermission called: manage:nilai

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Admin has universal access[2m > [22m[2mshould allow admin to create nilai
[22m[39mðŸ” DEBUG: user: { id: [32m'user-admin-123'[39m, role: [32m'admin'[39m, email: [32m'admin@test.com'[39m }
âœ… DEBUG: Admin bypass for permission: manage:nilai

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent mahasiswa from accessing dosen functions
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstderr[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent mahasiswa from accessing dosen functions
[22m[39mâŒ DEBUG: Permission denied for role: mahasiswa permission: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent mahasiswa from accessing dosen functions
[22m[39mðŸ” DEBUG: user: { id: [32m'user-mhs-123'[39m, role: [32m'mahasiswa'[39m, email: [32m'mahasiswa@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: mahasiswa permission: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent laboran from accessing dosen functions
[22m[39mðŸ” DEBUG: checkPermission called: manage:nilai

[90mstderr[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent laboran from accessing dosen functions
[22m[39mâŒ DEBUG: Permission denied for role: laboran permission: manage:nilai

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent laboran from accessing dosen functions
[22m[39mðŸ” DEBUG: user: { id: [32m'user-laboran-123'[39m, role: [32m'laboran'[39m, email: [32m'laboran@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: laboran permission: manage:nilai

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent dosen from accessing laboran functions
[22m[39mðŸ” DEBUG: checkPermission called: approve:peminjaman

[90mstderr[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent dosen from accessing laboran functions
[22m[39mâŒ DEBUG: Permission denied for role: dosen permission: approve:peminjaman

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Cross-role permission violations[2m > [22m[2mshould prevent dosen from accessing laboran functions
[22m[39mðŸ” DEBUG: user: { id: [32m'user-dosen-123'[39m, role: [32m'dosen'[39m, email: [32m'dosen@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: dosen permission: approve:peminjaman

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Error handling and messages[2m > [22m[2mshould provide clear error message for permission denial
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstderr[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Error handling and messages[2m > [22m[2mshould provide clear error message for permission denial
[22m[39mâŒ DEBUG: Permission denied for role: mahasiswa permission: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Error handling and messages[2m > [22m[2mshould provide clear error message for permission denial
[22m[39mðŸ” DEBUG: user: { id: [32m'user-mhs-123'[39m, role: [32m'mahasiswa'[39m, email: [32m'mahasiswa@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mfalse[39m for role: mahasiswa permission: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Error handling and messages[2m > [22m[2mshould provide clear error message for ownership denial
[22m[39mðŸ” DEBUG: checkPermission called: manage:kuis

[90mstdout[2m | server/src/__tests__/integration/middleware-rbac.test.ts[2m > [22m[2mRBAC Middleware Integration Tests[2m > [22m[2mScenario: Error handling and messages[2m > [22m[2mshould provide clear error message for ownership denial
[22m[39mðŸ” DEBUG: user: { id: [32m'user-dosen-123'[39m, role: [32m'dosen'[39m, email: [32m'dosen@test.com'[39m }
ðŸ” DEBUG: hasPermission result: [33mtrue[39m for role: dosen permission: manage:kuis
âœ… DEBUG: Permission granted for role: dosen permission: manage:kuis

 [32mâœ“[39m server/src/__tests__/integration/middleware-rbac.test.ts [2m([22m[2m20 tests[22m[2m)[22m[32m 124[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/validations/auth.schema.test.ts [2m([22m[2m38 tests[22m[2m)[22m[32m 123[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/validations/offline-data.schema.test.ts [2m([22m[2m53 tests[22m[2m)[22m[32m 47[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/validations/offline-data.schema.test.ts [2m([22m[2m53 tests[22m[2m)[22m[32m 110[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/validations/mata-kuliah.schema.test.ts [2m([22m[2m57 tests[22m[2m)[22m[32m 123[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/validations/mata-kuliah.schema.test.ts [2m([22m[2m57 tests[22m[2m)[22m[32m 168[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/offline/storage-manager.test.ts [2m([22m[2m32 tests[22m[2m)[22m[32m 44[2mms[22m[39m
[90mstdout[2m | src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mLast-Write-Wins Strategy[2m > [22m[2mshould choose local when local is newer
[22m[39m[ConflictResolver] {
  dataType: [32m'quiz_answer'[39m,
  dataId: [32m'answer_1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (2024-01-02T00:00:00.000Z > 2024-01-01T00:00:00.000Z)'[39m
}

[90mstdout[2m | src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mLast-Write-Wins Strategy[2m > [22m[2mshould choose remote when remote is newer
[22m[39m[ConflictResolver] {
  dataType: [32m'quiz_answer'[39m,
  dataId: [32m'answer_1'[39m,
  winner: [32m'remote'[39m,
  reason: [32m'Remote is newer (2024-01-02T00:00:00.000Z > 2024-01-01T00:00:00.000Z)'[39m
}

[90mstdout[2m | src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mLast-Write-Wins Strategy[2m > [22m[2mshould prefer remote when timestamps are equal
[22m[39m[ConflictResolver] {
  dataType: [32m'quiz_answer'[39m,
  dataId: [32m'answer_1'[39m,
  winner: [32m'remote'[39m,
  reason: [32m'Timestamps equal, preferring remote (server)'[39m
}

[90mstdout[2m | src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mTimestamp Parsing[2m > [22m[2mshould handle ISO string timestamps
[22m[39m[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (2024-01-02T00:00:00.000Z > 2024-01-01T00:00:00.000Z)'[39m
}

[90mstdout[2m | src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mTimestamp Parsing[2m > [22m[2mshould handle unix timestamps (milliseconds)
[22m[39m[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (2024-01-03T00:00:00.000Z > 2024-01-02T00:00:00.000Z)'[39m
}

[90mstdout[2m | src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mTimestamp Parsing[2m > [22m[2mshould handle mixed timestamp formats
[22m[39m[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (2024-01-03T00:00:00.000Z > 2024-01-01T00:00:00.000Z)'[39m
}

[90mstdout[2m | src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mAlternative Strategies[2m > [22m[2mshould always choose local with local-wins
[22m[39m[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local-wins strategy'[39m
}

[90mstdout[2m | src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mAlternative Strategies[2m > [22m[2mshould always choose remote with remote-wins
[22m[39m[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'remote'[39m,
  reason: [32m'Remote-wins strategy'[39m
}

[90mstdout[2m | src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mConflict Logging[2m > [22m[2mshould log conflicts
[22m[39m[ConflictResolver] {
  dataType: [32m'quiz_answer'[39m,
  dataId: [32m'answer_1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (2024-01-02T00:00:00.000Z > 2024-01-01T00:00:00.000Z)'[39m
}

[90mstdout[2m | src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mConflict Logging[2m > [22m[2mshould filter logs by type
[22m[39m[ConflictResolver] {
  dataType: [32m'quiz_answer'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}
[ConflictResolver] {
  dataType: [32m'attempt'[39m,
  dataId: [32m'2'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}

[90mstdout[2m | src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mConflict Logging[2m > [22m[2mshould filter logs by ID
[22m[39m[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'item_1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}
[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'item_2'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}

[90mstdout[2m | src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mConflict Logging[2m > [22m[2mshould clear logs
[22m[39m[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}

[90mstdout[2m | src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mStatistics[2m > [22m[2mshould generate statistics
[22m[39m[ConflictResolver] {
  dataType: [32m'quiz_answer'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}
[ConflictResolver] {
  dataType: [32m'quiz_answer'[39m,
  dataId: [32m'2'[39m,
  winner: [32m'remote'[39m,
  reason: [32m'Remote is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}
[ConflictResolver] {
  dataType: [32m'attempt'[39m,
  dataId: [32m'3'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}

[90mstdout[2m | src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mHelper Functions[2m > [22m[2mresolveConflict should use default resolver
[22m[39m[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}

 [32mâœ“[39m src/__tests__/unit/lib/offline/conflict-resolver.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 41[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/utils/debounce.test.ts [2m([22m[2m24 tests[22m[2m)[22m[32m 55[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/validations/kuis.schema.test.ts [2m([22m[2m31 tests[22m[2m)[22m[32m 50[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/validations/jadwal.schema.test.ts [2m([22m[2m31 tests[22m[2m)[22m[32m 56[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/validations/nilai.schema.test.ts [2m([22m[2m57 tests[22m[2m)[22m[32m 138[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/supabase/storage-helpers.test.ts [2m([22m[2m37 tests[22m[2m)[22m[32m 126[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/validations/user.schema.test.ts [2m([22m[2m48 tests[22m[2m)[22m[32m 36[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/validations/nilai.schema.test.ts [2m([22m[2m57 tests[22m[2m)[22m[32m 258[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/utils/permissions.test.ts [2m([22m[2m59 tests[22m[2m)[22m[32m 178[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/supabase/storage-helpers.test.ts [2m([22m[2m37 tests[22m[2m)[22m[32m 116[2mms[22m[39m
[90mstderr[2m | server/src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with exponential backoff[2m > [22m[2mshould retry failed operations
[22m[39mRetry attempt 1/3 after 100ms Temporary failure

[90mstderr[2m | server/src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with exponential backoff[2m > [22m[2mshould retry failed operations
[22m[39mRetry attempt 2/3 after 200ms Temporary failure

[90mstderr[2m | server/src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with exponential backoff[2m > [22m[2mshould use exponential backoff
[22m[39mRetry attempt 1/4 after 100ms Fail

[90mstderr[2m | server/src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with exponential backoff[2m > [22m[2mshould use exponential backoff
[22m[39mRetry attempt 2/4 after 200ms Fail

[90mstderr[2m | server/src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with exponential backoff[2m > [22m[2mshould use exponential backoff
[22m[39mRetry attempt 3/4 after 400ms Fail

[90mstderr[2m | server/src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with exponential backoff[2m > [22m[2mshould stop after max retries
[22m[39mRetry attempt 1/3 after 10ms Permanent failure

[90mstderr[2m | server/src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with exponential backoff[2m > [22m[2mshould stop after max retries
[22m[39mRetry attempt 2/3 after 20ms Permanent failure

[90mstderr[2m | server/src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with custom delay[2m > [22m[2mshould use custom delay between retries
[22m[39mRetry attempt 1/3 after 500ms Fail

[90mstderr[2m | server/src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with custom delay[2m > [22m[2mshould use custom delay between retries
[22m[39mRetry attempt 2/3 after 500ms Fail

[90mstderr[2m | server/src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mconditional retry[2m > [22m[2mshould retry only on specific errors
[22m[39mRetry attempt 1/5 after 10ms Retryable

 [32mâœ“[39m server/src/__tests__/unit/utils/quiz-scoring.test.ts [2m([22m[2m44 tests[22m[2m)[22m[32m 200[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/utils/retry.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 136[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/utils/permissions.test.ts [2m([22m[2m59 tests[22m[2m)[22m[32m 186[2mms[22m[39m
[90mstderr[2m | src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with exponential backoff[2m > [22m[2mshould retry failed operations
[22m[39mRetry attempt 1/3 after 100ms Temporary failure

[90mstderr[2m | src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with exponential backoff[2m > [22m[2mshould retry failed operations
[22m[39mRetry attempt 2/3 after 200ms Temporary failure

[90mstderr[2m | src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with exponential backoff[2m > [22m[2mshould use exponential backoff
[22m[39mRetry attempt 1/4 after 100ms Fail

[90mstderr[2m | src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with exponential backoff[2m > [22m[2mshould use exponential backoff
[22m[39mRetry attempt 2/4 after 200ms Fail

[90mstderr[2m | src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with exponential backoff[2m > [22m[2mshould use exponential backoff
[22m[39mRetry attempt 3/4 after 400ms Fail

[90mstderr[2m | src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with exponential backoff[2m > [22m[2mshould stop after max retries
[22m[39mRetry attempt 1/3 after 10ms Permanent failure

[90mstderr[2m | src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with exponential backoff[2m > [22m[2mshould stop after max retries
[22m[39mRetry attempt 2/3 after 20ms Permanent failure

[90mstderr[2m | src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with custom delay[2m > [22m[2mshould use custom delay between retries
[22m[39mRetry attempt 1/3 after 500ms Fail

[90mstderr[2m | src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mretry with custom delay[2m > [22m[2mshould use custom delay between retries
[22m[39mRetry attempt 2/3 after 500ms Fail

[90mstderr[2m | src/__tests__/unit/utils/retry.test.ts[2m > [22m[2mRetry Utilities[2m > [22m[2mconditional retry[2m > [22m[2mshould retry only on specific errors
[22m[39mRetry attempt 1/5 after 10ms Retryable

 [32mâœ“[39m src/__tests__/unit/utils/retry.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 233[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/integration/auth-flow.test.tsx [2m([22m[2m18 tests[22m[2m)[22m[32m 44[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/utils/logger.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 95[2mms[22m[39m
 [32mâœ“[39m src/__tests__/integration/auth-flow.test.tsx [2m([22m[2m18 tests[22m[2m)[22m[32m 42[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/validations/user.schema.test.ts [2m([22m[2m48 tests[22m[2m)[22m[32m 106[2mms[22m[39m
[90mstdout[2m | server/src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mLast-Write-Wins Strategy[2m > [22m[2mshould choose local when local is newer
[22m[39m[ConflictResolver] {
  dataType: [32m'quiz_answer'[39m,
  dataId: [32m'answer_1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (2024-01-02T00:00:00.000Z > 2024-01-01T00:00:00.000Z)'[39m
}

[90mstdout[2m | server/src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mLast-Write-Wins Strategy[2m > [22m[2mshould choose remote when remote is newer
[22m[39m[ConflictResolver] {
  dataType: [32m'quiz_answer'[39m,
  dataId: [32m'answer_1'[39m,
  winner: [32m'remote'[39m,
  reason: [32m'Remote is newer (2024-01-02T00:00:00.000Z > 2024-01-01T00:00:00.000Z)'[39m
}

[90mstdout[2m | server/src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mLast-Write-Wins Strategy[2m > [22m[2mshould prefer remote when timestamps are equal
[22m[39m[ConflictResolver] {
  dataType: [32m'quiz_answer'[39m,
  dataId: [32m'answer_1'[39m,
  winner: [32m'remote'[39m,
  reason: [32m'Timestamps equal, preferring remote (server)'[39m
}

[90mstdout[2m | server/src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mTimestamp Parsing[2m > [22m[2mshould handle ISO string timestamps
[22m[39m[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (2024-01-02T00:00:00.000Z > 2024-01-01T00:00:00.000Z)'[39m
}

[90mstdout[2m | server/src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mTimestamp Parsing[2m > [22m[2mshould handle unix timestamps (milliseconds)
[22m[39m[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (2024-01-03T00:00:00.000Z > 2024-01-02T00:00:00.000Z)'[39m
}

[90mstdout[2m | server/src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mTimestamp Parsing[2m > [22m[2mshould handle mixed timestamp formats
[22m[39m[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (2024-01-03T00:00:00.000Z > 2024-01-01T00:00:00.000Z)'[39m
}

[90mstdout[2m | server/src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mAlternative Strategies[2m > [22m[2mshould always choose local with local-wins
[22m[39m[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local-wins strategy'[39m
}

[90mstdout[2m | server/src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mAlternative Strategies[2m > [22m[2mshould always choose remote with remote-wins
[22m[39m[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'remote'[39m,
  reason: [32m'Remote-wins strategy'[39m
}

[90mstdout[2m | server/src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mConflict Logging[2m > [22m[2mshould log conflicts
[22m[39m[ConflictResolver] {
  dataType: [32m'quiz_answer'[39m,
  dataId: [32m'answer_1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (2024-01-02T00:00:00.000Z > 2024-01-01T00:00:00.000Z)'[39m
}

[90mstdout[2m | server/src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mConflict Logging[2m > [22m[2mshould filter logs by type
[22m[39m[ConflictResolver] {
  dataType: [32m'quiz_answer'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}
[ConflictResolver] {
  dataType: [32m'attempt'[39m,
  dataId: [32m'2'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}

[90mstdout[2m | server/src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mConflict Logging[2m > [22m[2mshould filter logs by ID
[22m[39m[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'item_1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}
[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'item_2'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}

[90mstdout[2m | server/src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mConflict Logging[2m > [22m[2mshould clear logs
[22m[39m[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}

[90mstdout[2m | server/src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mStatistics[2m > [22m[2mshould generate statistics
[22m[39m[ConflictResolver] {
  dataType: [32m'quiz_answer'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}
[ConflictResolver] {
  dataType: [32m'quiz_answer'[39m,
  dataId: [32m'2'[39m,
  winner: [32m'remote'[39m,
  reason: [32m'Remote is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}
[ConflictResolver] {
  dataType: [32m'attempt'[39m,
  dataId: [32m'3'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}

[90mstdout[2m | server/src/__tests__/unit/lib/offline/conflict-resolver.test.ts[2m > [22m[2mConflictResolver[2m > [22m[2mHelper Functions[2m > [22m[2mresolveConflict should use default resolver
[22m[39m[ConflictResolver] {
  dataType: [32m'test'[39m,
  dataId: [32m'1'[39m,
  winner: [32m'local'[39m,
  reason: [32m'Local is newer (1970-01-01T00:00:00.100Z > 1970-01-01T00:00:00.050Z)'[39m
}

 [32mâœ“[39m server/src/__tests__/unit/lib/offline/conflict-resolver.test.ts [2m([22m[2m17 tests[22m[2m)[22m[32m 181[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/utils/quiz-scoring.test.ts [2m([22m[2m44 tests[22m[2m)[22m[32m 165[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/utils/normalize.test.ts [2m([22m[2m59 tests[22m[2m)[22m[32m 128[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/api/auth.api.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 246[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/utils/normalize.test.ts [2m([22m[2m59 tests[22m[2m)[22m[32m 95[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/utils/logger.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 123[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/integration/offline-sync-flow.test.tsx [2m([22m[2m16 tests[22m[2m)[22m[32m 134[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/lib/validations.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 151[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/lib/validations.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 48[2mms[22m[39m
 [32mâœ“[39m src/__tests__/integration/offline-sync-flow.test.tsx [2m([22m[2m16 tests[22m[2m)[22m[32m 60[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/api/auth.api.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 33[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/api/peminjaman-extensions.test.ts [2m([22m[2m6 tests[22m[2m)[22m[32m 32[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/api/mata-kuliah.api.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 23[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/api/materi.api.test.ts [2m([22m[2m7 tests[22m[2m | [22m[33m1 skipped[39m[2m)[22m[32m 57[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/api/reports.api.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 32[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/api/announcements.api.test.ts [2m([22m[2m4 tests[22m[2m)[22m[32m 18[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/lib/pwa/background-sync.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/lib/pwa/background-sync.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/api/kuis.api.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 17[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/api/offline-queue.api.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 17[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/hooks/useAuth.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 14[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/api/offline-queue.api.test.ts [2m([22m[2m7 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/api/kuis.api.test.ts [2m([22m[2m9 tests[22m[2m)[22m[32m 18[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/hooks/useAuth.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 15[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/providers/AuthProvider.test.tsx [2m([22m[2m8 tests[22m[2m | [22m[33m7 skipped[39m[2m)[22m[32m 7[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/providers/AuthProvider.test.tsx [2m([22m[2m8 tests[22m[2m | [22m[33m7 skipped[39m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/integration/kuis-builder-autosave.test.tsx [2m([22m[2m6 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[32m 17[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/unit/providers/ThemeProvider.test.tsx [2m([22m[2m8 tests[22m[2m | [22m[33m7 skipped[39m[2m)[22m[32m 8[2mms[22m[39m
 [32mâœ“[39m src/__tests__/unit/providers/ThemeProvider.test.tsx [2m([22m[2m8 tests[22m[2m | [22m[33m7 skipped[39m[2m)[22m[32m 7[2mms[22m[39m
 [32mâœ“[39m src/__tests__/integration/kuis-builder-autosave.test.tsx [2m([22m[2m6 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[32m 7[2mms[22m[39m
 [32mâœ“[39m server/src/__tests__/integration/conflict-resolution.test.tsx [2m([22m[2m6 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[32m 8[2mms[22m[39m
 [2m[90mâ†“[39m[22m src/__tests__/unit/hooks/useAutoSave.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m
 [32mâœ“[39m src/__tests__/integration/conflict-resolution.test.tsx [2m([22m[2m6 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[32m 8[2mms[22m[39m
 [2m[90mâ†“[39m[22m server/src/__tests__/unit/hooks/useAutoSave.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Failed Suites 1 [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/providers/SyncProvider.test.tsx[2m [ server/src/__tests__/unit/providers/SyncProvider.test.tsx ][22m
[31m[1mError[22m: [vitest] There was an error when mocking a module. If you are using "vi.mock" factory, make sure there are no top level variables inside, since this call is hoisted to top of the file. Read more: https://vitest.dev/api/vi.html#vi-mock[39m
[36m [2mâ¯[22m server/src/providers/SyncProvider.tsx:[2m2:1[22m[39m
    [90m  1| [39m[35mimport[39m [33mReact[39m[33m,[39m { createContext[33m,[39m useContext[33m,[39m useEffect } [35mfrom[39m [32m"react"[39m[33m;[39m
    [90m  2| [39m[35mimport[39m { useSync } [35mfrom[39m [32m"@/lib/hooks/useSync"[39m[33m;[39m
    [90m   | [39m[31m^[39m
    [90m  3| [39m[35mimport[39m { useNetworkStatus } [35mfrom[39m [32m"@/lib/hooks/useNetworkStatus"[39m[33m;[39m
    [90m  4| [39m[35mimport[39m type { [33mUseSyncReturn[39m } [35mfrom[39m [32m"@/lib/hooks/useSync"[39m[33m;[39m

[31m[1mCaused by: ReferenceError[22m: Cannot access 'mockUseSync' before initialization[39m
[36m [2mâ¯[22m server/src/__tests__/unit/providers/SyncProvider.test.tsx:[2m49:12[22m[39m
[90m [2mâ¯[22m server/src/providers/SyncProvider.tsx:[2m2:1[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/318]âŽ¯[22m[39m


[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Failed Tests 317 [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/api/dosen.api.test.ts[2m > [22mDosen API - Dashboard Stats[2m > [22mgetDosenStats[2m > [22mshould return stats for authenticated dosen
[31m[1mAssertionError[22m: expected { totalKelas: +0, â€¦(3) } to deeply equal { totalKelas: 5, â€¦(3) }[39m

[32m- Expected[39m
[31m+ Received[39m

[2m  {[22m
[32m-   "activeKuis": 8,[39m
[32m-   "pendingGrading": 15,[39m
[32m-   "totalKelas": 5,[39m
[32m-   "totalMahasiswa": 120,[39m
[31m+   "activeKuis": 0,[39m
[31m+   "pendingGrading": 0,[39m
[31m+   "totalKelas": 0,[39m
[31m+   "totalMahasiswa": 0,[39m
[2m  }[22m

[36m [2mâ¯[22m src/__tests__/unit/api/dosen.api.test.ts:[2m218:22[22m[39m
    [90m216| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetDosenStats[39m()[33m;[39m
    [90m217| [39m
    [90m218| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m({
    [90m   | [39m                     [31m^[39m
    [90m219| [39m        totalKelas[33m:[39m [34m5[39m[33m,[39m
    [90m220| [39m        totalMahasiswa[33m:[39m [34m120[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/api/dosen.api.test.ts[2m > [22mDosen API - Kelas Management[2m > [22mgetMyKelas[2m > [22mshould return kelas with stats for dosen
[31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m src/__tests__/unit/api/dosen.api.test.ts:[2m337:22[22m[39m
    [90m335| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetMyKelas[39m()[33m;[39m
    [90m336| [39m
    [90m337| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m338| [39m      [34mexpect[39m(result[[34m0[39m])[33m.[39m[34mtoEqual[39m({
    [90m339| [39m        id[33m:[39m [32m"kelas-1"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/api/dosen.api.test.ts[2m > [22mDosen API - Kelas Management[2m > [22mgetMyKelas[2m > [22mshould apply limit when provided
[31m[1mAssertionError[22m: expected [] to have a length of 2 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 2[39m
[31m+ 0[39m

[36m [2mâ¯[22m src/__tests__/unit/api/dosen.api.test.ts:[2m395:22[22m[39m
    [90m393| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetMyKelas[39m([34m2[39m)[33m;[39m
    [90m394| [39m
    [90m395| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m2[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m396| [39m    })[33m;[39m
    [90m397| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[4/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/api/dosen.api.test.ts[2m > [22mDosen API - Kelas Management[2m > [22mgetMyKelas[2m > [22mshould handle duplicate kelas correctly
[31m[1mAssertionError[22m: expected [] to have a length of 2 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 2[39m
[31m+ 0[39m

[36m [2mâ¯[22m src/__tests__/unit/api/dosen.api.test.ts:[2m456:22[22m[39m
    [90m454| [39m
    [90m455| [39m      [90m// Should only return 2 unique kelas (duplicates removed)[39m
    [90m456| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m2[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m457| [39m    })[33m;[39m
    [90m458| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[5/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - CRUD Operations[2m > [22mdeleteKelas[2m > [22mshould delete kelas by ID
[31m[1mError[22m: Failed to delete kelas: Cannot read properties of undefined (reading 'select')[39m
[36m [2mâ¯[22m Module.deleteKelasImpl src/lib/api/kelas.api.ts:[2m254:11[22m[39m
    [90m252| [39m    }
    [90m253| [39m
    [90m254| [39m    [35mthrow[39m [35mnew[39m [33mError[39m([32m`Failed to delete kelas: [39m[36m${[39merrorMessage[36m}[39m[32m`[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m255| [39m  }
    [90m256| [39m}
[90m [2mâ¯[22m src/__tests__/unit/api/kelas.api.test.ts:[2m322:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[6/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould enroll student successfully when quota available
[31m[1mError[22m: Failed to enroll student: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[36m [2mâ¯[22m Module.enrollStudentImpl src/lib/api/kelas.api.ts:[2m405:11[22m[39m
    [90m403| [39m  } [35mcatch[39m (error[33m:[39m unknown) {
    [90m404| [39m    console[33m.[39m[34merror[39m([32m"Error enrolling student:"[39m[33m,[39m error)[33m;[39m
    [90m405| [39m    throw new Error(`Failed to enroll student: ${(error as Error).messâ€¦
    [90m   | [39m          [31m^[39m
    [90m406| [39m  }
    [90m407| [39m}
[90m [2mâ¯[22m src/__tests__/unit/api/kelas.api.test.ts:[2m415:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[7/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould handle null kuota (unlimited enrollment)
[31m[1mError[22m: Failed to enroll student: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.[39m
[36m [2mâ¯[22m Module.enrollStudentImpl src/lib/api/kelas.api.ts:[2m405:11[22m[39m
    [90m403| [39m  } [35mcatch[39m (error[33m:[39m unknown) {
    [90m404| [39m    console[33m.[39m[34merror[39m([32m"Error enrolling student:"[39m[33m,[39m error)[33m;[39m
    [90m405| [39m    throw new Error(`Failed to enroll student: ${(error as Error).messâ€¦
    [90m   | [39m          [31m^[39m
    [90m406| [39m  }
    [90m407| [39m}
[90m [2mâ¯[22m src/__tests__/unit/api/kelas.api.test.ts:[2m516:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[8/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould enroll existing mahasiswa to kelas
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/__tests__/unit/api/kelas.api.test.ts:[2m726:30[22m[39m
    [90m724| [39m      })[33m;[39m
    [90m725| [39m
    [90m726| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m727| [39m      [34mexpect[39m(result[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m"berhasil"[39m)[33m;[39m
    [90m728| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[9/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould create new mahasiswa and enroll
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/__tests__/unit/api/kelas.api.test.ts:[2m811:30[22m[39m
    [90m809| [39m      })[33m;[39m
    [90m810| [39m
    [90m811| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m812| [39m      [34mexpect[39m(vi[33m.[39m[34mmocked[39m(supabase[33m.[39mauth[33m.[39msignUp))[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m813| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[10/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/validations/jadwal.schema.test.ts[2m > [22mJadwal Schema Validation[2m > [22mjadwalSchema - Valid Cases[2m > [22mshould accept valid jadwal data
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/__tests__/unit/validations/jadwal.schema.test.ts:[2m41:30[22m[39m
    [90m 39| [39m
    [90m 40| [39m      [35mconst[39m result [33m=[39m jadwalSchema[33m.[39m[34msafeParse[39m(validData)[33m;[39m
    [90m 41| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 42| [39m    })[33m;[39m
    [90m 43| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[11/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/validations/jadwal.schema.test.ts[2m > [22mJadwal Schema Validation[2m > [22mjadwalSchema - Valid Cases[2m > [22mshould accept kelas with uppercase letters and numbers
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/__tests__/unit/validations/jadwal.schema.test.ts:[2m54:30[22m[39m
    [90m 52| [39m
    [90m 53| [39m      [35mconst[39m result [33m=[39m jadwalSchema[33m.[39m[34msafeParse[39m(data)[33m;[39m
    [90m 54| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 55| [39m    })[33m;[39m
    [90m 56| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[12/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/validations/jadwal.schema.test.ts[2m > [22mJadwal Schema Validation[2m > [22mjadwalSchema - Valid Cases[2m > [22mshould accept minimum duration of 30 minutes
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/__tests__/unit/validations/jadwal.schema.test.ts:[2m67:30[22m[39m
    [90m 65| [39m
    [90m 66| [39m      [35mconst[39m result [33m=[39m jadwalSchema[33m.[39m[34msafeParse[39m(data)[33m;[39m
    [90m 67| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 68| [39m    })[33m;[39m
    [90m 69| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[13/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/validations/jadwal.schema.test.ts[2m > [22mJadwal Schema Validation[2m > [22mjadwalSchema - Valid Cases[2m > [22mshould accept topik with minimum 10 characters
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/__tests__/unit/validations/jadwal.schema.test.ts:[2m81:30[22m[39m
    [90m 79| [39m
    [90m 80| [39m      [35mconst[39m result [33m=[39m jadwalSchema[33m.[39m[34msafeParse[39m(data)[33m;[39m
    [90m 81| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 82| [39m    })[33m;[39m
    [90m 83| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[14/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/validations/jadwal.schema.test.ts[2m > [22mJadwal Schema Validation[2m > [22mjadwalSchema - Valid Cases[2m > [22mshould accept empty topik
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/__tests__/unit/validations/jadwal.schema.test.ts:[2m95:30[22m[39m
    [90m 93| [39m
    [90m 94| [39m      [35mconst[39m result [33m=[39m jadwalSchema[33m.[39m[34msafeParse[39m(data)[33m;[39m
    [90m 95| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 96| [39m    })[33m;[39m
    [90m 97| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[15/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/validations/jadwal.schema.test.ts[2m > [22mJadwal Schema Validation[2m > [22mjadwalSchema - Invalid Cases[2m > [22mshould reject invalid time format
[31m[1mAssertionError[22m: expected 'Tanggal praktikum tidak boleh di masaâ€¦' to contain 'HH:MM'[39m

Expected: [32m"HH:MM"[39m
Received: [31m"Tanggal praktikum tidak boleh di masa lalu"[39m

[36m [2mâ¯[22m src/__tests__/unit/validations/jadwal.schema.test.ts:[2m171:48[22m[39m
    [90m169| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m170| [39m      [35mif[39m ([33m![39mresult[33m.[39msuccess) {
    [90m171| [39m        [34mexpect[39m(result[33m.[39merror[33m.[39missues[[34m0[39m][33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m"HH:MM"[39m)[33m;[39m
    [90m   | [39m                                               [31m^[39m
    [90m172| [39m      }
    [90m173| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[16/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/validations/jadwal.schema.test.ts[2m > [22mJadwal Schema Validation[2m > [22mjadwalSchema - Invalid Cases[2m > [22mshould reject when jam_selesai <= jam_mulai
[31m[1mAssertionError[22m: expected 'Tanggal praktikum tidak boleh di masaâ€¦' to contain 'lebih besar'[39m

Expected: [32m"lebih besar"[39m
Received: [31m"Tanggal praktikum tidak boleh di masa lalu"[39m

[36m [2mâ¯[22m src/__tests__/unit/validations/jadwal.schema.test.ts:[2m187:48[22m[39m
    [90m185| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m186| [39m      [35mif[39m ([33m![39mresult[33m.[39msuccess) {
    [90m187| [39m        expect(result.error.issues[0].message).toContain("lebih besar"â€¦
    [90m   | [39m                                               [31m^[39m
    [90m188| [39m      }
    [90m189| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[17/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/validations/jadwal.schema.test.ts[2m > [22mJadwal Schema Validation[2m > [22mjadwalSchema - Invalid Cases[2m > [22mshould reject duration less than 30 minutes
[31m[1mAssertionError[22m: expected 'Tanggal praktikum tidak boleh di masaâ€¦' to contain 'minimal 30 menit'[39m

Expected: [32m"minimal 30 menit"[39m
Received: [31m"Tanggal praktikum tidak boleh di masa lalu"[39m

[36m [2mâ¯[22m src/__tests__/unit/validations/jadwal.schema.test.ts:[2m203:48[22m[39m
    [90m201| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m202| [39m      [35mif[39m ([33m![39mresult[33m.[39msuccess) {
    [90m203| [39m        expect(result.error.issues[0].message).toContain("minimal 30 mâ€¦
    [90m   | [39m                                               [31m^[39m
    [90m204| [39m      }
    [90m205| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[18/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/validations/jadwal.schema.test.ts[2m > [22mJadwal Schema Validation[2m > [22mjadwalSchema - Invalid Cases[2m > [22mshould reject topik less than 10 characters when provided
[31m[1mAssertionError[22m: expected 'Tanggal praktikum tidak boleh di masaâ€¦' to contain 'minimal 10 karakter'[39m

Expected: [32m"minimal 10 karakter"[39m
Received: [31m"Tanggal praktikum tidak boleh di masa lalu"[39m

[36m [2mâ¯[22m src/__tests__/unit/validations/jadwal.schema.test.ts:[2m220:48[22m[39m
    [90m218| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m219| [39m      [35mif[39m ([33m![39mresult[33m.[39msuccess) {
    [90m220| [39m        expect(result.error.issues[0].message).toContain("minimal 10 kâ€¦
    [90m   | [39m                                               [31m^[39m
    [90m221| [39m      }
    [90m222| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[19/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/validations/jadwal.schema.test.ts[2m > [22mJadwal Schema Validation[2m > [22mHelper Functions[2m > [22mparseCreateJadwalForm[2m > [22mshould parse valid data
[31m[1mAssertionError[22m: expected [Function] to not throw an error but '[\n  {\n    "code": "custom",\n    "pâ€¦' was thrown[39m

[32m- Expected:[39m 
undefined

[31m+ Received:[39m 
"[
  {
    \"code\": \"custom\",
    \"path\": [
      \"tanggal_praktikum\"
    ],
    \"message\": \"Tanggal praktikum tidak boleh di masa lalu\"
  }
]"

[36m [2mâ¯[22m src/__tests__/unit/validations/jadwal.schema.test.ts:[2m388:55[22m[39m
    [90m386| [39m        }[33m;[39m
    [90m387| [39m
    [90m388| [39m        [34mexpect[39m(() [33m=>[39m [34mparseCreateJadwalForm[39m(data))[33m.[39mnot[33m.[39m[34mtoThrow[39m()[33m;[39m
    [90m   | [39m                                                      [31m^[39m
    [90m389| [39m      })[33m;[39m
    [90m390| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[20/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/validations/jadwal.schema.test.ts[2m > [22mJadwal Schema Validation[2m > [22mHelper Functions[2m > [22msafeParseCreateJadwal[2m > [22mshould return success for valid data
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m src/__tests__/unit/validations/jadwal.schema.test.ts:[2m411:32[22m[39m
    [90m409| [39m
    [90m410| [39m        [35mconst[39m result [33m=[39m [34msafeParseCreateJadwal[39m(data)[33m;[39m
    [90m411| [39m        [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                               [31m^[39m
    [90m412| [39m      })[33m;[39m
    [90m413| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[21/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m src/__tests__/unit/validations/kuis.schema.test.ts[2m > [22mKuis Validation Schemas[2m > [22mcreateKuisSchema[2m > [22mshould reject durasi above maximum
[31m[1mAssertionError[22m: expected true to be false // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- false[39m
[31m+ true[39m

[36m [2mâ¯[22m src/__tests__/unit/validations/kuis.schema.test.ts:[2m96:30[22m[39m
    [90m 94| [39m      [35mconst[39m result [33m=[39m createKuisSchema[33m.[39m[34msafeParse[39m(invalidData)[33m;[39m
    [90m 95| [39m
    [90m 96| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m 97| [39m      [35mif[39m ([33m![39mresult[33m.[39msuccess) {
    [90m 98| [39m        [34mexpect[39m(result[33m.[39merror[33m.[39missues[[34m0[39m][33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m"maksimal"[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetDashboardStats[2m > [22mshould return dashboard statistics successfully
[31m[1mTypeError[22m: supabase.from.mockImplementation is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m64:30[22m[39m
    [90m 62| [39m      [35mconst[39m mockPending [33m=[39m [{ id[33m:[39m [32m"1"[39m }[33m,[39m { id[33m:[39m [32m"2"[39m }][33m;[39m
    [90m 63| [39m
    [90m 64| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockImplementation[39m((table[33m:[39m string) [33m=>[39m {
    [90m   | [39m                             [31m^[39m
    [90m 65| [39m        [35mif[39m (table [33m===[39m [32m"users"[39m) {
    [90m 66| [39m          [35mreturn[39m {

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[23/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetDashboardStats[2m > [22mshould handle empty data gracefully
[31m[1mTypeError[22m: supabase.from.mockImplementation is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m117:30[22m[39m
    [90m115| [39m
    [90m116| [39m    [34mit[39m([32m"should handle empty data gracefully"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m117| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockImplementation[39m((table[33m:[39m string) [33m=>[39m {
    [90m   | [39m                             [31m^[39m
    [90m118| [39m        [35mif[39m (table [33m===[39m [32m"peminjaman"[39m) {
    [90m119| [39m          [90m// peminjaman needs .select().eq() chain[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[24/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetDashboardStats[2m > [22mshould handle database errors
[31m[1mTypeError[22m: supabase.from.mockImplementation is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m153:30[22m[39m
    [90m151| [39m
    [90m152| [39m    [34mit[39m([32m"should handle database errors"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m153| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockImplementation[39m(
    [90m   | [39m                             [31m^[39m
    [90m154| [39m        () [33m=>[39m
    [90m155| [39m          ({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[25/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetDashboardStats[2m > [22mshould handle null data from database
[31m[1mTypeError[22m: supabase.from.mockImplementation is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m169:30[22m[39m
    [90m167| [39m
    [90m168| [39m    [34mit[39m([32m"should handle null data from database"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m169| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockImplementation[39m((table[33m:[39m string) [33m=>[39m {
    [90m   | [39m                             [31m^[39m
    [90m170| [39m        [35mif[39m (table [33m===[39m [32m"peminjaman"[39m) {
    [90m171| [39m          [90m// peminjaman needs .select().eq() chain[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[26/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetUserGrowth[2m > [22mshould return user growth data for last 6 months
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m223:30[22m[39m
    [90m221| [39m      ][33m;[39m
    [90m222| [39m
    [90m223| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m224| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m225| [39m          order[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[27/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetUserGrowth[2m > [22mshould initialize all months with zero users
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m240:30[22m[39m
    [90m238| [39m
    [90m239| [39m    [34mit[39m([32m"should initialize all months with zero users"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m240| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m241| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m242| [39m          order[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[28/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetUserGrowth[2m > [22mshould handle users without created_at
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m260:30[22m[39m
    [90m258| [39m      const mockUsers = [{ created_at: null }, { created_at: undefinedâ€¦
    [90m259| [39m
    [90m260| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m261| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m262| [39m          order[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[29/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetUserGrowth[2m > [22mshould handle database errors
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m275:30[22m[39m
    [90m273| [39m
    [90m274| [39m    [34mit[39m([32m"should handle database errors"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m275| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m276| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m277| [39m          order[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[30/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetUserDistribution[2m > [22mshould return user distribution by role
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m298:30[22m[39m
    [90m296| [39m      ][33m;[39m
    [90m297| [39m
    [90m298| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m299| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m300| [39m          data[33m:[39m mockUsers[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[31/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetUserDistribution[2m > [22mshould capitalize role names
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m320:30[22m[39m
    [90m318| [39m      [35mconst[39m mockUsers [33m=[39m [{ role[33m:[39m [32m"mahasiswa"[39m }][33m;[39m
    [90m319| [39m
    [90m320| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m321| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m322| [39m          data[33m:[39m mockUsers[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[32/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetUserDistribution[2m > [22mshould handle empty data
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m333:30[22m[39m
    [90m331| [39m
    [90m332| [39m    [34mit[39m([32m"should handle empty data"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m333| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m334| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m335| [39m          data[33m:[39m [][33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[33/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetUserDistribution[2m > [22mshould calculate percentage correctly
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m348:30[22m[39m
    [90m346| [39m      [35mconst[39m mockUsers [33m=[39m [{ role[33m:[39m [32m"mahasiswa"[39m }[33m,[39m { role[33m:[39m [32m"dosen"[39m }][33m;[39m
    [90m347| [39m
    [90m348| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m349| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m350| [39m          data[33m:[39m mockUsers[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[34/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetUserDistribution[2m > [22mshould handle database errors
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m363:30[22m[39m
    [90m361| [39m
    [90m362| [39m    [34mit[39m([32m"should handle database errors"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m363| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m364| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m365| [39m          data[33m:[39m [35mnull[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[35/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetLabUsage[2m > [22mshould return lab usage data
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m383:30[22m[39m
    [90m381| [39m      ][33m;[39m
    [90m382| [39m
    [90m383| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m384| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m385| [39m          limit[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[36/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetLabUsage[2m > [22mshould limit to 5 labs
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m412:30[22m[39m
    [90m410| [39m      })[33m;[39m
    [90m411| [39m
    [90m412| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m413| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m414| [39m          limit[33m:[39m limitMock[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[37/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetLabUsage[2m > [22mshould handle empty lab data
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m424:30[22m[39m
    [90m422| [39m
    [90m423| [39m    [34mit[39m([32m"should handle empty lab data"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m424| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m425| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m426| [39m          limit[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[38/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetLabUsage[2m > [22mshould handle database errors
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m439:30[22m[39m
    [90m437| [39m
    [90m438| [39m    [34mit[39m([32m"should handle database errors"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m439| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m440| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m441| [39m          limit[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetRecentUsers[2m > [22mshould return recent users with default limit
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m476:30[22m[39m
    [90m474| [39m      })[33m;[39m
    [90m475| [39m
    [90m476| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m477| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m478| [39m          order[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[40/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetRecentUsers[2m > [22mshould accept custom limit parameter
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m505:30[22m[39m
    [90m503| [39m      })[33m;[39m
    [90m504| [39m
    [90m505| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m506| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m507| [39m          order[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[41/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetRecentUsers[2m > [22mshould handle users without created_at
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m529:30[22m[39m
    [90m527| [39m      ][33m;[39m
    [90m528| [39m
    [90m529| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m530| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m531| [39m          order[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[42/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetRecentUsers[2m > [22mshould handle empty data
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m546:30[22m[39m
    [90m544| [39m
    [90m545| [39m    [34mit[39m([32m"should handle empty data"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m546| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m547| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m548| [39m          order[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[43/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetRecentUsers[2m > [22mshould handle database errors
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m563:30[22m[39m
    [90m561| [39m
    [90m562| [39m    [34mit[39m([32m"should handle database errors"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m563| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m564| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m565| [39m          order[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[44/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetRecentAnnouncements[2m > [22mshould return recent announcements with author names
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m602:30[22m[39m
    [90m600| [39m      })[33m;[39m
    [90m601| [39m
    [90m602| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m603| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m604| [39m          order[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[45/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetRecentAnnouncements[2m > [22mshould handle announcements with null users
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m633:30[22m[39m
    [90m631| [39m      ][33m;[39m
    [90m632| [39m
    [90m633| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m634| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m635| [39m          order[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[46/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetRecentAnnouncements[2m > [22mshould accept custom limit parameter
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m655:30[22m[39m
    [90m653| [39m      })[33m;[39m
    [90m654| [39m
    [90m655| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m656| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m657| [39m          order[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[47/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetRecentAnnouncements[2m > [22mshould handle empty data
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m669:30[22m[39m
    [90m667| [39m
    [90m668| [39m    [34mit[39m([32m"should handle empty data"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m669| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m670| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m671| [39m          order[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[48/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/admin.api.test.ts[2m > [22mAdmin API[2m > [22mgetRecentAnnouncements[2m > [22mshould handle database errors
[31m[1mTypeError[22m: supabase.from.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/admin.api.test.ts:[2m686:30[22m[39m
    [90m684| [39m
    [90m685| [39m    [34mit[39m([32m"should handle database errors"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m686| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m({
    [90m   | [39m                             [31m^[39m
    [90m687| [39m        select[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({
    [90m688| [39m          order[33m:[39m vi[33m.[39m[34mfn[39m()[33m.[39m[34mmockReturnValue[39m({

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[49/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/analytics.api.test.ts[2m > [22mAnalytics API - System Metrics[2m > [22mgetSystemMetrics[2m > [22mshould fetch all system metrics successfully
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/analytics.api.test.ts:[2m82:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[50/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/analytics.api.test.ts[2m > [22mAnalytics API - System Metrics[2m > [22mgetSystemMetrics[2m > [22mshould determine Good health when borrowings < 50
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/analytics.api.test.ts:[2m117:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[51/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/analytics.api.test.ts[2m > [22mAnalytics API - System Metrics[2m > [22mgetSystemMetrics[2m > [22mshould determine Warning health when borrowings 51-100
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/analytics.api.test.ts:[2m145:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[52/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/analytics.api.test.ts[2m > [22mAnalytics API - System Metrics[2m > [22mgetSystemMetrics[2m > [22mshould determine Critical health when borrowings > 100
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/analytics.api.test.ts:[2m173:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[53/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/analytics.api.test.ts[2m > [22mAnalytics API - System Metrics[2m > [22mgetSystemMetrics[2m > [22mshould handle null counts as 0
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/analytics.api.test.ts:[2m204:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[54/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/analytics.api.test.ts[2m > [22mAnalytics API - System Metrics[2m > [22mgetSystemMetrics[2m > [22mshould return zero metrics on error
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/analytics.api.test.ts:[2m225:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[55/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/analytics.api.test.ts[2m > [22mAnalytics API - System Metrics[2m > [22mgetSystemMetrics[2m > [22mshould filter active classes correctly
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/analytics.api.test.ts:[2m260:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[56/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/analytics.api.test.ts[2m > [22mAnalytics API - System Metrics[2m > [22mgetSystemMetrics[2m > [22mshould filter pending and approved borrowings
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/analytics.api.test.ts:[2m289:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[57/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/announcements.api.test.ts[2m > [22mAnnouncements API[2m > [22mcreateAnnouncement[2m > [22mshould create announcement
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/announcements.api.test.ts:[2m86:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[58/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/announcements.api.test.ts[2m > [22mAnnouncements API[2m > [22mdeleteAnnouncement[2m > [22mshould delete announcement
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/announcements.api.test.ts:[2m103:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[59/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Query Functions[2m > [22mquery[2m > [22mshould fetch all records from a table
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.query server/src/lib/api/base.api.ts:[2m105:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m120:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[60/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Query Functions[2m > [22mquery[2m > [22mshould apply select option
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.query server/src/lib/api/base.api.ts:[2m105:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m132:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[61/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Query Functions[2m > [22mquery[2m > [22mshould apply order option
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.query server/src/lib/api/base.api.ts:[2m105:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m142:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[62/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Query Functions[2m > [22mquery[2m > [22mshould apply limit option
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.query server/src/lib/api/base.api.ts:[2m105:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m154:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[63/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Query Functions[2m > [22mquery[2m > [22mshould apply offset with range
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.query server/src/lib/api/base.api.ts:[2m105:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m164:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[64/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Query Functions[2m > [22mquery[2m > [22mshould throw NotFoundError when throwOnEmpty is true and no data
[31m[1mAssertionError[22m: expected [Function] to throw error including 'No records found' but got 'Could not find the table \'public.tesâ€¦'[39m

Expected: [32m"No records found"[39m
Received: [31m"Could not find the table 'public.test_table' in the schema cache"[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m174:7[22m[39m
    [90m172| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m(builder)[33m;[39m
    [90m173| [39m
    [90m174| [39m      await expect(query("test_table", { throwOnEmpty: true })).rejectâ€¦
    [90m   | [39m      [31m^[39m
    [90m175| [39m        [32m"No records found"[39m[33m,[39m
    [90m176| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[65/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Query Functions[2m > [22mqueryWithFilters[2m > [22mshould apply eq filter
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.queryWithFilters server/src/lib/api/base.api.ts:[2m208:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m203:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[66/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Query Functions[2m > [22mqueryWithFilters[2m > [22mshould apply multiple filters
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.queryWithFilters server/src/lib/api/base.api.ts:[2m208:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m215:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[67/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Query Functions[2m > [22mqueryWithFilters[2m > [22mshould apply all filter operators
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.queryWithFilters server/src/lib/api/base.api.ts:[2m208:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m229:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[68/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Query Functions[2m > [22mgetById[2m > [22mshould fetch single record by ID
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.getById server/src/lib/api/base.api.ts:[2m246:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m257:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[69/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Query Functions[2m > [22mgetById[2m > [22mshould throw NotFoundError when record not found
[31m[1mAssertionError[22m: expected error to be instance of NotFoundError[39m

[32m- Expected:[39m 
[Function NotFoundError]

[31m+ Received:[39m 
ServerError {
  "message": "Could not find the table 'public.test_table' in the schema cache",
  "code": "INTERNAL_ERROR",
  "statusCode": 500,
  "details": {
    "details": null,
    "hint": null,
  },
  "timestamp": "2026-01-14T05:28:11.030Z",
  "name": "ServerError",
}

[36m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m269:7[22m[39m
    [90m267| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m(builder)[33m;[39m
    [90m268| [39m
    [90m269| [39m      await expect(getById("test_table", "nonexistent")).rejects.toThrâ€¦
    [90m   | [39m      [31m^[39m
    [90m270| [39m        [33mNotFoundError[39m[33m,[39m
    [90m271| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[70/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Query Functions[2m > [22mgetPaginated[2m > [22mshould return paginated results with metadata
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.getPaginated server/src/lib/api/base.api.ts:[2m322:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m290:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[71/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Query Functions[2m > [22mgetPaginated[2m > [22mshould calculate correct pagination for last page
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.getPaginated server/src/lib/api/base.api.ts:[2m322:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m319:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[72/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Query Functions[2m > [22mgetPaginated[2m > [22mshould apply sorting
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.getPaginated server/src/lib/api/base.api.ts:[2m322:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m341:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[73/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - CRUD Operations[2m > [22minsert[2m > [22mshould insert single record
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.insert server/src/lib/api/base.api.ts:[2m375:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m368:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[74/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - CRUD Operations[2m > [22minsert[2m > [22mshould throw error when insert fails
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Insert failed' but got 'Could not find the table \'public.tesâ€¦'[39m

Expected: [32m"Insert failed"[39m
Received: [31m"Could not find the table 'public.test_table' in the schema cache"[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m383:7[22m[39m
    [90m381| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m(builder)[33m;[39m
    [90m382| [39m
    [90m383| [39m      await expect(insert("test_table", { name: "New Item" })).rejectsâ€¦
    [90m   | [39m      [31m^[39m
    [90m384| [39m        [32m"Insert failed"[39m[33m,[39m
    [90m385| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[75/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - CRUD Operations[2m > [22minsertMany[2m > [22mshould insert multiple records
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.insertMany server/src/lib/api/base.api.ts:[2m413:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m399:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[76/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - CRUD Operations[2m > [22mupdate[2m > [22mshould update record by ID
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.update server/src/lib/api/base.api.ts:[2m448:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m415:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[77/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - CRUD Operations[2m > [22mupdate[2m > [22mshould throw NotFoundError when record not found
[31m[1mAssertionError[22m: expected error to be instance of NotFoundError[39m

[32m- Expected:[39m 
[Function NotFoundError]

[31m+ Received:[39m 
ServerError {
  "message": "Could not find the table 'public.test_table' in the schema cache",
  "code": "INTERNAL_ERROR",
  "statusCode": 500,
  "details": {
    "details": null,
    "hint": null,
  },
  "timestamp": "2026-01-14T05:28:12.149Z",
  "name": "ServerError",
}

[36m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m427:7[22m[39m
    [90m425| [39m      (supabase[33m.[39m[35mfrom[39m [35mas[39m any)[33m.[39m[34mmockReturnValue[39m(builder)[33m;[39m
    [90m426| [39m
    [90m427| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m428| [39m        [34mupdate[39m([32m"test_table"[39m[33m,[39m [32m"nonexistent"[39m[33m,[39m { name[33m:[39m [32m"Updated"[39m })[33m,[39m
    [90m429| [39m      )[33m.[39mrejects[33m.[39m[34mtoThrow[39m([33mNotFoundError[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[78/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - CRUD Operations[2m > [22mupdateMany[2m > [22mshould update multiple records with filters
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.updateMany server/src/lib/api/base.api.ts:[2m524:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m442:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[79/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - CRUD Operations[2m > [22mremove[2m > [22mshould delete record by ID
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.remove server/src/lib/api/base.api.ts:[2m591:15[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m460:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[80/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - CRUD Operations[2m > [22mremoveMany[2m > [22mshould delete multiple records with filters
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.removeMany server/src/lib/api/base.api.ts:[2m678:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m474:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[81/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Utility Functions[2m > [22mexists[2m > [22mshould return true when record exists
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m502:22[22m[39m
    [90m500| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mexists[39m([32m"test_table"[39m[33m,[39m [32m"1"[39m)[33m;[39m
    [90m501| [39m
    [90m502| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m503| [39m    })[33m;[39m
    [90m504| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[82/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Utility Functions[2m > [22mcount[2m > [22mshould count all records
[31m[1mAssertionError[22m: expected +0 to be 42 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 42[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m538:22[22m[39m
    [90m536| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mcount[39m([32m"test_table"[39m)[33m;[39m
    [90m537| [39m
    [90m538| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBe[39m([34m42[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m539| [39m      [34mexpect[39m(builder[33m.[39mselect)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m"*"[39m[33m,[39m {
    [90m540| [39m        count[33m:[39m [32m"exact"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[83/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Utility Functions[2m > [22mcount[2m > [22mshould count records with filters
[31m[1mAssertionError[22m: expected +0 to be 10 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 10[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m555:22[22m[39m
    [90m553| [39m      ])[33m;[39m
    [90m554| [39m
    [90m555| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBe[39m([34m10[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m556| [39m      [34mexpect[39m(builder[33m.[39mselect)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m"*"[39m[33m,[39m {
    [90m557| [39m        count[33m:[39m [32m"exact"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[84/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/base.api.test.ts[2m > [22mBase API - Integration[2m > [22mshould handle complete CRUD workflow
[31m[1mServerError[22m: Could not find the table 'public.test_table' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.insert server/src/lib/api/base.api.ts:[2m375:13[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/base.api.test.ts:[2m619:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[85/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22mDosen API - Dashboard Stats[2m > [22mgetDosenStats[2m > [22mshould return stats for authenticated dosen
[31m[1mAssertionError[22m: expected { totalKelas: +0, â€¦(3) } to deeply equal { totalKelas: 5, â€¦(3) }[39m

[32m- Expected[39m
[31m+ Received[39m

[2m  {[22m
[32m-   "activeKuis": 8,[39m
[32m-   "pendingGrading": 15,[39m
[32m-   "totalKelas": 5,[39m
[32m-   "totalMahasiswa": 120,[39m
[31m+   "activeKuis": 0,[39m
[31m+   "pendingGrading": 0,[39m
[31m+   "totalKelas": 0,[39m
[31m+   "totalMahasiswa": 0,[39m
[2m  }[22m

[36m [2mâ¯[22m server/src/__tests__/unit/api/dosen.api.test.ts:[2m226:22[22m[39m
    [90m224| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetDosenStats[39m()[33m;[39m
    [90m225| [39m
    [90m226| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m({
    [90m   | [39m                     [31m^[39m
    [90m227| [39m        totalKelas[33m:[39m [34m5[39m[33m,[39m
    [90m228| [39m        totalMahasiswa[33m:[39m [34m120[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[86/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22mDosen API - Dashboard Stats[2m > [22mgetDosenStats[2m > [22mshould use cached dosen ID on subsequent calls
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'cached_dosen_id', â€¦(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/dosen.api.test.ts:[2m292:40[22m[39m
    [90m290| [39m      [35mawait[39m [34mgetDosenStats[39m()[33m;[39m
    [90m291| [39m
    [90m292| [39m      [34mexpect[39m(localStorageMock[33m.[39msetItem)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                                       [31m^[39m
    [90m293| [39m        [32m"cached_dosen_id"[39m[33m,[39m
    [90m294| [39m        [33mTEST_DOSEN_ID[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[87/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22mDosen API - Kelas Management[2m > [22mgetMyKelas[2m > [22mshould return kelas with stats for dosen
[31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/dosen.api.test.ts:[2m345:22[22m[39m
    [90m343| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetMyKelas[39m()[33m;[39m
    [90m344| [39m
    [90m345| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m346| [39m      [34mexpect[39m(result[[34m0[39m])[33m.[39m[34mtoEqual[39m({
    [90m347| [39m        id[33m:[39m [33mTEST_KELAS_ID[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[88/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22mDosen API - Kelas Management[2m > [22mgetMyKelas[2m > [22mshould apply limit when provided
[31m[1mAssertionError[22m: expected [] to have a length of 2 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 2[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/dosen.api.test.ts:[2m403:22[22m[39m
    [90m401| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetMyKelas[39m([34m2[39m)[33m;[39m
    [90m402| [39m
    [90m403| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m2[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m404| [39m    })[33m;[39m
    [90m405| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[89/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22mDosen API - Kelas Management[2m > [22mgetMyKelas[2m > [22mshould handle duplicate kelas correctly
[31m[1mAssertionError[22m: expected [] to have a length of 2 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 2[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/dosen.api.test.ts:[2m464:22[22m[39m
    [90m462| [39m
    [90m463| [39m      [90m// Should only return 2 unique kelas (duplicates removed)[39m
    [90m464| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m2[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m465| [39m    })[33m;[39m
    [90m466| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[90/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22mDosen API - Kelas Management[2m > [22mgetMyMataKuliah[2m > [22mshould return mata kuliah with aggregated stats
[31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/dosen.api.test.ts:[2m505:22[22m[39m
    [90m503| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetMyMataKuliah[39m()[33m;[39m
    [90m504| [39m
    [90m505| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m506| [39m      [34mexpect[39m(result[[34m0[39m])[33m.[39m[34mtoMatchObject[39m({
    [90m507| [39m        id[33m:[39m [33mTEST_MK_ID[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[91/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22mDosen API - Kelas Management[2m > [22mgetMyMataKuliah[2m > [22mshould apply limit when provided
[31m[1mAssertionError[22m: expected [] to have a length of 2 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 2[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/dosen.api.test.ts:[2m588:22[22m[39m
    [90m586| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetMyMataKuliah[39m([34m2[39m)[33m;[39m
    [90m587| [39m
    [90m588| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m2[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m589| [39m    })[33m;[39m
    [90m590| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[92/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22mDosen API - Student Management[2m > [22mgetKelasStudents[2m > [22mshould return students for a kelas
[31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/dosen.api.test.ts:[2m631:22[22m[39m
    [90m629| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetKelasStudents[39m([33mTEST_KELAS_ID[39m)[33m;[39m
    [90m630| [39m
    [90m631| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m632| [39m      [34mexpect[39m(result[[34m0[39m])[33m.[39m[34mtoMatchObject[39m({
    [90m633| [39m        id[33m:[39m [32m"enrollment-1"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[93/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22mDosen API - Grading Operations[2m > [22mgetPendingGrading[2m > [22mshould return pending grading items
[31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/dosen.api.test.ts:[2m856:22[22m[39m
    [90m854| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetPendingGrading[39m()[33m;[39m
    [90m855| [39m
    [90m856| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m857| [39m      [34mexpect[39m(result[[34m0[39m])[33m.[39m[34mtoMatchObject[39m({
    [90m858| [39m        id[33m:[39m [32m"attempt-1"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[94/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22mDosen API - Grading Operations[2m > [22mgetPendingGrading[2m > [22mshould apply limit when provided
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 5 ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/dosen.api.test.ts:[2m887:36[22m[39m
    [90m885| [39m      [35mawait[39m [34mgetPendingGrading[39m([34m5[39m)[33m;[39m
    [90m886| [39m
    [90m887| [39m      [34mexpect[39m(attemptBuilder[33m.[39mlimit)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m5[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m888| [39m    })[33m;[39m
    [90m889| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[95/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22mDosen API - Grading Operations[2m > [22mgetActiveKuis[2m > [22mshould return active quizzes with stats
[31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/dosen.api.test.ts:[2m935:22[22m[39m
    [90m933| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetActiveKuis[39m()[33m;[39m
    [90m934| [39m
    [90m935| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m936| [39m      [34mexpect[39m(result[[34m0[39m])[33m.[39m[34mtoMatchObject[39m({
    [90m937| [39m        id[33m:[39m [33mTEST_KUIS_ID[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[96/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/dosen.api.test.ts[2m > [22mDosen API - Grading Operations[2m > [22mgetActiveKuis[2m > [22mshould apply limit when provided
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 10 ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/dosen.api.test.ts:[2m957:29[22m[39m
    [90m955| [39m      [35mawait[39m [34mgetActiveKuis[39m([34m10[39m)[33m;[39m
    [90m956| [39m
    [90m957| [39m      [34mexpect[39m(builder[33m.[39mlimit)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m10[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m958| [39m    })[33m;[39m
    [90m959| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[97/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mgetKehadiranByJadwal[2m > [22mshould fetch kehadiran by jadwal_id successfully
[31m[1mAssertionError[22m: expected [] to deeply equal [ { â€¦(10) } ][39m

[32m- Expected[39m
[31m+ Received[39m

[32m- [[39m
[32m-   {[39m
[32m-     "created_at": "2025-01-15T08:00:00Z",[39m
[32m-     "id": "223e4567-e89b-12d3-a456-426614174001",[39m
[32m-     "jadwal_id": "123e4567-e89b-12d3-a456-426614174000",[39m
[32m-     "keterangan": undefined,[39m
[32m-     "mahasiswa": {[39m
[32m-       "id": "323e4567-e89b-12d3-a456-426614174002",[39m
[32m-       "nim": "BD2321001",[39m
[32m-       "user": {[39m
[32m-         "full_name": "Siti Nurhaliza",[39m
[32m-       },[39m
[32m-     },[39m
[32m-     "mahasiswa_id": "323e4567-e89b-12d3-a456-426614174002",[39m
[32m-     "status": "hadir",[39m
[32m-     "updated_at": "2025-01-15T08:00:00Z",[39m
[32m-     "waktu_check_in": "08:00:00",[39m
[32m-     "waktu_check_out": "10:00:00",[39m
[32m-   },[39m
[32m- ][39m
[31m+ [][39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m75:22[22m[39m
    [90m 73| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetKehadiranByJadwal[39m([33mTEST_JADWAL_ID[39m)[33m;[39m
    [90m 74| [39m
    [90m 75| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m(mockData)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m 76| [39m      [34mexpect[39m(supabase[33m.[39m[35mfrom[39m)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m"kehadiran"[39m)[33m;[39m
    [90m 77| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[98/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mgetKehadiranByJadwal[2m > [22mshould order by mahasiswa NIM ascending
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'mahasiswa(nim)', â€¦(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m92:25[22m[39m
    [90m 90| [39m      [35mawait[39m [34mgetKehadiranByJadwal[39m([33mTEST_JADWAL_ID[39m)[33m;[39m
    [90m 91| [39m
    [90m 92| [39m      [34mexpect[39m(orderMock)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m"mahasiswa(nim)"[39m[33m,[39m {
    [90m   | [39m                        [31m^[39m
    [90m 93| [39m        ascending[33m:[39m [35mtrue[39m[33m,[39m
    [90m 94| [39m      })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[99/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mgetKehadiranByJadwal[2m > [22mshould handle errors gracefully
[31m[1mAssertionError[22m: promise resolved "[]" instead of rejecting[39m

[32m- Expected:[39m 
Error {
  "message": "rejected promise",
}

[31m+ Received:[39m 
[]

[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m111:56[22m[39m
    [90m109| [39m      } [35mas[39m any)[33m;[39m
    [90m110| [39m
    [90m111| [39m      await expect(getKehadiranByJadwal(TEST_JADWAL_ID)).rejects.toThrâ€¦
    [90m   | [39m                                                       [31m^[39m
    [90m112| [39m    })[33m;[39m
    [90m113| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[100/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mgetKehadiranByKelas[2m > [22mshould fetch kehadiran by kelas_id successfully
[31m[1mAssertionError[22m: expected [] to deeply equal [ { â€¦(10) } ][39m

[32m- Expected[39m
[31m+ Received[39m

[32m- [[39m
[32m-   {[39m
[32m-     "created_at": "2025-01-15T08:00:00Z",[39m
[32m-     "id": "223e4567-e89b-12d3-a456-426614174001",[39m
[32m-     "jadwal_id": "123e4567-e89b-12d3-a456-426614174000",[39m
[32m-     "keterangan": undefined,[39m
[32m-     "mahasiswa": {[39m
[32m-       "id": "323e4567-e89b-12d3-a456-426614174002",[39m
[32m-       "nim": "BD2321001",[39m
[32m-       "user": {[39m
[32m-         "full_name": "Siti Nurhaliza",[39m
[32m-       },[39m
[32m-     },[39m
[32m-     "mahasiswa_id": "323e4567-e89b-12d3-a456-426614174002",[39m
[32m-     "status": "hadir",[39m
[32m-     "updated_at": "2025-01-15T08:00:00Z",[39m
[32m-     "waktu_check_in": "08:00:00",[39m
[32m-     "waktu_check_out": "10:00:00",[39m
[32m-   },[39m
[32m- ][39m
[31m+ [][39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m149:22[22m[39m
    [90m147| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetKehadiranByKelas[39m([33mTEST_KELAS_ID[39m)[33m;[39m
    [90m148| [39m
    [90m149| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m(mockData)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m150| [39m      [34mexpect[39m(supabase[33m.[39m[35mfrom[39m)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m"kehadiran"[39m)[33m;[39m
    [90m151| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[101/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mgetKehadiranByKelas[2m > [22mshould apply date range filters when provided
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'jadwal.tanggal_praktikum', â€¦(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m170:23[22m[39m
    [90m168| [39m      await getKehadiranByKelas(TEST_KELAS_ID, "2025-01-01", "2025-01-â€¦
    [90m169| [39m
    [90m170| [39m      [34mexpect[39m(gteMock)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                      [31m^[39m
    [90m171| [39m        [32m"jadwal.tanggal_praktikum"[39m[33m,[39m
    [90m172| [39m        [32m"2025-01-01"[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[102/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mgetKehadiranByKelas[2m > [22mshould handle errors gracefully
[31m[1mAssertionError[22m: promise resolved "[]" instead of rejecting[39m

[32m- Expected:[39m 
Error {
  "message": "rejected promise",
}

[31m+ Received:[39m 
[]

[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m208:54[22m[39m
    [90m206| [39m      } [35mas[39m any)[33m;[39m
    [90m207| [39m
    [90m208| [39m      await expect(getKehadiranByKelas(TEST_KELAS_ID)).rejects.toThrowâ€¦
    [90m   | [39m                                                     [31m^[39m
    [90m209| [39m    })[33m;[39m
    [90m210| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[103/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mgetKehadiranStats[2m > [22mshould calculate stats correctly with all statuses
[31m[1mServerError[22m: Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m Module.getKehadiranStats server/src/lib/api/kehadiran.api.ts:[2m348:11[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m236:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[104/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mgetKehadiranStats[2m > [22mshould return zero stats when no records
[31m[1mServerError[22m: Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m Module.getKehadiranStats server/src/lib/api/kehadiran.api.ts:[2m348:11[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m260:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[105/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mgetKehadiranStats[2m > [22mshould calculate 100% when all hadir
[31m[1mServerError[22m: Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m Module.getKehadiranStats server/src/lib/api/kehadiran.api.ts:[2m348:11[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m291:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[106/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mgetKehadiranStats[2m > [22mshould calculate 0% when all alpha
[31m[1mServerError[22m: Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m Module.getKehadiranStats server/src/lib/api/kehadiran.api.ts:[2m348:11[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m310:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[107/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mgetKehadiranStats[2m > [22mshould round persentase to nearest integer
[31m[1mServerError[22m: Could not find a relationship between 'kehadiran' and 'jadwal' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m Module.getKehadiranStats server/src/lib/api/kehadiran.api.ts:[2m348:11[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m351:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[108/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mcalculateNilaiKehadiran[2m > [22mshould calculate nilai with hadir only (100)
[31m[1mAssertionError[22m: expected +0 to be 100 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 100[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m374:21[22m[39m
    [90m372| [39m      const nilai = await calculateNilaiKehadiran(TEST_MHS_ID, TEST_KEâ€¦
    [90m373| [39m
    [90m374| [39m      [34mexpect[39m(nilai)[33m.[39m[34mtoBe[39m([34m100[39m)[33m;[39m
    [90m   | [39m                    [31m^[39m
    [90m375| [39m    })[33m;[39m
    [90m376| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[109/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mcalculateNilaiKehadiran[2m > [22mshould calculate nilai with mixed statuses
[31m[1mAssertionError[22m: expected +0 to be 75 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 75[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m399:21[22m[39m
    [90m397| [39m      const nilai = await calculateNilaiKehadiran(TEST_MHS_ID, TEST_KEâ€¦
    [90m398| [39m
    [90m399| [39m      [34mexpect[39m(nilai)[33m.[39m[34mtoBe[39m([34m75[39m)[33m;[39m
    [90m   | [39m                    [31m^[39m
    [90m400| [39m    })[33m;[39m
    [90m401| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[110/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mcalculateNilaiKehadiran[2m > [22mshould round nilai to nearest integer
[31m[1mAssertionError[22m: expected +0 to be 83 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 83[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m498:21[22m[39m
    [90m496| [39m      const nilai = await calculateNilaiKehadiran(TEST_MHS_ID, TEST_KEâ€¦
    [90m497| [39m
    [90m498| [39m      [34mexpect[39m(nilai)[33m.[39m[34mtoBe[39m([34m83[39m)[33m;[39m
    [90m   | [39m                    [31m^[39m
    [90m499| [39m      [34mexpect[39m([33mNumber[39m[33m.[39m[34misInteger[39m(nilai))[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m500| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[111/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mgetMahasiswaKehadiran[2m > [22mshould fetch mahasiswa kehadiran records successfully
[31m[1mAssertionError[22m: expected [] to deeply equal [ { â€¦(5) } ][39m

[32m- Expected[39m
[31m+ Received[39m

[32m- [[39m
[32m-   {[39m
[32m-     "created_at": "2025-01-15T08:00:00Z",[39m
[32m-     "id": "223e4567-e89b-12d3-a456-426614174001",[39m
[32m-     "jadwal": {[39m
[32m-       "id": "123e4567-e89b-12d3-a456-426614174000",[39m
[32m-       "jam_mulai": "08:00",[39m
[32m-       "jam_selesai": "10:00",[39m
[32m-       "kelas": {[39m
[32m-         "mata_kuliah": {[39m
[32m-           "nama_mk": "Kebidanan",[39m
[32m-         },[39m
[32m-         "nama_kelas": "Kelas A",[39m
[32m-       },[39m
[32m-       "laboratorium": {[39m
[32m-         "nama_lab": "Lab Kebidanan 1",[39m
[32m-       },[39m
[32m-       "tanggal_praktikum": "2025-01-15",[39m
[32m-       "topik": "Praktikum Dasar",[39m
[32m-     },[39m
[32m-     "keterangan": null,[39m
[32m-     "status": "hadir",[39m
[32m-   },[39m
[32m- ][39m
[31m+ [][39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m545:22[22m[39m
    [90m543| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetMahasiswaKehadiran[39m([33mTEST_MHS_ID[39m)[33m;[39m
    [90m544| [39m
    [90m545| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m(mockData)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m546| [39m      [34mexpect[39m(supabase[33m.[39m[35mfrom[39m)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m"kehadiran"[39m)[33m;[39m
    [90m547| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[112/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mgetMahasiswaKehadiran[2m > [22mshould limit results to 100
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 100 ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m564:25[22m[39m
    [90m562| [39m      [35mawait[39m [34mgetMahasiswaKehadiran[39m([33mTEST_MHS_ID[39m)[33m;[39m
    [90m563| [39m
    [90m564| [39m      [34mexpect[39m(limitMock)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m100[39m)[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m565| [39m    })[33m;[39m
    [90m566| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[113/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mgetMahasiswaKehadiran[2m > [22mshould order by tanggal descending
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'jadwal(tanggal_praktikum)', â€¦(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m582:25[22m[39m
    [90m580| [39m      [35mawait[39m [34mgetMahasiswaKehadiran[39m([33mTEST_MHS_ID[39m)[33m;[39m
    [90m581| [39m
    [90m582| [39m      expect(orderMock).toHaveBeenCalledWith("jadwal(tanggal_praktikumâ€¦
    [90m   | [39m                        [31m^[39m
    [90m583| [39m        ascending[33m:[39m [35mfalse[39m[33m,[39m
    [90m584| [39m      })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[114/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mgetMahasiswaKehadiran[2m > [22mshould handle errors gracefully
[31m[1mAssertionError[22m: promise resolved "[]" instead of rejecting[39m

[32m- Expected:[39m 
Error {
  "message": "rejected promise",
}

[31m+ Received:[39m 
[]

[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m603:54[22m[39m
    [90m601| [39m      } [35mas[39m any)[33m;[39m
    [90m602| [39m
    [90m603| [39m      await expect(getMahasiswaKehadiran(TEST_MHS_ID)).rejects.toThrowâ€¦
    [90m   | [39m                                                     [31m^[39m
    [90m604| [39m    })[33m;[39m
    [90m605| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[115/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mEdge Cases & Business Logic Validation[2m > [22mshould handle single attendance record correctly
[31m[1mAssertionError[22m: expected +0 to be 100 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 100[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m643:21[22m[39m
    [90m641| [39m      const nilai = await calculateNilaiKehadiran(TEST_MHS_ID, TEST_KEâ€¦
    [90m642| [39m
    [90m643| [39m      [34mexpect[39m(nilai)[33m.[39m[34mtoBe[39m([34m100[39m)[33m;[39m
    [90m   | [39m                    [31m^[39m
    [90m644| [39m    })[33m;[39m
    [90m645| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[116/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mEdge Cases & Business Logic Validation[2m > [22mshould handle all izin correctly (50% nilai)
[31m[1mAssertionError[22m: expected +0 to be 50 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 50[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m662:21[22m[39m
    [90m660| [39m      const nilai = await calculateNilaiKehadiran(TEST_MHS_ID, TEST_KEâ€¦
    [90m661| [39m
    [90m662| [39m      [34mexpect[39m(nilai)[33m.[39m[34mtoBe[39m([34m50[39m)[33m;[39m [90m// (0 + 1 + 0) / 2 * 100 = 50[39m
    [90m   | [39m                    [31m^[39m
    [90m663| [39m    })[33m;[39m
    [90m664| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[117/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mEdge Cases & Business Logic Validation[2m > [22mshould handle all sakit correctly (50% nilai)
[31m[1mAssertionError[22m: expected +0 to be 50 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 50[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m681:21[22m[39m
    [90m679| [39m      const nilai = await calculateNilaiKehadiran(TEST_MHS_ID, TEST_KEâ€¦
    [90m680| [39m
    [90m681| [39m      [34mexpect[39m(nilai)[33m.[39m[34mtoBe[39m([34m50[39m)[33m;[39m
    [90m   | [39m                    [31m^[39m
    [90m682| [39m    })[33m;[39m
    [90m683| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[118/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kehadiran.api.test.ts[2m > [22mKehadiran API[2m > [22mEdge Cases & Business Logic Validation[2m > [22mshould validate formula with large dataset
[31m[1mAssertionError[22m: expected +0 to be 82 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 82[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/kehadiran.api.test.ts:[2m707:21[22m[39m
    [90m705| [39m      const nilai = await calculateNilaiKehadiran(TEST_MHS_ID, TEST_KEâ€¦
    [90m706| [39m
    [90m707| [39m      [34mexpect[39m(nilai)[33m.[39m[34mtoBe[39m([34m82[39m)[33m;[39m
    [90m   | [39m                    [31m^[39m
    [90m708| [39m    })[33m;[39m
    [90m709| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[119/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - CRUD Operations[2m > [22mcreateKelas[2m > [22mshould create new kelas and return with relations
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m284:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[120/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - CRUD Operations[2m > [22mcreateKelas[2m > [22mshould handle creation errors
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Failed to create kelas' but got 'User not authenticated'[39m

Expected: [32m"Failed to create kelas"[39m
Received: [31m"User not authenticated"[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m294:7[22m[39m
    [90m292| [39m      vi[33m.[39m[34mmocked[39m(insert)[33m.[39m[34mmockRejectedValue[39m([35mnew[39m [33mError[39m([32m"Insert failed"[39m))[33m;[39m
    [90m293| [39m
    [90m294| [39m      [35mawait[39m [34mexpect[39m([34mcreateKelas[39m({} [35mas[39m any))[33m.[39mrejects[33m.[39m[34mtoThrow[39m(
    [90m   | [39m      [31m^[39m
    [90m295| [39m        [32m"Failed to create kelas"[39m[33m,[39m
    [90m296| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[121/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - CRUD Operations[2m > [22mupdateKelas[2m > [22mshould update kelas and return updated data
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m306:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[122/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - CRUD Operations[2m > [22mdeleteKelas[2m > [22mshould delete kelas by ID
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m322:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[123/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Enrollment[2m > [22mgetEnrolledStudents[2m > [22mshould fetch enrolled students for a kelas
[31m[1mError[22m: Failed to fetch enrolled students: invalid input syntax for type uuid: "kelas-1"[39m
[36m [2mâ¯[22m Module.getEnrolledStudents server/src/lib/api/kelas.api.ts:[2m296:11[22m[39m
    [90m294| [39m  } [35mcatch[39m (error[33m:[39m unknown) {
    [90m295| [39m    console[33m.[39m[34merror[39m([32m"Error fetching enrolled students:"[39m[33m,[39m error)[33m;[39m
    [90m296| [39m    [35mthrow[39m [35mnew[39m [33mError[39m(
    [90m   | [39m          [31m^[39m
    [90m297| [39m      [32m`Failed to fetch enrolled students: [39m[36m${[39m(error [35mas[39m [33mError[39m)[33m.[39mmessage[36m}[39m[32m`[39m[33m,[39m
    [90m298| [39m    )[33m;[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m347:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[124/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Enrollment[2m > [22mgetEnrolledStudents[2m > [22mshould handle empty enrollment
[31m[1mError[22m: Failed to fetch enrolled students: invalid input syntax for type uuid: "kelas-1"[39m
[36m [2mâ¯[22m Module.getEnrolledStudents server/src/lib/api/kelas.api.ts:[2m296:11[22m[39m
    [90m294| [39m  } [35mcatch[39m (error[33m:[39m unknown) {
    [90m295| [39m    console[33m.[39m[34merror[39m([32m"Error fetching enrolled students:"[39m[33m,[39m error)[33m;[39m
    [90m296| [39m    [35mthrow[39m [35mnew[39m [33mError[39m(
    [90m   | [39m          [31m^[39m
    [90m297| [39m      [32m`Failed to fetch enrolled students: [39m[36m${[39m(error [35mas[39m [33mError[39m)[33m.[39mmessage[36m}[39m[32m`[39m[33m,[39m
    [90m298| [39m    )[33m;[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m362:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[125/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould enroll student successfully when quota available
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m415:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[126/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould reject enrollment when kelas is full
[31m[1mAssertionError[22m: expected [Function] to throw error including 'sudah penuh' but got 'User not authenticated'[39m

Expected: [32m"sudah penuh"[39m
Received: [31m"User not authenticated"[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m438:7[22m[39m
    [90m436| [39m        [33m.[39m[34mmockReturnValueOnce[39m(countBuilder [35mas[39m any)[33m;[39m
    [90m437| [39m
    [90m438| [39m      [35mawait[39m [34mexpect[39m([34menrollStudent[39m([32m"kelas-1"[39m[33m,[39m [32m"mhs-1"[39m))[33m.[39mrejects[33m.[39m[34mtoThrow[39m(
    [90m   | [39m      [31m^[39m
    [90m439| [39m        [32m"sudah penuh"[39m[33m,[39m
    [90m440| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[127/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould reject duplicate enrollment
[31m[1mAssertionError[22m: expected [Function] to throw error including 'sudah terdaftar' but got 'User not authenticated'[39m

Expected: [32m"sudah terdaftar"[39m
Received: [31m"User not authenticated"[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m469:7[22m[39m
    [90m467| [39m        [33m.[39m[34mmockReturnValueOnce[39m(existingBuilder)[33m;[39m
    [90m468| [39m
    [90m469| [39m      [35mawait[39m [34mexpect[39m([34menrollStudent[39m([32m"kelas-1"[39m[33m,[39m [32m"mhs-1"[39m))[33m.[39mrejects[33m.[39m[34mtoThrow[39m(
    [90m   | [39m      [31m^[39m
    [90m470| [39m        [32m"sudah terdaftar"[39m[33m,[39m
    [90m471| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[128/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould handle kelas not found
[31m[1mAssertionError[22m: expected [Function] to throw error including 'tidak ditemukan' but got 'User not authenticated'[39m

Expected: [32m"tidak ditemukan"[39m
Received: [31m"User not authenticated"[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m480:7[22m[39m
    [90m478| [39m      vi[33m.[39m[34mmocked[39m(supabase[33m.[39m[35mfrom[39m)[33m.[39m[34mmockReturnValueOnce[39m(kelasBuilder)[33m;[39m
    [90m479| [39m
    [90m480| [39m      await expect(enrollStudent("nonexistent", "mhs-1")).rejects.toThâ€¦
    [90m   | [39m      [31m^[39m
    [90m481| [39m        [32m"tidak ditemukan"[39m[33m,[39m
    [90m482| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[129/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Enrollment[2m > [22menrollStudent - CRITICAL VALIDATION[2m > [22mshould handle null kuota (unlimited enrollment)
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m516:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[130/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Enrollment[2m > [22munenrollStudent[2m > [22mshould remove student from kelas
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m532:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[131/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Enrollment[2m > [22mtoggleStudentStatus[2m > [22mshould activate student in kelas
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m564:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[132/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Enrollment[2m > [22mtoggleStudentStatus[2m > [22mshould deactivate student in kelas
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m580:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[133/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Management[2m > [22mgetAllMahasiswa[2m > [22mshould fetch all mahasiswa with user info
[31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m624:22[22m[39m
    [90m622| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetAllMahasiswa[39m()[33m;[39m
    [90m623| [39m
    [90m624| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m625| [39m      [34mexpect[39m(result[[34m0[39m])[33m.[39m[34mtoMatchObject[39m({
    [90m626| [39m        id[33m:[39m [32m"mhs-1"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[134/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Management[2m > [22mgetAllMahasiswa[2m > [22mshould handle mahasiswa without users gracefully
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'users')[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m664:24[22m[39m
    [90m662| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetAllMahasiswa[39m()[33m;[39m
    [90m663| [39m
    [90m664| [39m      [34mexpect[39m(result[[34m0[39m][33m.[39musers)[33m.[39m[34mtoEqual[39m({ full_name[33m:[39m [32m"-"[39m[33m,[39m email[33m:[39m [32m"-"[39m })[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m665| [39m    })[33m;[39m
    [90m666| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[135/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould enroll existing mahasiswa to kelas
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m720:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[136/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould create new mahasiswa and enroll
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m805:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[137/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould reject if email already exists
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m837:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[138/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould reject if already enrolled
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m873:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[139/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/kelas.api.test.ts[2m > [22mKelas API - Student Management[2m > [22mcreateOrEnrollMahasiswa - COMPLEX BUSINESS LOGIC[2m > [22mshould handle NIM duplicate error
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/kelas.api.test.ts:[2m928:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[140/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mgetLaboranStats[2m > [22mshould return laboran statistics successfully
[31m[1mAssertionError[22m: expected { totalLab: 11, â€¦(3) } to deeply equal { totalLab: 5, â€¦(3) }[39m

[32m- Expected[39m
[31m+ Received[39m

[2m  {[22m
[32m-   "lowStockAlerts": 3,[39m
[32m-   "pendingApprovals": 10,[39m
[32m-   "totalInventaris": 100,[39m
[32m-   "totalLab": 5,[39m
[31m+   "lowStockAlerts": 0,[39m
[31m+   "pendingApprovals": 0,[39m
[31m+   "totalInventaris": 2,[39m
[31m+   "totalLab": 11,[39m
[2m  }[22m

[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m114:22[22m[39m
    [90m112| [39m      [35mconst[39m result [33m=[39m [35mawait[39m laboranAPI[33m.[39m[34mgetLaboranStats[39m()[33m;[39m
    [90m113| [39m
    [90m114| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m({
    [90m   | [39m                     [31m^[39m
    [90m115| [39m        totalLab[33m:[39m [34m5[39m[33m,[39m
    [90m116| [39m        totalInventaris[33m:[39m [34m100[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[141/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mgetLaboranStats[2m > [22mshould handle empty data
[31m[1mAssertionError[22m: expected { totalLab: 11, â€¦(3) } to deeply equal { totalLab: +0, â€¦(3) }[39m

[32m- Expected[39m
[31m+ Received[39m

[2m  {[22m
[2m    "lowStockAlerts": 0,[22m
[2m    "pendingApprovals": 0,[22m
[32m-   "totalInventaris": 0,[39m
[32m-   "totalLab": 0,[39m
[31m+   "totalInventaris": 2,[39m
[31m+   "totalLab": 11,[39m
[2m  }[22m

[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m136:22[22m[39m
    [90m134| [39m      [35mconst[39m result [33m=[39m [35mawait[39m laboranAPI[33m.[39m[34mgetLaboranStats[39m()[33m;[39m
    [90m135| [39m
    [90m136| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m({
    [90m   | [39m                     [31m^[39m
    [90m137| [39m        totalLab[33m:[39m [34m0[39m[33m,[39m
    [90m138| [39m        totalInventaris[33m:[39m [34m0[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[142/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mgetLaboranStats[2m > [22mshould handle database errors
[31m[1mAssertionError[22m: promise resolved "{ totalLab: 11, â€¦(3) }" instead of rejecting[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- Error {[39m
[32m-   "message": "rejected promise",[39m
[31m+ {[39m
[31m+   "lowStockAlerts": 0,[39m
[31m+   "pendingApprovals": 0,[39m
[31m+   "totalInventaris": 2,[39m
[31m+   "totalLab": 11,[39m
[2m  }[22m

[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m149:48[22m[39m
    [90m147| [39m      })[33m;[39m
    [90m148| [39m
    [90m149| [39m      [35mawait[39m [34mexpect[39m(laboranAPI[33m.[39m[34mgetLaboranStats[39m())[33m.[39mrejects[33m.[39m[34mtoThrow[39m(
    [90m   | [39m                                               [31m^[39m
    [90m150| [39m        [32m"Database error"[39m[33m,[39m
    [90m151| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[143/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mgetPendingApprovals[2m > [22mshould return pending approval list
[31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m229:22[22m[39m
    [90m227| [39m      [35mconst[39m result [33m=[39m [35mawait[39m laboranAPI[33m.[39m[34mgetPendingApprovals[39m()[33m;[39m
    [90m228| [39m
    [90m229| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m230| [39m      [34mexpect[39m(result[[34m0[39m])[33m.[39m[34mtoEqual[39m({
    [90m231| [39m        id[33m:[39m [32m"pem-1"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[144/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mgetPendingApprovals[2m > [22mshould handle missing related data gracefully
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'peminjam_nama')[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m286:24[22m[39m
    [90m284| [39m      [35mconst[39m result [33m=[39m [35mawait[39m laboranAPI[33m.[39m[34mgetPendingApprovals[39m()[33m;[39m
    [90m285| [39m
    [90m286| [39m      [34mexpect[39m(result[[34m0[39m][33m.[39mpeminjam_nama)[33m.[39m[34mtoBe[39m([32m"Unknown"[39m)[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m287| [39m      [34mexpect[39m(result[[34m0[39m][33m.[39minventaris_nama)[33m.[39m[34mtoBe[39m([32m"Unknown"[39m)[33m;[39m
    [90m288| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[145/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mgetPendingApprovals[2m > [22mshould respect limit parameter
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 20 ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m308:25[22m[39m
    [90m306| [39m      [35mawait[39m laboranAPI[33m.[39m[34mgetPendingApprovals[39m([34m20[39m)[33m;[39m
    [90m307| [39m
    [90m308| [39m      [34mexpect[39m(limitMock)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m20[39m)[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m309| [39m    })[33m;[39m
    [90m310| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[146/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mgetInventoryAlerts[2m > [22mshould return low stock items
[31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m345:22[22m[39m
    [90m343| [39m      [35mconst[39m result [33m=[39m [35mawait[39m laboranAPI[33m.[39m[34mgetInventoryAlerts[39m()[33m;[39m
    [90m344| [39m
    [90m345| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m346| [39m      [34mexpect[39m(result[[34m0[39m][33m.[39mjumlah_tersedia)[33m.[39m[34mtoBeLessThan[39m([34m5[39m)[33m;[39m
    [90m347| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[147/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mgetInventoryAlerts[2m > [22mshould handle null category as "Umum"
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'kategori')[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m381:24[22m[39m
    [90m379| [39m      [35mconst[39m result [33m=[39m [35mawait[39m laboranAPI[33m.[39m[34mgetInventoryAlerts[39m()[33m;[39m
    [90m380| [39m
    [90m381| [39m      [34mexpect[39m(result[[34m0[39m][33m.[39mkategori)[33m.[39m[34mtoBe[39m([32m"Umum"[39m)[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m382| [39m    })[33m;[39m
    [90m383| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[148/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mapprovePeminjaman[2m > [22mshould approve peminjaman and decrease stock
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m448:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[149/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mapprovePeminjaman[2m > [22mshould fail when stock is insufficient
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Stok tidak cukup' but got 'User not authenticated'[39m

Expected: [32m"Stok tidak cukup"[39m
Received: [31m"User not authenticated"[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m501:7[22m[39m
    [90m499| [39m      })[33m;[39m
    [90m500| [39m
    [90m501| [39m      await expect(laboranAPI.approvePeminjaman("pem-1")).rejects.toThâ€¦
    [90m   | [39m      [31m^[39m
    [90m502| [39m        [32m"Stok tidak cukup"[39m[33m,[39m
    [90m503| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[150/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mrejectPeminjaman[2m > [22mshould reject peminjaman with reason
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m563:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[151/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mInventaris CRUD[2m > [22mgetInventarisList[2m > [22mshould return inventaris list with filters
[31m[1mAssertionError[22m: expected [ { â€¦(15) }, { â€¦(15) } ] to have a length of 1 but got 2[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 2[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m619:29[22m[39m
    [90m617| [39m        [35mconst[39m result [33m=[39m [35mawait[39m laboranAPI[33m.[39m[34mgetInventarisList[39m()[33m;[39m
    [90m618| [39m
    [90m619| [39m        [34mexpect[39m(result[33m.[39mdata)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                            [31m^[39m
    [90m620| [39m        [34mexpect[39m(result[33m.[39mcount)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m621| [39m      })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[152/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mInventaris CRUD[2m > [22mgetInventarisList[2m > [22mshould apply search filter
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ Array(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m640:24[22m[39m
    [90m638| [39m        [35mawait[39m laboranAPI[33m.[39m[34mgetInventarisList[39m({ search[33m:[39m [32m"mikroskop"[39m })[33m;[39m
    [90m639| [39m
    [90m640| [39m        [34mexpect[39m(orMock)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                       [31m^[39m
    [90m641| [39m          expect[33m.[39m[34mstringContaining[39m([32m"nama_barang.ilike"[39m)[33m,[39m
    [90m642| [39m        )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[153/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mInventaris CRUD[2m > [22mgetInventarisList[2m > [22mshould apply pagination
[31m[1mUnknown Error[22m: {"[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[154/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mInventaris CRUD[2m > [22mcreateInventaris[2m > [22mshould create new inventaris
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m694:24[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[155/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mInventaris CRUD[2m > [22mupdateInventaris[2m > [22mshould update inventaris
[31m[1mAssertionError[22m: promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m734:9[22m[39m
    [90m732| [39m        [35mawait[39m [34mexpect[39m(
    [90m733| [39m          laboranAPI.updateInventaris("inv-1", { nama_barang: "New Namâ€¦
    [90m734| [39m        )[33m.[39mresolves[33m.[39mnot[33m.[39m[34mtoThrow[39m()[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m735| [39m      })[33m;[39m
    [90m736| [39m    })[33m;[39m

[31m[1mCaused by: AuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m732:9[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'AUTHENTICATION_REQUIRED', statusCode: 401, toUserMessage: 'Function<toUserMessage>' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[156/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mInventaris CRUD[2m > [22mdeleteInventaris[2m > [22mshould delete inventaris when no active borrowings
[31m[1mAssertionError[22m: promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m766:9[22m[39m
    [90m764| [39m        [35mawait[39m [34mexpect[39m(
    [90m765| [39m          laboranAPI[33m.[39m[34mdeleteInventaris[39m([32m"inv-1"[39m)[33m,[39m
    [90m766| [39m        )[33m.[39mresolves[33m.[39mnot[33m.[39m[34mtoThrow[39m()[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m767| [39m      })[33m;[39m
    [90m768| [39m

[31m[1mCaused by: AuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m764:9[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'AUTHENTICATION_REQUIRED', statusCode: 401, toUserMessage: 'Function<toUserMessage>' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[157/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mInventaris CRUD[2m > [22mdeleteInventaris[2m > [22mshould fail when active borrowings exist
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Cannot delete inventaris with active â€¦' but got 'User not authenticated'[39m

Expected: [32m"Cannot delete inventaris with active borrowings"[39m
Received: [31m"User not authenticated"[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m783:9[22m[39m
    [90m781| [39m        } [35mas[39m any)[33m;[39m
    [90m782| [39m
    [90m783| [39m        await expect(laboranAPI.deleteInventaris("inv-1")).rejects.toTâ€¦
    [90m   | [39m        [31m^[39m
    [90m784| [39m          [32m"Cannot delete inventaris with active borrowings"[39m[33m,[39m
    [90m785| [39m        )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[158/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mLaboratorium Management[2m > [22mgetLaboratoriumList[2m > [22mshould return laboratorium list
[31m[1mAssertionError[22m: expected [ { â€¦(10) }, { â€¦(10) }, â€¦(9) ] to have a length of 1 but got 11[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 11[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m819:24[22m[39m
    [90m817| [39m        [35mconst[39m result [33m=[39m [35mawait[39m laboranAPI[33m.[39m[34mgetLaboratoriumList[39m()[33m;[39m
    [90m818| [39m
    [90m819| [39m        [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m820| [39m      })[33m;[39m
    [90m821| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[159/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mLaboratorium Management[2m > [22mgetLaboratoriumList[2m > [22mshould filter by is_active
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'is_active', true ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m838:24[22m[39m
    [90m836| [39m        [35mawait[39m laboranAPI[33m.[39m[34mgetLaboratoriumList[39m({ is_active[33m:[39m [35mtrue[39m })[33m;[39m
    [90m837| [39m
    [90m838| [39m        [34mexpect[39m(eqMock)[33m.[39m[34mtoHaveBeenCalledWith[39m([32m"is_active"[39m[33m,[39m [35mtrue[39m)[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m839| [39m      })[33m;[39m
    [90m840| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[160/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mLaboratorium Management[2m > [22mcreateLaboratorium[2m > [22mshould create new laboratorium
[31m[1mAssertionError[22m: promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m855:9[22m[39m
    [90m853| [39m            nama_lab[33m:[39m [32m"Lab Baru"[39m[33m,[39m
    [90m854| [39m          })[33m,[39m
    [90m855| [39m        )[33m.[39mresolves[33m.[39mnot[33m.[39m[34mtoThrow[39m()[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m856| [39m      })[33m;[39m
    [90m857| [39m    })[33m;[39m

[31m[1mCaused by: AuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m850:9[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'AUTHENTICATION_REQUIRED', statusCode: 401, toUserMessage: 'Function<toUserMessage>' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[161/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mLaboratorium Management[2m > [22mdeleteLaboratorium[2m > [22mshould delete laboratorium when no related data
[31m[1mAssertionError[22m: promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m885:9[22m[39m
    [90m883| [39m        [35mawait[39m [34mexpect[39m(
    [90m884| [39m          laboranAPI[33m.[39m[34mdeleteLaboratorium[39m([32m"lab-1"[39m)[33m,[39m
    [90m885| [39m        )[33m.[39mresolves[33m.[39mnot[33m.[39m[34mtoThrow[39m()[33m;[39m
    [90m   | [39m        [31m^[39m
    [90m886| [39m      })[33m;[39m
    [90m887| [39m

[31m[1mCaused by: AuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m883:9[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'AUTHENTICATION_REQUIRED', statusCode: 401, toUserMessage: 'Function<toUserMessage>' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[162/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/laboran.api.test.ts[2m > [22mLaboran API[2m > [22mLaboratorium Management[2m > [22mdeleteLaboratorium[2m > [22mshould fail when equipment exists
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Cannot delete laboratory that has equâ€¦' but got 'User not authenticated'[39m

Expected: [32m"Cannot delete laboratory that has equipment assigned to it"[39m
Received: [31m"User not authenticated"[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/laboran.api.test.ts:[2m900:9[22m[39m
    [90m898| [39m        } [35mas[39m any)[33m;[39m
    [90m899| [39m
    [90m900| [39m        await expect(laboranAPI.deleteLaboratorium("lab-1")).rejects.tâ€¦
    [90m   | [39m        [31m^[39m
    [90m901| [39m          [32m"Cannot delete laboratory that has equipment assigned to it"[39m[33m,[39m
    [90m902| [39m        )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[163/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/mahasiswa.api.test.ts[2m > [22mMahasiswa API[2m > [22mgetMahasiswaStats[2m > [22mshould return mahasiswa statistics successfully
[31m[1mAssertionError[22m: expected { totalKelasPraktikum: +0, â€¦(3) } to deeply equal { totalKelasPraktikum: 2, â€¦(3) }[39m

[32m- Expected[39m
[31m+ Received[39m

[2m  {[22m
[32m-   "jadwalHariIni": 1,[39m
[32m-   "rataRataNilai": 85,[39m
[32m-   "totalKelasPraktikum": 2,[39m
[32m-   "totalKuis": 2,[39m
[31m+   "jadwalHariIni": 0,[39m
[31m+   "rataRataNilai": null,[39m
[31m+   "totalKelasPraktikum": 0,[39m
[31m+   "totalKuis": 0,[39m
[2m  }[22m

[36m [2mâ¯[22m server/src/__tests__/unit/api/mahasiswa.api.test.ts:[2m178:22[22m[39m
    [90m176| [39m      [35mconst[39m result [33m=[39m [35mawait[39m mahasiswaAPI[33m.[39m[34mgetMahasiswaStats[39m()[33m;[39m
    [90m177| [39m
    [90m178| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m({
    [90m   | [39m                     [31m^[39m
    [90m179| [39m        totalKelasPraktikum[33m:[39m [34m2[39m[33m,[39m
    [90m180| [39m        totalKuis[33m:[39m [34m2[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[164/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/mahasiswa.api.test.ts[2m > [22mMahasiswa API[2m > [22mgetMahasiswaStats[2m > [22mshould calculate average score correctly
[31m[1mAssertionError[22m: expected null to be 80 // Object.is equality[39m

[32m- Expected:[39m 
80

[31m+ Received:[39m 
null

[36m [2mâ¯[22m server/src/__tests__/unit/api/mahasiswa.api.test.ts:[2m246:36[22m[39m
    [90m244| [39m      [35mconst[39m result [33m=[39m [35mawait[39m mahasiswaAPI[33m.[39m[34mgetMahasiswaStats[39m()[33m;[39m
    [90m245| [39m
    [90m246| [39m      [34mexpect[39m(result[33m.[39mrataRataNilai)[33m.[39m[34mtoBe[39m([34m80[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m247| [39m    })[33m;[39m
    [90m248| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[165/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/mahasiswa.api.test.ts[2m > [22mMahasiswa API[2m > [22menrollToKelas[2m > [22mshould enroll mahasiswa to kelas successfully
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/mahasiswa.api.test.ts:[2m446:30[22m[39m
    [90m444| [39m      [35mconst[39m result [33m=[39m [35mawait[39m mahasiswaAPI[33m.[39m[34menrollToKelas[39m([32m"kelas-1"[39m)[33m;[39m
    [90m445| [39m
    [90m446| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m447| [39m      [34mexpect[39m(result[33m.[39mmessage)[33m.[39m[34mtoBe[39m([32m"Berhasil mendaftar ke kelas"[39m)[33m;[39m
    [90m448| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[166/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/mahasiswa.api.test.ts[2m > [22mMahasiswa API[2m > [22menrollToKelas[2m > [22mshould fail when already enrolled
[31m[1mAssertionError[22m: expected 'Mahasiswa tidak ditemukan' to be 'Anda sudah terdaftar di kelas ini' // Object.is equality[39m

Expected: [32m"Anda sudah terdaftar di kelas ini"[39m
Received: [31m"Mahasiswa tidak ditemukan"[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/mahasiswa.api.test.ts:[2m544:30[22m[39m
    [90m542| [39m
    [90m543| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m544| [39m      [34mexpect[39m(result[33m.[39mmessage)[33m.[39m[34mtoBe[39m([32m"Anda sudah terdaftar di kelas ini"[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m545| [39m    })[33m;[39m
    [90m546| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[167/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/mahasiswa.api.test.ts[2m > [22mMahasiswa API[2m > [22menrollToKelas[2m > [22mshould fail when kelas is full
[31m[1mAssertionError[22m: expected 'Mahasiswa tidak ditemukan' to be 'Kelas sudah penuh' // Object.is equality[39m

Expected: [32m"Kelas sudah penuh"[39m
Received: [31m"Mahasiswa tidak ditemukan"[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/mahasiswa.api.test.ts:[2m625:30[22m[39m
    [90m623| [39m
    [90m624| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m625| [39m      [34mexpect[39m(result[33m.[39mmessage)[33m.[39m[34mtoBe[39m([32m"Kelas sudah penuh"[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m626| [39m    })[33m;[39m
    [90m627| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[168/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/mahasiswa.api.test.ts[2m > [22mMahasiswa API[2m > [22munenrollFromKelas[2m > [22mshould unenroll mahasiswa from kelas successfully
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/mahasiswa.api.test.ts:[2m667:30[22m[39m
    [90m665| [39m      [35mconst[39m result [33m=[39m [35mawait[39m mahasiswaAPI[33m.[39m[34munenrollFromKelas[39m([32m"kelas-1"[39m)[33m;[39m
    [90m666| [39m
    [90m667| [39m      [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                             [31m^[39m
    [90m668| [39m      [34mexpect[39m(result[33m.[39mmessage)[33m.[39m[34mtoBe[39m([32m"Berhasil keluar dari kelas"[39m)[33m;[39m
    [90m669| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[169/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/mahasiswa.api.test.ts[2m > [22mMahasiswa API[2m > [22mgetMyKelas[2m > [22mshould return enrolled kelas list
[31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/mahasiswa.api.test.ts:[2m830:22[22m[39m
    [90m828| [39m      [35mconst[39m result [33m=[39m [35mawait[39m mahasiswaAPI[33m.[39m[34mgetMyKelas[39m()[33m;[39m
    [90m829| [39m
    [90m830| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m831| [39m      [34mexpect[39m(result[[34m0[39m][33m.[39mkode_kelas)[33m.[39m[34mtoBe[39m([32m"K001"[39m)[33m;[39m
    [90m832| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[170/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/mahasiswa.api.test.ts[2m > [22mMahasiswa API[2m > [22mgetMyJadwal[2m > [22mshould respect limit parameter
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 5 ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/api/mahasiswa.api.test.ts:[2m1065:25[22m[39m
    [90m1063| [39m      [35mawait[39m mahasiswaAPI[33m.[39m[34mgetMyJadwal[39m([34m5[39m)[33m;[39m
    [90m1064| [39m
    [90m1065| [39m      [34mexpect[39m(limitMock)[33m.[39m[34mtoHaveBeenCalledWith[39m([34m5[39m)[33m;[39m
    [90m   | [39m                        [31m^[39m
    [90m1066| [39m    })[33m;[39m
    [90m1067| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[171/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/mata-kuliah.api.test.ts[2m > [22mMata Kuliah API[2m > [22mcreateMataKuliah[2m > [22mshould create new mata kuliah
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/mata-kuliah.api.test.ts:[2m92:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[172/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/mata-kuliah.api.test.ts[2m > [22mMata Kuliah API[2m > [22mcreateMataKuliah[2m > [22mshould reject duplicate kode_mk
[31m[1mAssertionError[22m: expected [Function] to throw error including 'sudah ada' but got 'User not authenticated'[39m

Expected: [32m"sudah ada"[39m
Received: [31m"User not authenticated"[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/mata-kuliah.api.test.ts:[2m106:7[22m[39m
    [90m104| [39m      vi[33m.[39m[34mmocked[39m(queryWithFilters)[33m.[39m[34mmockResolvedValue[39m([mockMataKuliah])[33m;[39m
    [90m105| [39m
    [90m106| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m107| [39m        [34mcreateMataKuliah[39m({
    [90m108| [39m          kode_mk[33m:[39m [32m"KBD101"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[173/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/mata-kuliah.api.test.ts[2m > [22mMata Kuliah API[2m > [22mupdateMataKuliah[2m > [22mshould update mata kuliah
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/mata-kuliah.api.test.ts:[2m122:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[174/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/mata-kuliah.api.test.ts[2m > [22mMata Kuliah API[2m > [22mdeleteMataKuliah[2m > [22mshould delete when no kelas
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/mata-kuliah.api.test.ts:[2m133:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[175/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/mata-kuliah.api.test.ts[2m > [22mMata Kuliah API[2m > [22mdeleteMataKuliah[2m > [22mshould detach kelas and delete when kelas exist by default
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/mata-kuliah.api.test.ts:[2m147:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[176/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/materi.api.test.ts[2m > [22mMateri API[2m > [22mcreateMateri[2m > [22mshould upload file and create materi
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/materi.api.test.ts:[2m104:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[177/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/materi.api.test.ts[2m > [22mMateri API[2m > [22mdeleteMateri[2m > [22mshould delete file and materi record
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m475:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/materi.api.test.ts:[2m122:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[178/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22mNilai API - CRUD Operations[2m > [22mgetNilaiByKelas[2m > [22mshould get all nilai for a kelas
[31m[1mServerError[22m: "failed to parse order (mahasiswa(user(full_name)).asc)" (line 1, column 10)[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.getNilaiByKelas server/src/lib/api/nilai.api.ts:[2m160:22[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/nilai.api.test.ts:[2m230:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[179/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22mNilai API - CRUD Operations[2m > [22mgetNilaiByKelas[2m > [22mshould return empty array when no nilai found
[31m[1mServerError[22m: "failed to parse order (mahasiswa(user(full_name)).asc)" (line 1, column 10)[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.getNilaiByKelas server/src/lib/api/nilai.api.ts:[2m160:22[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/nilai.api.test.ts:[2m244:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[180/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22mNilai API - CRUD Operations[2m > [22mgetNilaiByMahasiswa[2m > [22mshould get all nilai for a mahasiswa
[31m[1mValidationError[22m: Invalid data format[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m282:16[22m[39m
    [90m280| [39m        [35mreturn[39m [35mnew[39m [33mNotFoundError[39m([32m"Record not found"[39m[33m,[39m details)[33m;[39m
    [90m281| [39m      [35mcase[39m [32m"22P02"[39m[33m:[39m [90m// invalid_text_representation[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.getNilaiByMahasiswa server/src/lib/api/nilai.api.ts:[2m198:22[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/nilai.api.test.ts:[2m264:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[181/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22mNilai API - CRUD Operations[2m > [22mgetNilaiByMahasiswa[2m > [22mshould return empty array when no nilai found
[31m[1mValidationError[22m: Invalid data format[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m282:16[22m[39m
    [90m280| [39m        [35mreturn[39m [35mnew[39m [33mNotFoundError[39m([32m"Record not found"[39m[33m,[39m details)[33m;[39m
    [90m281| [39m      [35mcase[39m [32m"22P02"[39m[33m:[39m [90m// invalid_text_representation[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.getNilaiByMahasiswa server/src/lib/api/nilai.api.ts:[2m198:22[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/nilai.api.test.ts:[2m279:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[182/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22mNilai API - Statistics[2m > [22mgetNilaiSummary[2m > [22mshould calculate summary statistics correctly
[31m[1mBaseApiError[22m: An unknown error occurred[39m
[36m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m339:10[22m[39m
    [90m337| [39m
    [90m338| [39m  [90m// Unknown error[39m
    [90m339| [39m  [35mreturn[39m [35mnew[39m [33mBaseApiError[39m(
    [90m   | [39m         [31m^[39m
    [90m340| [39m    [32m"An unknown error occurred"[39m[33m,[39m
    [90m341| [39m    [33mApiErrorCode[39m[33m.[39m[33mUNKNOWN[39m[33m,[39m
[90m [2mâ¯[22m Module.getNilaiSummary server/src/lib/api/nilai.api.ts:[2m538:27[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/nilai.api.test.ts:[2m337:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[183/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22mNilai API - Statistics[2m > [22mgetNilaiSummary[2m > [22mshould handle empty nilai data
[31m[1mBaseApiError[22m: An unknown error occurred[39m
[36m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m339:10[22m[39m
    [90m337| [39m
    [90m338| [39m  [90m// Unknown error[39m
    [90m339| [39m  [35mreturn[39m [35mnew[39m [33mBaseApiError[39m(
    [90m   | [39m         [31m^[39m
    [90m340| [39m    [32m"An unknown error occurred"[39m[33m,[39m
    [90m341| [39m    [33mApiErrorCode[39m[33m.[39m[33mUNKNOWN[39m[33m,[39m
[90m [2mâ¯[22m Module.getNilaiSummary server/src/lib/api/nilai.api.ts:[2m538:27[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/nilai.api.test.ts:[2m360:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[184/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22mNilai API - Statistics[2m > [22mgetNilaiSummary[2m > [22mshould filter out null nilai_akhir when calculating average
[31m[1mBaseApiError[22m: An unknown error occurred[39m
[36m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m339:10[22m[39m
    [90m337| [39m
    [90m338| [39m  [90m// Unknown error[39m
    [90m339| [39m  [35mreturn[39m [35mnew[39m [33mBaseApiError[39m(
    [90m   | [39m         [31m^[39m
    [90m340| [39m    [32m"An unknown error occurred"[39m[33m,[39m
    [90m341| [39m    [33mApiErrorCode[39m[33m.[39m[33mUNKNOWN[39m[33m,[39m
[90m [2mâ¯[22m Module.getNilaiSummary server/src/lib/api/nilai.api.ts:[2m538:27[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/nilai.api.test.ts:[2m392:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[185/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22mNilai API - Statistics[2m > [22mgetNilaiSummary[2m > [22mshould round average to 2 decimal places
[31m[1mBaseApiError[22m: An unknown error occurred[39m
[36m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m339:10[22m[39m
    [90m337| [39m
    [90m338| [39m  [90m// Unknown error[39m
    [90m339| [39m  [35mreturn[39m [35mnew[39m [33mBaseApiError[39m(
    [90m   | [39m         [31m^[39m
    [90m340| [39m    [32m"An unknown error occurred"[39m[33m,[39m
    [90m341| [39m    [33mApiErrorCode[39m[33m.[39m[33mUNKNOWN[39m[33m,[39m
[90m [2mâ¯[22m Module.getNilaiSummary server/src/lib/api/nilai.api.ts:[2m538:27[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/nilai.api.test.ts:[2m414:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[186/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22mNilai API - Statistics[2m > [22mgetMahasiswaForGrading[2m > [22mshould return mahasiswa with their nilai
[31m[1mValidationError[22m: Invalid data format[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m282:16[22m[39m
    [90m280| [39m        [35mreturn[39m [35mnew[39m [33mNotFoundError[39m([32m"Record not found"[39m[33m,[39m details)[33m;[39m
    [90m281| [39m      [35mcase[39m [32m"22P02"[39m[33m:[39m [90m// invalid_text_representation[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.getMahasiswaForGrading server/src/lib/api/nilai.api.ts:[2m597:28[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/nilai.api.test.ts:[2m455:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[187/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22mNilai API - Statistics[2m > [22mgetMahasiswaForGrading[2m > [22mshould return mahasiswa with default nilai when not graded yet
[31m[1mValidationError[22m: Invalid data format[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m282:16[22m[39m
    [90m280| [39m        [35mreturn[39m [35mnew[39m [33mNotFoundError[39m([32m"Record not found"[39m[33m,[39m details)[33m;[39m
    [90m281| [39m      [35mcase[39m [32m"22P02"[39m[33m:[39m [90m// invalid_text_representation[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.getMahasiswaForGrading server/src/lib/api/nilai.api.ts:[2m597:28[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/nilai.api.test.ts:[2m491:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[188/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22mNilai API - Statistics[2m > [22mgetMahasiswaForGrading[2m > [22mshould return empty array when no mahasiswa enrolled
[31m[1mValidationError[22m: Invalid data format[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m282:16[22m[39m
    [90m280| [39m        [35mreturn[39m [35mnew[39m [33mNotFoundError[39m([32m"Record not found"[39m[33m,[39m details)[33m;[39m
    [90m281| [39m      [35mcase[39m [32m"22P02"[39m[33m:[39m [90m// invalid_text_representation[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.getMahasiswaForGrading server/src/lib/api/nilai.api.ts:[2m597:28[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/nilai.api.test.ts:[2m507:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[189/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/nilai.api.test.ts[2m > [22mNilai API - Statistics[2m > [22mgetMahasiswaForGrading[2m > [22mshould handle multiple mahasiswa with mixed nilai status
[31m[1mValidationError[22m: Invalid data format[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m282:16[22m[39m
    [90m280| [39m        [35mreturn[39m [35mnew[39m [33mNotFoundError[39m([32m"Record not found"[39m[33m,[39m details)[33m;[39m
    [90m281| [39m      [35mcase[39m [32m"22P02"[39m[33m:[39m [90m// invalid_text_representation[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
[90m [2mâ¯[22m handleError src/lib/utils/errors.ts:[2m323:12[22m[39m
[90m [2mâ¯[22m Module.getMahasiswaForGrading server/src/lib/api/nilai.api.ts:[2m597:28[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/nilai.api.test.ts:[2m552:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[190/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/peminjaman-extensions.test.ts[2m > [22mPeminjaman Extensions API[2m > [22mgetAllPeminjaman[2m > [22mshould fetch all peminjaman with details
[31m[1mServerError[22m: Could not find a relationship between 'peminjaman' and 'mahasiswa' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m Module.getAllPeminjaman server/src/lib/api/peminjaman-extensions.ts:[2m228:11[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/peminjaman-extensions.test.ts:[2m84:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[191/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/peminjaman-extensions.test.ts[2m > [22mPeminjaman Extensions API[2m > [22mgetAllPeminjaman[2m > [22mshould apply status filter
[31m[1mServerError[22m: Could not find a relationship between 'peminjaman' and 'mahasiswa' in the schema cache[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m284:16[22m[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m285| [39m    }
    [90m286| [39m  }
[90m [2mâ¯[22m Module.getAllPeminjaman server/src/lib/api/peminjaman-extensions.ts:[2m228:11[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/peminjaman-extensions.test.ts:[2m98:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[192/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/peminjaman-extensions.test.ts[2m > [22mPeminjaman Extensions API[2m > [22mmarkAsReturned[2m > [22mshould mark peminjaman as returned
[31m[1mValidationError[22m: Invalid data format[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m282:16[22m[39m
    [90m280| [39m        [35mreturn[39m [35mnew[39m [33mNotFoundError[39m([32m"Record not found"[39m[33m,[39m details)[33m;[39m
    [90m281| [39m      [35mcase[39m [32m"22P02"[39m[33m:[39m [90m// invalid_text_representation[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
[90m [2mâ¯[22m Module.markAsReturned server/src/lib/api/peminjaman-extensions.ts:[2m259:11[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/peminjaman-extensions.test.ts:[2m112:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[193/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/peminjaman-extensions.test.ts[2m > [22mPeminjaman Extensions API[2m > [22mgetPendingRoomBookings[2m > [22mshould fetch pending room bookings
[31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/peminjaman-extensions.test.ts:[2m181:22[22m[39m
    [90m179| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetPendingRoomBookings[39m()[33m;[39m
    [90m180| [39m
    [90m181| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m182| [39m    })[33m;[39m
    [90m183| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[194/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/peminjaman-extensions.test.ts[2m > [22mPeminjaman Extensions API[2m > [22mapproveRoomBooking[2m > [22mshould approve room booking
[31m[1mValidationError[22m: Invalid data format[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m282:16[22m[39m
    [90m280| [39m        [35mreturn[39m [35mnew[39m [33mNotFoundError[39m([32m"Record not found"[39m[33m,[39m details)[33m;[39m
    [90m281| [39m      [35mcase[39m [32m"22P02"[39m[33m:[39m [90m// invalid_text_representation[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
[90m [2mâ¯[22m Module.approveRoomBooking server/src/lib/api/peminjaman-extensions.ts:[2m435:11[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/peminjaman-extensions.test.ts:[2m191:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[195/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/peminjaman-extensions.test.ts[2m > [22mPeminjaman Extensions API[2m > [22mrejectRoomBooking[2m > [22mshould reject and delete room booking
[31m[1mValidationError[22m: Invalid data format[39m
[36m [2mâ¯[22m handleSupabaseError src/lib/utils/errors.ts:[2m282:16[22m[39m
    [90m280| [39m        [35mreturn[39m [35mnew[39m [33mNotFoundError[39m([32m"Record not found"[39m[33m,[39m details)[33m;[39m
    [90m281| [39m      [35mcase[39m [32m"22P02"[39m[33m:[39m [90m// invalid_text_representation[39m
    [90m282| [39m        [35mreturn[39m [35mnew[39m [33mValidationError[39m([32m"Invalid data format"[39m[33m,[39m details)[33m;[39m
    [90m   | [39m               [31m^[39m
    [90m283| [39m      [35mdefault[39m[33m:[39m
    [90m284| [39m        [35mreturn[39m [35mnew[39m [33mServerError[39m(message[33m,[39m details)[33m;[39m
[90m [2mâ¯[22m Module.rejectRoomBooking server/src/lib/api/peminjaman-extensions.ts:[2m463:11[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/peminjaman-extensions.test.ts:[2m206:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[196/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/reports.api.test.ts[2m > [22mReports API[2m > [22mgetBorrowingStats[2m > [22mshould calculate borrowing statistics
[31m[1mAssertionError[22m: expected { total_borrowings: +0, â€¦(6) } to have property "total_borrowings" with value 3[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 3[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/reports.api.test.ts:[2m64:21[22m[39m
    [90m 62| [39m      [35mconst[39m stats [33m=[39m [35mawait[39m [34mgetBorrowingStats[39m()[33m;[39m
    [90m 63| [39m
    [90m 64| [39m      [34mexpect[39m(stats)[33m.[39m[34mtoHaveProperty[39m([32m"total_borrowings"[39m[33m,[39m [34m3[39m)[33m;[39m
    [90m   | [39m                    [31m^[39m
    [90m 65| [39m      [34mexpect[39m(stats)[33m.[39m[34mtoHaveProperty[39m([32m"pending"[39m[33m,[39m [34m1[39m)[33m;[39m
    [90m 66| [39m      [34mexpect[39m(stats)[33m.[39m[34mtoHaveProperty[39m([32m"total_equipment_borrowed"[39m[33m,[39m [34m10[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[197/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/reports.api.test.ts[2m > [22mReports API[2m > [22mgetEquipmentStats[2m > [22mshould calculate equipment statistics
[31m[1mAssertionError[22m: expected { total_items: 2, low_stock: +0, â€¦(4) } to have property "out_of_stock" with value 1[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/reports.api.test.ts:[2m85:21[22m[39m
    [90m 83| [39m
    [90m 84| [39m      [34mexpect[39m(stats)[33m.[39m[34mtoHaveProperty[39m([32m"total_items"[39m[33m,[39m [34m2[39m)[33m;[39m
    [90m 85| [39m      [34mexpect[39m(stats)[33m.[39m[34mtoHaveProperty[39m([32m"out_of_stock"[39m[33m,[39m [34m1[39m)[33m;[39m
    [90m   | [39m                    [31m^[39m
    [90m 86| [39m    })[33m;[39m
    [90m 87| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[198/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/reports.api.test.ts[2m > [22mReports API[2m > [22mgetTopBorrowedItems[2m > [22mshould return top borrowed items
[31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/reports.api.test.ts:[2m126:22[22m[39m
    [90m124| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetTopBorrowedItems[39m([34m10[39m)[33m;[39m
    [90m125| [39m
    [90m126| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m127| [39m      [34mexpect[39m(result[[34m0[39m])[33m.[39m[34mtoHaveProperty[39m([32m"total_borrowed"[39m)[33m;[39m
    [90m128| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[199/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/reports.api.test.ts[2m > [22mReports API[2m > [22mgetRecentActivities[2m > [22mshould return recent activities
[31m[1mAssertionError[22m: expected [] to have a length of 1 but got +0[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/reports.api.test.ts:[2m190:22[22m[39m
    [90m188| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetRecentActivities[39m([34m20[39m)[33m;[39m
    [90m189| [39m
    [90m190| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveLength[39m([34m1[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m191| [39m      [34mexpect[39m(result[[34m0[39m])[33m.[39m[34mtoHaveProperty[39m([32m"type"[39m)[33m;[39m
    [90m192| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[200/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/sync.api.test.ts[2m > [22mSync API[2m > [22mgetSyncManagementStats[2m > [22mshould return sync statistics
[31m[1mAssertionError[22m: expected { pendingSync: +0, synced: +0, â€¦(5) } to have property "pendingSync" with value 10[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 10[39m
[31m+ 0[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/sync.api.test.ts:[2m51:22[22m[39m
    [90m 49| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetSyncManagementStats[39m()[33m;[39m
    [90m 50| [39m
    [90m 51| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveProperty[39m([32m"pendingSync"[39m[33m,[39m [34m10[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m 52| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveProperty[39m([32m"synced"[39m[33m,[39m [34m80[39m)[33m;[39m
    [90m 53| [39m      [34mexpect[39m(result)[33m.[39m[34mtoHaveProperty[39m([32m"failed"[39m[33m,[39m [34m5[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[201/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/sync.api.test.ts[2m > [22mSync API[2m > [22mforceSyncNow[2m > [22mshould trigger sync process
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/sync.api.test.ts:[2m76:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[202/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - Get All Users[2m > [22mgetAllUsers[2m > [22mshould fetch all users with role-specific data
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m154:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[203/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - Get All Users[2m > [22mgetAllUsers[2m > [22mshould map mahasiswa NIM correctly
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m188:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[204/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - Get All Users[2m > [22mgetAllUsers[2m > [22mshould map dosen NIP and NIDN correctly
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m221:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[205/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - Get All Users[2m > [22mgetAllUsers[2m > [22mshould handle empty users list
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m239:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[206/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - Get All Users[2m > [22mgetAllUsers[2m > [22mshould handle null users data
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m253:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[207/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - Get All Users[2m > [22mgetAllUsers[2m > [22mshould provide default values for missing data
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m283:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[208/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - Statistics[2m > [22mgetUserStats[2m > [22mshould calculate user statistics correctly
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m336:21[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[209/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - Statistics[2m > [22mgetUserStats[2m > [22mshould return zero stats when no users
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m355:21[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[210/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - Statistics[2m > [22mgetUserStats[2m > [22mshould handle errors and return zero stats
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m377:21[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[211/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - CRUD Operations[2m > [22mtoggleUserStatus[2m > [22mshould activate user
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m407:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[212/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - CRUD Operations[2m > [22mtoggleUserStatus[2m > [22mshould deactivate user
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m418:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[213/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - CRUD Operations[2m > [22mupdateUser[2m > [22mshould update user data
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m443:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[214/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - CRUD Operations[2m > [22mupdateUser[2m > [22mshould update user role
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m454:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[215/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - CRUD Operations[2m > [22mcreateUser - COMPLEX FLOW[2m > [22mshould create admin user successfully
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m474:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[216/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - CRUD Operations[2m > [22mcreateUser - COMPLEX FLOW[2m > [22mshould create mahasiswa with role-specific data
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m509:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[217/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - CRUD Operations[2m > [22mcreateUser - COMPLEX FLOW[2m > [22mshould create dosen with NIP and NIDN
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m543:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[218/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - CRUD Operations[2m > [22mcreateUser - COMPLEX FLOW[2m > [22mshould handle missing user data after signup
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Failed to create user' but got 'User not authenticated'[39m

Expected: [32m"Failed to create user"[39m
Received: [31m"User not authenticated"[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m584:7[22m[39m
    [90m582| [39m      } [35mas[39m any)[33m;[39m
    [90m583| [39m
    [90m584| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m585| [39m        [34mcreateUser[39m({
    [90m586| [39m          email[33m:[39m [32m"test@test.com"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[219/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - CRUD Operations[2m > [22mdeleteUser - CASCADE DELETE[2m > [22mshould delete mahasiswa from role table then users table
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m652:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[220/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - CRUD Operations[2m > [22mdeleteUser - CASCADE DELETE[2m > [22mshould delete dosen from role table then users table
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m681:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[221/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - CRUD Operations[2m > [22mdeleteUser - CASCADE DELETE[2m > [22mshould delete laboran from role table then users table
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m Module.<anonymous> src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m709:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[222/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/api/users.api.test.ts[2m > [22mUsers API - CRUD Operations[2m > [22mdeleteUser - CASCADE DELETE[2m > [22mshould fail if role-specific delete fails
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Failed to delete mahasiswa record' but got 'User not authenticated'[39m

Expected: [32m"[7mFailed to delete mahasiswa recor[27md"[39m
Received: [31m"[7mUser not authenticate[27md"[39m

[36m [2mâ¯[22m server/src/__tests__/unit/api/users.api.test.ts:[2m732:7[22m[39m
    [90m730| [39m
    [90m731| [39m      [90m// Should throw when role-specific delete fails[39m
    [90m732| [39m      [35mawait[39m [34mexpect[39m([34mdeleteUser[39m([32m"user-3"[39m))[33m.[39mrejects[33m.[39m[34mtoThrow[39m(
    [90m   | [39m      [31m^[39m
    [90m733| [39m        [32m"Failed to delete mahasiswa record"[39m[33m,[39m
    [90m734| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[223/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mInitialization[2m > [22mshould initialize with default state
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mInitialization[2m > [22mshould initialize queue manager if not ready
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mInitialization[2m > [22mshould not re-initialize if already ready
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mInitialization[2m > [22mshould subscribe to queue events
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mInitialization[2m > [22mshould load initial stats
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mInitialization[2m > [22mshould mark as ready after initialization
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mInitialization[2m > [22mshould get initial processing state
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22maddToQueue[2m > [22mshould add item to queue
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22maddToQueue[2m > [22mshould refresh stats after adding
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22maddToQueue[2m > [22mshould handle different entity types
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22maddToQueue[2m > [22mshould handle different operations
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22maddToQueue[2m > [22mshould throw error on enqueue failure
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mprocessQueue[2m > [22mshould process the queue
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mprocessQueue[2m > [22mshould set processing state during queue processing
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mprocessQueue[2m > [22mshould refresh stats after processing
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mprocessQueue[2m > [22mshould reset processing state on error
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mretryFailed[2m > [22mshould retry failed items
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mretryFailed[2m > [22mshould refresh stats after retrying
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mretryFailed[2m > [22mshould return 0 on retry failure
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mclearCompleted[2m > [22mshould clear completed items
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mclearCompleted[2m > [22mshould refresh stats after clearing
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mclearCompleted[2m > [22mshould return 0 on clear failure
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mgetAllItems[2m > [22mshould get all items without filter
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mgetAllItems[2m > [22mshould get items with status filter
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mgetAllItems[2m > [22mshould return empty array on error
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mQueue Events[2m > [22mshould update processing state on processing event
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mQueue Events[2m > [22mshould update processing state on completed event
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mQueue Events[2m > [22mshould update processing state on failed event
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mQueue Events[2m > [22mshould refresh stats on queue events
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mStats[2m > [22mshould expose queue statistics
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mStats[2m > [22mshould refresh stats manually
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mCleanup[2m > [22mshould unsubscribe from queue events on unmount
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mIntegration[2m > [22mshould handle complete sync workflow
[41m[1m FAIL [22m[49m server/src/__tests__/unit/hooks/useSync.test.ts[2m > [22museSync[2m > [22mIntegration[2m > [22mshould maintain consistent state across re-renders
[31m[1mTypeError[22m: queueManager._reset is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/hooks/useSync.test.ts:[2m94:27[22m[39m
    [90m 92| [39m  [34mbeforeEach[39m(() [33m=>[39m {
    [90m 93| [39m    vi[33m.[39m[34mclearAllMocks[39m()[33m;[39m
    [90m 94| [39m    (queueManager [35mas[39m any)[33m.[39m[34m_reset[39m()[33m;[39m
    [90m   | [39m                          [31m^[39m
    [90m 95| [39m    (queueManager[33m.[39mgetStats [35mas[39m any)[33m.[39m[34mmockResolvedValue[39m(mockStats)[33m;[39m
    [90m 96| [39m  })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[224/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mgetCurrentUserWithRole[2m > [22mshould return user with role from database
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m Module.getCurrentUserWithRole server/src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m125:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[225/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mgetCurrentUserWithRole[2m > [22mshould throw AuthenticationError if user not authenticated
[31m[1mAssertionError[22m: expected error to be instance of AuthenticationError[39m

[32m- Expected:[39m 
[Function AuthenticationError]

[31m+ Received:[39m 
AuthenticationError {
  "message": "User not authenticated",
  "code": "AUTHENTICATION_REQUIRED",
  "statusCode": 401,
  "name": "AuthenticationError",
}

[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m140:7[22m[39m
    [90m138| [39m      })[33m;[39m
    [90m139| [39m
    [90m140| [39m      [35mawait[39m [34mexpect[39m([34mgetCurrentUserWithRole[39m())[33m.[39mrejects[33m.[39m[34mtoThrow[39m(
    [90m   | [39m      [31m^[39m
    [90m141| [39m        [33mAuthenticationError[39m
    [90m142| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[226/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mgetCurrentUserWithRole[2m > [22mshould throw RoleNotFoundError if user role not found in database
[31m[1mAssertionError[22m: expected error to be instance of RoleNotFoundError[39m

[32m- Expected:[39m 
[Function RoleNotFoundError]

[31m+ Received:[39m 
AuthenticationError {
  "message": "User not authenticated",
  "code": "AUTHENTICATION_REQUIRED",
  "statusCode": 401,
  "name": "AuthenticationError",
}

[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m152:7[22m[39m
    [90m150| [39m      [34mmockSupabaseFrom[39m([32m"users"[39m[33m,[39m [35mnull[39m[33m,[39m [35mnew[39m [33mError[39m([32m"User not found"[39m))[33m;[39m
    [90m151| [39m
    [90m152| [39m      await expect(getCurrentUserWithRole()).rejects.toThrow(RoleNotFoâ€¦
    [90m   | [39m      [31m^[39m
    [90m153| [39m    })[33m;[39m
    [90m154| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[227/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mgetCurrentUserWithRole[2m > [22mshould get role for admin user
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m Module.getCurrentUserWithRole server/src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m159:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[228/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mgetCurrentUserWithRole[2m > [22mshould get role for mahasiswa user
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m Module.getCurrentUserWithRole server/src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m168:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[229/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mgetCurrentDosenId[2m > [22mshould return dosen ID for dosen user
[31m[1mAssertionError[22m: expected null to be 'dosen-456' // Object.is equality[39m

[32m- Expected:[39m 
"dosen-456"

[31m+ Received:[39m 
null

[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m185:22[22m[39m
    [90m183| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetCurrentDosenId[39m()[33m;[39m
    [90m184| [39m
    [90m185| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBe[39m([32m"dosen-456"[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m186| [39m    })[33m;[39m
    [90m187| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[230/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mgetCurrentMahasiswaId[2m > [22mshould return mahasiswa ID for mahasiswa user
[31m[1mAssertionError[22m: expected null to be 'mhs-456' // Object.is equality[39m

[32m- Expected:[39m 
"mhs-456"

[31m+ Received:[39m 
null

[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m217:22[22m[39m
    [90m215| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mgetCurrentMahasiswaId[39m()[33m;[39m
    [90m216| [39m
    [90m217| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBe[39m([32m"mhs-456"[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m218| [39m    })[33m;[39m
    [90m219| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[231/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mcheckPermission[2m > [22mshould allow admin to bypass permission check
[31m[1mAssertionError[22m: promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m239:50[22m[39m
    [90m237| [39m      [34mmockSupabaseFrom[39m([32m"users"[39m[33m,[39m { role[33m:[39m [32m"admin"[39m })[33m;[39m
    [90m238| [39m
    [90m239| [39m      await expect(checkPermission("create:kuis")).resolves.not.toThroâ€¦
    [90m   | [39m                                                 [31m^[39m
    [90m240| [39m    })[33m;[39m
    [90m241| [39m

[31m[1mCaused by: AuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole server/src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
[90m [2mâ¯[22m Module.checkPermission server/src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m239:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'AUTHENTICATION_REQUIRED', statusCode: 401, toUserMessage: 'Function<toUserMessage>' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[232/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mcheckPermission[2m > [22mshould allow user with permission
[31m[1mAssertionError[22m: promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m247:50[22m[39m
    [90m245| [39m      (mockedHasPermission [35mas[39m any)[33m.[39m[34mmockReturnValue[39m([35mtrue[39m)[33m;[39m
    [90m246| [39m
    [90m247| [39m      await expect(checkPermission("create:kuis")).resolves.not.toThroâ€¦
    [90m   | [39m                                                 [31m^[39m
    [90m248| [39m
    [90m249| [39m      expect(mockedHasPermission).toHaveBeenCalledWith("dosen", "creatâ€¦

[31m[1mCaused by: AuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole server/src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
[90m [2mâ¯[22m Module.checkPermission server/src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m247:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'AUTHENTICATION_REQUIRED', statusCode: 401, toUserMessage: 'Function<toUserMessage>' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[233/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mcheckPermission[2m > [22mshould throw PermissionError if user lacks permission
[31m[1mAssertionError[22m: expected error to be instance of PermissionError[39m

[32m- Expected:[39m 
[Function PermissionError]

[31m+ Received:[39m 
AuthenticationError {
  "message": "User not authenticated",
  "code": "AUTHENTICATION_REQUIRED",
  "statusCode": 401,
  "name": "AuthenticationError",
}

[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m257:7[22m[39m
    [90m255| [39m      (mockedHasPermission [35mas[39m any)[33m.[39m[34mmockReturnValue[39m([35mfalse[39m)[33m;[39m
    [90m256| [39m
    [90m257| [39m      [35mawait[39m [34mexpect[39m([34mcheckPermission[39m([32m"create:kuis"[39m))[33m.[39mrejects[33m.[39m[34mtoThrow[39m(
    [90m   | [39m      [31m^[39m
    [90m258| [39m        [33mPermissionError[39m
    [90m259| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[234/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mcheckPermission[2m > [22mshould include role in error message
[31m[1mAssertionError[22m: expected AuthenticationError: User not authenticatâ€¦ { â€¦(2) } to be an instance of PermissionError[39m
[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m273:23[22m[39m
    [90m271| [39m        [35mawait[39m [34mcheckPermission[39m([32m"manage:user"[39m)[33m;[39m
    [90m272| [39m      } [35mcatch[39m (error) {
    [90m273| [39m        [34mexpect[39m(error)[33m.[39m[34mtoBeInstanceOf[39m([33mPermissionError[39m)[33m;[39m
    [90m   | [39m                      [31m^[39m
    [90m274| [39m        expect((error as PermissionError).permission).toBe("manage:useâ€¦
    [90m275| [39m        [34mexpect[39m((error [35mas[39m [33mPermissionError[39m)[33m.[39muserRole)[33m.[39m[34mtoBe[39m([32m"mahasiswa"[39m)[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[235/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mrequirePermission[2m > [22mshould execute function if permission granted
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole server/src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission server/src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m server/src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m295:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[236/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mrequirePermission[2m > [22mshould not execute function if permission denied
[31m[1mAssertionError[22m: expected error to be instance of PermissionError[39m

[32m- Expected:[39m 
[Function PermissionError]

[31m+ Received:[39m 
AuthenticationError {
  "message": "User not authenticated",
  "code": "AUTHENTICATION_REQUIRED",
  "statusCode": 401,
  "name": "AuthenticationError",
}

[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m309:7[22m[39m
    [90m307| [39m      [35mconst[39m wrappedFn [33m=[39m [34mrequirePermission[39m([32m"create:kuis"[39m[33m,[39m mockFn)[33m;[39m
    [90m308| [39m
    [90m309| [39m      [35mawait[39m [34mexpect[39m([34mwrappedFn[39m({ judul[33m:[39m [32m"Test"[39m }))[33m.[39mrejects[33m.[39m[34mtoThrow[39m(
    [90m   | [39m      [31m^[39m
    [90m310| [39m        [33mPermissionError[39m
    [90m311| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[237/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mrequirePermission[2m > [22mshould pass arguments to wrapped function
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole server/src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission server/src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m server/src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m322:22[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[238/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mrequirePermission[2m > [22mshould allow admin bypass
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole server/src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission server/src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m server/src/lib/middleware/permission.middleware.ts:[2m279:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m335:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[239/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mrequireOwnership[2m > [22mshould allow admin bypass by default
[31m[1mAssertionError[22m: promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m356:7[22m[39m
    [90m354| [39m          ownerField[33m:[39m [32m"dosen_id"[39m[33m,[39m
    [90m355| [39m        })
    [90m356| [39m      )[33m.[39mresolves[33m.[39mnot[33m.[39m[34mtoThrow[39m()[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m357| [39m    })[33m;[39m
    [90m358| [39m

[31m[1mCaused by: AuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole server/src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
[90m [2mâ¯[22m Module.requireOwnership server/src/lib/middleware/permission.middleware.ts:[2m371:16[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m350:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'AUTHENTICATION_REQUIRED', statusCode: 401, toUserMessage: 'Function<toUserMessage>' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[240/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mrequireOwnership[2m > [22mshould allow owner to access their resource (user_id)
[31m[1mAssertionError[22m: promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m398:7[22m[39m
    [90m396| [39m          ownerField[33m:[39m [32m"user_id"[39m[33m,[39m
    [90m397| [39m        })
    [90m398| [39m      )[33m.[39mresolves[33m.[39mnot[33m.[39m[34mtoThrow[39m()[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m399| [39m    })[33m;[39m
    [90m400| [39m

[31m[1mCaused by: AuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole server/src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
[90m [2mâ¯[22m Module.requireOwnership server/src/lib/middleware/permission.middleware.ts:[2m371:16[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m392:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'AUTHENTICATION_REQUIRED', statusCode: 401, toUserMessage: 'Function<toUserMessage>' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[241/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mrequireOwnership[2m > [22mshould allow dosen to access their own kuis
[31m[1mAssertionError[22m: promise rejected "AuthenticationError: User not authenticatâ€¦ { â€¦(2) }" instead of resolving[39m
[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m451:7[22m[39m
    [90m449| [39m          ownerField[33m:[39m [32m"dosen_id"[39m[33m,[39m
    [90m450| [39m        })
    [90m451| [39m      )[33m.[39mresolves[33m.[39mnot[33m.[39m[34mtoThrow[39m()[33m;[39m
    [90m   | [39m      [31m^[39m
    [90m452| [39m    })[33m;[39m
    [90m453| [39m

[31m[1mCaused by: AuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole server/src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
[90m [2mâ¯[22m Module.requireOwnership server/src/lib/middleware/permission.middleware.ts:[2m371:16[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m445:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'AUTHENTICATION_REQUIRED', statusCode: 401, toUserMessage: 'Function<toUserMessage>' }[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[242/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mrequireOwnership[2m > [22mshould throw OwnershipError if not owner
[31m[1mAssertionError[22m: expected error to be instance of OwnershipError[39m

[32m- Expected:[39m 
[Function OwnershipError]

[31m+ Received:[39m 
AuthenticationError {
  "message": "User not authenticated",
  "code": "AUTHENTICATION_REQUIRED",
  "statusCode": 401,
  "name": "AuthenticationError",
}

[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m495:7[22m[39m
    [90m493| [39m      })[33m;[39m
    [90m494| [39m
    [90m495| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m496| [39m        [34mrequireOwnership[39m({
    [90m497| [39m          table[33m:[39m [32m"jawaban"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[243/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mrequireOwnership[2m > [22mshould throw error if resource not found
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Resource not found' but got 'User not authenticated'[39m

Expected: [32m"[7mResource not foun[27md"[39m
Received: [31m"[7mUser not authenticate[27md"[39m

[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m528:7[22m[39m
    [90m526| [39m      })[33m;[39m
    [90m527| [39m
    [90m528| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m529| [39m        [34mrequireOwnership[39m({
    [90m530| [39m          table[33m:[39m [32m"kuis"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[244/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mrequireOwnership[2m > [22mshould respect allowAdmin option
[31m[1mAssertionError[22m: expected error to be instance of OwnershipError[39m

[32m- Expected:[39m 
[Function OwnershipError]

[31m+ Received:[39m 
AuthenticationError {
  "message": "User not authenticated",
  "code": "AUTHENTICATION_REQUIRED",
  "statusCode": 401,
  "name": "AuthenticationError",
}

[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m570:7[22m[39m
    [90m568| [39m
    [90m569| [39m      // With allowAdmin: false, admin should NOT bypass and should faâ€¦
    [90m570| [39m      [35mawait[39m [34mexpect[39m(
    [90m   | [39m      [31m^[39m
    [90m571| [39m        [34mrequireOwnership[39m({
    [90m572| [39m          table[33m:[39m [32m"kuis"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[245/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mrequirePermissionAndOwnership[2m > [22mshould check both permission and ownership
[31m[1mAuthenticationError[22m: User not authenticated[39m
[36m [2mâ¯[22m getCurrentUserWithRole server/src/lib/middleware/permission.middleware.ts:[2m108:11[22m[39m
    [90m106| [39m
    [90m107| [39m  [35mif[39m (authError [33m||[39m [33m![39muser) {
    [90m108| [39m    [35mthrow[39m [35mnew[39m [33mAuthenticationError[39m([32m"User not authenticated"[39m)[33m;[39m
    [90m   | [39m          [31m^[39m
    [90m109| [39m  }
    [90m110| [39m
[90m [2mâ¯[22m checkPermission server/src/lib/middleware/permission.middleware.ts:[2m231:16[22m[39m
[90m [2mâ¯[22m server/src/lib/middleware/permission.middleware.ts:[2m475:5[22m[39m
[90m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m638:7[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[246/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mrequirePermissionAndOwnership[2m > [22mshould fail if permission denied
[31m[1mAssertionError[22m: expected error to be instance of PermissionError[39m

[32m- Expected:[39m 
[Function PermissionError]

[31m+ Received:[39m 
AuthenticationError {
  "message": "User not authenticated",
  "code": "AUTHENTICATION_REQUIRED",
  "statusCode": 401,
  "name": "AuthenticationError",
}

[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m656:7[22m[39m
    [90m654| [39m      )[33m;[39m
    [90m655| [39m
    [90m656| [39m      await expect(wrappedFn("kuis-123")).rejects.toThrow(PermissionErâ€¦
    [90m   | [39m      [31m^[39m
    [90m657| [39m      [34mexpect[39m(mockFn)[33m.[39mnot[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m658| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[247/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mrequirePermissionAndOwnership[2m > [22mshould fail if ownership denied
[31m[1mAssertionError[22m: expected error to be instance of OwnershipError[39m

[32m- Expected:[39m 
[Function OwnershipError]

[31m+ Received:[39m 
AuthenticationError {
  "message": "User not authenticated",
  "code": "AUTHENTICATION_REQUIRED",
  "statusCode": 401,
  "name": "AuthenticationError",
}

[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m710:7[22m[39m
    [90m708| [39m      )[33m;[39m
    [90m709| [39m
    [90m710| [39m      await expect(wrappedFn("kuis-456")).rejects.toThrow(OwnershipErrâ€¦
    [90m   | [39m      [31m^[39m
    [90m711| [39m      [34mexpect[39m(mockFn)[33m.[39mnot[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m712| [39m    })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[248/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22misCurrentUserAdmin[2m > [22mshould return true for admin user
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m726:22[22m[39m
    [90m724| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34misCurrentUserAdmin[39m()[33m;[39m
    [90m725| [39m
    [90m726| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m727| [39m    })[33m;[39m
    [90m728| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[249/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/middleware/permission.middleware.test.ts[2m > [22mPermission Middleware[2m > [22mhasRole[2m > [22mshould return true if user has specified role
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m server/src/__tests__/unit/middleware/permission.middleware.test.ts:[2m754:22[22m[39m
    [90m752| [39m      [35mconst[39m result [33m=[39m [35mawait[39m [34mhasRole[39m([32m"dosen"[39m)[33m;[39m
    [90m753| [39m
    [90m754| [39m      [34mexpect[39m(result)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m755| [39m    })[33m;[39m
    [90m756| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[250/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22minitStorage[2m > [22mshould initialize IndexedDB successfully
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ Array(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m136:27[22m[39m
    [90m134| [39m
    [90m135| [39m      [34mexpect[39m(indexedDBManager[33m.[39minitialize)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m136| [39m      [34mexpect[39m(logger[33m.[39minfo)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                          [31m^[39m
    [90m137| [39m        [32m"Storage systems initialized successfully"[39m
    [90m138| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[251/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22minitStorage[2m > [22mshould warn if localStorage is not available
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'localStorage is not available' ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m148:27[22m[39m
    [90m146| [39m      [35mawait[39m [34minitStorage[39m()[33m;[39m
    [90m147| [39m
    [90m148| [39m      expect(logger.warn).toHaveBeenCalledWith("localStorage is not avâ€¦
    [90m   | [39m                          [31m^[39m
    [90m149| [39m
    [90m150| [39m      global[33m.[39mlocalStorage [33m=[39m originalLocalStorage[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[252/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22minitStorage[2m > [22mshould handle initialization errors
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ â€¦(2) ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m159:28[22m[39m
    [90m157| [39m
    [90m158| [39m      [35mawait[39m [34mexpect[39m([34minitStorage[39m())[33m.[39mrejects[33m.[39m[34mtoThrow[39m([32m"Init error"[39m)[33m;[39m
    [90m159| [39m      [34mexpect[39m(logger[33m.[39merror)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                           [31m^[39m
    [90m160| [39m        [32m"Failed to initialize storage:"[39m[33m,[39m
    [90m161| [39m        expect[33m.[39m[34many[39m([33mError[39m)

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[253/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mgetItem[2m > [22mwith ID (IndexedDB)[2m > [22mshould handle IndexedDB read errors
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'Failed to get item users:', â€¦(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m194:30[22m[39m
    [90m192| [39m
    [90m193| [39m        [34mexpect[39m(result)[33m.[39m[34mtoBeUndefined[39m()[33m;[39m
    [90m194| [39m        [34mexpect[39m(logger[33m.[39merror)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                             [31m^[39m
    [90m195| [39m          [32m"Failed to get item users:"[39m[33m,[39m
    [90m196| [39m          expect[33m.[39m[34many[39m([33mError[39m)

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[254/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mgetItem[2m > [22mwithout ID (localStorage)[2m > [22mshould get JSON object from localStorage
[31m[1mAssertionError[22m: expected undefined to deeply equal { id: 1, name: 'Test' }[39m

[32m- Expected:[39m 
{
  "id": 1,
  "name": "Test",
}

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m208:24[22m[39m
    [90m206| [39m        const result = await getItem<{ id: number; name: string }>("teâ€¦
    [90m207| [39m
    [90m208| [39m        [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m(data)[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m209| [39m        expect(localStorageMock.getItem).toHaveBeenCalledWith("test-keâ€¦
    [90m210| [39m      })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[255/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mgetItem[2m > [22mwithout ID (localStorage)[2m > [22mshould get string from localStorage
[31m[1mAssertionError[22m: expected undefined to be 'simple-string' // Object.is equality[39m

[32m- Expected:[39m 
"simple-string"

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m217:24[22m[39m
    [90m215| [39m        [35mconst[39m result [33m=[39m [35mawait[39m getItem[33m<[39mstring[33m>[39m([32m"string-key"[39m)[33m;[39m
    [90m216| [39m
    [90m217| [39m        [34mexpect[39m(result)[33m.[39m[34mtoBe[39m([32m"simple-string"[39m)[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m218| [39m      })[33m;[39m
    [90m219| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[256/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mgetItem[2m > [22mwithout ID (localStorage)[2m > [22mshould handle invalid JSON gracefully
[31m[1mAssertionError[22m: expected undefined to be 'invalid-json{' // Object.is equality[39m

[32m- Expected:[39m 
"invalid-json{"

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m234:24[22m[39m
    [90m232| [39m
    [90m233| [39m        [90m// Should return as string when JSON parsing fails[39m
    [90m234| [39m        [34mexpect[39m(result)[33m.[39m[34mtoBe[39m([32m"invalid-json{"[39m)[33m;[39m
    [90m   | [39m                       [31m^[39m
    [90m235| [39m      })[33m;[39m
    [90m236| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[257/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mgetItem[2m > [22mwithout ID (localStorage)[2m > [22mshould handle localStorage errors
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ â€¦(2) ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m245:30[22m[39m
    [90m243| [39m
    [90m244| [39m        [34mexpect[39m(result)[33m.[39m[34mtoBeUndefined[39m()[33m;[39m
    [90m245| [39m        [34mexpect[39m(logger[33m.[39merror)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                             [31m^[39m
    [90m246| [39m          [32m"Failed to get item error-key:"[39m[33m,[39m
    [90m247| [39m          expect[33m.[39m[34many[39m([33mError[39m)

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[258/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22msetItem[2m > [22mshould store string in localStorage
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'setItem')[39m
[36m [2mâ¯[22m Module.setItem server/src/lib/offline/storage-manager.ts:[2m83:18[22m[39m
    [90m 81| [39m    [35mconst[39m serialized [33m=[39m
    [90m 82| [39m      [35mtypeof[39m value [33m===[39m [32m"string"[39m [33m?[39m value [33m:[39m [33mJSON[39m[33m.[39m[34mstringify[39m(value)[33m;[39m
    [90m 83| [39m    localStorage[33m.[39m[34msetItem[39m(key[33m,[39m serialized)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m 84| [39m  } [35mcatch[39m (error) {
    [90m 85| [39m    logger[33m.[39m[34merror[39m([32m`Failed to set item [39m[36m${[39mkey[36m}[39m[32m:`[39m[33m,[39m error)[33m;[39m
[90m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m255:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[259/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22msetItem[2m > [22mshould serialize and store object in localStorage
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'setItem')[39m
[36m [2mâ¯[22m Module.setItem server/src/lib/offline/storage-manager.ts:[2m83:18[22m[39m
    [90m 81| [39m    [35mconst[39m serialized [33m=[39m
    [90m 82| [39m      [35mtypeof[39m value [33m===[39m [32m"string"[39m [33m?[39m value [33m:[39m [33mJSON[39m[33m.[39m[34mstringify[39m(value)[33m;[39m
    [90m 83| [39m    localStorage[33m.[39m[34msetItem[39m(key[33m,[39m serialized)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m 84| [39m  } [35mcatch[39m (error) {
    [90m 85| [39m    logger[33m.[39m[34merror[39m([32m`Failed to set item [39m[36m${[39mkey[36m}[39m[32m:`[39m[33m,[39m error)[33m;[39m
[90m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m266:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[260/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22msetItem[2m > [22mshould serialize and store array in localStorage
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'setItem')[39m
[36m [2mâ¯[22m Module.setItem server/src/lib/offline/storage-manager.ts:[2m83:18[22m[39m
    [90m 81| [39m    [35mconst[39m serialized [33m=[39m
    [90m 82| [39m      [35mtypeof[39m value [33m===[39m [32m"string"[39m [33m?[39m value [33m:[39m [33mJSON[39m[33m.[39m[34mstringify[39m(value)[33m;[39m
    [90m 83| [39m    localStorage[33m.[39m[34msetItem[39m(key[33m,[39m serialized)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m 84| [39m  } [35mcatch[39m (error) {
    [90m 85| [39m    logger[33m.[39m[34merror[39m([32m`Failed to set item [39m[36m${[39mkey[36m}[39m[32m:`[39m[33m,[39m error)[33m;[39m
[90m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m277:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[261/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22msetItem[2m > [22mshould store number in localStorage
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'setItem')[39m
[36m [2mâ¯[22m Module.setItem server/src/lib/offline/storage-manager.ts:[2m83:18[22m[39m
    [90m 81| [39m    [35mconst[39m serialized [33m=[39m
    [90m 82| [39m      [35mtypeof[39m value [33m===[39m [32m"string"[39m [33m?[39m value [33m:[39m [33mJSON[39m[33m.[39m[34mstringify[39m(value)[33m;[39m
    [90m 83| [39m    localStorage[33m.[39m[34msetItem[39m(key[33m,[39m serialized)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m 84| [39m  } [35mcatch[39m (error) {
    [90m 85| [39m    logger[33m.[39m[34merror[39m([32m`Failed to set item [39m[36m${[39mkey[36m}[39m[32m:`[39m[33m,[39m error)[33m;[39m
[90m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m286:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[262/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22msetItem[2m > [22mshould store boolean in localStorage
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'setItem')[39m
[36m [2mâ¯[22m Module.setItem server/src/lib/offline/storage-manager.ts:[2m83:18[22m[39m
    [90m 81| [39m    [35mconst[39m serialized [33m=[39m
    [90m 82| [39m      [35mtypeof[39m value [33m===[39m [32m"string"[39m [33m?[39m value [33m:[39m [33mJSON[39m[33m.[39m[34mstringify[39m(value)[33m;[39m
    [90m 83| [39m    localStorage[33m.[39m[34msetItem[39m(key[33m,[39m serialized)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m 84| [39m  } [35mcatch[39m (error) {
    [90m 85| [39m    logger[33m.[39m[34merror[39m([32m`Failed to set item [39m[36m${[39mkey[36m}[39m[32m:`[39m[33m,[39m error)[33m;[39m
[90m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m292:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[263/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22msetItem[2m > [22mshould handle storage quota errors
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Quota exceeded' but got 'Cannot read properties of undefined (â€¦'[39m

Expected: [32m"Quota exceeded"[39m
Received: [31m"Cannot read properties of undefined (reading 'setItem')"[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[264/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mremoveItem[2m > [22mshould remove item from localStorage
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'removeItem')[39m
[36m [2mâ¯[22m Module.removeItem server/src/lib/offline/storage-manager.ts:[2m99:18[22m[39m
    [90m 97| [39m[35mexport[39m [35masync[39m [35mfunction[39m [34mremoveItem[39m(key[33m:[39m string)[33m:[39m [33mPromise[39m[33m<[39m[35mvoid[39m[33m>[39m {
    [90m 98| [39m  [35mtry[39m {
    [90m 99| [39m    localStorage[33m.[39m[34mremoveItem[39m(key)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m100| [39m  } [35mcatch[39m (error) {
    [90m101| [39m    logger[33m.[39m[34merror[39m([32m`Failed to remove item [39m[36m${[39mkey[36m}[39m[32m:`[39m[33m,[39m error)[33m;[39m
[90m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m312:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[265/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mremoveItem[2m > [22mshould handle removal errors
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Remove error' but got 'Cannot read properties of undefined (â€¦'[39m

Expected: [32m"Remove error"[39m
Received: [31m"Cannot read properties of undefined (reading 'removeItem')"[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[266/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mclear[2m > [22mshould clear both localStorage and IndexedDB
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'clear')[39m
[36m [2mâ¯[22m Module.clear server/src/lib/offline/storage-manager.ts:[2m114:18[22m[39m
    [90m112| [39m  [35mtry[39m {
    [90m113| [39m    [90m// Clear localStorage[39m
    [90m114| [39m    localStorage[33m.[39m[34mclear[39m()[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m115| [39m
    [90m116| [39m    [90m// Clear IndexedDB[39m
[90m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m332:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[267/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mclear[2m > [22mshould handle clear errors
[31m[1mAssertionError[22m: expected [Function] to throw error including 'Clear error' but got 'Cannot read properties of undefined (â€¦'[39m

Expected: [32m"C[7mlear error[27m"[39m
Received: [31m"C[7mannot read properties of undefined (reading 'clear')[27m"[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[268/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mclear[2m > [22mshould call localStorage.clear before IndexedDB
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'clear')[39m
[36m [2mâ¯[22m Module.clear server/src/lib/offline/storage-manager.ts:[2m114:18[22m[39m
    [90m112| [39m  [35mtry[39m {
    [90m113| [39m    [90m// Clear localStorage[39m
    [90m114| [39m    localStorage[33m.[39m[34mclear[39m()[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m115| [39m
    [90m116| [39m    [90m// Clear IndexedDB[39m
[90m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m362:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[269/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22misStorageAvailable[2m > [22mshould return true when both storages are available
[31m[1mAssertionError[22m: expected false to be true // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

[36m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m374:27[22m[39m
    [90m372| [39m      [35mconst[39m isAvailable [33m=[39m [34misStorageAvailable[39m()[33m;[39m
    [90m373| [39m
    [90m374| [39m      [34mexpect[39m(isAvailable)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m   | [39m                          [31m^[39m
    [90m375| [39m      [34mexpect[39m(localStorageMock[33m.[39msetItem)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m376| [39m        [32m"__storage_test__"[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[270/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mgetStorageInfo[2m > [22mshould return storage usage information
[31m[1mTypeError[22m: Object.defineProperty called on non-object[39m
[36m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m406:14[22m[39m
    [90m404| [39m    [34mit[39m([32m"should return storage usage information"[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m405| [39m      [90m// Mock localStorage with some data[39m
    [90m406| [39m      [33mObject[39m[33m.[39m[34mdefineProperty[39m(localStorage[33m,[39m [32m"key1"[39m[33m,[39m {
    [90m   | [39m             [31m^[39m
    [90m407| [39m        value[33m:[39m [32m"value1"[39m[33m,[39m
    [90m408| [39m        enumerable[33m:[39m [35mtrue[39m[33m,[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[271/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mgetStorageInfo[2m > [22mshould handle empty localStorage
[31m[1mTypeError[22m: Cannot convert undefined or null to object[39m
[36m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m460:14[22m[39m
    [90m458| [39m        [32m"_setStore"[39m[33m,[39m
    [90m459| [39m      ][33m;[39m
    [90m460| [39m      [33mObject[39m[33m.[39m[34mkeys[39m(localStorage)[33m.[39m[34mforEach[39m((key) [33m=>[39m {
    [90m   | [39m             [31m^[39m
    [90m461| [39m        [35mif[39m ([33m![39mbuiltInMethods[33m.[39m[34mincludes[39m(key)) {
    [90m462| [39m          [35mdelete[39m (localStorage [35mas[39m any)[key][33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[272/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mgetStorageInfo[2m > [22mshould handle errors getting storage info
[31m[1mAssertionError[22m: expected "spy" to be called with arguments: [ 'Failed to get storage info:', â€¦(1) ][90m

Number of calls: [1m0[22m
[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m486:28[22m[39m
    [90m484| [39m
    [90m485| [39m      [35mawait[39m [34mexpect[39m([34mgetStorageInfo[39m())[33m.[39mrejects[33m.[39m[34mtoThrow[39m([32m"Info error"[39m)[33m;[39m
    [90m486| [39m      [34mexpect[39m(logger[33m.[39merror)[33m.[39m[34mtoHaveBeenCalledWith[39m(
    [90m   | [39m                           [31m^[39m
    [90m487| [39m        [32m"Failed to get storage info:"[39m[33m,[39m
    [90m488| [39m        expect[33m.[39m[34many[39m([33mError[39m)

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[273/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mgetStorageInfo[2m > [22mshould calculate localStorage size correctly
[31m[1mTypeError[22m: Cannot convert undefined or null to object[39m
[36m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m504:14[22m[39m
    [90m502| [39m        [32m"_setStore"[39m[33m,[39m
    [90m503| [39m      ][33m;[39m
    [90m504| [39m      [33mObject[39m[33m.[39m[34mkeys[39m(localStorage)[33m.[39m[34mforEach[39m((key) [33m=>[39m {
    [90m   | [39m             [31m^[39m
    [90m505| [39m        [35mif[39m ([33m![39mbuiltInMethods[33m.[39m[34mincludes[39m(key)) {
    [90m506| [39m          [35mdelete[39m (localStorage [35mas[39m any)[key][33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[274/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mIntegration[2m > [22mshould work with getItem and setItem together
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'setItem')[39m
[36m [2mâ¯[22m Module.setItem server/src/lib/offline/storage-manager.ts:[2m83:18[22m[39m
    [90m 81| [39m    [35mconst[39m serialized [33m=[39m
    [90m 82| [39m      [35mtypeof[39m value [33m===[39m [32m"string"[39m [33m?[39m value [33m:[39m [33mJSON[39m[33m.[39m[34mstringify[39m(value)[33m;[39m
    [90m 83| [39m    localStorage[33m.[39m[34msetItem[39m(key[33m,[39m serialized)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m 84| [39m  } [35mcatch[39m (error) {
    [90m 85| [39m    logger[33m.[39m[34merror[39m([32m`Failed to set item [39m[36m${[39mkey[36m}[39m[32m:`[39m[33m,[39m error)[33m;[39m
[90m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m548:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[275/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mIntegration[2m > [22mshould work with setItem and removeItem together
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'setItem')[39m
[36m [2mâ¯[22m Module.setItem server/src/lib/offline/storage-manager.ts:[2m83:18[22m[39m
    [90m 81| [39m    [35mconst[39m serialized [33m=[39m
    [90m 82| [39m      [35mtypeof[39m value [33m===[39m [32m"string"[39m [33m?[39m value [33m:[39m [33mJSON[39m[33m.[39m[34mstringify[39m(value)[33m;[39m
    [90m 83| [39m    localStorage[33m.[39m[34msetItem[39m(key[33m,[39m serialized)[33m;[39m
    [90m   | [39m                 [31m^[39m
    [90m 84| [39m  } [35mcatch[39m (error) {
    [90m 85| [39m    logger[33m.[39m[34merror[39m([32m`Failed to set item [39m[36m${[39mkey[36m}[39m[32m:`[39m[33m,[39m error)[33m;[39m
[90m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m558:13[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[276/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/offline/storage-manager.test.ts[2m > [22mStorage Manager[2m > [22mType Safety[2m > [22mshould preserve type information for getItem
[31m[1mAssertionError[22m: expected undefined to deeply equal { id: 1, name: 'Test User', â€¦(1) }[39m

[32m- Expected:[39m 
{
  "email": "test@example.com",
  "id": 1,
  "name": "Test User",
}

[31m+ Received:[39m 
undefined

[36m [2mâ¯[22m server/src/__tests__/unit/offline/storage-manager.test.ts:[2m584:22[22m[39m
    [90m582| [39m      [35mconst[39m result [33m=[39m [35mawait[39m getItem[33m<[39m[33mUser[39m[33m>[39m([32m"user-key"[39m)[33m;[39m
    [90m583| [39m
    [90m584| [39m      [34mexpect[39m(result)[33m.[39m[34mtoEqual[39m(user)[33m;[39m
    [90m   | [39m                     [31m^[39m
    [90m585| [39m      [90m// TypeScript should know result is User | undefined[39m
    [90m586| [39m      [35mif[39m (result) {

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[277/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22mOfflineProvider[2m > [22mInitialization[2m > [22mshould initialize IndexedDB on mount
[31m[1mTypeError[22m: [AsyncFunction initialize] is not a spy or a call to a spy!

Ignored nodes: comments, script, style
[36m<html>[31m
  [36m<head />[31m
  [36m<body>[31m
    [36m<div>[31m
      [36m<div>[31m
        [36m<div[31m
          [33mdata-testid[31m=[32m"status"[31m
        [36m>[31m
          [0monline[0m
        [36m</div>[31m
        [36m<div[31m
          [33mdata-testid[31m=[32m"isOnline"[31m
        [36m>[31m
          [0mtrue[0m
        [36m</div>[31m
        [36m<div[31m
          [33mdata-testid[31m=[32m"isOffline"[31m
        [36m>[31m
          [0mfalse[0m
        [36m</div>[31m
      [36m</div>[31m
    [36m</div>[31m
  [36m</body>[31m
[36m</html>[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/providers/OfflineProvider.test.tsx:[2m94:45[22m[39m
    [90m 92| [39m
    [90m 93| [39m      [35mawait[39m [34mwaitFor[39m(() [33m=>[39m {
    [90m 94| [39m        [34mexpect[39m(indexedDBManager[33m.[39minitialize)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                                            [31m^[39m
    [90m 95| [39m      })[33m;[39m
    [90m 96| [39m    })[33m;[39m
[90m [2mâ¯[22m runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:[2m47:12[22m[39m
[90m [2mâ¯[22m checkCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m124:77[22m[39m
[90m [2mâ¯[22m Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m118:16[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[278/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22mOfflineProvider[2m > [22mInitialization[2m > [22mshould not render children before IndexedDB is ready
[31m[1mTypeError[22m: indexedDBManager.initialize.mockImplementation is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/providers/OfflineProvider.test.tsx:[2m111:44[22m[39m
    [90m109| [39m
    [90m110| [39m    [34mit[39m([32m"should not render children before IndexedDB is ready"[39m[33m,[39m () [33m=>[39m {
    [90m111| [39m      (indexedDBManager[33m.[39minitialize [35mas[39m any)[33m.[39m[34mmockImplementation[39m(
    [90m   | [39m                                           [31m^[39m
    [90m112| [39m        () [33m=>[39m [35mnew[39m [33mPromise[39m(() [33m=>[39m {}) [90m// Never resolves[39m
    [90m113| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[279/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22mOfflineProvider[2m > [22mInitialization[2m > [22mshould log error message when IndexedDB initialization fails
[31m[1mTypeError[22m: indexedDBManager.initialize.mockRejectedValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/providers/OfflineProvider.test.tsx:[2m149:44[22m[39m
    [90m147| [39m        [33m.[39m[34mmockImplementation[39m(() [33m=>[39m {})[33m;[39m
    [90m148| [39m      [35mconst[39m error [33m=[39m [35mnew[39m [33mError[39m([32m"Init failed"[39m)[33m;[39m
    [90m149| [39m      (indexedDBManager[33m.[39minitialize [35mas[39m any)[33m.[39m[34mmockRejectedValue[39m(error)[33m;[39m
    [90m   | [39m                                           [31m^[39m
    [90m150| [39m
    [90m151| [39m      [34mrender[39m(

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[280/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22mOfflineProvider[2m > [22mCleanup[2m > [22mshould cleanup on unmount
[31m[1mTypeError[22m: [AsyncFunction initialize] is not a spy or a call to a spy!

Ignored nodes: comments, script, style
[36m<html>[31m
  [36m<head />[31m
  [36m<body>[31m
    [36m<div>[31m
      [36m<div>[31m
        [36m<div[31m
          [33mdata-testid[31m=[32m"status"[31m
        [36m>[31m
          [0monline[0m
        [36m</div>[31m
        [36m<div[31m
          [33mdata-testid[31m=[32m"isOnline"[31m
        [36m>[31m
          [0mtrue[0m
        [36m</div>[31m
        [36m<div[31m
          [33mdata-testid[31m=[32m"isOffline"[31m
        [36m>[31m
          [0mfalse[0m
        [36m</div>[31m
      [36m</div>[31m
    [36m</div>[31m
  [36m</body>[31m
[36m</html>[31m[39m
[36m [2mâ¯[22m server/src/__tests__/unit/providers/OfflineProvider.test.tsx:[2m285:45[22m[39m
    [90m283| [39m
    [90m284| [39m      [35mawait[39m [34mwaitFor[39m(() [33m=>[39m {
    [90m285| [39m        [34mexpect[39m(indexedDBManager[33m.[39minitialize)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m   | [39m                                            [31m^[39m
    [90m286| [39m      })[33m;[39m
    [90m287| [39m
[90m [2mâ¯[22m runWithExpensiveErrorDiagnosticsDisabled node_modules/@testing-library/dom/dist/config.js:[2m47:12[22m[39m
[90m [2mâ¯[22m checkCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m124:77[22m[39m
[90m [2mâ¯[22m Timeout.checkRealTimersCallback node_modules/@testing-library/dom/dist/wait-for.js:[2m118:16[22m[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[281/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22mOfflineProvider[2m > [22mCleanup[2m > [22mshould not update state after unmount
[31m[1mTypeError[22m: indexedDBManager.initialize.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/providers/OfflineProvider.test.tsx:[2m300:44[22m[39m
    [90m298| [39m      })[33m;[39m
    [90m299| [39m
    [90m300| [39m      (indexedDBManager.initialize as any).mockReturnValue(initPromiseâ€¦
    [90m   | [39m                                           [31m^[39m
    [90m301| [39m
    [90m302| [39m      [35mconst[39m { unmount } [33m=[39m [34mrender[39m(

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[282/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22mOfflineProvider[2m > [22mIntegration[2m > [22mshould initialize only once with multiple children
[31m[1mTypeError[22m: [AsyncFunction initialize] is not a spy or a call to a spy![39m
[36m [2mâ¯[22m server/src/__tests__/unit/providers/OfflineProvider.test.tsx:[2m357:43[22m[39m
    [90m355| [39m      })[33m;[39m
    [90m356| [39m
    [90m357| [39m      [34mexpect[39m(indexedDBManager[33m.[39minitialize)[33m.[39m[34mtoHaveBeenCalledTimes[39m([34m1[39m)[33m;[39m
    [90m   | [39m                                          [31m^[39m
    [90m358| [39m    })[33m;[39m
    [90m359| [39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[283/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22mOfflineProvider[2m > [22mError Handling[2m > [22mshould handle IndexedDB initialization error gracefully
[31m[1mTypeError[22m: indexedDBManager.initialize.mockRejectedValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/providers/OfflineProvider.test.tsx:[2m394:44[22m[39m
    [90m392| [39m        [33m.[39m[34mspyOn[39m(console[33m,[39m [32m"error"[39m)
    [90m393| [39m        [33m.[39m[34mmockImplementation[39m(() [33m=>[39m {})[33m;[39m
    [90m394| [39m      (indexedDBManager[33m.[39minitialize [35mas[39m any)[33m.[39m[34mmockRejectedValue[39m(
    [90m   | [39m                                           [31m^[39m
    [90m395| [39m        [35mnew[39m [33mError[39m([32m"IndexedDB not supported"[39m)
    [90m396| [39m      )[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[284/318]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m server/src/__tests__/unit/providers/OfflineProvider.test.tsx[2m > [22mOfflineProvider[2m > [22mError Handling[2m > [22mshould not throw when initialization takes long time
[31m[1mTypeError[22m: indexedDBManager.initialize.mockReturnValue is not a function[39m
[36m [2mâ¯[22m server/src/__tests__/unit/providers/OfflineProvider.test.tsx:[2m419:44[22m[39m
    [90m417| [39m      })[33m;[39m
    [90m418| [39m
    [90m419| [39m      (indexedDBManager.initialize as any).mockReturnValue(initPromiseâ€¦
    [90m   | [39m                                           [31m^[39m
    [90m420| [39m
    [90m421| [39m      [35mconst[39m { container } [33m=[39m [34mrender[39m(

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[285/318]âŽ¯[22m[39m


[2m Test Files [22m [1m[31m25 failed[39m[22m[2m | [22m[1m[32m117 passed[39m[22m[2m | [22m[33m2 skipped[39m[90m (144)[39m
[2m      Tests [22m [1m[31m317 failed[39m[22m[2m | [22m[1m[32m2989 passed[39m[22m[2m | [22m[33m20 skipped[39m[2m | [22m[90m50 todo[39m[90m (3376)[39m
[2m   Start at [22m 13:28:02
[2m   Duration [22m 503.51s[2m (transform 67.25s, setup 151.09s, collect 141.91s, tests 64.16s, environment 774.37s, prepare 94.57s)[22m

